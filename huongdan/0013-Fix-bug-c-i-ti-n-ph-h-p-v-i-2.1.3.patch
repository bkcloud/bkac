From 20112396614949422ab3f2a1f7b6c1024d393abf Mon Sep 17 00:00:00 2001
From: neittien0110 <neittien0110@gmail.com>
Date: Tue, 15 Jul 2014 20:41:33 +0700
Subject: [PATCH 13/13] =?UTF-8?q?Fix=20bug:=20c=E1=BA=A3i=20ti=E1=BA=BFn?=
 =?UTF-8?q?=20=C4=91=E1=BB=83=20ph=C3=B9=20h=E1=BB=A3p=20v=E1=BB=9Bi=202.1?=
 =?UTF-8?q?.3?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

---
 usr/local/www/carp_status.php                      |    9 +-
 usr/local/www/csrf/csrf-secret.php                 |    1 +
 usr/local/www/dfly-pg.gif                          |  Bin 0 -> 44345 bytes
 usr/local/www/dfuife.css                           |   88 ++
 usr/local/www/dfuife.js                            |   61 ++
 usr/local/www/diag_backup.php                      |    2 +-
 usr/local/www/diag_confbak.php                     |   58 +-
 usr/local/www/diag_dns.php                         |   21 +-
 usr/local/www/diag_limiter_info.php                |    8 +-
 usr/local/www/diag_logs.php                        |    4 +-
 usr/local/www/diag_logs_auth.php                   |   11 +-
 usr/local/www/diag_logs_dhcp.php                   |    9 +-
 usr/local/www/diag_logs_filter.php                 |  134 ++-
 usr/local/www/diag_logs_filter_dynamic.php         |   44 +-
 usr/local/www/diag_logs_filter_summary.php         |   64 +-
 usr/local/www/diag_logs_gateways.php               |    4 +-
 usr/local/www/diag_logs_ipsec.php                  |   10 +-
 usr/local/www/diag_logs_ntpd.php                   |   11 +-
 usr/local/www/diag_logs_openvpn.php                |    8 +-
 usr/local/www/diag_logs_ppp.php                    |    8 +-
 usr/local/www/diag_logs_relayd.php                 |    9 +-
 usr/local/www/diag_logs_resolver.php               |    4 +-
 usr/local/www/diag_logs_routing.php                |    9 +-
 usr/local/www/diag_logs_settings.php               |  150 +--
 usr/local/www/diag_logs_vpn.php                    |   24 +-
 usr/local/www/diag_logs_wireless.php               |    9 +-
 usr/local/www/diag_nanobsd.php                     |   22 +-
 usr/local/www/diag_pf_info.php                     |   10 +-
 usr/local/www/diag_ping.php                        |    2 +-
 usr/local/www/diag_system_activity.php             |    4 +-
 usr/local/www/diag_system_pftop.php                |    8 +-
 usr/local/www/diag_testport.php                    |    2 +-
 usr/local/www/diag_traceroute.php                  |    2 +-
 usr/local/www/edit.php                             |    2 +-
 usr/local/www/exec.php                             |    2 +-
 usr/local/www/firewall_aliases_edit.php            |  274 +++--
 usr/local/www/firewall_aliases_import.php          |   79 +-
 usr/local/www/firewall_nat_1to1.php                |  365 ++-----
 usr/local/www/firewall_nat_npt.php                 |    2 +-
 usr/local/www/firewall_nat_npt_edit.php            |    2 +-
 usr/local/www/firewall_nat_out.php                 |  961 +++++++---------
 usr/local/www/firewall_rules_edit.php              |   29 +-
 usr/local/www/firewall_shaper.php                  |    8 +-
 usr/local/www/firewall_shaper_layer7.php           |    2 +-
 usr/local/www/firewall_shaper_queues.php           |    4 +-
 usr/local/www/firewall_shaper_vinterface.php       |   13 +-
 usr/local/www/firewall_shaper_wizards.php          |    3 +-
 usr/local/www/firewall_virtual_ip.php              |   10 +
 usr/local/www/firewall_virtual_ip_edit.php         |   35 +-
 usr/local/www/fred-bg.gif                          |  Bin 0 -> 47748 bytes
 usr/local/www/graph.php                            |   18 +-
 usr/local/www/graph_cpu.php                        |    2 +-
 usr/local/www/guiconfig.inc                        |   65 +-
 usr/local/www/guiconfig.inc.orig                   | 1145 ++++++++++++++++++++
 usr/local/www/headjs.php                           |    2 +-
 usr/local/www/help.php                             |  570 +++++-----
 usr/local/www/includes/functions.inc.php           |   29 +-
 usr/local/www/interfaces.php                       |  583 +---------
 usr/local/www/interfaces_bridge_edit.php           |    2 +-
 usr/local/www/interfaces_gif_edit.php              |    2 +-
 usr/local/www/interfaces_gre_edit.php              |    7 +-
 usr/local/www/interfaces_groups_edit.php           |    4 +-
 usr/local/www/interfaces_lagg.php                  |    4 +-
 usr/local/www/interfaces_lagg_edit.php             |    6 +-
 usr/local/www/interfaces_ppps_edit.php             |    9 +-
 usr/local/www/interfaces_qinq_edit.php             |    4 +-
 usr/local/www/interfaces_vlan.php                  |    5 +-
 usr/local/www/interfaces_vlan_edit.php             |    8 +-
 usr/local/www/interfaces_wireless_edit.php         |    2 +-
 usr/local/www/javascript/datetimepicker.js         |  486 +++++++++
 usr/local/www/javascript/index/ajax.js             |   35 +-
 .../www/javascript/jquery/jquery-ui.custom.css     |    6 +-
 usr/local/www/javascript/row_helper.js             |    6 +-
 usr/local/www/license.php                          |   86 +-
 usr/local/www/load_balancer_monitor_edit.php       |    2 +-
 usr/local/www/load_balancer_pool_edit.php          |   12 +-
 usr/local/www/load_balancer_relay_action_edit.php  |    2 +-
 .../www/load_balancer_relay_protocol_edit.php      |    2 +-
 usr/local/www/load_balancer_setting.php            |    2 +-
 .../www/load_balancer_virtual_server_edit.php      |   10 +-
 usr/local/www/pkg_edit.php                         |   10 +-
 usr/local/www/pkg_mgr.php                          |  338 +++---
 usr/local/www/services_captiveportal.php           |  101 +-
 .../www/services_captiveportal_filemanager.php     |    4 +-
 usr/local/www/services_captiveportal_hostname.php  |   10 +-
 .../www/services_captiveportal_hostname_edit.php   |    9 +-
 usr/local/www/services_captiveportal_ip.php        |    4 +-
 usr/local/www/services_captiveportal_ip_edit.php   |    7 +-
 usr/local/www/services_captiveportal_mac.php       |  157 ++-
 usr/local/www/services_captiveportal_mac_edit.php  |  208 ++--
 usr/local/www/services_captiveportal_vouchers.php  |   29 +-
 .../www/services_captiveportal_vouchers_edit.php   |    2 +-
 usr/local/www/services_captiveportal_zones.php     |    6 +-
 .../www/services_captiveportal_zones_edit.php      |    2 +-
 usr/local/www/services_dhcp.php                    |   28 +-
 usr/local/www/services_dhcp_edit.php               |   44 +-
 usr/local/www/services_dhcp_relay.php              |    2 +-
 usr/local/www/services_dhcpv6.php                  |   41 +-
 usr/local/www/services_dhcpv6_edit.php             |    2 +-
 usr/local/www/services_dhcpv6_relay.php            |    2 +-
 .../www/services_dnsmasq_domainoverride_edit.php   |    2 +-
 usr/local/www/services_dnsmasq_edit.php            |    4 +-
 usr/local/www/services_dyndns.php                  |   14 +-
 usr/local/www/services_dyndns_edit.php             |   48 +-
 usr/local/www/services_igmpproxy_edit.php          |    4 +-
 usr/local/www/services_rfc2136_edit.php            |    2 +-
 usr/local/www/services_snmp.php                    |   12 +-
 usr/local/www/services_wol_edit.php                |    2 +-
 usr/local/www/status.php                           |    8 +-
 usr/local/www/status_captiveportal.php             |    2 +-
 usr/local/www/status_dhcp_leases.php               |   34 +-
 usr/local/www/status_gateways.php                  |    5 +-
 usr/local/www/status_interfaces.php                |    2 +-
 usr/local/www/status_lb_vs.php                     |    2 +-
 usr/local/www/status_ntpd.php                      |    6 +-
 usr/local/www/status_openvpn.php                   |  177 ++-
 usr/local/www/status_rrd_graph.php                 |   64 +-
 usr/local/www/status_rrd_graph_settings.php        |   18 +-
 usr/local/www/status_services.php                  |   17 +-
 usr/local/www/system.php                           |    5 +-
 usr/local/www/system_advanced_firewall.php         |   39 +-
 usr/local/www/system_advanced_misc.php             |   22 +-
 usr/local/www/system_advanced_network.php          |   22 +-
 usr/local/www/system_advanced_notifications.php    |   36 +-
 usr/local/www/system_advanced_sysctl.php           |    2 +-
 usr/local/www/system_authservers.php               |    6 +-
 usr/local/www/system_camanager.php                 |    3 +-
 usr/local/www/system_certmanager.php               |   39 +-
 usr/local/www/system_crlmanager.php                |    5 +-
 usr/local/www/system_firmware_auto.php.orig        |  279 +++++
 usr/local/www/system_gateway_groups_edit.php       |    2 +-
 usr/local/www/system_gateways.php                  |  423 +++-----
 usr/local/www/system_gateways_edit.php             |   68 +-
 usr/local/www/system_groupmanager.php              |    2 +-
 usr/local/www/system_groupmanager_addprivs.php     |    2 +-
 usr/local/www/system_routes.php                    |  235 +---
 usr/local/www/system_routes_edit.php               |   31 +-
 usr/local/www/system_usermanager.php               |   40 +-
 usr/local/www/system_usermanager_addprivs.php      |    2 +-
 usr/local/www/system_usermanager_passwordmg.php    |   15 +-
 usr/local/www/system_usermanager_settings.php      |  162 +--
 usr/local/www/vpn_ipsec_keys_edit.php              |    2 +-
 usr/local/www/vpn_ipsec_mobile.php                 |    2 +-
 usr/local/www/vpn_ipsec_phase1.php                 |    2 +-
 usr/local/www/vpn_ipsec_phase2.php                 |    2 +-
 usr/local/www/vpn_l2tp.php                         |    2 +-
 usr/local/www/vpn_l2tp_users_edit.php              |    2 +-
 usr/local/www/vpn_openvpn_client.php               |   50 +-
 usr/local/www/vpn_openvpn_csc.php                  |   76 +-
 usr/local/www/vpn_openvpn_server.php               |   96 +-
 usr/local/www/vpn_pppoe_edit.php                   |  624 ++++++-----
 usr/local/www/vpn_pptp.php                         |    4 +-
 usr/local/www/vpn_pptp_users_edit.php              |    2 +-
 .../www/widgets/include/interface_statistics.inc~  |    5 +
 usr/local/www/widgets/include/interfaces.inc~      |    6 +
 usr/local/www/widgets/include/log.inc~             |    6 +
 usr/local/www/widgets/include/services_status.inc~ |    7 +
 .../widgets/captive_portal_status.widget.php       |    4 +-
 .../www/widgets/widgets/carp_status.widget.php     |    7 +-
 .../www/widgets/widgets/dyn_dns_status.widget.php  |    6 +-
 usr/local/www/widgets/widgets/gateways.widget.php  |   33 +-
 .../widgets/widgets/installed_packages.widget.php~ |  123 +++
 .../widgets/interface_statistics.widget.php~       |  214 ++++
 .../www/widgets/widgets/interfaces.widget.php      |   38 +-
 .../widgets/load_balancer_status.widget.php        |    2 +-
 usr/local/www/widgets/widgets/log.widget.php       |   22 +-
 usr/local/www/widgets/widgets/openvpn.widget.php   |    4 +-
 usr/local/www/widgets/widgets/picture.widget.php   |   13 +-
 usr/local/www/widgets/widgets/rss.widget.php       |   36 +-
 .../www/widgets/widgets/services_status.widget.php |   18 +-
 .../widgets/widgets/services_status.widget.php~    |   96 ++
 .../widgets/widgets/system_information.widget.php~ |  297 +++++
 .../www/widgets/widgets/thermal_sensors.widget.php |   58 +-
 .../www/widgets/widgets/traffic_graphs.widget.php  |   27 +-
 .../www/widgets/widgets/wake_on_lan.widget.php     |   10 +-
 usr/local/www/wizards/openvpn_wizard.inc           |   19 -
 usr/local/www/wizards/openvpn_wizard.xml           |   24 +-
 usr/local/www/wizards/setup_wizard.xml             |   30 +-
 usr/local/www/wizards/traffic_shaper_wizard.inc    |   30 +-
 .../wizards/traffic_shaper_wizard_dedicated.inc    |   32 +-
 .../wizards/traffic_shaper_wizard_multi_all.inc    |   32 +-
 .../wizards/traffic_shaper_wizard_multi_lan.inc    |   30 +-
 usr/local/www/xmlrpc.php                           |    5 +-
 183 files changed, 5822 insertions(+), 4862 deletions(-)
 create mode 100644 usr/local/www/csrf/csrf-secret.php
 create mode 100644 usr/local/www/dfly-pg.gif
 create mode 100644 usr/local/www/dfuife.css
 create mode 100644 usr/local/www/dfuife.js
 create mode 100644 usr/local/www/fred-bg.gif
 create mode 100755 usr/local/www/guiconfig.inc.orig
 create mode 100755 usr/local/www/javascript/datetimepicker.js
 create mode 100755 usr/local/www/system_firmware_auto.php.orig
 create mode 100644 usr/local/www/widgets/include/interface_statistics.inc~
 create mode 100644 usr/local/www/widgets/include/interfaces.inc~
 create mode 100644 usr/local/www/widgets/include/log.inc~
 create mode 100644 usr/local/www/widgets/include/services_status.inc~
 create mode 100644 usr/local/www/widgets/widgets/installed_packages.widget.php~
 create mode 100644 usr/local/www/widgets/widgets/interface_statistics.widget.php~
 create mode 100644 usr/local/www/widgets/widgets/services_status.widget.php~
 create mode 100644 usr/local/www/widgets/widgets/system_information.widget.php~

diff --git a/usr/local/www/carp_status.php b/usr/local/www/carp_status.php
index 9967484..9749063 100755
--- a/usr/local/www/carp_status.php
+++ b/usr/local/www/carp_status.php
@@ -75,6 +75,10 @@ if($_POST['disablecarp'] <> "") {
 						interface_carp_configure($vip);
 						sleep(1);
 					break;
+					case "ipalias":
+						if (strstr($vip['interface'], "_vip"))
+							interface_ipalias_configure($vip);
+					break;
                                 }
                         }
                 }
@@ -148,7 +152,8 @@ include("head.inc");
 						$vhid = $carp['vhid'];
 						$advskew = $carp['advskew'];
 						$advbase = $carp['advbase'];
-						$status = get_carp_interface_status("{$carp['interface']}_vip{$carp['vhid']}");
+						$carp_int = "{$carp['interface']}_vip{$vhid}";
+						$status = get_carp_interface_status($carp_int);
 						echo "<tr>";
 						$align = "valign='middle'";
 						if($carp_enabled == false) {
@@ -163,7 +168,7 @@ include("head.inc");
 								$icon = "<img {$align} src='/themes/".$g['theme']."/images/icons/icon_log.gif'>";
 							}
 						}
-						echo "<td class=\"listlr\"><center>" . convert_friendly_interface_to_friendly_descr($carp['interface']) . "@{$vhid} &nbsp;</td>";
+						echo "<td class=\"listlr\"><center>" . $carp_int . "&nbsp;</td>";
 						echo "<td class=\"listlr\"><center>" . $ipaddress . "&nbsp;</td>";
 						echo "<td class=\"listlr\"><center>{$icon}&nbsp;&nbsp;" . $status . "&nbsp;</td>";
 						echo "</tr>";
diff --git a/usr/local/www/csrf/csrf-secret.php b/usr/local/www/csrf/csrf-secret.php
new file mode 100644
index 0000000..dd6b3ca
--- /dev/null
+++ b/usr/local/www/csrf/csrf-secret.php
@@ -0,0 +1 @@
+<?php $secret = "a65365ab47410a77a541527bde813a55b3757857";
diff --git a/usr/local/www/dfly-pg.gif b/usr/local/www/dfly-pg.gif
new file mode 100644
index 0000000000000000000000000000000000000000..ded5f5d29f049300896be061db49f29f339b0d58
GIT binary patch
literal 44345
zcmbr`S5T9C<M#W|L&pXIQL)oSQ3+)UR;q%HYC&`<O+_pe5$Pn<(9(g>lh8sBp(DMk
zh;(Vvdrbm_eFxWi-e>RserNW)dnN}t$RsBT-1ld`*H2gf22}kCghK%|kpyxj?f;l5
z<wX(o$Ugm<a@aR-zkh*vK(117J|w(IIJ8hYr0{fP@t!d1`B17>OsRNO$??b%Wo)G&
zs^VZYO_xw9jQ=7QUvW6LTn<;EnpC|PSMe9N;u^N%Zc42Lw(4d|?I~jY!Q|SraW#7B
zjY3Ja8cB6mlfT?fs<Fsw*_T#pl-hVHv*mbF-II(K<(xK&j7H#P#s%N_irS<o%~wjk
z^5?c{W;9!no2|)>4h3zhMeXwC-}mIV-^gpfRr>u{X3P7$R-62G)0|ejqV`8sKOs5o
zZ%R8g3cuej?>bl4%UAN_YE`#fd8bj)w^s$<-j#M*HT239ef6ew+Liry+Sb3P@H@P=
zTd(=ozLL&Q<(;n8-R4cb>Xkp78+xzQ_S|V3IQ8`xq;23_P4APg5uWm&fek%&wY^TY
zJs)a%KeheRYaTRf`DNTSD)Xf~{Oj=LFa7?#<9oZt&NTG}G!MS}F{V+|hiUuu>g&*x
zfhoxFEU0(%`qyE*mZ4AGqc@ue!@EcCca1(6{C#O+hIedAx_L0MWeEL!?Ct2Z;`fn&
z!Abp|(RbfQLPw^d{S%hmqaV9Qy$2`nd>_WP4rh!^U!7Ul+dpa3J8AcIG_7+qac1Fk
z--Kt+7;0%1)HM+?H0eAz={7cJ+&xNKSe6=_Gas3I+&Na*KNZ+J6*{?~Kf84C=R`{X
zBz9)$a?g0~)ZCNt+1C?uwo^-YN2bI3rxQo!{JJJ92PU(|=Us+pkYn?nD{CqP(}i<O
ze~(O)`)114R&}T612)z!t*)BPEWi6bk6m6hA6+2Kue@4bwVqk=7@esYo~fN#3?Ex4
zm{~}iUk;jDAWbY}56!i%tlQ75pq4kBmskBa)||%{8dul67MJ5U*4-!P+h-Qb=T<Tn
zSJP(K@>l8M%XH+-O8v~zx7GEemDK{q25NexcX6eiPLE$%FI#1#&#v_|=y@xQx|NM@
z%WGo{X2~+WXN%d$WVSCe=IM+P#@0{z*39PCZ`Rf?#ulBmy~^6zI=Ulx>-xRBS1+4f
zKc}q1#Q_3=jxxA;L_y*pMc_Gz{WAf9S)d($X*~*|$``y({y_sJ;Y*;{aRa<wPGW5^
z&!$~}LrzkCIO|G~w0>@KW0dS&@`J|QlxCF5U3;w_<7cgyQ)=TG`l=_|aXK$p`<Xe!
zy3ZSt@(-KxNq0Y)BpJjS6p(+Uo9EdNG!>-(%(jlQxi7Hx=w6!bck;vLi&NTePNPk+
zhDFL1C7X-mzl*Z7AD4ezndg};q6~k5?NfLZl6|)PQ}`jnIHTg+-_2-MhrtlzxKSG6
zYVhHkwAG4t#JlN_T50dge^Q<{$KAvond{4+s!gr`sP=k*;k9%4Rw;F9v>{62aa$?l
zjZ5i(e*CR6+S(L(pkT1A?Bn$3@71ipg&XCijFrj8KCAZfvdxXf(dKyL&z@TAOUv2q
z?T<h2?0|S>hdxge_ZfSGPZ5WFgf33X`2M~oJM6dL)OOhacL-`QKpLyos@>uzI|4f%
zP#@y@-48Z$el6czR7<70;a13O3uH7{d1UgK7PPM6Y4{~xxiQ2wak~={V+bzeNPXqT
zu_%)pa=)YRncDr1=~2O)RPT8=^&4d!AbCplQKbF|#x}LFMY}@f`*T=frJW)EZI|6d
zY+*~%M4ZR^)I|K}Tvg*x-!9w91lTF^WMat0X=38wHTkLJXjA*C6!i0;sdF*Pqf=>w
zfa$3-%?M^QDK&^GM@kQ~oF=g{>w=~;cF;C6nbdLeOxD8c^h|aoufi;)M&#oy=z{de
zw%lQleQkNevgwZb9m>s$`Q6Xc=L&iQj<*&K1#D)jjv*c9izidl=V>#`BP~iri^mp9
zSGyb*%9d$~3*}quGYb`<U(EIs+!Bt9Rp8V8ZPh|*vx{HEbW2sBb6!uEY9TK&a_WA)
z+iI;n9H_Y5a3Wl~wNW-LBe&_>wd3>6XEu+mw4DFxxYDZj>yB!v*2b)ADZ1YWE?We%
zS^cUj`ttlKBel%@?|P?O-&J$(jJ`W+{vva&>%oh%wx8C4O6%P=xTotqwrQE`y|%AM
z*ZZ96x7StMsSni#Tqi!Yu+F+|gl-Iaak12Xd1zmC9jfn0get+~OX;HsU1i2tv_g54
zeEx$hw^MkRdBy}GP?<T2*L+Ev+UZVUPG=O&GpGH#y)S6w|9rFwE$qA0HedWbY;(RM
ziE9h`WB+5Vr5Q-})^dy5!q!UdwZ}#mzL~w=Uh9^KYF_VmS@@)!;nm(mA43^mI*q6J
zu$Z$&3#`pZr@a*?R=>a2+ot!uZeT^uE>vu9k3I%%>+0;3&3mP91|Ae|sN~h?@c!U*
zmHV_U-y7Jdlz0n)SFNE+#9d5EMkoP{`zmA`jqsB-N)Rw>s1~PDB=gX<ayEKjq<R+v
zh&tDW-n(9vnpO#9sjqU&I}gK;NiD(jR=JNO8){BzEWu44j2ubTtChE03Nml8IWVvo
z$mjmmTU^!`Qm<Ec)?hf~4&{neW@X*Q+}j78LXxD1U4=F5N2Od#k00J>sK3Nq3itG@
zyKoIsZP}TKsM1S5CLt+w_2RjRfQ;+MkL&9j#EnFvTar(yHR|8IGO`~5PLbWWr|BAc
zIhtscB5&5%bhpiW&s$iE;tNSbXiF8c$j?{#1<CNicrNNQXdJR*QfDLeozp@u^&ARg
zbY5cx(>4}xK25*X{#F#E%P;Bt1To}Qbq;PQ<SDdD|CaOg6-k=jY2|N?Z69bWu~Xds
zS`+&1?rm@P5m?=Rmo^&PJ?B^UfP{%Ud`z$&cP9ZcdG*K@Qb)k4`~<O3;<ZgL-t)=B
ziI7&}4Yj7PVX2n|Wqxp~>Kc5Dd|t(QLyu%|SHKTRTTM~%CtaXi{*L|DDFuz4y7`uN
z*Rkb%8uU8vS;XagHjp)<-c9lyI7e`*#t#w|M!xsNTaaw9w$HqkY+BTGKkM6ySTMcj
zXr)0{ZrJ;bV4WF@pYAYC>RP4?!S}(0!B1N6T9#`j@zI9mS7rKIwwJJ@1YV`Pa_>4n
zj7QE!qPe@yewbe&RMFtRhTqZT^L*&mjOS`47WS^|c?981Tiw3kM<z-6#G5beBK8D#
z(bfwnp{$pVN=N(5E2|4p4KMG${RkgeUoR>Z&T{f?4jhr%pf=phaz<G_pbl0EwO{ak
zmu5IHZGaN!PN|m6O@AnFG+Z(yob6g~_-ILExODQb*MI+P9$cpt<%&bD2#y>6V)ky7
zZ`=$x8xj%1Vs2D`L?~W-_>gbwW(6sq{Cy-chVDd<91snl_?|X;!e>>zH;n2OaHeHg
z#04sb1pC2sjYjr{Lquh7<pi0vjEKJ;u6^ot_DG%1=-C!(9keYc%%x@E@CF*JBa({<
z6dIG+uMXC`buRKv<(SO*p2nNcbEDHje8q<<Ib|Dikwq=Pm0gOtzJTANL(h(Hi#)Bc
zy_Ltp{&W<w$nR-=jr7O=HVV?{W3;)psm2|zdT~j!x;+e>PvE<0s|y<GfZaNu*kf(8
zFMIeaA}l}obeaE!Qu;S^TYjoqnVqaF^E-i+FLvYR^c@_wQ%$dcY}Pt$TB7komRiN1
ztL30%HN-`2E68#wn-QTif0pwGPy&@4&mP?Dwz=h>6LV<%9(1#(BjAJVojpPJR-3)u
zZH31QTjyS`xQTuo$~$swIM5l_*KaTDLi;|)cY(S&u=w1!bmHcM`_D}QdRtL>MdgC$
z=H{>MS3Z?|x179>C-Cd(QL7Kk`vz!k4U2_SMXhy~AT=Of@pfvRYL-vf$E{Hrvnnv_
zh7;$5_@S}W^#wf8%4K8;o@+m>xaGyI6|~^!IJ81N$LgqK+(zjE9Z_0G;H_0#UEE$h
zW7;=V+`G%r?I|B37d4F)pf;N@eV<RQtEg>FjaW6aC{oh>W5_=jw>|r!!bf5?cHty-
zd+v3GPv38m4ceImKG*h=!HqZ<Df;$;*M_E$t<F;Q!NJ8-dZi;0?XLSmww8{6E*`UZ
z<t^+;_$^Xd%5|~AO~i?{LTFcSyPpvBHR=&0*|==ltlj;-*rCZ#SlR3g<IUb?*3^3^
z_d_3!tPO0kHYy~17X!}(WL0<zHW-&LqvE$tKz}hF=y6IkdHNl9O<?}aE?+NVwQtYO
z=<pfR%Z2NVS<ASct;r&9@HL9hddbfANm#|!gz*l;ip8S0SFqMzd-KwP>i~!srz=R<
z3B*_FRw5(BPxUIP^b)3fiFJEn3H+I6-pPSr2-;hU>Mhv~hKYT27V|j<^*Legb5hSk
z7VRSs^D*l1QKEZ%<MTZS^;MyAU3B%mNdKfk_0^*KDi3jLEc#xi`zp(DYEwP+(0&F~
zKO?HAqztE|nExH9|2<j%Jx>1SuKvPe9Gtcsf{XsvR1lv`z*AeV=dK_wuK;^k0GA3#
z7%GrN5p;qEzJmn5p$cNX0{2k^J-P$;>4C92U>_*V&kO9|;LU<{@ItzIL%LyMbXXYF
z$6AKZ+60btg`>f|w+ZkV2v6K3Tp1FSIO(Hp5|rv1M5J>;sX-YHoQf2#EJ$z`I5<ns
z?;4nsiVmhxgG-6QGl3k(yf~_%AvJm-VqP3#h>#|9h(&iuD<r^r(w|!;^g9*Q=^EM%
z0ri4GT$Q0OyZPUP1DzpZ@6GwgUBf0O1O2FBvuHjyF}_6zpPyLxQUmM_2p$UIeJRGf
z)g8WV&I6J}+;@WGCgHK>h}$OI0>ua+5<&|RM1pedRgc)OA8}@pbDvwp8JS?|si32a
z5i*jI#~2Y(mBA8D9Q(W?PZvijsB<VYBKIw_K*|hIvw2h_5d_6VX^=qRj;KphQBU+h
z;xeFX`qAHsp?drvgW_nTo@h`9zlmhb9l4lcSeU5=zb_)jvN*<_5aUPSbJGFOLy!x4
z;j4PQwiu*62KmGb$!ZAag!6#lJkBKU4{j(|H<WNALaPJi$v|nDaQUdC{V)*{>ReJ7
z&NB$kkRG(04ktnq6R93~oWy~2!$`?+U@SNe$Z*8UaqI&DU#ut<1}N1HD}=!EQ?MD0
zSPeKxixI`+1<JDk6}sWB>qlR;i0*-aKts4&l6YhFm>S8L->xweP_TJ%jBiJb#T4FM
z1@_bq*;$P2>OsEl33q1cqc|;i+!(PREVvCQC_#SoXMMDv9M?G$t^=fq`6+a`9A=px
z6U`qfCB})y#N($hdpqJ;`q&gVtY{^Os~5{l!wMik{8BjWsi-0bp;!)7Vi)}r7F{Wa
zziEM&(g<vThqaJmI(qQFGO<rBke!m@U2d^GlDq?w2xor85F>VM3NhY;x*&$0ltb@@
zN5J6d`C{~<di;t-JRK8%qbZ)%6A#jeIx9y=Z3OXyQuu-h>ioD%cA&p3aH96OYj6+^
zgF8SAg-8J(7jwTSp|KI)CYRVMhqO_TJuMLaOpH&i3Hi(`_VrZaTmGc8WYnm7(uHZ1
zIyQ+V4v$!nOunLlxn`e??!jy_FgyC#)ShG_275;%MX-rrHchZ>N-0)P;1o->(MUD2
zNPTV)7^5O!%S>?W#Xppc^#P~7kxzR+jdaDvDhVVF_M{E-6TRh$zD;rdShNJ32sen2
zc8kB>M2u_1#JX`9XkbCp$y{VCnoQ8_A><dQP#Gj^_h@cJbh0HmRUqa?P-=4{*+DA(
zq<!KW%k)C`GzD6$k~^vdiyGl4USCXC!zRthWqh&BSZqYs8*m=ArmQs*Lj_3RXvv+H
zB$Pct6CTyuOB$HYEOm<>(a18i$QpOgYG@?OOyeIjQgfMEi?qZYYT8FKi`zpgNtKqp
z$xMf0<3J@ze=(D|tSHxL83LO`p@UeFnPid$;cif7HYu}@mib^h<vKsP%q>CMDr*du
zH7=W*#l(NrN6tgjWd*VwF=@r}h*D-+xn<J!bhhtQlD0syW^>+O!I;B@_%Nw_LjzKb
zeLfnSd7va;Vl)4jRMxNt`L1CB(Y~MwUSQRjbviiry?eTi6;Ho@;f7`5n10>`P2!vz
z@%6_HzJo>D!O8l)lt_63QYvRJF8`B54v$!Z$-z`<!>qpz!pK2c$2Q52rov9mWc}bT
zEDTClJcwBDO*?CtG%lI3Lrw}H<%L;L8fZkMdeOV!<aoCtQI=IEu@CFfN645VK@1ao
zN^<<I@cC9H>C6OoMETSvKBT!MY?E3ch*Fd)t!_@Q)y&(H%1~=Ag!dG~d-G0^D6JYa
z1C9J^4w<^a`3ATYO9R|P0qRhC&K=G28vPPeT-Ibs`Ab^KBg3?J(<POfs54EmNL)55
zxR|MsG2d9hbufNMuu>o$_>q4RI!O9%kO}t4?6yxiP?EBTnexj%p+d66SY2Sq7BB8t
z0@=bF2_-%-L_X3?lPOJnqhF}(fQso$uQkkT_?V~FRNOjKN;p_{gGtnv&+l@e{lHdY
z408Tz$;{j&MNK$gFsoP9b^J2^wsO(^YEiw%gLkYO6OKk|4Suul`V0B)sJ#zzdT)w)
zZ~4OGq1uN?q1U!%jnC^ppdDSDbX~A5E^%9p-V#kdd|aoTT=$zbCHK3M@vaC7x3^o)
zQ3ot^thvwLZ$9gP_tN{j7kKWK_BZRCym$3Li{XV9!?k;L{rB$Qzu%yE|MrjjZCfqo
zJOc4D#_<&JlNi&k7SrAkQ@eszr|W!g{LMzR+T3c*KAtq6+%ofvX?wWHee{R<qI7#i
z${o|U7aqQCe|YsG(^2H<mv+aMc2L<xXVnhwmul@MLY^yX`~zyRBsFhUC@cyZyiYjh
z?pN_oUy(`bxT_k{178n+(vaB}9gsPEDDv=kufuB*8sFs0zA4Tf-ta!M?sSCp^~l-3
zWG;UC&b=(7QTAO+_$XxgyUxR-C;#d^=(Fd>r%t`tPJ^;eqk&HSLt_8v$qq=71H=K6
z;E?;HC)+D(9gi#i)sw6KtYiP^2}ITYkDkb=9^S8)`?$t)#{^mGib!dM^YGjVk&7BD
z!$IFp_c!LHwa0I)@*gtDCw@)Ri`vzb?`bAU;=;6hg!0c<a%@@+mdW=ct-k~vQZS9{
z$=lVF!b~f-EjoY5!HvfcDb91_1I@4Fe^q#K2_810syv}=vgW?jQ*%b^5yyA+<Zq81
z70tE~jA~Ci;i~UVU0VLs_gy{Fc=+FXvQx_|h*K;3Rp~2u<Ue|Hc<abt6RZ9D;mUxX
z%ybXHPxWM$Y%C0YVFktmdO}~Bm?J&@kDi>_`Q;utUEdpAUs1u<69_?PiTHHrUp*mO
ztBc+EqbE<)$KIoaRi!^n4hPBv$R30Jj;J?+|NfC=^Ve+U=rJv&YWhg90-0_c3iY`^
z8lts6IU26R%YQ;0(37zUy;G#INTZ8WV-cJO7^3Pu_W(UHe~$UB-Q(2r`<!(EqxoD#
zh~zltIg<1o(~{AXpybrM{2c$TOT9hTb({p~$-G>L*5};glLS9;`+xK#(0z0=3320J
zJsDKwBI#h_rlv4EUKXeH|MnC})oG?CPLneVr>DuR9jZ-JMt+w)peJq2wye_iKYHRw
z*_oB^P@gDWX;=H@<v*J<EWIh3+Zph5uAuw*$2s+08-@R=C#+FGPqy9)p4rtC`gn7*
z_U3vsSr*N$=u`;`woy3+64Yw^S5LOW)#vUx?&`@>-A+DNTfGchPmcTYoXZ3BWVuN(
zO}e#NrCu?wh3zP<(9Oh^Hb75S+I3ch7CNp;++5Y>J)ODwjfW54_}xVJ&|2j^GbN}0
zpL*gILvPMMKmU)OL}lj+C?Q`cuZ`nf+KP_?dO|ytjC#eKBBo_&Oj{<6GH0@PxHM-+
zJ6W_jYTvy3TtRrjtqYZWXSNn=BwlMR)t&&%q=~I39TUg4S3Awl{H0J#N!(uVe|rY8
zj`usmV(Ury3H;U<_=(xP*Ls_aB}Zr{5-W_gw+YQV^{lOho%SQIzyuJVUL~j0q8DfW
z70{ear2}G2Y6M2$KCM?JU`g@mXdv)j(A#T!e$<z(C%Ssod$9nS=>5@?RIvj@*95^A
zd#*xy#RB4V{7-*q_;Pq1v4^E2lqeRcS96s06t-=cxEIw>vt8x=*$LEqq)F#LdXiFk
zUCw+s*jgy*K>p>rbJ&QG9i69=-(5p5(w0KmdNK+Qb+Dy`N{?BqtOI(&n<QS)eO!i*
zQGZ#=8L>mGl@o7lxS_Eefp9!=LMEp{|JL#mgq|OuCylq<m!k+{W73ebfp@UW(J6jk
zr0*3s-Ov3N?F9Q<{wY77(z9VCwIxN_rLp<ZU~X`w&~ugI%PlriE9lx2yyu!5LRIBQ
zG0!|w&o@JF+F5?b(o6!BovLm=bX~y>38g_VUv6{8uHeV}xn(a_?dr*#hu<GP*|#^G
zReAb^ihAQE`uBJQJxzztz~pn{Fu_*O_liVQM}Wp^g4hoq@i>{Ur_EOrA+?j&LMy+9
zxvwTk^Z4ko^#r+kq?@fL_Mu42t0~H#<Strje8<%7m#onVxCO8J9>-iw(>ckj7+`QO
z(RqbP^}2p1f(cL6SR<K)+TUwsgkSd<5eqcGW|~93pW$AR{&0<KwxH9MJLoN9do$hg
zXH!=p?LdN)zk|d$TTcoEZ&jv0T(Q4>8qkxg;0$X%!|rO4swD5<wj$zyo@jLCbiy*8
zoi^-gvMiJ+Bk(>~Yqn@Pc3gZ{PYf-;StjP^cwM*GKi6qUUEfP_VkzBzY}nV^g%qW>
zX1;Q1?i*x^7d<cYmGpB6*wqsy<pap(2jg+x0(W6qyLw`YqInAYd?*O!l6G<_836R8
zRsnHzh`=*>Gus`|lQn@FNFyxUW8#mVG*&u#Y6kb1(KimHfK<G=q=z^}sr$jVoaCg3
z!G=(Jl~~xKFV_>ejyb&=(zfWoR5>j2k^V)7cS(Ga;;*#zrDkX73&d25_dp)KRwXPa
z1ZVhEYTxj#p1d!8I5#*{&(;%fMZ`YBP=nsB+(=Z**oh(#j}jyxI&CZb31qa%wET~r
zG*?3&m**<hDF#1_#_Uf9^RTe`OF<V(7_CmHuAdm!dZF8isd8=0i<1<BUD{-{dp`FK
zxKJ8!<scK#lU405laU*mOh8ZGB`4@i8CcQ2U1<RHq}A@G;5G17-durQJ+b6D4yocZ
z{p4d><o<&aR*>;xz+3d)P#3lQg35=onJ266O_d_+DtGoc+8C-IXt-6F8*wP;S>Q-d
zM_6HgS|-fis-*Yr;FrVWvw?c_;l3f>BB}DfUcE^l?w`D&cCf2;{zFOMfElc)bYk1z
zy>D}nUhcAQy>-D;je~#Z2B0U(PDdbHLttZS^(T;TK)npFiYv9|G|TA#dT0bv;YwDE
zvlnp%^hC6{fu()RI}*1wCVQq>#k6fXW<?6J)BRq-bsz}aw>1uJcT+%?IU3NnCUiuZ
z?L3!P69p4RdT%ig4pIVB&OGe96;A8?Mc^f;ZBCn;`AQVFt!24v3p_#>m7;Xkb5Yv@
z&vZ+AewO<k2K2-!e6!C^XM@%kJFh~x{AHufrTm4~=#Fd^FRwAZ`XFl&wnOET>HzUU
zSxX{Aps~|CbY$KG8AUVyasLEH+ebi8%>3J|zQVrYSgS<ivZ>%le2G63)^tAudZPXD
zY&UD&2F*N3t=t?0^rXz#XVJf%XZZCtSa*?gIVOB-Tyuxf_S0JgDf8)|`3|$YovkOY
zx%R-Ud4@zQ=!QDGdNS7T#r)asxu!d`z4&=Yd$66(?Au|{>vu*DIeFDDT!HLJc$LU_
zahZGZLfKprpXQbD(+#%hB?j@{3-(Ss%_r{a&DIm5cOf4yb;DZ*;!{}9ZBxm8O4h>&
z!CkB7q1f%COyyF6_^QZ$I&bcK(cD)V;j2#MQm*vXnB*Lk@Vf%_yJqe;h~hZb;VB8?
zFzWU*f^dk5eZE8Y6g2TSb@ev~#Kgp(ufzWl6!Z`ZvUUa8KtWu)Vq!}TaHIx+se=5F
zKxb&+8$Iv`*FeBZ+|YshVBnXFfnE?8peHZAya6g<StDRUR9FaLB||VcgeMZhbIP2p
zC#UFKSSlRf0M}gPItS><E|(;`2Bp~sX%l^AI)bw3K@>=^j0|TUG#Dbo2|=*+q-4_1
zhzP2Lgj5qjU@uUOc?hpH2#oOO)&bq01OO%U8zhv&Bow3q`Y9U_+Yw+(4CwC;h!G1L
zkqvtX3k3AU4Z-(DjBi>GJVOtAvlzIf2LsS#4Z=%Dhtth@06n=+frZP$BOq)y;dMiR
z?EsO03z6Wei(IN=5rCekE^?lci4bRS5~&f%5YEF4ww@d&apbsioO0vX=M*UqkKET0
z39yM0g9R$@_Txu@s%=AR(QJv(v;bXVL~)8mUr~>4H4nYP57NU#19}3`$t^~-34csK
zH0&NgCr&Zum>74jf9Pb29y1LNU)1A$?uN8=Lq4%aGO6L)FrF<Kj}wXeodxQH1&SYz
z(4wF`df0U0C5iTdM~GWQi0{%#P%)cM!Wd|TT;wqlN3;c-PEfmaf&=Je2)JsCOjPF(
zHNgUaK(vS=7h?siqb_2iC>9~w!0mwr?z?R$M`bh(9(}t9cc(GnzIvFib&Q2N*vc)Y
zp2X(@K|brj+cEGCJxB%^<vbOB-wD;NkGjqxaJ#u7JbO?+a_Dn1To-gAB;Dcw$Uzjx
zg~?%#kT{N7W0px6yd1~6TYQonHq`<vv<MQSU_q8qYHlH5LWovlRNhq7WjLrn4pih8
zUD6m`uAblk!B<=08!!o0#rP-c$W}&JJAdpqN!~67avL4n-4iRoi2Z26^;t5`OEN;j
zA|e1DH`N$7I~BJi7q4X*zhM{8kc>($j^Dz7b|eX$_EFr}DBd6fm`o6siv9*p*dw2?
zkBO_aOBjJA)Z5`3_>tC)_#?D107{OMk<Y|pU)m+!2cdq#6I~l)<(m>c_>)vLBK+-=
zLf}a=q$JIzr08PIY7d4*SI4HPC#S)&x&nku^$<gO9KS&H?P)@%UdnxJw3$@Q5LCc2
zDB)2M-in0(Ae;KsAoWEP(q2CHWK+1oVycsT+JJuAkX_nuc-o{J`eRdC_*C2?BkeCT
zX4Q>DM+(c(PiA4TdgSCU5FDQrDM~)&x;_Z$PP&O9-BORSlnRT(CYY&{4^1aLbte<C
zsmBdsPg<g~>`{H{Y1d`al?9T<EYb_H5mUuz8UQ6;*`)%+82xyEsbrXaMi4e5tSJM*
zOy-dR2}z~I*oStKqr2RJ`|pH40rCJD{|n$4ck*#;xMOeX&qlHnIdQHxE0>u#BA0#6
zAZY@_LaUL}J)5$(<%xa**vs;i?P4N_C8eb|>JpC9&Lk8wD5V(EFLY)vEz=!=ha5~D
zlFAw(BOPdD7M)CyN`D7Pj1>ApZ|)iyy+O{_u*V!$i9f%Y1Ug9B!sIoQGb(K<tw9u>
zX3AHMOq5j45G?<TMUKT(CICevSn}Pz)K~6_Q%th?OjbTQ_u)+Lnp7b}DsM}ksLjl-
zrNsx4^FrLC{!%D1(IAN$<fHBLb#a*nn<QVc)LWbR&m;@(q?6y+#ZGGEo^Z(hrJuee
zmE<>7Q0$)V$xQp(q3}{K2IP?8kY230S?DwqbxR;$&;j>;hH~v=$}d=eJF7Xxuq6L6
zjV2|S=p9TxY?zp%Py(|m0TkzheO&2guF7V~xn|4-hhio?uOS_qNlJ$H<nc2zqI)Tc
zR{7-?WqOAAIBZ#8U&4S@YL;OZb29vgJ~a@RID@4I8Kwgl$PYIQ%4f=>(m7a`#kIkC
zFK4j$gSZHJ5<wwTS3O^}Bve^3C#8?X9TL+>im}0jS(9=EqzewsRNn6+zmu#gC`q(%
zNE?HvNra@&_LXlMV5%H2zCndG?!{?t8I4RANd22bYR(V(Yvnd-Pj5JvioZRl=6;b+
z=sEta7RvF;&$?Ge@45>4^ic1DI^G#=yfaDrco+5F1OMvLMm_7n=?^|FAD*Xu@Kbbw
z;Tv3v8e9P!>2ML=Xb20bJ!NuR@_i#p=nhu;&JF83agKM+pS*kS@4IL3H>LL9fyUe=
zOW(_ozIT1C>1x5f8~*pGGWQETnr{L!qH_z75!00W<%*`&il$XsErHgiJ5Hvr3R+sW
zOy8U|b2-rZHpc8*KhOT(>bR#DdOa>Y{N4(%$k3MP)8lQ9ciYBGFFHrHO*{U>A`AWh
zi$zZC5suDl-|BCVh*AfIwsI<UOy2I`d3l&u`0#hJ!>eCAM7BG`1`e;kIkIkjg!A@S
z>zpH;xnHG~WJH#~${hM8<b3qR!*2(!?B(G2e<zS_{?(t^zjVBJ#7?cE79U^r7da%L
zxEqiF1XAis0Rj@4tN#f|QfDQ;CRBMV3X2P=-yQld0@3lE@6`Q&5Qssn{962_bThbR
zZSS3#AIRnEphJd*8Gi`G3VB33@by5`OUA;>hsAFO=KGq9vi}fB>B8g39_)am<sSlJ
zZJ^IxqM@y5eJ#bRFIuOrumh4m1kzSdE0_TSl9i`_X%^0P?L5%!jO}|;-p`oi|6c^s
zR$9FBd6n>e#pu)9;+gI|hhJfzdh=fa1QLA2xZFc+VX^}ESbH$;pMa#Ie0y_!r!0K(
zQeK%WJ0S7m7B?qcT_Ps!1|&niVmBsbT>AcgI_wX5PE5E8VMPh60t7MwJAt$vfdScu
zjp1Vc<Vdhe*WK`|=i1CiLzM==qhWstq)@Mo9gzHoK<tvQUbED@6^K^K3%Od6zZx9#
zz<J69_1KcpjI{ZnpNf7O)@X#4>8%b?a;lS?z`t#KI`M}<+%?XNYI^a?|A#=_iE2PV
z@*e_enmiY#F?JL6V0nZckT9pTOA!WS1!5|hO(4v01y*W}{0y5w95NQhfPmx=fv}jy
zP~fh;O?_hj!LRDg0i&~dZO4KY^E*ui=hV9{DYO>$e<;aR9STsGr~U~@G~PDT5`$>-
zB}Mu9S+c8LhG$N#*(9DR2M8p)EOAw{vGRWeB>gJT{bp<edD_1hy5qId`iDSH_)52`
zeNAQ)NV?+9^MiHLc~`&DZB|;L6Bz)3^p(!bFP7sP0Rnls`c?1rr~C>dwTBG=fhetY
znq)s+`vC+b@4Lp|&8_VQBtQG2UjhLMZo5VG@4PY~AUX0@sQ+Ds(#C*G-(MT7{`T3>
zjk8J|ap#o$Bwo>nVW+dGBk37e3`Y^)Pd1K48`?Dd4loaM8%H@@QlG#DzJmRSKxpiC
zq-}=sg=IXO6aG|lwkSz8Y`%Eq)g}~e@vxOmAX`ffryqM<`>}r%AQ0U%+pER**a68z
zb<ldoyM^tI!JW~+PLH8pvlx@{XZTO=INd4!9kp|GXKVH6>z!@-&Pw3Ht&If$;e-ev
z#tS}9DHCb15rI>J9gv85cd!X$QVehpAIQG}$>Nb#wErIhG4Uhn@CX<~1rMYy`k!g>
zKm8mCNV*Vvpe+d^E)8D}v3vtrdoaFYflxju_$$mwWkf8BSaa-L4s6-?i*_=x;+#1<
zAW0N2a=k9+x)f{*PJ+}DL(gHCLTul`E@oBL{YxO(9KsskZu`933gq6|6T%Kis)*N>
zI3@Kii+n@C6rU-vZU^6m0t6D0eBv~}zMjs=epLR66D$t+HCKQ@gi>U6^$kqgj_$c8
zZ6jsc*knpuj>+uwQ7l0CTlOyhArQOfGt6aF`B;ETpni*uNED<_F-hesG2}Ti2h(=`
z`1t~kR(sRC0A27X7m|Wsxw8r6h1x#^GWI_S<PzuJ4OafMOX~b^Hi2w!u?eK(QsrLc
zLp>s!K$M|X2|}MH_nne&hFbyz@}qiR$p1Nky!t;S5Mig#^ao#6{C5MAR)t5gl|Rdu
z--Eq`*#u%<`Qbd@)uI3I1cLOsu4ug{BH__U0m_S2>i`$%>+S6-^l12pK-P<jFU%Zj
zQF)*W*$qhEkShDfFK!6k>u`7r*BO|$+@Spg2&Aawp|mTigx$2%8xDRJO8AFB9<57_
zmi;$@bUS)z_66?}2$<r<G5hPze)CGOvj0ix9P2*>LOIEKcK8p0Q2s+8tVMBXslO7m
zrp5!}yBm;{&}$VwWQAZ9{G|Hmb<i-F*sIFX!<+Pa9o}W_S5BP!A&fr+f`7IuGTLb3
z>3l6<X;9vZ(PVxxKrz4cZ{_A=<+%tRIlVnWXK{=cc0htTUiJK<=CQqDusr;P(F=91
zk==l#hwwx=d$`?81PDmB!!JbB0RqWSlqj>6g#rZP`7ZPmn?QQ`RJ<+=*$}2~eq??>
zYvN7Ry=i|ZT&EKt5dKSx-utM%KQbO&NPls2#xjq_b!5^j%O%snnjMgY<x>1(gYI4H
z={8m_%tf`%+Wg-M#BuN{Zd;6B+jX<=m#J@2t<o!PB0wOw{vnXfT>|<24}lc^A&`xO
z{2)=+$}=~ej&uwS@da`SpKDzVQ0wOg0+O23uYB%VY5kCHpw_9iErmJYId=&}SH$@V
zdTZ<y-@3NPK+xl&k>4ueKtM7W^!yBNFSNb5%_Z*bWq?3@h+hr|Tv}BteIj~8&HZas
z+iGh1u<%qEt+Rd3pKP@~Z3d(w<4OxBUAJc*SNQy_6<N;(QW0C@lHQ+jAN)!lax1_}
z`X?Uw(E7ILU9&f}4Jh8_n?OJ!S~_%L(5qT=Xc6WD;@jKqT9dRjCZb*}f6AEAWW`#J
zNpn+>s`^793tR0oLn|7HOOvTUKyv>~Kv&5lp_^(N63>Bvq%Uq=zv0t-F@jt9-mZHr
z`ipLj9NeMT{q$ardF{(4kdE;3)t53p(^hN(@#MY6LU_-A+}Rx3@Z_$G_g=zjbNU-s
z00hEXKSJOTfr3U{jtVjRK1*!WSFkq1Ki{-XT;2(EiwOjC0|esg#ogcrt8{bj@Dc$6
z5{UO6y8C`}Z*e_uBN<*Jig$56cUjs;fIyC+KWduzoT73yqkQCvKFS?F8bdzHi@-xv
z3H_;yj}waa?b<CbF428;CVkoEg^J&GSHJ5}PcbJ?BdDj~qMr%G{|?w6kPlOKDB{lr
z{8fa4=xXdx#2Om#3>vUqB*;Pq*i!@Sb}JDla3GH!7;NtK(hK|&5$FyCB*Z{5Ft0O+
zmmQFp!+aq;EFTC@5D{i1#&eMBEk%b#(z&8{3FI^yj-_%bR&wII;e<(eLbp#c+Ls-W
zKsh8RK^fGbeTzX9D2M1`kf@hmA<RzzAP{0Oz#ak}!DY4}u$VtL1;p(XQg0j5Kn-bz
zfZBju1Qcr3&Hpzzz{WiEZ*%@$YG_|Wz#Dq#5G0T-A0}aMbim`bVQvt<PsG3{9lTG(
z!k1;k@0*0LoAda=U_odY6T)+SF&qd;b{e=)<_K*SE-(fmKtce;2!9Xaj9Ad#9{5p{
z2ywRvh(&~yS5THK$6ghVBa*>6bkGTlNFk?4eng}^DY9fTxUxH#$BP9zYXLfM5yj~g
z1q3AZlObCCYy#1dWShq|i|8A6(LWkO4FL1#hz1D6eJJ`*E;4E!GlmYE(&K&56Z5Di
z=1FDD3M703#<K?Fc~0WCFGe~RBRM4zT4E??b+&o10}=*8Se;93*E|3M0nEeC0v&*f
zkR)*c1Ok{x=&pH0Fe3JfMIO@+KFI+7+hY`ZFmfaiKL}evk33@$m5PZXHiooAKv#OO
zm)xQ$@aSjM=zb{Jh!O287ITw?bC(GlCB{@TVyY#PPvyd&!;u^2JTHs!_CO)Bhy>}Q
z-ojC?yM>4#e?%`!4()4)9@Iy}>>_|fB*Y>PA%}^<#G&+qbJ3U+>|i54j)5tKV!<*Y
z=j5VN^`q3_Afg<I+!K{07oB54c&djhfa6Mv3Ad+kX8d?dIs6w3{1XIz-4?mlfN$oH
z<&ukiW5M-aKlTG0A<~HQAjN)ejQz!k9oCQg%}AWY#GP};oal)=<rcZD9-n9zUkQt6
zlH#`*@oGIG?NCCd1wj`R4W@+(ka5MuI8(bAQGtZtdc1FB60G%kYt)ev?np^;!Yc+|
zdOE>bF7a3sLZmoWo|YKclX#{H9pM%irH`4hO9HZs*y1E5ee9+i_KE<Zp&=^6E}3;1
zo~*BdOQIwTFq2CpW6Jmg?;51s4@$8qPN}s^kR;=+d+`8!{B57w4Nv{lgK%g{9fG4r
zrxIVwV}RJ_utnO3={TrHd_r+>u^yJullEC7SyLaxX+YGrBVH#Z8@l6yr;`!xF%@zo
zGXs*PJ?W_%UYv%+_9ENVQ?Cz^WaJZnN|F-|$o>52Q~)`2vW6L{P8w<N>@mmX(sA%K
zH~Vy|K$NOo6iY7Io0(q8#8w-G)))Y98|_ZO-IYs;Fi2@*X6(02cr=}2u$Us%l+c6C
zjFU?IF_n43K2cUGYqU2J$Sa)5S(NEGEF&x5G992AZTqMaDHg$(mVMQZ*lnKC3!xM@
z;>zGL%}p8ng2)F!qzx*`rk8Y>mf7!)IvtcK*OYT;CMRTyV_Y(Ax+&|}RF<rM`m#p0
zDu43jpzJboc4cpNk6vD(U7j%}gD;p8Es(k5ngFp67gflA#Xuf#$a#*9wQtH#wamID
zn0r<uX+}SH!L2|8o14;DptzaFA&^%kpQmb-!7)R;qaMbKi?Q#^6YNX5oR0iKOW13e
z^NpW8ppocaoa3XOl{TFk#9wgxVA5O5G#|}$z${h_vK9K`AI+qfTPCXnCwGGbp7kYj
zX;Mrqi(Bl&_zxll43R=sJg)_daLi(YVJg9Zmcr^oxi_aCPLG&uBA+A2c^l^Xr6;XU
zMN-M>N`}d2`bv12RK&sJ8XV5np%~nk(YTrS0-n$ym%jte=d>vL@G(^%m)dPbR-ly~
zafp+0ic>Wxn6r;O`7zhMDXFqM4L(!gBLJE)BzAUJU1OBM1&ZtBDT4A8jo=t9hYAP7
zgujc6vAxB3X7K?98pJBm?IVrYSCqb)=q#V~D$oh@oKr-i=CaY78$xd+0^b}isxdNh
zzNP3~x$dA)?~LVpTWM0O`r>VE-CKY_F1>j9QRdyXG_an_JA<NkIT9c57S&A!ynp5R
z{((gObG{GH)ao5w>Rq?KobNF4z?+EvsP6^xj6A>Feh(UC-ZvcmoBLEj!>Q|c&z-z`
z@xa|ktwtsPyXx;7FUK@qzJCv|b<gncdwTwYcP;?w$UVX$|JW*ju=Rb*f+m}_CY#?)
z6c6z8HPIKpO{w_i*B8v3fAAQrG*?QuU^>p%l%Bcwwxz!GLerM0<(HPHD=i(07wuGA
zJNqvJ;m7-@YCT43pZBS`CaHbqg6`QP91IYMM;nYweY$_|{%>vjs}C;<wNLJ8A5Azs
z;(dgUZ)cXaFC`q=d?Lym76T3J-FYIz`>BKX*inJ94k6*A^B#x(cf7H~KReO>xZ*P(
z|N3!r%9G3fA_tX2=-C9FV2A>9pX=@8y1s({@`ljyfA=v@oACO1sW-!RR;QYa^CoV2
z|Mf<I$36SM3lIJG|6?DMK3KvOjqk~O!84+uke%6A^k*NFHBjO@y4<%J{`yz>mJ_cy
zgu3|1b93*%ym3@;Ah7VCeM}4ETp3V!d}eL*#A>>yviC6>YuYZ^JTybylES$@>f4#Y
z){idb|0z6%cYNNqpgi1G#u(QOclR-D-Y}~#0}7Ad)w{d_>|=hX-khoXvyXAPYy7!v
zYja_4>R0=p!UNz9PFCI#U8eBg)>^<mhRqw01f3<17rVS6qP|;rNVC2_x!8laIs%tX
zC5{B0U`2%nx75gvhMe!R9SuF-rTaKUV}!dsTs!xR2;ws9%dNlkx>k%MjpRuubdC1@
zyN@xI2aCcUd|>ZmK1{WupCK8>m}kmK<5<VS;&E+z)-eR`4H>x8e$QHNKKJokacZ1b
z9dRP0aKF8vYM>Obk11^VPvOyayhH2CbMjOw{=+nzH+to;$w>QY5;1YQ1>lXQX(bkA
z`PeRR%w(2s9Z%1q(MJB+$CP7jW^)=&rO)Qpl>@xdaYJDa;0=d4&55nIZG}4?E1`wG
zuW)lFBd-p&vG*~`w22H{*7?Ocg)^mD?0pP<aHg5Pk2zC8;Z<C$<PhXemj$23tDF*i
zIzo{ZQI*cA7AP56JOS)umg=NkW|vNk=N||5F(}97M%khjW6h!b*=3;ckXF4lw8a%x
z^oKVlq+8o{_>}THzFkvY_^P|ZwNPQCdb4?#H{{bhuB`pQJY(-;T-dzv;?Pp}Gt|R|
zfA%riyZaa=m;Uk2mm9!7CUb)|(6>6b@ylxy(2r01E&;p&=*LLNku3UXxMn$hq}@n_
zaTfZ7mDdUEW7IqGe!xB^`Ry_IRH|Vj?Zi&TJZ(Cl<`wKjZoP=+Y~JXj&G`?j^P3C1
zg~ylp(6*(9<2%O7jp3tOEA`>NVJqKsjmvyqnI!>*hYP?PLvJ6q0EGveH&F4-?0t-<
zaz<r)6TlnBJKC$LOB%;_d1HICeut&ATX?W}LwGWPS7XszECk>Ux{fBb%BSK><As_k
zU>~yx6dp&x374z)A}Nyp*~cvUE8zWwUa<EuCcr+XR@jdCMVcvgfECw}a5_M*=9tvi
zeIO%0cHwdA+#3-%+IN4N-gWuvsvxr(8}SKHptAFl=);;up!)y{4}dp}o=PTH-neLa
zS-{lwsq_Ry_ht7|m}~y1_A0UduScWdUP8$-eEJQSuZ&6sYMnT?$FBM__b9*{&s6Mh
z2kYNijzrfapLAFXx5SV9!y8Q|S4N`J{QTs1IQUNkyzz;>k5M-~-+fN_-@=2r7iHOT
zMLYoD4WRI7FnTVYOli3Y>|<X3*FGjc>HG??kLk_94VE5<7I3sVBUg?zb@(egc?-S=
z_A!egY05g6+ueIt;?`Na>e24WT#09S__2Az=gJiV`Cf|R(aVMb-y%iW`<T-Lx2*u)
zD4g}#-N$^W;y*Gcs~4~H%{p>5S@tGLJkI*hKIWyI*mHyL*xt_6oyve)F66ro^iC<w
zZ8?*i;k$`@?-Ltjc+VjXLjDvU@@K6t{~(*j#G2RgDCT2-7`v{eTMMU~*V?y#Rvg(E
z2(3BRiR~&#UCVs+e#YvTdmz9YBKunvuD1fb!Hf~`0#+)V3f*#$bqefehK)qJ`Dy5S
zPS_!zKZVB!@R=A#kr0G$n>(<N;ZeG9!?5=oc0Hdscl``8p|^`xC}9}N@^^dz6dnL?
zAgObXPpbBiAB_~1mvJllZT7JXkJ{h9&Zy@8agB}Qj{EZu7p!@wnFZNT8?rtWH4n`0
zT`&1{(ud6(%Ry@331J`ipXraJscK-Tb@oSg;W0ws*?8&gxzYTK#Y9!q(RIB-BSJV2
z(ksEYC_V@J1-U9r3$kI03I=C~`R}5u#g+X7)LNbxx_0kDf^q_NjcoSvRqyrIWA9^Z
z4vY@(79KB*MkQWzoc8E`6;^^9P@)68!8*G?z-a8)J_}$U0~8+kXWrmpUXw6jA7k{l
z{LUz^v^s}CA+V46$Y{2H#UZe&8FCKQ1F3`X0{fVj@rxzJt+`%#isMEv?jVls|8S~S
zVYy}E(k5nq1o$1{&@fC-Y`5@8;Ha9sp-KDdXuA~jQw(;&oVmM?*~tlz0eD0El@C#O
zfcpfR*_pQP{bwJ;_K){MHXvV%K4w>*>1CmNl{1evnLq#a4@h5k4N!QXS{-d%hI%?Y
zFRG;8oU_9*db^e1%HMhO@|DBKz9A78>eYxK6Z9s)8%4AOdjzfn`xtK^0pXluCm@6L
zwvDnMLwueaR>ExF=+Rm9Ik+{%SK(7F(YAO7%HGG&zv%xpebT&?4+89C)Z*Squ?vq4
zs1VB*<jXERPN{h}nYAq=aWdU1q8Is|-&$c89_Q1%+FaUJ;$|K|bVM~e(znCyihO!A
z^?-d0z#BzZ`bSdzI@4~gk&PdUnYYtqrezkgDu#tW0)F#bX&u<d2;1wFRQ_!HaKUvL
zC_Fy)XAkiNoarBNZQnegSiVs@I>5{34L)Pn>R=si1@=DXu}_^QYYFjsi|rq5-axmP
zj@!)x^R!A1f@s;KuC{vu-$R+pX8zOu3Cyk%)*8jk|2xoq^!BmVsqJNRd5`!qekN>K
z?UXGBYI~f8?9gpgG$jTr{dal8#dB|}_9x{N-h!{StM`<$2%qL10NxPQroY$mT;?j@
z8gubxzNdJurSBY>)-Gl5V}QbAQBv$O?|S<VYcqal4}cG74i38Lo*_3d+Dm}yCFBZ<
zcL60730BK^@23hLuw@q>;zWMzqWdAp$IL+RpMA`6*N@H!A9<<|P<SZ8Jb=RE9N5>$
z#P@>UCxACJh`yQ~zL&avCnfxT*K=NL;GCcEltJw7V}Qa#mJ<T<hp719GxvvpILx5_
zVif-eU=B{Yzcs{5P$l4*dBAh?06s*3Jro%31UPoHS2E(e&Br^}Kv&nmgH%E3?m$m^
zpr;;t9|O|?``h}kj(7923lCr)L){(6sKD900R$gj@F)lmP<ULV!wI&&+A2ZG=0PcR
zUm`l_FFij^6Td77Cs26gLW3zpj+?F=5-J?Uu;9{$;C+k1m2CD17VYq_qxuT~`xt77
zfETbl32CzhwV4M1?D4}jv`Y^J@J7ELh+~l*d<;VZV-bPxYy-#9fiaY@*@iGLC~OfD
z?z=mbd1DgpXC2Oj@C7x5hY?|H`A|V{>jNtp1lWQn1`Wqk;X;x;*LMq#J&jzct`SL4
zE};34>WMh4&IRDdA<4)yLqVtX{qmu~Qj|zV635=5$O9%Uj=eHb0DxSuh^m5wh*F}o
z8bOyZAb>Y67l*V@hTO0KLX~J9O0<z2h+TM)LVrPHKqfJ!ZZYQkpjb)_z#9+k!sZ~z
z7!~j{3*>VW-{1ORcLblGPPn5*_$D>{nF<OhJl;w2zO_JbVG!m{2=fk<ffyRt$N1<+
z>}%wLVbDR1To*dfK;dy*G7_j!<Q6&QoG@q%=Lrf15AcR$FhCDV>e#dDQG1=RL}16$
z7zM0TGUcKv{L#QVC67P!h8xZZgEJ|{4S>Tq5HXb&F^|;okKutfJz>5o$mi-{TYY3J
ziEl+O{Ea#=hKY40p}2ccpII2heI4|mB>FmmJ3uZXn1l{z?4}-z5db-0NSIj3cpL*$
z0L8A`VTo>7vVKT)16GsG9)uh@T$6e9*U1nA49;*W8ce})cHr(w;w|*?``rWU;rQk$
zyi^eK>lE_4B<hD<Y_}wDKOFJN4e@I#cGM!`HynMT5<Ss_mXeE<QOC?P;+Ey&SLLwl
zjgjXpu;(#Y_2Q`Qo~TQ51TITlp<VPh7=fQg5Sfndha~LPNZ4<QuX9V7MJKcZYnUG7
z%c+DT_UtLlQFqicr&xEpL{E64oF#gsI8h0UJ}Z@USPr9x#i&cg$4g?hdXrQoqt3Z;
zu$b^D@>F~#BTC-@*W!x1MJAX?rLcv=KE`Z1W*W#lumBt2ZTVw;{^T84lzmX_$)Lmm
zM(U7U+FOIP_p~^d>9}Z8+Q(_kr{1JXQpo|dc$j^%o&c@|9TJ9()+Z5eGo$+;ph0k0
zjC%~KDaM+VGSfhkGC(FwBfqJWpIegc+{x~w*pu?;bOZFTT-x<T@)@b5X}R<~gUAIq
zrpSO(lbl{6MP%4Tl~2cCVqm$Nh}SGK>fJL0dkK;9G11HnOUcaN&`b&Y%($S;4pOF*
zI(d+pdE6lJWpAp%P^ug)aSEH2Es!)hm8EK#G-ro_x~FS0S!q&39LbENQd)dXLw1&A
zMs+W-7E9p9W!%vqRgfsvZlo!_%pdld?u+<+2U7u}kZ>ULV95QA<Tuk~C0f?(H2NYo
zcgY<C=)$T&{5ms<A(y-<kO5VQ)+ouV3(9DuWwc7=UumXH+vYd&=RC(`CQj$S5Xibc
z1CR;gkYRzp9s0Oo?)#=VH(IWuRki|u-r3;z^ZI!eSfZU~G(a83WZWgegewlDYgYN4
zLHV&7;3rM_Hw|NrgL52cIX(x`zsZR*3c0@})92)qA{q+{HL{gva+BcMfA^)Q+vTCs
z3v1*lTqV)^jRd}#&^MdKf`<4hy}%F6Df%p2{^KB8KRH|?7?oj|C}qXty-9nmQIfBj
zmJ?J`ESSB-EKt%clrq6q85YCH#2pP>h&=&2Q}|jizvE!p7xl6m>3F<*Sx<UqpH*sl
zF!_{wVxNA&9*ctgZd8~<npH``!`+3=I)5@lzVypxJe--G&rdOQk48w5_%s3YDr&b3
zQz?!4o=!?Kto)mSf5AYmb|d@Al>?fI9vB2gvu51B{J2BODZ`{-h3xqfZt0C06KUr=
ziq0z5oU&%lrVnbBi)!U1-kuA5Yb{-ONv%%H>}99vyBlgB4furY``?-Hy)u=kcMf^K
zP{{Y-=ldYB57ufQp1FMR?EkRnrRe0W*5LHQC1BRY^QQ|e!z?7^HstqhMComr1C0QF
zROJI>z($PpUA*Gm8%}o#9(S)_xOesay({mVh_iR~Q|@Ib-p^9JZ+f8lUhRFenEO-}
zHg7y)M;`3?%ZmcjN-eV*Ewe8VS^}NScD&3&S{mX<)y?*`J^^^+K`X}OVz<#n$Gp})
zEw#ZdQD?5UkE(5B8EW2d+a@1C0sIIZh0e7=QBhFDadnihy7V65c6@t##!+#f!>q0L
zaqlBQ;jwzQW8uk>`O7kF-WcfEej>wXBg%VBY;Wkkb(y1(*sqY*c3>aVzvq85YuWyD
zD2Vqq^U&(g1)%BRmpFCLR^?dLXU?4`t3`W~bVH@op9`ty{5cdvv6#X>6yy(j7<~d}
zEuD<lX~v&6oYq^^-w`h%WWtZlxn+~svzC9*<M!u&4+Q~cEt~rQ^kC0gO4g597SYEV
zfkQ#q=&>?A05lyBJ-v4RFUH<8sL8(VyA3@Q0Xt0v^-=)~7P<<Gg`$Y4G#g^0C?be7
z3mp<#=qW%#PeKd5D~QqstQ1iZRH}+tNC3k=&NF!3_p|qY=6%2L6^3D$`LC?sI=;Wa
zR;WF%3lI``_n%pd*L%Ij#BHa~wE|)3q(wiMUvN6oZy)YVMx2he;N<+j(4)Hi+Z&Gm
z-&sr8{L;u>Y}W`*!r`dZRmiMGo%yB%fga#=1Z+EuMnPWWY}34MQ_hQmJUl%+`*nOg
z@kRkUYeAh3dt1MGwut%t<ld#706madi#h%H?v&{C55c@yi$DEY@Vq_oDGz#V=DMZ*
zH}oiLYTvc}UHQ;m!$N^ha5}6n?LlWPhRP0qqac!`xA93{>7NpK(8G}vmC$yrvK^uz
zjL#&wKZ98m#Xm(ax7l-Jvy$zrDkYK~r;LUv&N~D~wr%gTqi+dX{Xd{bOwmQKOa22r
ziUKmPcElmj193X&?_9;VaaoP1(;=pMwWcC%!Re?XuZ1Yc3a5#}M-S2`irO{C5$GZQ
zMehTwTy%#o<vi1zPf9;t_90L{zx?f$@h{qgS-?w1@>Nmj@lEf!?Z$##4?gBBL_y}N
zR3_^LtMM)MY3p+*AEnu*K_0|l^Y#WQgWWAi6a;}D*CMsQ1R_xo1bQGVm)6bY2=oX@
zk8U5hb8*4x&^$Z@vlfw6CA*&WJC*DzSr4<8Bbr}+zA!}wDCU;QEr`>>gC4Jzgly4x
z9E3U@+1G#TTr2+qPRGMP-}`TM1N3mekv`3RcW1hGdS~azDy@OQmG|1W2W>QEe+b|C
zKx;5mPrz%aN%2%==R7No^Et^aKl(EddL)`w@n$Hw#m<J~tZL`xiI{fh+3||*{Mj!x
zZ=9QW(BtvSZF9XN>kDe8<~Ki_)9TWr&S{P4gVQmj82?A_n&l8cj}T<m5^}zsGm>2Z
zQIK?M+w5f1w)<OiKl-=+nI0Z&;Udt33nD2xYZ0DYBRChpb2<QeTpG~h4g`zYO!Ax#
z`+cevA3T<qG^p#lF1ksa<V8W~`|T^h>3E6V#pR2*(lZ&n;B>6+7!2XfTG$P<i?@fe
zDMBiWH^mIKp5btzX#hRYS<8tegSDUQo^17g7UnWwC-XtNacfL;xZUn`vhx^`h`Lk>
zWY#il*rd~XT+AiTe|4s95aM+7VNvLD-@bv+jYL6svlbkrLe?7@$u+9U5FrW@a6HV$
zwg`nD`#1>y_!|W|xnuE?sL;!sFK`ZQbbO4v+kAN|mELv^oDO?^1G)b|54jSWke0oY
zcvpB98U?Z0N%m>a(kO0;K%I`C8@AUOh3mTp5d2RbQjD)Ry`A+U`AhiK-R`LpXGi!~
zR&ZI_XcT0Oe;FDDQRzDBYqu186r2vSnYGT#RA3LQHW)wC?fOp?MEFO#;-V`n55cU3
zTq16&&oDYM6PU20I8!Zxainxoa9z*OEUl-EqkeVhtVQpSh(@sS%T${o`fEiM^H_XD
zx<)C(1WkpUva|ZdM4}*&3d#3=mBW@$-D<ntqVV2eE;?(evhd?xTucoeSu45Svg**!
z{M+Dka1iKGTCg0}CxTAFkK_P)Y}vegMVnP4x;|N$wImdoHs@a1sT+twk40akuj%x4
z^z9O%AI)>LthRBiK%*de*RG<ikg|%W*SFE-!rsmNF0WhU?6O6vA5tL|ilbxyB;@p)
z?DDAWipamU?Rz)kba*yzU0qgp_Uqapsf$=73i57>Y*`a=^oBRC4x%8_wci%`-x=0D
zuh5hDU>|Fn<W$ak?pV1H8U;Brz+bK?i$IT+?E}KPR`s=pEN7=#yx7CEWik(3l((Mw
zu;?PpTDAtQ+q`dZ35ET5gJj@8{Plw?!0FiXIzRj>(6)jPjhfshxm{C1UuOV%NbVq{
z>VI4-U)j9h5Sg`H`p4-2Rx=cV9-mY!Icqev_zX>b{ZZ&4Sxh{R8Mr{?w9m^N;*wun
z3)etqEs@2W!<E9cUsQHr6AtdUv=47a80;)y7b8)S{f7s;LT(>euYf?0nP(Bgff*Z*
zjv5v7HL5ihW@+Y)s(Q|d(<DpjhgXel0O&zKq`t%g^rG1T-mK+|fJ~2$Fd7BP^GBdZ
z-Pd2(z4{YN|No%}6`+U4e?bq;3WLHg|3Z)YueVkCpZWAOq$1Ks&+NNti-6i+$v4#5
zv+w7x1V9vI(tl<D3uM-kSO-qWoR~yNMZ-oImsrgW%5<`yIMjWQ^hp|0qxt1=51YEi
zPzFA3I#$_wRLwu3`i`IiFA73#OX5eJj!3r);B@RQ_^p@qR?M+{a0HElyc4?_Mp<G8
zvzF}D?)$9%jQP_IYRb_*$oSbP&7LOH-_Qq{z<|>MeUP$hGzzjZQf+!&4>%p2vv1vL
z0sl<?g&yojZ}bJ%TKPc~guMi2Erh6=q50$fi>!FiLvz~?Vb6C6^bpWeoOvFydPJ|g
zx${&#4|-g^t9r8jr^T*81bTe+h?>pmt{-#9-g_NzYz`=j1Vlk(T03~qBLtuaRdDN(
zhhJ_}b$^v}se!9J=V#vySF@Xr-TPi$C#0jLH}mS7|NW#j-zTGxD9HWCSM>#Do5AVm
zy#MF$z`U$95Rd!w!(QNY0Q3;$1wy2~ArP`y%dgtZ51F+<hlAypn=M)>;uFe?g2?!n
zhhWP$itwPv))D_^5#d(N0GPEjqoWs{io36y?)Fa$=wbo~Gy@ILA;}?#f;96_WZzTd
zIUQO-FeEtz+yjOr06ltwPGk9GFu~FQJ+y)aJ%jDp_r+NV@wo1Zxi;bpvlaof5J@Ze
z>X)u2R?R}8hm{|h<|l6z8tfU$4Kl<6^uR;0q(_(_gNxC^#q^-`g8)tkE{TpiPQV?P
z#-}z59;XH9fYw38>w(kJgU{6x0O(Q3=HI3kR#FjIA;XVEL3+UK;5&gbkcLg+jrQS7
z0eS!fA%shr1$Su$i(&Z0%pzXfM_>sNefAh(UyO4FMo>EP12%HVFmg}^p6rppK*p^?
zk};t^Jt33W(0Fh<?4v@PLt!d{s2`J2pnhOP2?QCDI2jxQKv)Ec7Q(4Xg0!^|g^f$a
z;+FvcAw<hnM$5Jc<g=soFkwofVI@{!|DZ;NN@WZf6%Ykc8|8*Qp!0##0ZN4?s#NGA
zGm_Z7mEmn{3^*MUE^(rSIAaEME-+%Wh+ZoURxw@(pocOBW-T_j$WeMEW-{JZHo>k}
z6oDQN36q{tj)()203T(04<zs$kUv(5TrGltkuc0!U`2AFE^$#MVKGif3MUlI5Co?q
zyppI;8NFK?q97!2Kp+Z2R1Vu|7L(KxvqdzPHX5^|5<wptUSuF1OCSoOj3ht+eH2#4
zm5>nhQI4)|EP5$69LlgEW=sZS2X=*5LNhMmenrBx7WNt^AwW9ux^l8NE7XIL*uzQe
z<H`~PS_r{7;$mx|2<;R+B7P9%j7YIK`1VK|q{u!di4>C}OHS1$Ly%;KLC&ot=Z}WB
zV<`s!edyCl9Vk6?3brfagm!$bb-Wc0^H3R6-y8qfA*qp+BsUh)-ka2=ovbLA_}VMc
z3zv*xB){oRz95|<?Ld?=N*ThXtYV}@TMNXuq$C){lvR*6T2p_^#<CeyjmlU?Z!D0V
z1G2P3UU9<Sv`Pl;4L#!2C{0=?)ygaKEH2fCnR=C!u*xxNjY{$}pg9hS-41E<V0`$d
z`5FoLYZJG46Ss+_M|!2ejw1$_t|doJHVWH2lb)s=n@OT__qWFCRK~6xpza$b^UF~T
zM>8tCBFyCCrM%-Uj8g~gQvrIMVJ0c)h@GEFy{H3rN;2Lv%buKdO@(-)FL^UeM2xaO
zd1ZT&v%STrWNm6nWsEPV83Q@#${7ZZ8DTTjh^maE#*`SFi0WQiyf?!VANgoBp5mR9
zY@BdzCbLtSY3I#cZ<A(U#mpVcQkhBKTtzJGBYyVEK4_MsflvR2%h6Gx?rDvw#Zv=S
zat|8k>N(`{d&d=f(W3j}o{rH@+F<w<Q!U60Yn!}_UU}b$dF{$fXNJgg?Zhj1<_DF0
zl`(>=O180Dwwg*h%vwsl)4wPe{ID*#Kf_IDlM7b+k`J^N%!7X-$1+u62${t14r6uM
zq`n+uVO;Wl(DQy77CtjdeuYc?Lu77L$@dk_E|7~Za?CC<PX8uWkl2#F*{NV!EVrIn
zFxN|cg3n;JWWb<B@J;SXFV@~_*7H8re%+D-)k%lOlMH7Q-Z2a1+p_XhN>5=@PEztu
zg{6Rz;Z4p_eN(hGtUz71ct;y`k9Bd=7~P>dPN%KR`E+KYSc#i>g1c(r(zd*G9qbiy
z;Q%?=tc{sJQz(tgzhzvslbKR3SD@_}mRy-rD^|8oB{$f(j5}H|KSSr&WeJ%ugvX1;
z#FK8ymq@l{{-_A?kk4A-RCtMtuYz$*jvVph7(sQcsz5cT$f@Y7cTPnsY4=!ml{kGH
zrGU=hV~Ezoy`euAXGD+1>CV!+@C*r`RH}IGLEYMZ$J%F=<qS%)Q&m--4{@tlN>Fuv
zuusM3oTBx;r7D%xHM+4;In;xF)IT~84~^2F%x1K=mc_SLy5umpvo-0Hk(Xs_Y0NxN
z@#L4HiATZ`O>?rua?^s0N|kbmfx0<GK1HRf1!9RV%Z6Q+BtDkwer!5-(@X*(9{*f*
zI=TCaY9g{`*>ctG+}sm|Iybvqw^xU*8yvn>8gi?S&}cGzYv7Q(i$aq{x3dq;{d6|=
z{IL6ljkhm%H#to=jbcPR{3mXw+_qf)OKQcd<M^89)yvHl-OUL{%#~5-(SG2>4uBrH
zCz5JT9KxKWNt`r&a`K4KDHDJmcTSqCpUSN{m0xq}{PMQ5rz~v$v8bp+pvP5!9vCx#
z9xm#Zb>Wte!z~-aEzM%vTWi{lPpEgysdp(neV!zG@x;?h=^8z`8aIod_W#i656~P?
z=<pcQ{CK9r|A)jAnpRkP2hKn{_=Q%Kfp)yWl4qDDgEu?D>3CDP8fGn{g=;X2x~3O*
zO+~Nyep3;f+y&4B6Qd|*CncJ;SUO^vq`4AAL6-B&{cnoL0_}i^$LfjhZ&ZVjKY|)b
zBT-8GgBLHdS<gO3Gl){uo$=}UKGcAh;U!Q_!q@X?$5SNY@t9En5fA+Uu~l+E*Bqx#
z-_v<{HE#5Iid5?Uv)%>&oj|qrKo>05B=&Pipq8PE$Kb4H_m;C>3$%l`V3|u?^Drc2
z(Z&r9J*k5Y^Ag`E|0YmtzJ2&uJU@c_cfoS*Y#)zyME*DJxY7ULv_qatsB9mgH8oPu
z1ghi^<6qhlHh(T3Nua*SIe*?6MlEOp_2E6uY4-a!@AclN@Dix7V6h+Y6XyPSZ@_(e
zsncEB=5PlufeH&2pdIH%q=V*<5TBw87TiBN2h#BE=z^sY6c4q}SJNZb*QcjPPE3rX
zNB$Dz9NS|c?2r+?UevlX3W<0?0+lgzWODaoN!@ps7=LL;u=15eNv~oa?a;d#^D~Ux
zRwFvRLn@gQmUOejYdFPY#|wy|&e^rm0(Tfd#G`LVCz3#g1<T%<&NRuVZlC^(c90=k
zO3z4`iQ3hXfi76a#&Wo<M>A17%loG~x77Syu;|rP{G}aD<g^9a(fVK=Pw{|=N7xs=
zZ-H(dy2F99otl!#C-N(Y1Jl1&eJHE`T0Pk)?_4u>=prZ{gQ`b&WkLd#o;|Y`Xa|}=
zl{zyH5sx#f8>HW_ZGF7VGF<eD^!cRkjnZMRg->LUt^KQbP%fJ4@@PlX<{x^S19-H<
ztz&!d9IANy>^dNjd}CLW!jJanMtbQbFHARXQ8#LuySQ!3U)oXHjVw`mE?u=-NT6OT
zzpl~b(sZ_&M>}p6@My;ukM}AfTiHN6_Odl#!NMNIZHr*<e6x8A=i||1&e|``H=b>W
zh(}5rl0fy|noH<tg@{Mwj2_)>aAus<wAE)K#$`%sW6Z~tS-q<12i5B(jqI8y8-|@j
zC!ef21_{(R9~KrYFAtv&UFDVzipQJzhCS0mfl?2C57CxBU=N4rz0i480tr;09rJVF
zJ)GzNOn0WubLZ0i@!a{L_gwDqL;e+ND^m<%!BU}rNQ<X<tYb@wazFgLV6mH2y6+Oe
zTd)A_C<$1eqPaih%+Q){=@6dcF&V587>s;!9HO5t%cC8L;_*Fn-agpCR7syNWe{f;
z4zxq&pkdM@JfS&lg;I3rR`2gf#6zZO<caorJ4yQ^>2j~IA-f)Zh;X`dQGQslNz+bR
z^1iQuEE4em+TlBqzD!tINOjp1!2)PU9xVcictqU_T{oW^;baAh2a-T#7}=j`h^5V~
zmrDH}Ws4+GB@S(IykKmRKNZh912t5mCmWpy(FMy5PAEb<>h1`x53D>Ga;Z?N`M`$t
zF)i&^be59l^#gXj(0}S^^Ml;eenq3S?kKcBV8N2D)nwG+>K{uOIkHiwav|cezEKzV
z%<%SpbJ;#_-POJE^__>OmQv@T#<&1Mgb~`&Y8K$Xe<dvx6c6KPq0aovR{m*PyZ2_O
z!RANltNz#@KCEIM4Lt`Bh<JR{4?z>CKs&CgJSF#?B%f_&n0mCnfDKIc?mweTgIk}b
z%0U7Z-N3v=6ptf9{wK4ILGk#trl*-{QS2CzZ)1>i?vIK_6{I+Vmm?Vv8(cj^JbvZ5
zKnCQqv1QfZV7_ON(AJ;$?qd+~Ko%@Qs?SVh5~NVYqYWY+D+*PCfvk55ZngPcM9kZ~
zT*D-2=e5_xDaro!hk1%ern|qRWlo>cU)m8eaI*Vz9abA%u$+EpJ_NKQ-zCJP|J+Z1
zxkgB!`lP<L(gMW;Xh)_KZnTkqMfct2GmCt1Uv76-_d~=(VBfo`K}et?5s&J3TLvzO
zpJt2PnXeDo-s2(htF{1DJY0W2#Jt<QSQu!Byl34$eHZB!?Y6>07?DMik062iK}`1&
zc1tr06c0$C_Q=eu9olgS5~x5sHksbsk<d11S;1bOxk)JeqQu3OO|W2jQ25X739QLa
zPoN#H1jv9)$-#o<(3D(4`^OEsoR)dpsg(mJpU?$M{*Gmc;^AhEwFTPIB=I=}91vat
z75-R20@<kV2Md;AB!TMIp(duI7QT13va?Ypc)Re?5hUUfkPx)}QtHUToi;04Y<D3e
z7^Bmu;*q(o-oX^vz+i!P9CbV{F!+*gs?O}C32Ri$0PS$kEzlpgc{3x9(vIZu4R=yS
z>m<uq(OrV;WoCPte)}N{mMgk%MASlWBRYr!Bv4;i_?4AE{Q`=I;5xQ%#W8(n*D#*q
zp*!g(35v&8;ozE2dnCN)Iq&Y99#on7a`i4GP%+&en}mUOfZ~CN1nSavqkCNXq@pJS
z9&g-xQ{AwCaK&_hoCYjdAc1-g3lWdQd#6-A>tC0i^KZ3$Fr`ZG|Fk)Zv&35;RXo(Q
z{Xp?>OK$KLekNJf73A!nCjV!|P?N7BQPNow5~v96pqlz23l^(_Dm93B<aNr+%o99R
zKflEz2~_)IKC1lO8^#L}521b2RgeMkY4&;delmE^Wb!wk`RW0Yf?!S0B=OK=HG|8k
zfncDB8x8Dlj&c#)X7+9>4ipc~0<TpgwxTKJej|sE%^(pE4QW5DMIF$N2ZF39h<HfN
z-jA~tKxs$k>^r@;d<yoy0>MB#<lnQ;4p*t1Or85Aei2=;WWE<WMXy~R(acMresy~I
z)t%<E>X9BA@o<+8nCadYT>tRG_lfg*OCQ$-&gkx)nuY}Gs)qsVCkEy*6#^-mzOY~s
z9N|wH=Eu@~CFs7)X*A-Y<;R5b27zxOfhxnddc;q507k)li(tXx=?@81<q^yySn8<V
z0Xni>E1+6GK;1Jy%PN4(3SiPi+lB*Pth^hlhD1CL83w-DD1szVdjd^I0>7^eGN<2z
zvB@vX`#(K`Y}f)oJI;*+L1u#w7Az<oxk3zfBnInr`6^BZyPy#dpd&7zhxmrbu#g1m
zJuDwYJp9;xuwYrt!f->0p|D^P@ePd_@h8ACMiCb~;xFKWQ%B_xat|)00!IOKqlnkF
zLK3LD=r|^~84rrcVXMIFfI6(g$~?o4qRSYd9S_)HwK76AGD46*J?IkNObp*W8Pv`e
z*r_Ja!47|}6@f-JB3`rkohl-fx+31ef~6-yPAvrKliEgpf?<dj-$YO3(n-t&8{@AP
z<x9u>_KafNM*-@`c10mo5LzgBB7$a!<sk$M7Ha}u7XcWF6g;OVapY#)G7c^tXa^&j
z-h*GwiOxekk#*WJH(g>jX@}i(f#VlQP*qKq8@t_F2x!Ntfv`u0;SI#t<Am_$W&uz<
z_Jej|76;Gl9{Y$__7RA7F&SqD+J##DN$dCzGLdqSKm}2xE`GTg-x5p$cp?|I6TXf_
zN)ZwqTQJv17@!?Da8a{8QMbSou}u^rBzh}j5Zci~STqVhE)iL<^ok;i2ZOk*GCC3%
z2}(P>6-hisvX(^JfQv~n5~j(L(`3mPFytMgu^Kp`T{s~oLolC1W^u?6Y&B4hJM0yQ
zMmQpRdnm`1<4?&Zo$!i(N9R*w#W!=}FDUZ?bhwI3aD-KiVzP^MvNNn=e3R$6hKc=N
ziQbh+mQ`$&z-LSRY)uR!rG$^-qAH^UFr-**Y`iS#2SY?jIVOcf-Kb5TvnFTD#xh&T
z8rDLvV95tSqDIlPrs!J>9DoihC%oG#!eo^4P&w(5Q4)wA3ROv9VRXtyeUnLc06=1!
z1_{(@twe55lqV<It0fUDox;x|_*th6d!>w3rYHBLe3hmCl+B3uqEZ-CP7C!9hk8Mc
zrp_Sma-az@X$R|Q`$SWvbs~%%Qjg<O>lvx?t*O?c39ZTr9bO3z+G$QL37g1ieU-`m
zqJ*t8Y1@s{?`Ws^lhSpn(#Km;_A;aOb*NKDR5F9aJ?NM*D=T7XOujTg&F;;};bfRW
z$3rFaq$9<miefbeuZ_$z#t6DO-<Nuxk+c$%c7>C)UM2Z@OI9x_>g{N<8nQOY_P}S4
zfaSr&K^^t3Scac5HQs@mYefg$1LsH%pP?R^$q<B(^_jHYYMCd;Xwpmyk<932Q_Ol9
z>!tbM&M<75@vYWbO86`WGfTOTnctV}DwcA~CSAe^<L8j`8JC0WCEg`RKak6a*3PBi
z04va&s^~4=WWLsng5KOh94$^IFWx4vTP1Z_AH~!wHF+!(P=_7NZ)DSkb&{PNlQ|<<
z6MgyoYU#yd#8Tse00(YCs8=+n3K^gL<`g75&;?9b##I?nGjwAN!%QW!iOrJoro67A
zETiQ0i6yNJE3_HqYpE<;W0U{cCQXr&KUS4iFq6ib$#*x-+3b_!Emq7Cqds7Y{IV_%
z^e)z-6gR8Hw&~D1bQp0qjDt>@HH^#^K85ea@@-YJ))?p0<&qucie6RbpY};)spRY;
z6ZjMhR80!DhDBeVP1&JK;u_~Z(P0URm*<RTsB?<lR4HApv_$Wc#gvle)p`AW<@dx(
zkB_I?S?4nxOM}G|L)((SjO8njS7^zVZ3)X+*^;x}r|h8)Hn6JfnoovvPH{wEaq2i(
zOg?kJQ@ID%C$ooH;?tISP9^e#T!MmXMVC?92)=Y|hUwl?Dx{cRJ6rKXtOlc2)^NJ=
zKEBLemEJ1P+C(bO9IY{FEk1>*dM3}<KhBc!VG#Qu!dsQpTKkq#xSYl}Bv(-~TlhIF
zIj=SCpV{Pd;sp<8tLs!BvTbUv`aGN>RkrzL@V7neoUPotyS&M;yx5^Un^LueS-Yse
z<X#RRt2+LoPHDDIg%g8m^(JekqO`EJB0{|Kqv*q>oX6XAA8vOli?OE0wUE{_NPH&3
zs&{gADP#@hTDuxnG3Tb@VOM(v*G=V(JDOb8x*N4X@#uHEHQ@$~#9-xh&pS;<-AxCZ
zZgG!ly8G{Lwzh1xoOb`Q;<lZ~-76vz;YqizW#4esY>7MKAyzKp34huH9(P4N{f6&-
zz1j#2L;lzCj63G^JLcI*tsyM)`8xBR%iD^MoY1^{Vvl>9&aV>{{X)mOjvD@ItCKkO
zNa55W+f$9#PF?!P!tS!gg;(tz{ip2XEuJe_zErSucYo?uYUvaI)YIKE;MdcE2}{_<
zEIz1BTBi;Fc%avD{zb>vxsEdi8dDP*KhJdjP7=Kt+bJ8MIoIBK|3~NifF|E{Ey1&0
zK@D0!JEDM*xM+_|bS1=gEZ*^~Z~JPX9WsknPZT~=$Xh-4{n?s`HHv%I%qXqFx<22O
zy!^S!Dn+p(#oshV$?wnCe^*?#Na_C!M&LG#*}%gP>G@wvdyWm(;jps~?N*aigD9@P
z_cGD#ADctCyZ&xp)DI!s7Zi-N{|iQ-ZhAazI&i}u&av|+vdw(<$BF$)ec<z-+b|9I
zPgTW8+T;4yfC?$<e{Wyjb1Bu9DSzvx=xvylpPSfg^qQj9ya;cv*#7V?avP={)j;OI
zr2nUGiljZ5Z(CB1BHNd*&qv=q1q}q<zU1pt7jDDcsQmG1o?y_vGTHmUSfg8CvE_?%
zHHZcRX^)h-2G6nQISX~uH;I&ENZNz_Baxz!M_B+PZzr$X-WS{;GjMxh`+{m9Y^eb0
zdQ=0UD{23m_CPg|P^lo|QH_r^3)>gH9fQs73uzDG(ILMVY7NwAkwcG_bme!5O6f|!
zT6cNR{1NL<aps2tFWYFo8v2kp5vcqbwl5AF;^qTKpThQK^fLubd)(j(3>&=LjNXRf
zbnbXK$A275Ud~mj-v;<dGH6E?J?-IyjPlOd9T(d&cb|jp3#9|S4Wj~AW4Jq|4rIGB
zR1ORW4k2KqacoRGuXT*M3%L!W_grgeVfz9aNbUkL*@bE#s$cYK%ua9FmVYVd3#2{9
z^Hj3}d1;UQif<Wk8)l+x9KgsUc_1cp22QmwkCD#%{rb(=gFjQVPkCVE{ekpJ03-dZ
zUC%~TzCW&*v0JE{DqKyPfV4-_<^wHwyQ!9q7h`s8*j%1l)V8VGu1Iyuv47JZ2r+@}
z3xE+wd+2@fO-D75k{64&L`>Fop1kh<s!74^*K3QbUrM{rI_3S^X?Oqbkpov%kF@pi
zG?1oM)5u0<`Yq`rY+pbFLAEc$U#12E%g;0;X%F^bXu%L#H}(3s*V38uiFoxMM+3bL
zlWh5vv-8dF6HiC!mM7ZL+c4v-;*_?D5&*7Sa|b$Fzt&85%<5IUtwrmmHQ#x}WY_yS
zy^h20Ym{DE-UwX}bfosjYmf7_t9Tj+Y+u+xJvX&<Cd%J)^}bf?b<BM))|1rv@&3kr
zuDW*044U>h(H)M|O@-$U?_BMQw?@H;t>AG#F;P>O70WYd!h52{k9i{7m(-0iuzevT
z8i<nUd>!0|nG8}32las+rT4OH(O(T@rc07*;S#VaQ0uYN83P5wBWT@pgU)e<F3><S
z+0yoklaTfpTpm#W#0JtHwh|Y&m?CvkWc#vCPN}}}1nYYQWJ*yDqz|?)8AC{>6agc5
zAyX=-ZKx%)gb=*`l9G^vp*&YW@^UDoJ&an6ZCqo_3HxPp2`xu#KE%=lGc^twwVFpx
zt?Bc`Dn~S<X%ANTCw1EPwoPTO_%61{N~oJ|eZ7BWoy3Mss0LC@q+p(GNI<|yEGa4!
z)j$sGKO(zK1ZXIwK6Q32rrc$3&}!;Ex{LT@4FpSdx_P%@zP|L|4apE>`@-h7g9hTz
zX^L!LJ_e)P7s)sop??}TRbDW@zG)~m{SN(rk@j&M+_;%XvZ;m7Y@u#iKNpDBP04W?
zPv-vOlFTi49ZasOoFH}F%JKj(0=NXNn=WFSg*bMk$-PQCYsfTDY<&s1gmL8V*wQSO
zPKFI=ASf<*mGAv4=ZuiQRTJEXNdR18m}B$8F`~@IAkX=(sz#qqcV#1rOU~iyK?4CW
z0=Puj#Ol%DAS)Db$+9r3=)IR%iO^Bmwy&od0VAcG*J!l$E@&WEJRF60_NT&am^{Z5
zCPA;wKS&f@=We-{tq<Fm-=Kkfxt?72=H1k7>;f23@>CZwX!cv|3TY46zI0{=^XjJ4
zRkb5R>P2mDzg}4>TezTsBy=zN93iy%<*bxR#dPgt&<(}Si$jsyFznK8tA8Wgm+6P|
zZ~0f3v4TP;FGyflH~1|@G!S-uegrG<v`L`YX{ej#yGVyh2O@P-E$sJ@0BIDAY(cj#
zpn+&Tk=ov<2Zv_Rv<KXVaqkbi^s}ew-Q6HU&>8&Nm7L|7iaTN=+CQ#s>Rya)UnD{i
zFk*4V;NG|DVEx<=Z73L-i&EeHQCtwc4FlVk99c2YK$3<w2coxO@^>BxbO}J}roNK5
zX!AD%mhS#22;?Mf<x|i=`krmk-zN^_#MrV=CUJG6Uhsu*Q`o+M27-tr$78Er78wdN
zjTVcUSIjKWN9v|~#tnP=UYkW8h(pW`n1(#G2q*~Jat(4FJ<X;X@(Cyy>9q`ny6K-F
z^fpY{?WJ%V#@Rz&6xqJq)&J^B0Wk8LPvZ5e0GT@4+sR0e>QnmPkh<y5)%94@Nk1vY
znfHGrD-aFjp2xrdR!>W91;k=c!wR<GmWugz7re<G&_FyJ4eC)aqBvZ!mV3x_D*C;*
zRN1|T)$i(D;|pq#w1?a~!USwzdd@XN+T+0wRnH53&(HaHh3x&QihVnB;MmL(@4BB^
zx_?HGX8XbR#hn4<WW1y5b*Zy|zR#a=TTQ<QP5Cz@i3k{}?&~!5Lo^VV8`Wx`O{Xh0
z=hled5NbGGKaHk6ZUi-|o8r*Asb-DhicZgcFE2<DLgwVh^daqWP6D<sGIkxVTRov}
zD)nbLR^R)%o0906X3pZsfuL9A_kJN@<YIxqs?DjtHJU*K0WdQA4*b`8F$9bx4zQ8i
zFj4bSORf!|U?lt4pJH7apMr}o)J?znPPom__7&*9g`+dyW6#TcMA9A)xfb-blX>=m
zyzR?<Zg@e%pz=4*wzd!R81{WK4~#SmVw(jsvVF5Hy&>%(RUxoM%WtWb52As1`fWAy
z*~;=;#r9hzbBDKm*&uTVIq||mwl7<o{TE9kw_z4{Vc<3lvV9>2bbDa-((eK=*{2m)
zt&gNV46Onop!%^X@JRE$@enL>8^$WgeAE3<#ru2}L1$!qp-^fo9c%|+WK-~Q>EPpp
z;N!l&PDEd4cCel_Qa5!o^n<$T5)_+w_k?&ihuozLC}Q~mj363FD3*UMEwmoZiXa*Y
z7Kda-%y5ZB9LX>sNhUyi5=WE4r+Q+<2Lduj0_a+py;>NiCni@5a}b3mMF2*u!i+1#
zO;8P_#t;j2(>nX0lRd)bJ;DG+VEfWi5p-cP{DPSffRR&b!B>gF_MQ=tC++Wvc-I`U
zTR&tF$cb4bavKJ`65GfzHvc_#q_+(JlvdPFtEeeDUnr`U%+jN{BT-AG3H%WIlqN{g
za9A%KqLy?KBsm0xoTx=3<U|oKu8#pQB3l`~sxn$m7PFRvFX$01-xOBj8B=a0y16%I
z%V^jmD6#DziR>aFLDfK)SRGjrXg;)uhJ#zug^hR_D)c;5=nz8?xeZep_kJW|w{*O@
zc06br$o8cra!gC$3lX{O0vZU2C8!1x^_$KIX%Fy9uA^SbP4G(e6K`n~1UMKV5E5O9
zqLYcfqC{!s=%w1x&{GYu#()OGk8WQ8KdcqSK;0BH5NL~#D@jQ$q>ZC7G+-ub<P2-F
zw?3K2Ow?P*x*YN)X-bhcrASt|P&=;EKF-i6;#61M14bN7S&sEaoYV#_BOU=JzL8&g
zlI*k-uE-`|!X^9wU{aURBbw;SRp#sOP4*-u`XIz41?a?mgqWlNvYDtPe&rA+MPmfj
zNPNDe-$tZl5;eskEOj&{KoOdt*lcaG08^yiDz<<GCr)T(I7(+TR954jvnda>lLoAk
zj#~?y@=CI>jvQ}>i4fc+NqVlF{L(AAhm-~;NIxf8*og3fktjjH>~u^S9wjWcCa%B{
zLq}8ay+kaA%CAU;*WWabG(*ZL?V)mIX@WBu*<Lhthgi|7Sh(9FIYT>KnOSR;YO0*H
z0-tK$lBz(C93M#nsp6^^v?vm8GLqd!k(rNLYvNt&bPZ+-q)meuL^y%6zmKS>OyVB)
zrW*B;s4W>=Ml%FdXo9WeTpaC`cPxx(ENv*4x@eMOsZ0AZ&xvI<C}%YqWwkkEon=Hi
zFtc9Z5?<rduB#-v$R@7rO7q|(Z&yjVN6H@M5PTeods~TqIvMiT8A14rkSeN)ju?I{
zBhr|b?Le#B#E3O!BzjZGW3(#KRFhH05!s{*HiBu)R0U>IrX!O+lVr<a0xcOgPQE^t
z1?OS5dgt86XMbwRS=5pe%*n2k%Wcr1##-klc;!+^bi5d?y^sD(C-bBZGE*T{G0xZs
z8EL1Ub4(o&%TKFHZMM!|Eta+xpFifEmOqp4B3Iz9U9i0`@uLGby;>}KW-Mn;1+!0%
z-e8PK6M{}L!f&YU#$<0b8bg-x9I~SFh1RW%8V-Xd$Fx()AM%b@Qb}8<QUsfoYomO<
zoUBdbY3`2MTPWEza>d|J{BbM}kYj06NKMQbk+v8;Rhp0^Eyud#kWa~Loj3^7zMu>C
z&oE5o^E1W@Px$0p<S-}jr5mc#Hmel4$)$KWf>ctxokE<m!PKkd{t#sysw&g1j=3>Q
zy?L4}?o@tihSjZ7xU9Owm{a~1UnqAvDZ@B_6*FE*HDRoZd5xK1Q(da6lX%XgphBh6
zPrEGMr_y(<z@fS<-iW2b$Q79_?!=RK8I>&J`c!#>z$Tm8Csx6#E>tkdYWJ!JF16k#
z>YG?j#G5pg>Y~cAqHQK+JDke&@nw{-;*^|>PWh^ExsrXe^w+w17WgW!oXo?@snsnd
z{XHdSq7MR2GoM;ljEE(F_IdD)$+z6M{<}(cnRm{&oSbTMdi;1gDW@{Jw~~`Xoo#z4
zI{T2{rmEYgDgj^4)Ga*g-LPD&x-cxYc)V~8KI_xz`ma?9wc-WgPKoDcO9yc|lR4QO
zoktJxl_Z}>zi^M9IL27zk~+m}+aMr2o1uTY{FQtIOS^$i$y8}_jc)R~cEn9{y0N*@
z%{A9e-?GX0@GV1+CNtzPjQhQ7?py#Rr^}uF6`C)2G@m_u`*Qj1@c!nT)6F-!T_i$0
zyhQHb6_H4g@C*pKiR*4jsqtK2E)uoU3(s=h2pWil7**{Ea1zyD=J|I{6x}&dxVtTc
zbz;8mgh6Rr&5@IbFP}WRyxsWM$w$CR)Q(xjx3@}Iv@2K~vbE^CW^wBuOV`VmH{GB1
z^jmnwTlOnhy;HCXTHX;*Y89s55$bNW_LRh#7wY3R>Q~&<zlEz`iB*T{hpQW+f!uJ@
zoKw((?F%MZG-zj6aD$fcQ?1z8u6adm@jPv)o00@{mh5?!{zIbwrqa$2t3Cl3IlKD%
zccgCmEp-jlP1&i6n<8YM3&%X?^H;=}E2*t|v188*NmnJANB?UV<Ui5~?`|$^W&TjK
z3aR=ynLh^)$UGa|7bP$+nxs{<-Uz?;g!#*!Lf%AXBD9FdMoRvhjlkuXsCP@NUJmQg
zmL(s$i#LB?`(Jl+8=T)7LH3k9i%KI~-rS$v^tIvee@$fG*UpcaW~de{+|A`>PnZ9o
z?2bNvxpmX_c}ja{-f*Y$kK^r!ZGP&#NHcnI`YA7a3U_l6Hj*=6c)JN@BX`qpCFcKo
zH@EV~^R9Fg>N)b7U*pe?#g?I6kb!xwdv^1mtXfY*8tHs+cNX{kWeatIjl9{maQS7E
zt@eu}FP<)3ez|>OAV64SQ>y>KDY%;}b7f@J?!T8`217r_*)McKHkU#6RGDiK8NTDn
z#i0nT&-9^4EhLYszi>DABjJVG4_b`S4r@i@HAOq^_MGGze2V{N<@JxTWu(kMy0*bQ
zHu9NdU$k?v?z@t|Y~<E!>){>F<{zK#fV;U@sSgEJMz$>#ni<}9pUaV=2Jawmq6LVF
zecaX#HVGn)FtUE!Lc1U;O#0PV%itVtQu>(Q`#V26ncRYuAC6i}TbN8{HgY$&da!kz
z@mvt@=GN<6T<C(dYrL7z>*#lF(<`5}LoUAn8`1ba*a~-Z5jJwqsg-v(cOqrB1EdjE
z^lt8r+W8uR4(NhZZ!?}NLnbmSuc_5PLnbm3+aPE9_>e;3HeU7=CNfW+-=6s1^xS-X
zD@<fIi)~ncF%7b(1=psU^KGZ3HpIS!ySZo=WS;n<1L=YwY~;@|UG9dr1=>e$4E=;I
z$e*7(JGIWL!$jt8`*v%Oh+nU51OBLYpV2e8-P1&iyZxx71ewS*ZJF+OL-sVchm%|W
zvJsF*-fdaw?5TvZk?@TVI(T<;V|HFg*hs$ii&wXJcXPc*p2YDkzs!tQmV5<i1R|yr
zxi6h(zm&~i)ZJJ!jdVfgw~B6zS$3mleXv5oZsX>4Hw>pbHKl5QbXwl1UDb270PTY8
znZ~ED<Fbe54fb+|GNQOzBP{BJ*)I?8zZlX`zX;jW;R29GzUj50Y(#{ucarAs%fAch
zf{32{_-HBG1;Oq+WVJAnX%5xnu@R6)_Dh?8lyY9U`~qymndL8E782tWI`nrUvughk
zOk@NH58N|c4DLp#UQO_l0Bi*GJ3tz-L;4-crqTFQkJDC^dgA{|BMn&G3H`xv`vVu(
zzHVN~p01N0CWLAuU69A?6eh4Cd%vRZFNL|DCcV0PLU2;^n$|kr<(KeFvKeYds#g2N
zh&37iXgU~ON3*A&^!73yBbQ&0ySW9a;TBcqvQ@tSY`ww=`<p%0uSX{`wf%u;_Ehf2
z;^rf8H&+yQnD&gcRQuwZEbXI)W{5QMdDpW^Dd#k$MSrD{m=oe7?f!q+$mFGs8<4xX
zb}{liHbOdPHxVn7^7!he(r3oU9xRE=Ur$%X)tlMX4W>#5jcneC7q>bYmqu;o-OauI
zGI8GO@kYs;p$FsQGB*4JmtV-{@ywr+Y7wKWM)aWzf=*;ipCJ>OWsA;YfsGg=K!ko^
z&)Cugd`BioBW4H?(SOARHgZx3u7tF{%D)Xj1e;^k;22S4V~~4gkE%v1yg0K^AaX_?
zx%{HO!t-g)xoJny2aS)GutJ44Z<^{dktt&(>gQfS?&iuRND(3yCNe9EwyQU++T|3C
zvXNh#mmdOuB(AI^D;cDbHt2%<F3of2`d_=M`bMb-VIz6Y*H6Dvknm$_V-acO%%J%Y
z?{01z>W_4QG?E+^UTdSdA``kG=a1tpUAn9L7TvhL1x~mSr$HL|=7pSaLD)#dH=pnN
z=-piQ(`^V4xj#9*=8jB&uLvTIu<Hai<oU1MZL=1={K5(d&<|8ZF26MT1#edngtSD1
zVq?8taF_prG=iVM5PqqGcliY-GAm6qWnX*=@~AbzquJB1H`fR6zI1q5?_#tIGJ)0C
z;z0Ivhx|wJ_v(Uni>x}(%P;qH>)Xx`6cC$^eBMFvYBw`P?&juRQK~>DGCwFA*9OY>
zAa`?%Q>O0(EH(QmxCy<R3(|;A*D9IdwB^?&4#}rKi$d<^9(B0b{OEaNW65TXEn%0M
z*Ea8w3_`P~svwQ*{Y9A8zod8IkrZ<I<wBmY-pjt%j?Ja{Zcl^JiHzj$<-tcM?Cv9M
z1TMe44ZNZ|+uM1_za)Fl^)*)L-P|&`+v40bfObJn@z}^lGn9hdrVhOQ<_wo#;BIbt
zwE(+A^MPOew|hT)o?)aa(oQUP@t4}Y9GS>0UM&`!sIx3C6tbs#Z|;MM43aO^c<>#`
zm#&`nY~mW2PQ^gKwA!??)$L1ALiOCIZO|{pAD#H8XYRA+L;t7lkv~$PUy9z%U42VV
z29ZW|B<#DsWa+*g-4F^B8B_PA;R9n<YxqQv%P+u2&Sd){6Pcp0voiL_bo>7Nk-Ar&
z_C62Eo|;ZqmD_y~r+TjY-2oSs{|vgbJXi5kzt_X%myneKgDbZM$M__P!$jue#x<Pv
zR_~^eQ@1wgsoNjaZ#9TC@@yO~-D=e?vgqVZWO$cukuJzTJT}rlpDrkm;R>VD$UOVW
zu(yC5%Uwiko}=LT;AeKh?~<JT%U?fypq3AJbCK*RljWm2_toP7an0g;i6D(Y_O$x_
zAH0ab5Yh$NnIg)5SOXK8`9I%48o~NzqijTA1dI^@(Gh;J5&n5!-{O^iz(yc@T8w%l
za5q<>$4_2{56Pa&@U>Z@(nzSk2%NTY!E{1I1QW2MLL9mL;u%m)6D1Ga)y3ZH_qeAo
z6S%KO7?DOi0}nUfL+D3WpeZ}hY$Wh_SKx88pyR&xEko}^S=FW|=*XmitxT}preH)J
zfr$*tKpcC59h-wU5Afd%^~GZOfsJ?)L%e~4*oG9N6a>khZVHuF3*}0~<rjMBVhrCp
zcBr^CGLebx@fTrX5{Ni~E`Lfh4(cMiPzI6)(ufs)7hP1F9sm=We0o5jbXd`*FtA7V
z%ZR{irJ^G2rhZ^;Xy5@<$$+yjPppK1jhvbcJYfZ>BphG}u#uOWB6h0<_W%rGMF1Ol
z3oxWEVt~!>Y!&G!!#_fd9IJ>Nq4Rm8FyuQHZqY_9b%|ob&c-E5iWSNwhKeC<gaEA(
zAshzlfDzWmAr46wK?)w&90J_U<#UM!heVcxOLoDh8RA!a;p5d})*HnXXoYPe#lX&{
zrYGjoWDFvWsL2X%a|nM-54Z9Sw<5$E!`)m?>|X1Lm(2o5_7v0+n8;Md4PqmAszoB|
z2uLHKj-Z!cpk5-^6@L!Y5ljN2j_4!m$W^Zd4lzm!CNeD;7ZS!*JJC&>AdDk;f;vJ=
z6oR|C${6JG3x}}Mnuu{BBGL#XMo=~qH5&boHVG0V$V7%AlE_PpuwqhRDAN*#^fDY`
z;X;irBm5L5F26Sx7|4F@h{FzXCY7i(G7vG;LpkLTZ!Mc-Ss6bH3}iCCSv%n}Dvf|l
z;fzWnx2%(0QE5bki%aYuO?;<J9I%cS^o{0Y!8U_PAf-e*;Nz@g0?bH6Z7kUVkw%KJ
z<n+;)OyyX*S8OgLwuMd3*QUI-q8zXmF!Z7rRYrVZ#~p*KGaSkz<)p`6NzGoVZM{kD
zoTNE=)U)0M03b?^$=%8X4-x^}lK8GS(HDmqP{s^e6F+&SgfUVyZ17*;@{195H<L6i
zN=_qDZ|VyhR8iH9gtHxDTZplz>N5CeVhfFE2W@Ew88oq(hz}za2!z;Jr>>ldzr;wo
zGKw6wSv`~BqMf#$nfwNqC`?F%voG7kh|3*_yBt$A#7Hru^!1hLKOjKDAyIKKk->)@
z(up;~ljm{a#$DuNViZB+%rb|}YFwt7XyobE%!bPNMu*h%HVGGv5>~QO9XUxb#<^LU
z)oVoPC#9**B)W;EuW-orAQQcq*%R7gcdF8Tjj3b@YM~)L$R;DiINY$0%H&Y@j?(pI
zGmBdUAUXmEY^tmo33$ds?RYZmY3lMGb24ppvNBs!v+-GuHpzmrguJRmpUSjC<Lp4~
z6d5@F;++#wnSDo$3U_Ji#WMD(WQ5qn{u!knt;)!2p&wJp>{4NfcvGrcC;)SMtMZnQ
zF$Pq!2Js0WXHs2^lGj%;Z&&8SK4$Y+nww4zR6If*3a0Vgf-fyOiBOAaAqA-9!nu}E
z$MCRLa+C^1Of^q*jAhKBNz0`!H7Q&^8^4;6bb(x`;GJbZR_N5q9A~DjpUp4A7Xd#g
zmy6-(#HguKe>p(^HKxIl{=_>M&x}1H2h^sxvy~NBMeBAfA+=_{C6}zEq{`{!UzSUD
z@XjBRD>~Jd|5Yw$g>u2ps?yD>G3RGfE`*VQu5fV0+Bq2*W_TN!WiFRjYQ%VDTrOc#
z;t^Kvox^9+RwC<|aO`wGU8UldQE8rB_IpnL_Nt2TH>Kw&1!}W7l*$<O*@Ad^)-Fbw
zrmV1VTX9rhWr}K^TN`DGPYKzk@C!Dd#_cPYuPRiaFxQ9|tsQ5sJB``mUG&{JM}?BD
zq>PUm&)%V0>?c=q)g&XqsYdWk#*r$r%Xseo7S<vYM*4W1jZIa(QSAy!k{m6m=S@|1
zYb~>ixlyM&B&@=nTvVBpGCEs2)B50-cI6{o@>E!{Kv*pK4Sf%%jL=u<>Xa#^8aeM&
zezG!;GLv_XRP~{?+<{YKrkYIetG&j|KQ+sARjJ=0hN(E6v&!r7mg?$ia{cbUoS)WZ
zsV!m4G@mTFdXruzBG+^ik8xeI(RJOhXJomnU5%5PW#iVvZuS#yT1{?_M{YUKH5#pK
zGKPyTlegYlG~GJm?ycZ%?cr`a-8Adl&UZz#`O@%>Kd)~)Z@lL!B7r~S;hE@ivfpg6
zdW)3%@g)b3R}35{*R;sO>ZQ&ENXXjD=4lh=Srg`&cUnUfPt2>G(D~KMsyU(e>BPZP
zZTsC%mH`RzH8mGH^<bjSYI(c$Wx;c&+Rr_)aLlxDj<;y<Z@(;Ld2{*G+v-nmU)DBv
zd)jkN9r_>VeyG3gSGP}BzpzuoK2~Gd;zhUM@=Hy}%~;K^yS3nM?o^U!@QF^<7h3G_
zPPqIsucrN{MjNxLD=}SZ#oE<F7o-NaFUCeJ8UC;u*vQw^HNZxeMXV8UeI~O?acR*r
z`9F#Zd5Vi;6b1J@Uw^dg|H=(vr8a~}&;FV{9BrrPzjT}Nfr{?~PyFWv&6gSN$asif
zelRkwxroO<;!ysf{%e$X`4$<?@GjqaynBJTAt}p9X_u;Yj{Q&m@x-WX;=#X{Z_DR9
z8lU_R{_$}6Xsi5@ivQvt4RdQx#BHwJ@USI%=Xq|^HYy}S48l65zwI=Bo}!#~=x70Y
z_GN*8RJgsEo$iBV>I3BR?QYMiq2^fC^T^qk;jZ|o6w^P&wd2Uy7bFofG0);!*4zV2
z1Rc$ErtEp*IX2j~z(2+l-z;=dtvYtSxb^q)?OW*)TR(|IL|f}+eJ79YnLp#HWGrWA
z^&v#|(K_DQ7u?!+f>PQj|4>6lGrL}Etvk4d+hC``JNv?AAJZ^cLRz%*-^;f#QhS?^
z#I1^Hj*MSk7^@U~=A2e%qHTx4v)vPM4!}Pk5rViOS19wWp{H>9)?wl7%bnMi?Nm7X
zVozK4$3G@Dgny=!7RDVM+3`?fW>ZF_g^lvgNW0eXElJK*%Fsm>b0k6+RfX~G?`TGs
zi&Rc?)t|{Z<rQ^!n`)tFUmkoFyH@ag86-mH4TswQCPGy6AbjlBwx#B;8&a0P;D&sy
z%vx|moT~~NRd49R<=Y#z1H44Yn{CE3_tq_pW&{rZ>xL+(et-Przub^JU%(By^F^<G
zZe453rfh&9n=TGcwQVk#a|J<UYHB^Ni#k0~to^xP^=FrX0DAT%@8`2OyC4x_rVDA)
zqbK&j*%wHgzCLq4?^pMEpW0uqJHr?K-o7a{Pi@PB8?vRmA6e79^}L$)uNxwguh|~B
zlI!~a;UDt>9a@P|0opnwr*ki~=69caI<j#2_MG?j+;W6}G=25n3U0{kmr7QQt}5^k
zUDbKad)<w^voCAloJ*U@V9k&D-P`W|d}d-7`m00Ub<gj<^WW}H4|v>YTIix?-@m6c
zwDJ*WcJj33{4DuKN9E_ikH9}T21E1n^Xa_6hs>n!!r2!gZn|vo!sXjTaM+eLAh<KM
zUec~>DSa{!;U7zO3@#)>9^I!;N+E6t+C_B<c5X(`zO0^^4B_gQ_{+Br2j4$4BsT|_
zZ(}_lZ_xRU@Q<abHy2?nqJ6ouht<lOpKL|0*|G;$)Ej~uQn(`9FkP-2;U9$&gwS>C
zO_iGNKi<CBvps$FG%}jm9<?<o0J^A#`yO484B53_VTps`0ZG?r!kLe227F`m;y&<3
zGc7G9#^8p;`7b}<5M)j^mq+-=agNk=v&ZqQ5>d^HLgULlOXADgFRQqd+RptpN3XgB
zGQxOW)D4?ZH>8+^Xd+ogFq(-aM>S_@l(!tc-nu<<8SdhmMr~6=!jGhpBg0xiMRsL;
zK)R^t<y*%ODK^|@e>4#SZV2Yp)lJYvJ=QTr!yetVAD3!&(q<@C3Qc(&w?i)9KBXUm
zlt-lZ%k&B?!|;NicntpMQs|-@Teg}fX#7|c#(u0MS%@Wflw|FEs%(0b{37Yyhiv^?
zfmM(QNkc|6M^)q!T3=?RrHY$HFi&Rp32i*-&P1-Heq*3+h>fTJ;zn>o$nLrN;D&U!
zT9k1G<Xs|E&nP)YR6KXjch6H*hgM7N6u2Ro_TYx}Ac>HWQbD_meBzB38R_7LY+mal
z+H4MP$dmu!hWI%K>&Cs7KocPp8<mO#v8$fohA`BEcy36Z^Ud+VcQa+>1}OjN9~Ab;
zeYDC+G6CtLc2~Y!xO{7&Dckcj|8{Yk<yZc)l?B*us>X}onG-!~KK)bR)!lXuY?Z~4
zF39EE^V7mmHEl*lGw1&det3u`LN*T|s~Rk~X~m{TA=`QUBXHxKZLdwwqXXz@=7OZi
zhXzH-?UF9igNotA#~V$*<CJ#@DwGWHx~Q9nzVyLp#x!{Q?e>e-G7U|-2|<L|?U&3K
z&c4Jd;5KOXE<P4qfOJvW{DZAl9Xk?wyWVs2|Ko<3eH6$3Z*ItsMZb|QD!3t^e<1f{
z@JSdU^y~|`Aq^D*4WT6&>#m1im}EaEHvUvIR~kL(iMS!|D*N}1nNuJUViCx+%yZoM
zt-b{YE8vDWsW(G;_IH5X?Wg1Cia&HCqnV()L3Z-9J?9P4F6w2?4{-VRc1g7U7e~uC
zB0U{tFq*l(rf%TP_E0{FM@PT9hMX2cx~Sa|Ul)hhb!`mwsL|uOA=6)dA51^JVatB=
zz5&yiA!6!cYEp&rkL6n(%}xwL7q#NC($-M?=`+&qJpqmCXvt$})vy+fW=vhxYf`&6
z9pmKJ)=ec;_kXgSd{h`w8%TcB|Jjo6)p4Wa$3H&@;PP!%m!D|>GMYIE_hcSC{h6it
zRuD~uIP-g)e*0FTx$1Q}@DHbCep{*Po+ioL7r+g<GOww|{qW6V&gX-uWl;a{)@chm
z|5xmdz<1NYKW6WKTTx)}WL(iRd?{SMJzOILZpd~*lK71Q|BoBt?8~veqGt^KKkuXp
zCan2@J;%N?qKAxT9{kkls$XJ$BLMB9f*W#Ok$-XS03<^0irz-tkbBd}McoDd(cBIE
zqmB>ZACmTae`bHXQ$kH%dzD(PHp1<=Tji8C`}S}kBtp1TQPgj)hTw((|0sWmCPF@S
z2F^HfxojBCe190goqagZSn12J<;y?9FATS8eSNV2KWu$V|Bhx#|6ijSw%=+fsIu;?
zw?g>`^h5?QB9q8sW}8evwPL_d;2&B6<jK2CLcs2x0Bu7o!awZqed-nl{$U7-kO~xm
z{5|_}d@}I3OOPcbJIwCGXyz<?fq%?f24Cs94|iI03BlLEy&wh)%Y-PZh1{|V0se7|
z?Tb`Jx{yT3eJmgNAO2RMK{9+?X^cO9#812{G?E<}1p<f*CdLph-(m#xaU?ndKX#(<
zgQkVg(86m~i0`F~#<TE@O@VOv772DJ0`tJa45h+8@Fp$rFiJka4XL*h0{(GII_Q*V
zkOdJTAF!C|g0m`W!7qV)xJ2|2BYJ^+_(t@z`LD}FI>_*Uv_jmFk90l{lze<?j-13s
zEme#93FJd9O3F5L#wt{-D~ijG!UF#Q?BR=vGQ>m}V#II+@m_+YEJnH)hv@=rBbtfD
zr+G$aR^SzSqXQ<9%eUT`7@ky7=owQI8n)R;7)gY1xG@(7Vjf|`8$*R2hYD#i1b0J<
zvp4n`77$Gw@DI>HkjuBD5&c>M?@<i|+z`+}5H|#eP#Wl>f(CLP)j%$S24b6V#X9O2
z8*>fb{F4cyaP~zx5yQa12^i2oysVMY3_rLbvP3b_=s;0SuouEVKm&nuvyr33mA%n1
zpn>R<l(ezyIMF1A$Ub7sW)7)bCN@nwR$Vq+ixJysC8SqL-VI|FX~YLP$cQsWYaV^<
zh$^G_Q@HpC4)HeDk<b%4XPsncl(2-5)XGQzGypx3PVL0!vWd_WdF7Dk;gxuoTbb<F
zn=B=Z!C+GG+9_ci;^$tXyf!JvlcZRQz>j27jH)O(Rhhiqnydk>QtNO?gs_w&inQa@
zUE)e`aos%;rlWCHvhg(>%0t<t$JR+p@JX$tq;_1??~$Zyu#%}uePNW$4aM}}FhU?j
zR3_iyBx1Xg`6rX5ArS)c4jufMHfe%Hf&}O$WFkaOl@<A|9D7NhtZp5yWi52L5AXqb
z-dd2)I8Mlh_NE7^ZAg;irBzbTX(u#UC$upVu94vK3&4-mZtXMyWx^fA4N1G-O9&E8
z->#AlL`U6`l!#0BR*Ojz4cs%9{!2E)z&L}O$)G-_3o;oQc^v979m;V$<-|-}zkQ~q
zSdxu)(qd-jCFO*RUVJOa3GIy3PSM0Gj>+?(S)RDGd!t!fstAF~DXw_ptr_^0iNS70
z(>P|g3e{JRzE3PXz=oX7pza~j^;#gBAz(U_Az(u*7iC22Flv<J;{kiv=G8MYPmg8N
zyi?P3vM#G6XZJ<*I;1gMnKyKZg3{TA-o#>j%59tU3FR1)bxgHfSglxwzg#XG&eh=Q
zjjiOP%-jeST8S5>l0*{+F+?nt#LPR}ns;?HPi`jR87DPMjPS`j?HV*hSZU5<OjyhW
zbMnI((d9Y?h;_u^#y}!uRxCEik={tB7ihEEjcFp3II$|4L@R62IP2UfUt>$=5}#B%
zovf8kS=m*EKAe)(VfkB)i@xgQY@!rZFpDO=3Vw{H&l=MYl4B3IQu%V|EjFwuN7}QQ
z;yCZjZj};glhoyXdA4IomyoNug`cVtSII*GBY)kS{0;I29?YUU#xaGS1+{X;J9-Od
zt&4YCmznfsw5d>{W^x^UXnWt3Ig6Le>6aXYGby-|_c}~Z-Nd8S<#*p?<<2CZJY9N=
z8C_;mp;-l!B@!IG4Vx|9r40Xfpmt8yFsY1h%XOeo#KlYE$5^BEJc>^F3gg1%CQKPh
zp*)wuRFE%K98dP0O)HSEF7nB-HYxajx;pcBC>K5s5032F5{*KOBBTXlsc1WvRJKG(
z`-$OL6NVCT#*C4DnZ+3U7-H;9wl<7ioyt}REkcXaDH)0P`^<FS^Pcw)c&_XD>A9}w
zzP_LPrjqaIOEE7p%6FJmogZnwA6L51mA&E{lQNQeytAR1+bHWrL;KPC4|8&Dn&6aY
z!*sP4vF!HNO14eSm?}BOtog$beOpO#TuE~jF}qc@5l>_$&164_tF<SxU%0e*o25O$
z77q=lG49+Bh)cJkR`;2(o`e;?;?%J^IT7Dj<GiN4vq`hKnqXqE)H6T2k^j%(50vV#
zVTt~#MdIp{{_D2{Y{ER;QWW6a?WLdbP!9vymq1Kip!@DC=XbYRooKTL+A((JkMuSV
z+aMq5pcD8YcTD>g+pAY~uVTOYdOy3mpXS$^==W0olD&eaz3TA}*ulh(+G`$nAnH1-
zf8vn1ma7H8gN>Yi>^Sb2IqFCob)=4R@p4Yf8cx<wzAbe+`ozhprqlk?@lphM96Mv!
zRUPhJOLG3X-<dP&EE^*e^t$Wnp%eFZcRyttw1s!uDjI?!WMsSH!+t||ksh}|BUcfl
z^MOVlj`9QBF{7hBFQhRcioH?bMRn^XpEZ6PZX93L8-Kv$!&=j{s+BMQT!)Niyk*DN
zs{sNTw^w{Kpa%ToeUdtiW>#EN7f$Y%l+jRl)Gza1V`Y|xT$F~!rym;_AxYFSN*9F^
zLa7L8qfp{YsQ<t7z{_pix@cK3(Q<wDj`R7k>}<>EWyv|kj)5~)DOyLIZ5tlt{ZOGk
zE@(#NAphbV_F2mzo1fGfcsdqh^iDR0{!0#Wnn(EFp7744(xEHeuq6GD=70JxtG|x_
zlee|4-`*S%rLESsrM%*0d*a5!bb%a1a}x5lhzgY#sV1|aemRbM#IgG_rN$EnDpbLp
zhoJvbdxyV)*)}@y@yb7(BX5K+2N7_NYv0VLm5P=Q7kKE?1#*xU`uW{K0yzk5U_N*K
z-G52n)no8{705xvH#5&-M2xJ)qU1Ka^hJMZg}m)Mx7cy>RSpNw?OA)>V*rnaye&b~
zId+1md(!xY`E26GAN?2porj5o!AtX<zifO3Dpb!+Nz2mYi^<&vd^rg8U+j+Fx4n5{
zW#*-ue_cWPFCYiW{1@kVLw&b+{}$$dIL8~FY*yFr4c&|v(pZp#IDGEPZPCDa<aOCy
zWaf8mALhf3;(~M|PpMtC(F?^zx#?Jz-hVj<vVmFXHK}^E(1%%_l{aHPIg9QsAAif4
zF=>SjOvM8=sZs+_q3Txk9{kaNfjf_xZoRt2Kq>vd^S1K(%d-=mKQ=IBUY(7=IY18b
z$m^&X^j|)<pu}|jTE<p+g8+34jeSTo;^pjpIZNF?AIMo=KsGS63WI^&GZpPXRl0uk
zUy9s5>6Q4+fC|-dQ)joqGu=*egA2L4Hs`*3SJkuYP88SN^w@bMZ;Pl<k5%>x^0p3C
zLEiSuQy1TtNZ$6l;URZ(c)+75Yi>t7^ZnegcYBY~XkYc|;O7DA7m}7<tbRNJ8yLPE
zM6tPZYxUZ)kj*5_2mS_z_loq*oA=sG8Bw7^|7G%R^fu1hmk@9@W~SUaI#rtYf-|GP
z_jC`kf%*2ne$qW`hv3db>|@wAKIZ`Tv0JAb^KrM%vW5B{9U4Dxd%3)66U}O(>FaX1
zJ~U_Wz8$>DFc`<ol$Y;an9cKT|B<(yj97m2R~&E-lr*A3wOHQw5;%v(A-O@)fBP?1
zcU^zndFaJTI(f_8Tqm6)ZVz)9feKY(&0WC;=Hj^d*?ByA_=gJB;{awJIERIFt{mR#
zpvLfB8OzV(^6we(2<JGmXt^p+>!H`*d0XZoI0T6k1G}J-3JKZ3Aobcu%r>LSig-V#
zm*!Z1qA9Y00nYJ}e+ZIrW3gRbabL%N^rysF+x!huyo7_@<IsP3wQ+pAn9WgzmFbNa
zH}4>DZJx@ljL^CXdD~9p&Z8i8|C;=>qRuvvY0l7pxx|g<-+5GP?g$uqaB{yrvC|`W
z=WiyqTNE5sAK3n~a~Xy`V-sYKU;~4Vnt(eGP@y&ueE50W$&GCw2cak`B%ofY>j)F}
z)`JQ)oX<J-GK6G2mpTM0RNx$*{ZSS$jfp~k2F?L;5N!Vm)6Y3_K}<vTz5$}c?`V}Q
zkVA0ny=@KhRQUA6;d~~)|6&95Bc1bmK_5vQM5d19>l26y^=L5Xu{R<zHGZ&u^$w>T
z=)YL)nYK?N{%&Ucr8t;zlP?EBHZV;^&ULuHZT$X=mojbpQ+Dzf2@fSL;2ckDvEvdy
z$CkKF+B~Zl9xvnHdDz7BH!vUv2^)~Y%7F^?z35Jyd|aF9Tm}EmLn_XtHFtwvQ}i$A
za)u6HtgT|m{OZB85cFSQ17j`q#4Ph}%`dS_ph7)7GUzZ~>trnA6L>gAdmd4t!kvez
z+ZM>%wyld2^k0I-15W$61q$-EgN8rvtc48>?(3Z~8U5g}B<XwUn2K^MU)<rl?sLt#
zt7c++!zR1jEsgIfd~GV%oP!O_CyZRWcr^dcLsmuhZxyPqknE}X_SGA@#o}NYqteSp
z<RCI1=kBX-j*7JeIY^4JxYp4MqJQgoC9z08=kT|X2jtOa3>%o>#+T=y|FU<feS5Sw
zX@e@rL5^1Hk}6(p=$hbiLn?KxKxt|Rd0V*iC|^t17Ca<>rWU#L_~o1M1mtaZEm4Nf
zjtQ5KBPvwdWaDoUzlX}4$z;>NBAg?%&knis(DPWYBIv*Pw(?b|iMOirj@^i|5y(Lb
z^`1xB1T#ciK@M_2=9NQ+sZud2fOU;D?R;n9NwIiLDU!DxF<nJO?mV8q-V-u}=sMW=
zJ>G`mBZF-~KadSf6~Z}cs|&92H!x>9_?+Wc%sBtfBMI(2GDgJsoTJA_y|wi@LO&+p
z&g1bZ(fQuG<}cTTl}KYhtul#h6<dmwr7^~kI}gPdk-wQOj^BejkBxh$BceG<xjr%c
zylq&c68oy5CbEG^rqW(TSv7Qu+T-`skG}Q|xvzF!Eim)(;v3@=_f;u9aOW{1g>a6T
z>!SK@Bg2QG|B`k+CLeQc%I?g5*+S^QoXVOuKsX0INTnaO0^uC@eWLhs5X@cir@eFX
zeq+#ofjf_t!ID2zs9U!A6Rq5oZYZyS{>%J5Rd*$I-$NT$_st{y7t)E)bq?-$ZdD`n
zU&7x!Y~}UF2~7h1;LAZ$_DV1<_bA)Re%`qDu2dPmY34HIZ6CXfnYsvn__Y-{$I{nU
z*=Cu88c|Bnf9cSV{FKqR_(o@0UGv7$io#>xk-Y6we3%G&3GfG~P{(9j<{@PJi5j8&
zmcN0KI^rQb`@y_%Tz((Ye_8tC+qiZP>AwJNwv<0R7K-F;J3?&}Vb6fGX5*yiZ^*^s
z%o2Yx0~Kn$NPR{m+<B~dE3Ecb*c27D0a(ab<bz;D4gxCF2YeQS^k0l`?obheI}f9I
zS)=-Ez&RjqYyOtcLi|vF;IAY8(nLfKVjFv%(trH}2HC(kT8X=4#zb30oQjQz?O%c1
zdB6r{aK(2qBwY)6TTr2Tsfc1#L<3YrC9Lq0S}P<o@o*7>$U)}u=6;cI=YbFrJJ`Uu
z#Nu6I)#oEMW@7~^RIrI8ScUUls|0A<QW4jxP%dx|52)_mWP03`;;T?^hoH(`qAMXb
zV}bZVL=xk&#-gq3qZ{8wr^%7-X_1_nF>N6vgoUt4z(Tq^NM}{VplyrDOM!F5#vg|}
z4;N8yaeROZehj*`{0+?O4v`z;vAg<jeVD)X5kSb;txxm9gph<76=6`JE)IgaKqw_d
zNH|nTaeE@HC=?SDC3z?b9x8u6F^`E-FiBcPKtbLXS;CAVOBl7Oq;<Tc4cf^<cF7Im
zs0L<S7W7|+l6ARp_hADAM-?CkF)9`_6dY9~l6Du9`sSffhH#F9YgQZ}$HULO3p?JW
zKh=i6fpH+*n(PokRH#U|CC#0e_E{@omt6wC+mh~qbX(GabHG>!4V(k6KrAwlE07x*
za0L?9kRi#-0PzX*U!?6aCE(73kO?0PWlv-eli-R16{@fuvVl=^O{Peop#K7WS=v-`
z?oe{8R?0nNaY&usypdwSrQi}{_O3~-^h9uj4I%yrFZH>LsM8SD9uUacv^Vu>CwXaS
z_y}ayC83*~jvY$xZ%FrTfVUD349yBAXDBSO!Jv^D0Vx_T3NQ%4m5%3cV1T;BLz5+x
zJZqAyDFMF-l(`{t9y#0AgL0oqF`S~5n258dQY^Ho-H^8prJiF`M+Z|!-cp;ip{_x5
zaTRg%q@5nR^_Ow_1uk-dF|a1<v1isZ*W6)l*2q+r%$m%xHFOCJ`kPR?A^|l+K%phb
ziBt4sSF&LJLJiHHBWG`uNLhsF43{Frq3jt-sqkcUA(~T$rS*#1;#8UGR7l-|2Svdq
z$CZ$yf=>8rkfwpo^)boSG|dPhXW@pjZfIxf+GHZMgGDzaCMj!^O*nabPm(v8Wbemi
zFC9FYf5b&1&o6(eA-{x>Qcj3DCRt!_Q(zrhP{(D+c2eCIsAnV#&uuO2v@X1;op700
z_=uPO#5&iDk`YYEP)-Ekk)>x!|1Gp=$~q}@I@8pK9I=q6UQGUC!eqEI^<62J6iOT`
zKhcIEDp>%E3}+Ujfy;0xE_RZjojLgv9h;*<q2+94<xkTtdm_`9*C6ufEc8W}Y&9(b
z?Z|6Fi2|2y%mK$IlWdIw%_rTuREHM_W{_nr#dIn^X}YwJ#TaH5oMioUN-{@*b$fWa
zSQ$tA14cE|ITJQz8(FNW>B5=LjQ7L2F(!1tK1$Z*Cc{Od8cV1>3q>uQ@<n2Hj3m3A
zSh`d!2F4k4GAS9y=)<MD5R0GJ7rPG^uj;)0d^&C2bdEaQMT}GgP6-VT6|OJIh5pUv
zu*y%Y$|PQmURb#Wx^$N+<pH*oNURdpVSs?t+^irKTYTV@D95$>DYp8ab%l}+G9<F|
zV!hc~qaK#4)mi2*Ne_}N|C3Vr8BNwzt=&#7-)UBL*{h03DJ4zk|N5<JpH6i~CwtW8
zwi~)a(T2vDzP$#Wj;5x+!m+UE3_u-QSQ#!eW!0>D0-?nHTmALn5{r|y-&xr$nM@&S
zm1#-U?S@jHZ?*g4QU_S^Qj(mUJH`2C6(dWMEaj2vi@Z9I;fm$VveJ|F+NPD8PL*s4
zD`^;}pOGT(MmH?5%A+J351KY&N@_8LMq5q;O{%WPtnSJTgF~nrq}1W!nsPd6!#ZVs
zLrpKJWoSDg*~T)zttD01W;o6<n65F!l{cfSF6y-8vEv?M8x{!^lMxDLsLH&dC98yO
z>sq~1H7&RcOtck6VHK*=b)_SmD5*P|(}h}FD{JEFt8vXCrseT>N}5y~T5YmhrBHdB
zv8#jq33dLEw^dUPU|tP?ysdVTS6F|5ev$aDErEuY0~unty>)FpMpt~+Ua?eex39Z$
z4AXuB^0wVUxY3~Pv$7Y&uKu+d)!~Whxb*C*mt}A)tz#`Cm_!SP{)_T)dksTws<cCg
zh5QCh2b~%&3|;7>4u+zRJ7c7F1Lp{L1dGQrDBPl)4nFC$RqC=8?WznHxBDV%A9I}3
z*yZ~0_$f{2*2Uu&mAauLBl5(#gVr5X(|z^QPhnrW`)my#Ey_9`0NT+r*l2hjRH$x9
z>ee^KXj!h;Ck2DO(Cd+c@xLHHU}p?+kXc=0;;z0_$G*AnKJpEd1)53r<G$~s>wt3z
z@9BT~=en_TvVZJTbFf!?H_*SbM{Qny0PZ~I<TXGJvMj$IeS1KrazOl(hPZ+p%IrUt
CRZQvt

literal 0
HcmV?d00001

diff --git a/usr/local/www/dfuife.css b/usr/local/www/dfuife.css
new file mode 100644
index 0000000..bee4dc6
--- /dev/null
+++ b/usr/local/www/dfuife.css
@@ -0,0 +1,88 @@
+* {
+}
+
+body { 
+	margin: 0em;
+	background-color: #FFFFFF;
+	background-image: url("fred-bg.gif");
+	background-repeat: no-repeat;
+	white-space: normal;
+	font-weight: bold;
+	color: navy;
+	font-family: 'Arial', 'Helvetica', 'Verdana', sans-serif;
+}
+
+div.mainness {  
+	margin-top: 0em;
+	padding-top: 0em;
+}
+
+div.maintitle { 
+	background: #DDEEDD;
+	font-style: italic;
+	padding-top: 1.0em;
+	padding-left: 4%;
+	font-size: large;
+	border-bottom: thin solid #000000;
+}
+
+div.title { 
+	background: #EEEEEE;
+	font-weight: bold;
+	padding-top: 0.5em;
+	padding-left: 8%;
+	border-bottom: thin solid #AAAAAA;
+}
+
+div.textbox { 
+	border: thin solid #000000;
+	margin-bottom: 0.5em;
+	margin-top: 1.5em;
+	margin-left: 10%; margin-right: 10%;
+	padding: 0.5em;
+	background: #FFFFFF;
+	text-align: center;
+}
+
+
+div.monospaced { 
+	border: thin solid #000000;
+	margin-bottom: 0.5em;
+	margin-top: 1.5em;
+	margin-left: 10%; margin-right: 10%;
+	padding: 0.5em;
+	background: #FFFFFF;
+	white-space: pre;
+	font-family: monospace;
+	font-weight: normal;
+	font-size: 90%;
+}
+
+
+div.mainform {
+	text-align: center;
+	margin: 0.5em;
+}
+
+table.maintable {
+	text-align: left;
+	margin: 1em auto;
+	width: 50%;
+}
+
+td.colhead {
+	font-weight: bold;
+	text-align: center;
+}
+
+.note {
+	font-style: italic;
+	color: #AAAAAA;
+	font-size: smaller;
+}
+
+input.button {
+	font-weight: bold;
+	color: navy;
+	font-family: 'Arial', 'Helvetica', 'Verdana', sans-serif;
+}
diff --git a/usr/local/www/dfuife.js b/usr/local/www/dfuife.js
new file mode 100644
index 0000000..d3a885b
--- /dev/null
+++ b/usr/local/www/dfuife.js
@@ -0,0 +1,61 @@
+// Global Variables
+var rowname = new Array(99);
+var rowtype = new Array(99);
+for (i = 0; i < 99; i++) {
+	rowname[i] = '';
+	rowtype[i] = '';
+}
+
+var field_counter_js = 0;
+var loaded = 0;
+var is_streaming_progress_bar = 0;
+var temp_streaming_text = "";
+
+var addRowTo = (function() {
+    return (function (tableId) {
+	var d, tbody, tr, td, bgc, i, ii, j;
+	d = document;
+	tbody = d.getElementById(tableId).getElementsByTagName("tbody").item(0);
+	tr = d.createElement("tr");
+	totalrows++;
+	for (i = 0; i < field_counter_js; i++) {
+		td = d.createElement("td");
+		if(rowtype[i] == 'textbox') {
+			td.innerHTML="<INPUT type='hidden' value='" + totalrows +"' name='" + rowname[i] + "_row-" + totalrows + "'></input><input name='" + rowname[i] + "-" + totalrows + "'></input> ";
+		} else {
+			td.innerHTML="<INPUT type='hidden' value='" + totalrows +"' name='" + rowname[i] + "_row-" + totalrows + "'></input><input type='checkbox' name='" + rowname[i] + "-" + totalrows + "'></input> ";
+		}
+		tr.appendChild(td);
+	}
+	td = d.createElement("td");
+	td.rowSpan = "1";
+	td.innerHTML = '<input type="button" value="Delete" onclick="removeRow(this)">';
+	tr.appendChild(td);
+	tbody.appendChild(tr);
+    });
+})();
+
+function removeRow(el) {
+    var cel;
+    while (el && el.nodeName.toLowerCase() != "tr")
+	    el = el.parentNode;
+
+    if (el && el.parentNode) {
+	cel = el.getElementsByTagName("td").item(0);
+	el.parentNode.removeChild(el);
+    }
+}
+
+function find_unique_field_name(field_name) {
+	// loop through field_name and strip off -NUMBER
+	var last_found_dash = 0;
+	for (var i = 0; i < field_name.length; i++) {
+		// is this a dash, if so, update
+		//    last_found_dash
+		if (field_name.substr(i,1) == "-" )
+			last_found_dash = i;
+	}
+	if (last_found_dash < 1)
+		return field_name;
+	return(field_name.substr(0,last_found_dash));
+}
diff --git a/usr/local/www/diag_backup.php b/usr/local/www/diag_backup.php
index b5ec90c..8e3f601 100755
--- a/usr/local/www/diag_backup.php
+++ b/usr/local/www/diag_backup.php
@@ -709,7 +709,7 @@ function backuparea_change(obj) {
 						<?=gettext("Open a"); ?> <?=$g['[product_name']?> <?=gettext("configuration XML file and click the button below to restore the configuration."); ?>
 						<br /><br />
 						<?=gettext("Restore area:"); ?> <?php spit_out_select_items("restorearea", true); ?>
-						<p><input name="conffile" type="file" class="formbtn" id="conffile" size="40"></p>
+						<p><input name="conffile" type="file" class="formfld unknown" id="conffile" size="40"></p>
 						<table>
 							<tr>
 								<td>
diff --git a/usr/local/www/diag_confbak.php b/usr/local/www/diag_confbak.php
index ddf4f2d..08072fc 100755
--- a/usr/local/www/diag_confbak.php
+++ b/usr/local/www/diag_confbak.php
@@ -41,17 +41,6 @@
 
 require("guiconfig.inc");
 
-if (isset($_POST['backupcount'])) {
-	if (is_numeric($_POST['backupcount']) && ($_POST['backupcount'] >= 0)) {
-		$config['system']['backupcount'] = $_POST['backupcount'];
-		$changedescr = $config['system']['backupcount'];
-	} else {
-		unset($config['system']['backupcount']);
-		$changedescr = "(platform default)";
-	}
-	write_config("Changed backup revision count to {$changedescr}");
-}
-
 if($_GET['newver'] != "") {
 	conf_mount_rw();
 	$confvers = unserialize(file_get_contents($g['cf_conf_path'] . '/backup/backup.cache'));
@@ -102,7 +91,7 @@ if (($_GET['diff'] == 'Diff') && isset($_GET['oldtime']) && isset($_GET['newtime
 	}
 }
 
-cleanup_backupcache(false);
+cleanup_backupcache();
 $confvers = get_backups();
 unset($confvers['versions']);
 
@@ -156,43 +145,14 @@ include("head.inc");
 		<tr>
 			<td>
 				<div id="mainarea">
-					<form action="diag_confbak.php" method="post">
-					<table class="tabcont" align="center" width="100%" border="0" cellpadding="6" cellspacing="0">
-						<tr>
-							<td width="10%">&nbsp;</td>
-							<td width="15%" valign="top"><?=gettext("Backup Count");?></td>
-							<td width="10%" align="top">
-							<input name="backupcount" type="text" class="formfld unknown" size="5" value="<?=htmlspecialchars($config['system']['backupcount']);?>"/>
-							</td>
-							<td width="60%">
-							<?= gettext("Enter the number of older configurations to keep in the local backup cache. By default this is 30 for a full install or 5 on NanoBSD."); ?>
-							</td>
-							<td width= "5%"><input name="save" type="submit" class="formbtn" value="<?=gettext("Save"); ?>"></td>
-						</tr>
-						<tr>
-							<td class="vncell">&nbsp;</td>
-							<td colspan="4" class="vncell">
-							<?= gettext("NOTE: Be aware of how much space is consumed by backups before adjusting this value. Current space used by backups: "); ?> <?= exec("/usr/bin/du -sh /conf/backup | /usr/bin/awk '{print $1;}'") ?>
-							</td>
-						</tr>
-					</table>
-					</form>
 					<form action="diag_confbak.php" method="get">
 					<table class="tabcont" align="center" width="100%" border="0" cellpadding="6" cellspacing="0">
 						<?php if (is_array($confvers)): ?>
 						<tr>
-							<td colspan="7" class="list">
-							<?= gettext("To view the differences between an older configuration and a newer configuration, select the older configuration using the left column of radio options and select the newer configuration in the right colomn, then press the Diff button."); ?>
-							<br/><br/>
-							</td>
-						</tr>
-						<tr>
-							<td width="5%" colspan="2" valign="middle" align="center" class="list" nowrap><input type="submit" name="diff" value="<?=gettext("Diff"); ?>"></td>
-							<td width="20%" class="listhdrr"><?=gettext("Date");?></td>
-							<td width="5%" class="listhdrr"><?=gettext("Version");?></td>
-							<td width="5%" class="listhdrr"><?=gettext("Size");?></td>
-							<td width="60%" class="listhdrr"><?=gettext("Configuration Change");?></td>
-							<td width="5%" class="list">&nbsp;</td>
+							<td colspan="2" valign="middle" align="center" class="list" nowrap><input type="submit" name="diff" value="<?=gettext("Diff"); ?>"></td>
+							<td width="22%" class="listhdrr"><?=gettext("Date");?></td>
+							<td width="8%" class="listhdrr"><?=gettext("Version");?></td>
+							<td width="70%" class="listhdrr"><?=gettext("Configuration Change");?></td>
 						</tr>
 						<tr valign="top">
 							<td valign="middle" class="list" nowrap></td>
@@ -201,9 +161,8 @@ include("head.inc");
 							</td>
 							<td class="listlr"> <?= date(gettext("n/j/y H:i:s"), $config['revision']['time']) ?></td>
 							<td class="listr"> <?= $config['version'] ?></td>
-							<td class="listr"> <?= format_bytes(filesize("/conf/config.xml")) ?></td>
 							<td class="listr"> <?= $config['revision']['description'] ?></td>
-							<td valign="middle" class="list" nowrap><b><?=gettext("Current");?></b></td>
+							<td colspan="3" valign="middle" class="list" nowrap><b><?=gettext("Current");?></b></td>
 						</tr>
 						<?php
 							$c = 0;
@@ -227,15 +186,18 @@ include("head.inc");
 							</td>
 							<td class="listlr"> <?= $date ?></td>
 							<td class="listr"> <?= $version['version'] ?></td>
-							<td class="listr"> <?= format_bytes($version['filesize']) ?></td>
 							<td class="listr"> <?= $version['description'] ?></td>
 							<td valign="middle" class="list" nowrap>
 							<a href="diag_confbak.php?newver=<?=$version['time'];?>" onclick="return confirm('<?=gettext("Revert to this configuration?");?>'")>
 							<img src="/themes/<?= $g['theme']; ?>/images/icons/icon_plus.gif" width="17" height="17" border="0" alt="<?=gettext("Revert to this configuration");?>" title="<?=gettext("Revert to this configuration");?>">
 								</a>
+							</td>
+							<td valign="middle" class="list" nowrap>
 							<a href="diag_confbak.php?rmver=<?=$version['time'];?>" onclick="return confirm('<?=gettext("Delete this configuration backup?");?>')">
 							<img src="/themes/<?= $g['theme']; ?>/images/icons/icon_x.gif" width="17" height="17" border="0" alt="<?=gettext("Remove this backup");?>" title="<?=gettext("Remove this backup");?>">
 								</a>
+							</td>
+							<td valign="middle" class="list" nowrap>
 								<a href="diag_confbak.php?getcfg=<?=$version['time'];?>">
 								<img src="/themes/<?= $g['theme']; ?>/images/icons/icon_down.gif" width="17" height="17" border="0" alt="<?=gettext("Download this backup");?>" title="<?=gettext("Download this backup");?>">
 								</a>
diff --git a/usr/local/www/diag_dns.php b/usr/local/www/diag_dns.php
index 900f562..6b336a2 100644
--- a/usr/local/www/diag_dns.php
+++ b/usr/local/www/diag_dns.php
@@ -92,7 +92,7 @@ if ($_POST) {
 	$reqdfields = explode(" ", "host");
 	$reqdfieldsn = explode(",", "Host");
 
-	do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+	do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 	$host = trim($_POST['host'], " \t\n\r\0\x0B[]");
 	$host_esc = escapeshellarg($host);
 	
@@ -150,22 +150,15 @@ if( ($_POST['host']) && ($_POST['dialog_output']) ) {
 }
 
 function display_host_results ($address,$hostname,$dns_speeds) {
-	$map_lengths = function($element) { return strlen($element[0]); };
-
 	echo gettext("IP Address") . ": {$address} \n";
 	echo gettext("Host Name") . ": {$hostname} \n";
 	echo "\n";
-	$text_table = array();
-	$text_table[] = array(gettext("Server"), gettext("Query Time"));
-	if (is_array($dns_speeds)) {
-		foreach ($dns_speeds as $qt) {
-			$text_table[] = array(trim($qt['dns_server']), trim($qt['query_time']));
+	echo gettext("Server") . "\t" . gettext("Query Time") . "\n";
+	if(is_array($dns_speeds)) 
+		foreach($dns_speeds as $qt){
+			echo trim($qt['dns_server']) . "\t" . trim($qt['query_time']);
+			echo "\n";
 		}
-	}
-	$col0_padlength = max(array_map($map_lengths, $text_table)) + 4;
-	foreach ($text_table as $text_row) {
-		echo str_pad($text_row[0], $col0_padlength) . $text_row[1] . "\n";
-	}
 }
 
 include("head.inc"); ?>
@@ -217,7 +210,7 @@ include("head.inc"); ?>
 ?>
 				<font size="-1">
 
-			<?php } ?>
+			<?	} ?>
 			</td></tr></table>
 		  </td>
 		</tr>
diff --git a/usr/local/www/diag_limiter_info.php b/usr/local/www/diag_limiter_info.php
index 25d066c..3d8c338 100644
--- a/usr/local/www/diag_limiter_info.php
+++ b/usr/local/www/diag_limiter_info.php
@@ -33,10 +33,10 @@
 */
 
 ##|+PRIV
-##|*IDENT=page-diagnostics-limiter-info
-##|*NAME=Diagnostics: Limiter Info
-##|*DESCR=Allows access to the 'Diagnostics: Limiter Info' page
-##|*MATCH=diag_limiter_info.php*
+##|*IDENT=page-diag-system-activity
+##|*NAME=Diagnostics: System Activity
+##|*DESCR=Allows access to the 'Diagnostics: System Activity' page
+##|*MATCH=diag_system_activity*
 ##|-PRIV
 
 require("guiconfig.inc");
diff --git a/usr/local/www/diag_logs.php b/usr/local/www/diag_logs.php
index 74d01b1..0f22c27 100755
--- a/usr/local/www/diag_logs.php
+++ b/usr/local/www/diag_logs.php
@@ -69,7 +69,7 @@ include("head.inc");
 
 <body link="#0000CC" vlink="#0000CC" alink="#0000CC">
 <?php include("fbegin.inc"); ?>
-<table width="100%" border="0" cellpadding="0" cellspacing="0" summary="logs system">
+<table width="100%" border="0" cellpadding="0" cellspacing="0">
 	<tr>
 		<td>
 <?php
@@ -104,7 +104,7 @@ include("head.inc");
 	<tr>
 		<td>
 			<div id="mainarea">
-			<table class="tabcont" width="100%" border="0" cellspacing="0" cellpadding="0" summary="main area">
+			<table class="tabcont" width="100%" border="0" cellspacing="0" cellpadding="0">
 				<tr>
 					<td colspan="2" class="listtopic"><?php printf(gettext("Last %s system log entries"),$nentries); ?></td>
 				</tr>
diff --git a/usr/local/www/diag_logs_auth.php b/usr/local/www/diag_logs_auth.php
index d34bd24..8d1b3ae 100755
--- a/usr/local/www/diag_logs_auth.php
+++ b/usr/local/www/diag_logs_auth.php
@@ -59,7 +59,7 @@ include("head.inc");
 
 <body link="#0000CC" vlink="#0000CC" alink="#0000CC">
 <?php include("fbegin.inc"); ?>
-<table width="100%" border="0" cellpadding="0" cellspacing="0" summary="logs captive portal">
+<table width="100%" border="0" cellpadding="0" cellspacing="0">
   <tr><td>
 <?php
 	$tab_array = array();
@@ -80,19 +80,20 @@ include("head.inc");
   <tr>
     <td>
 	<div id="mainarea">
-		<table class="tabcont" width="100%" border="0" cellspacing="0" cellpadding="0" summary="main area">
+		<table class="tabcont" width="100%" border="0" cellspacing="0" cellpadding="0">
 		  <tr>
 			<td colspan="2" class="listtopic">
 			  <?php printf(gettext("Last %s Portal Auth log entries"),$nentries);?></td>
 		  </tr>
 		  <?php dump_clog($portal_logfile, $nentries, true); ?>
-		<tr><td><br/><form action="diag_logs_auth.php" method="post">
-			<input name="clear" type="submit" class="formbtn" value="<?= gettext("Clear log"); ?>"/></form></td></tr>
+		<tr><td><br><form action="diag_logs_auth.php" method="post">
+			<input name="clear" type="submit" class="formbtn" value="<?= gettext("Clear log"); ?>"></td></tr>
 		</table>
 	</div>
+	</form>
 	</td>
   </tr>
 </table>
 <?php include("fend.inc"); ?>
 </body>
-</html>
\ No newline at end of file
+</html>
diff --git a/usr/local/www/diag_logs_dhcp.php b/usr/local/www/diag_logs_dhcp.php
index 26465bf..1988c91 100755
--- a/usr/local/www/diag_logs_dhcp.php
+++ b/usr/local/www/diag_logs_dhcp.php
@@ -64,7 +64,7 @@ include("head.inc");
 
 <body link="#0000CC" vlink="#0000CC" alink="#0000CC">
 <?php include("fbegin.inc"); ?>
-<table width="100%" border="0" cellpadding="0" cellspacing="0" summary="logs dhcp">
+<table width="100%" border="0" cellpadding="0" cellspacing="0">
   <tr><td>
 <?php
 	$tab_array = array();
@@ -85,17 +85,18 @@ include("head.inc");
   <tr>
     <td>
 	<div id="mainarea">
-		<table class="tabcont" width="100%" border="0" cellspacing="0" cellpadding="0" summary="main area">
+		<table class="tabcont" width="100%" border="0" cellspacing="0" cellpadding="0">
 		  <tr>
 			<td colspan="2" class="listtopic">
 			  <?php printf(gettext("Last %s DHCP service log entries"), $nentries);?></td>
 		  </tr>
 		  <?php dump_clog($dhcpd_logfile, $nentries); ?>
-		<tr><td><br/><form action="diag_logs_dhcp.php" method="post">
-			<input name="clear" type="submit" class="formbtn" value="<?= gettext("Clear log");?>" /></form</td>
+		<tr><td><br><form action="diag_logs_dhcp.php" method="post">
+			<input name="clear" type="submit" class="formbtn" value="<?= gettext("Clear log");?>"></td>
 			<td>NOTE: Clearing the log file will restart the DHCP daemon.</td></tr>
 		</table>
 	</div>
+</form>
 	</td>
   </tr>
 </table>
diff --git a/usr/local/www/diag_logs_filter.php b/usr/local/www/diag_logs_filter.php
index 69ffa6d..6338396 100755
--- a/usr/local/www/diag_logs_filter.php
+++ b/usr/local/www/diag_logs_filter.php
@@ -114,7 +114,7 @@ include("head.inc");
 <body link="#0000CC" vlink="#0000CC" alink="#0000CC">
 <script src="/javascript/filter_log.js" type="text/javascript"></script>
 <?php include("fbegin.inc"); ?>
-<table width="100%" border="0" cellpadding="0" cellspacing="0" summary="logs filter">
+<table width="100%" border="0" cellpadding="0" cellspacing="0">
   <tr><td>
 <?php
 	$tab_array = array();
@@ -132,100 +132,90 @@ include("head.inc");
 	display_top_tabs($tab_array);
 ?>
  </td></tr>
-  <tr><td class="tabnavtbl">
-<?php
-	$tab_array = array();
-	$tab_array[] = array(gettext("Normal View"), true, "/diag_logs_filter.php");
-	$tab_array[] = array(gettext("Dynamic View"), false, "/diag_logs_filter_dynamic.php");
-	$tab_array[] = array(gettext("Summary View"), false, "/diag_logs_filter_summary.php");
-	display_top_tabs($tab_array);
-?>
-		</td>
-	</tr>
   <tr>
     <td>
 	<div id="mainarea">
-		<table class="tabcont sortable" width="100%" border="0" cellpadding="0" cellspacing="0" sortableMultirow="<?=$config['syslog']['filterdescriptions'] === "2"?2:1?>" summary="main area">
+		<table class="tabcont sortable" width="100%" border="0" cellpadding="0" cellspacing="0" sortableMultirow="<?=$config['syslog']['filterdescriptions'] === "2"?2:1?>">
 			<thead>
 			<tr>
 				<td colspan="<?=(!isset($config['syslog']['rawfilter']))?7:2?>" align="left" valign="middle">
-				<div id="filterlogentries_show" class="widgetconfigdiv" style=<?=(!isset($config['syslog']['rawfilter']))?"":"display:none"?>>
+				<div id="filterlogentries_show" name="filterlogentries_show" class="widgetconfigdiv" style=<?=(!isset($config['syslog']['rawfilter']))?"":"display:none"?>>
 					<form id="filterlogentries" name="filterlogentries" action="diag_logs_filter.php" method="post">
 						<?php 
 							$Include_Act = explode(",", str_replace(" ", ",", $filterfieldsarray['act']));
 							if ($filterfieldsarray['interface'] == "All") $interface = "";
 						?>
-					<table width="100%" border="0" cellpadding="0" cellspacing="0" summary="action">
+					<table width="100%" border="0" cellpadding="0" cellspacing="0">
 					<tr>
-						<td rowspan="2">
-							<div align="center"><?=gettext("Action");?></div>
-							<div align="left">
-							<input id="actpass"   name="actpass"   type="checkbox" value="Pass"   <?php if (in_arrayi('Pass',   $Include_Act)) echo "checked=\"checked\""; ?> /> Pass<br/>
-							<input id="actblock"  name="actblock"  type="checkbox" value="Block"  <?php if (in_arrayi('Block',  $Include_Act)) echo "checked=\"checked\""; ?> /> Block<br/>
-							<input id="actreject" name="actreject" type="checkbox" value="Reject" <?php if (in_arrayi('Reject', $Include_Act)) echo "checked=\"checked\""; ?> /> Reject<br/>
+						<td rowspan=2>
+							<div align=center><?=gettext("Action");?></div>
+							<div align=left>
+							<input id="actpass"   name="actpass"   type="checkbox" value="Pass"   <?php if (in_arrayi('Pass',   $Include_Act)) echo "checked"; ?> /> Pass<br>
+							<input id="actblock"  name="actblock"  type="checkbox" value="Block"  <?php if (in_arrayi('Block',  $Include_Act)) echo "checked"; ?> /> Block<br>
+							<input id="actreject" name="actreject" type="checkbox" value="Reject" <?php if (in_arrayi('Reject', $Include_Act)) echo "checked"; ?> /> Reject<br>
 							</div>
 						</td>
 						<td>
-							<div align="center"><?=gettext("Time");?></div>
-							<div align="center"><input id="filterlogentries_time" name="filterlogentries_time" class="formfld search" type="text" size="12" value="<?= $filterfieldsarray['time'] ?>" /></div>
+							<div align=center><?=gettext("Time");?></div>
+							<div align=center><input id="filterlogentries_time" name="filterlogentries_time" class="formfld search" type="text" size="12" value="<?= $filterfieldsarray['time'] ?>" /></div>
 						</td>
 						<td>
-							<div align="center"><?=gettext("Source IP Address");?></div>
-							<div align="center"><input id="filterlogentries_sourceipaddress" name="filterlogentries_sourceipaddress" class="formfld search" type="text" size="35" value="<?= $filterfieldsarray['srcip'] ?>" /></div>
+							<div align=center><?=gettext("Source IP Address");?></div>
+							<div align=center><input id="filterlogentries_sourceipaddress" name="filterlogentries_sourceipaddress" class="formfld search" type="text" size="35" value="<?= $filterfieldsarray['srcip'] ?>" /></div>
 						</td>
 						<td>
-							<div align="center"><?=gettext("Source Port");?></div>
-							<div align="center"><input id="filterlogentries_sourceport" name="filterlogentries_sourceport" class="formfld search" type="text" size="10" value="<?= $filterfieldsarray['srcport'] ?>" /></div>
+							<div align=center><?=gettext("Source Port");?></div>
+							<div align=center><input id="filterlogentries_sourceport" name="filterlogentries_sourceport" class="formfld search" type="text" size="10" value="<?= $filterfieldsarray['srcport'] ?>" /></div>
 						</td>
 						<td>
-							<div align="center"><?=gettext("Protocol");?></div>
-							<div align="center"><input id="filterlogentries_protocol" name="filterlogentries_protocol" class="formfld search" type="text" size="5" value="<?= $filterfieldsarray['proto'] ?>" /></div>
+							<div align=center><?=gettext("Protocol");?></div>
+							<div align=center><input id="filterlogentries_protocol" name="filterlogentries_protocol" class="formfld search" type="text" size="5" value="<?= $filterfieldsarray['proto'] ?>" /></div>
 						</td>
 						<td>
-							<div align="center" style="vertical-align:top;"><?=gettext("Quantity");?></div>
-							<div align="center" style="vertical-align:top;"><input id="filterlogentries_qty" name="filterlogentries_qty" class="" type="text" size="6" value="<?= $filterlogentries_qty ?>" /></div>
+							<div align=center valign=top><?=gettext("Quantity");?></div>
+							<div align=center valign=top><input id="filterlogentries_qty" name="filterlogentries_qty" class="" type="text" size="6" value="<?= $filterlogentries_qty ?>" /></div>
 						</td>
 					</tr>
 					<tr>
-						<td valign="top">
-							<div align="center"><?=gettext("Interface");?></div>
-							<div align="center"><input id="filterlogentries_interfaces" name="filterlogentries_interfaces" class="formfld search" type="text" size="12" value="<?= $filterfieldsarray['interface'] ?>" /></div>
+						<td valign=top>
+							<div align=center><?=gettext("Interface");?></div>
+							<div align=center><input id="filterlogentries_interfaces" name="filterlogentries_interfaces" class="formfld search" type="text" size="12" value="<?= $filterfieldsarray['interface'] ?>" /></div>
 						</td>
-						<td valign="top">
-							<div align="center"><?=gettext("Destination IP Address");?></div>
-							<div align="center"><input id="filterlogentries_destinationipaddress" name="filterlogentries_destinationipaddress" class="formfld search" type="text" size="35" value="<?= $filterfieldsarray['dstip'] ?>" /></div>
+						<td valign=top>
+							<div align=center><?=gettext("Destination IP Address");?></div>
+							<div align=center><input id="filterlogentries_destinationipaddress" name="filterlogentries_destinationipaddress" class="formfld search" type="text" size="35" value="<?= $filterfieldsarray['dstip'] ?>" /></div>
 						</td>
-						<td valign="top">
-							<div align="center"><?=gettext("Destination Port");?></div>
-							<div align="center"><input id="filterlogentries_destinationport" name="filterlogentries_destinationport" class="formfld search" type="text" size="10" value="<?= $filterfieldsarray['dstport'] ?>" /></div>
+						<td valign=top>
+							<div align=center><?=gettext("Destination Port");?></div>
+							<div align=center><input id="filterlogentries_destinationport" name="filterlogentries_destinationport" class="formfld search" type="text" size="10" value="<?= $filterfieldsarray['dstport'] ?>" /></div>
 						</td>
-						<td valign="top">
-							<div align="center"><?=gettext("Protocol Flags");?></div>
-							<div align="center"><input id="filterlogentries_protocolflags" name="filterlogentries_protocolflags" class="formfld search" type="text" size="5" value="<?= $filterfieldsarray['tcpflags'] ?>" /></div>
+						<td valign=top>
+							<div align=center><?=gettext("Protocol Flags");?></div>
+							<div align=center><input id="filterlogentries_protocolflags" name="filterlogentries_protocolflags" class="formfld search" type="text" size="5" value="<?= $filterfieldsarray['tcpflags'] ?>" /></div>
 						</td>
-						<td valign="bottom">
-							<div align="center"><input id="filterlogentries_submit" name="filterlogentries_submit" type="submit" class="formbtn" value="<?=gettext("Filter");?>" /></div>
+						<td valign=bottom>
+							<div align=center><input id="filterlogentries_submit" name="filterlogentries_submit" type="submit" class="formbtn" value="<?=gettext("Filter");?>" /></div>
 						</td>
 					</tr>
 					<tr>
 						<td></td>
-						<td colspan="5">
-							<?printf(gettext('Matches %1$s regular expression%2$s.'), '<a target="_blank" href="http://www.php.net/manual/en/book.pcre.php">', '</a>');?>&nbsp;&nbsp;
-							<?=gettext("Precede with exclamation (!) as first character to exclude match.");?>&nbsp;&nbsp;
+						<td colspan=5>
+							<?printf(gettext('Matches %1$s regular expression%2$s.'), '<a target="_blank" href="http://www.php.net/manual/en/book.pcre.php">', '</a>');?>&nbsp&nbsp
+							<?=gettext("Precede with exclamation (!) as first character to exclude match.");?>&nbsp&nbsp
 						</td>
 					</tr>
 					</table>
 					</form>
 				</div>
-				<div id="filterform_show" class="widgetconfigdiv" style=<?=(!isset($config['syslog']['rawfilter']))?"display:none":""?>>
+				<div id="filterform_show" name="filterform_show" class="widgetconfigdiv" style=<?=(!isset($config['syslog']['rawfilter']))?"display:none":""?>>
 					<form id="filterform" name="filterform" action="diag_logs_filter.php" method="post">
-					<table width="0%" border="0" cellpadding="0" cellspacing="0" summary="firewall log">
+					<table width="0%" border="0" cellpadding="0" cellspacing="0">
 					<tr>
 						<td>
-							<div align="center" style="vertical-align:top;"><?=gettext("Interface");?></div>
-							<div align="center" style="vertical-align:top;">
+							<div align=center valign=top><?=gettext("Interface");?></div>
+							<div align=center valign=top>
 							<select name="interface" onChange="dst_change(this.value,iface_old,document.iform.dsttype.value);iface_old = document.iform.interface.value;typesel_change();">
-							<option value="" <?=$interfacefilter?"":"selected=\"selected\""?>>*Any interface</option>
+							<option value="" <?=$interfacefilter?"":"selected"?>>*Any interface</option>
 							<?php						
 							$iflist = get_configured_interface_with_descr(false, true);
 							//$iflist = get_interface_list();
@@ -252,35 +242,39 @@ include("head.inc");
 								$interfaces["openvpn"] = "OpenVPN";
 
 							foreach ($interfaces as $iface => $ifacename): ?>
-							<option value="<?=$iface;?>" <?=($iface==$interfacefilter)?"selected=\"selected\"":"";?>><?=htmlspecialchars($ifacename);?></option>
+							<option value="<?=$iface;?>" <?=($iface==$interfacefilter)?"selected":"";?>><?=htmlspecialchars($ifacename);?></option>
 							<?php endforeach; ?>
 							</select>
 							</div>
 						</td>
 						<td>
-							<div align="center" style="vertical-align:top;"><?=gettext("Filter expression");?></div>
-							<div align="center" style="vertical-align:top;"><input id="filtertext" name="filtertext" class="formfld search" style="vertical-align:top;" type="text" size="35" value="<?=$filtertext?>" /></div>
+							<div align=center valign=top><?=gettext("Filter expression");?></div>
+							<div align=center valign=top><input id="filtertext" name="filtertext" class="formfld search" style="vertical-align:top;" type="text" size="35" value="<?=$filtertext?>" /></div>
 						</td>
 						<td>
-							<div align="center" style="vertical-align:top;"><?=gettext("Quantity");?></div>
-							<div align="center" style="vertical-align:top;"><input id="filterlogentries_qty" name="filterlogentries_qty" class="" style="vertical-align:top;" type="text" size="6" value="<?= $filterlogentries_qty ?>" /></div>
+							<div align=center valign=top><?=gettext("Quantity");?></div>
+							<div align=center valign=top><input id="filterlogentries_qty" name="filterlogentries_qty" class="" style="vertical-align:top;" type="text" size="6" value="<?= $filterlogentries_qty ?>" /></div>
 						</td>
 						<td>
-							<div align="center" style="vertical-align:top;">&nbsp;</div>
-							<div align="center" style="vertical-align:top;"><input id="filtersubmit" name="filtersubmit" type="submit" class="formbtn" style="vertical-align:top;" value="<?=gettext("Filter");?>" /></div>
+							<div align=center valign=top>&nbsp</div>
+							<div align=center valign=top><input id="filtersubmit" name="filtersubmit" type="submit" class="formbtn" style="vertical-align:top;" value="<?=gettext("Filter");?>" /></div>
 						</td>
 					</tr>
 					<tr>
 						<td></td>
-						<td colspan="2">
-							<?printf(gettext('Matches %1$s regular expression%2$s.'), '<a target="_blank" href="http://www.php.net/manual/en/book.pcre.php">', '</a>');?>&nbsp;&nbsp;
+						<td colspan=2>
+							<?printf(gettext('Matches %1$s regular expression%2$s.'), '<a target="_blank" href="http://www.php.net/manual/en/book.pcre.php">', '</a>');?>&nbsp&nbsp
 						</td>
 					</tr>
 					</table>
 					</form>
 				</div>
+				<div style="float: left;">
+					<br>
+					<?=gettext("Normal View");?> | <a href="diag_logs_filter_dynamic.php"><?=gettext("Dynamic View");?></a> | <a href="diag_logs_filter_summary.php"><?=gettext("Summary View");?></a>
+				</div>
 				<div style="float: right; vertical-align:middle">
-					<br/>
+					<br>
 					<?php if (!isset($config['syslog']['rawfilter']) && (isset($config['syslog']['filterdescriptions']) && $config['syslog']['filterdescriptions'] === "2")):?>
 					<a href="#" onclick="toggleListDescriptions()">Show/hide rule descriptions</a>
 					<?php endif;?>
@@ -325,7 +319,7 @@ include("head.inc");
 			$evenRowClass = $rowIndex % 2 ? " listMReven" : " listMRodd";
 			$rowIndex++;?>
 			<tr class="<?=$evenRowClass?>">
-			  <td class="listMRlr nowrap" align="center" sorttable_customkey="<?=$filterent['act']?>">
+			  <td class="listMRlr" nowrap="nowrap" align="center" sorttable_customkey="<?=$filterent['act']?>">
 			  <center>
 			  <a onclick="javascript:getURL('diag_logs_filter.php?getrulenum=<?php echo "{$filterent['rulenum']},{$filterent['act']}"; ?>', outputrule);">
 			  <img border="0" src="<?php echo find_action_image($filterent['act']);?>" width="11" height="11" align="middle" alt="<?php echo $filterent['act'];?>" title="<?php echo $filterent['act'];?>" />
@@ -338,7 +332,7 @@ include("head.inc");
 				<?php echo htmlspecialchars($filterent['interface']);?></td>
 			  <?php 
 			  if ($config['syslog']['filterdescriptions'] === "1")
-				echo("<td class=\"listMRr nowrap\">".find_rule_by_number_buffer($filterent['rulenum'],$filterent['act'])."</td>");
+				echo("<td class=\"listMRr\" nowrap=\"nowrap\">".find_rule_by_number_buffer($filterent['rulenum'],$filterent['act'])."</td>");
 				
 			  $int = strtolower($filterent['interface']);
 			  $proto = strtolower($filterent['proto']);
@@ -353,8 +347,8 @@ include("head.inc");
 			  $srcstr = $filterent['srcip'] . get_port_with_service($filterent['srcport'], $proto);
 			  $dststr = $filterent['dstip'] . get_port_with_service($filterent['dstport'], $proto);
 			  ?>
-			  <td class="listMRr nowrap">
-				<a onclick="javascript:getURL('diag_dns.php?host=<?php echo "{$filterent['srcip']}"; ?>&amp;dialog_output=true', outputrule);" title="<?=gettext("Reverse Resolve with DNS");?>">
+			  <td class="listMRr" nowrap="nowrap">
+				<a onclick="javascript:getURL('diag_dns.php?host=<?php echo "{$filterent['srcip']}"; ?>&dialog_output=true', outputrule);" title="<?=gettext("Reverse Resolve with DNS");?>">
 				<img border="0" src="/themes/<?= $g['theme']; ?>/images/icons/icon_log_d.gif" alt="Icon Reverse Resolve with DNS"/></a>
 				<a href="diag_dns.php?host=<?php echo $filterent['srcip']; ?>" title="<?=gettext("Reverse Resolve with DNS");?>">
 				<img border="0" src="/themes/<?= $g['theme']; ?>/images/icons/icon_log.gif" alt="Icon Reverse Resolve with DNS"/></a>
@@ -362,8 +356,8 @@ include("head.inc");
 				<img border="0" src="/themes/<?= $g['theme']; ?>/images/icons/icon_block_add.gif" alt="Icon Easy Rule: Add to Block List" /></a>
 				<?php echo $srcstr;?>
 			  </td>
-			  <td class="listMRr nowrap">
-				<a onclick="javascript:getURL('diag_dns.php?host=<?php echo "{$filterent['dstip']}"; ?>&amp;dialog_output=true', outputrule);" title="<?=gettext("Reverse Resolve with DNS");?>">
+			  <td class="listMRr" nowrap="nowrap">
+				<a onclick="javascript:getURL('diag_dns.php?host=<?php echo "{$filterent['dstip']}"; ?>&dialog_output=true', outputrule);" title="<?=gettext("Reverse Resolve with DNS");?>">
 				<img border="0" src="/themes/<?= $g['theme']; ?>/images/icons/icon_log_d.gif" alt="Icon Reverse Resolve with DNS" /></a>
 				<a href="diag_dns.php?host=<?php echo $filterent['dstip']; ?>" title="<?=gettext("Reverse Resolve with DNS");?>">
 				<img border="0" src="/themes/<?= $g['theme']; ?>/images/icons/icon_log.gif" alt="Icon Reverse Resolve with DNS" /></a>
@@ -380,7 +374,7 @@ include("head.inc");
 			<?php if (isset($config['syslog']['filterdescriptions']) && $config['syslog']['filterdescriptions'] === "2"):?>
 			<tr class="<?=$evenRowClass?>">
 			  <td colspan="2" class="listMRDescriptionL listMRlr" />
-			  <td colspan="4" class="listMRDescriptionR listMRr nowrap"><?=find_rule_by_number_buffer($filterent['rulenum'],$filterent['act']);?></td>
+			  <td colspan="4" class="listMRDescriptionR listMRr" nowrap="nowrap"><?=find_rule_by_number_buffer($filterent['rulenum'],$filterent['act']);?></td>
 			</tr>
 			<?php endif;
 			endforeach; 
@@ -416,4 +410,4 @@ include("head.inc");
 
 <?php include("fend.inc"); ?>
 </body>
-</html>
\ No newline at end of file
+</html>
diff --git a/usr/local/www/diag_logs_filter_dynamic.php b/usr/local/www/diag_logs_filter_dynamic.php
index 07f6f7d..f1b714c 100755
--- a/usr/local/www/diag_logs_filter_dynamic.php
+++ b/usr/local/www/diag_logs_filter_dynamic.php
@@ -65,8 +65,7 @@ include("head.inc");
 ?>
 <body link="#0000CC" vlink="#0000CC" alink="#0000CC">
 <?php include("fbegin.inc"); ?>
-<script type="text/javascript">
-//<![CDATA[
+<script language="javascript">
 	lastsawtime = '<?php echo time(); ?>;';
 	var lines = Array();
 	var timer;
@@ -83,16 +82,15 @@ include("head.inc");
 	/* Called by the AJAX updater */
 	function format_log_line(row) {
 		var i = 0;
-		var line = '<td class="listMRlr nowrap" align="center">' + row[i++] + '<\/td>';
+		var line = '<td class="listMRlr" nowrap="nowrap" align="center">' + row[i++] + '</td>';
 		while (i < 6) {
-			line += '<td class="listMRr nowrap">' + row[i++] + '<\/td>';
+			line += '<td class="listMRr" nowrap="nowrap">' + row[i++] + '</td>';
 		}
 		return line;
 	}
-//]]>
 </script>
 <script src="/javascript/filter_log.js" type="text/javascript"></script>
-<table width="100%" border="0" cellpadding="0" cellspacing="0" summary="logs filter dynamic">
+<table width="100%" border="0" cellpadding="0" cellspacing="0">
   <tr><td>
 <?php
 	$tab_array = array();
@@ -110,24 +108,20 @@ include("head.inc");
 	display_top_tabs($tab_array);
 ?>
  </td></tr>
-  <tr><td class="tabnavtbl">
-<?php
-	$tab_array = array();
-	$tab_array[] = array(gettext("Normal View"), false, "/diag_logs_filter.php");
-	$tab_array[] = array(gettext("Dynamic View"), true, "/diag_logs_filter_dynamic.php");
-	$tab_array[] = array(gettext("Summary View"), false, "/diag_logs_filter_summary.php");
-	display_top_tabs($tab_array);
-?>
-		</td>
-	</tr>
   <tr>
      <td>
 	<div id="mainarea">
-		<table class="tabcont" width="100%" border="0" cellpadding="0" cellspacing="0" summary="main area">
+		<table class="tabcont" width="100%" border="0" cellpadding="0" cellspacing="0">
 			<thead>
 			<tr>
+				<td colspan="6" align"left" valign="middle">
+				<a href="diag_logs_filter.php"><?=gettext("Normal View");?></a> | <?=gettext("Dynamic View");?> | <a href="diag_logs_filter_summary.php"><?=gettext("Summary View");?></a>
+				<br/><br/>
+				</td>
+			</tr>
+			<tr>
 				<td colspan="6" class="listtopic">
-				<?php printf(gettext("Last %s records"),$nentries);?>;   <?=gettext("Pause:");?><input style="vertical-align:middle;" type="checkbox" onClick="javascript:toggle_pause();" />
+				<?php printf(gettext("Last %s records"),$nentries);?>;   <?=gettext("Pause:");?><input valign="middle" type="checkbox" onClick="javascript:toggle_pause();">
 				</td>
 			</tr>
 			<tr>
@@ -146,20 +140,20 @@ include("head.inc");
 			$evenRowClass = $rowIndex % 2 ? " listMReven" : " listMRodd";
 			$rowIndex++;?>
 			<tr class="<?=$evenRowClass?>">
-				<td class="listMRlr nowrap" align="center">
+				<td class="listMRlr" nowrap="nowrap" align="center">
 				<a href="#" onclick="javascript:getURL('diag_logs_filter.php?getrulenum=<?php echo "{$filterent['rulenum']},{$filterent['act']}"; ?>', outputrule);">
 				<img border="0" src="<?php echo find_action_image($filterent['act']);?>" width="11" height="11" alt="<?php echo $filterent['act'];?>" title="<?php echo $filterent['act'];?>" />
 				</a>
 				</td>
-				<td class="listMRr nowrap"><?php echo htmlspecialchars($filterent['time']);?></td>
-				<td class="listMRr nowrap"><?php echo htmlspecialchars($filterent['interface']);?></td>
-				<td class="listMRr nowrap"><?php echo htmlspecialchars($filterent['src']);?></td>
-				<td class="listMRr nowrap"><?php echo htmlspecialchars($filterent['dst']);?></td>
+				<td class="listMRr" nowrap="nowrap"><?php echo htmlspecialchars($filterent['time']);?></td>
+				<td class="listMRr" nowrap="nowrap"><?php echo htmlspecialchars($filterent['interface']);?></td>
+				<td class="listMRr" nowrap="nowrap"><?php echo htmlspecialchars($filterent['src']);?></td>
+				<td class="listMRr" nowrap="nowrap"><?php echo htmlspecialchars($filterent['dst']);?></td>
 				<?php
 					if ($filterent['proto'] == "TCP")
 						$filterent['proto'] .= ":{$filterent['tcpflags']}";
 				?>
-				<td class="listMRr nowrap"><?php echo htmlspecialchars($filterent['proto']);?></td>
+				<td class="listMRr" nowrap="nowrap"><?php echo htmlspecialchars($filterent['proto']);?></td>
 			</tr>
 			<?php endforeach; ?>
 			</tbody>
@@ -171,4 +165,4 @@ include("head.inc");
 <p><span class="vexpl"><a href="http://doc.pfsense.org/index.php/What_are_TCP_Flags%3F"><?=gettext("TCP Flags"); ?></a>: F - FIN, S - SYN, A or . - ACK, R - RST, P - PSH, U - URG, E - ECE, C - CWR</span></p>
 <?php include("fend.inc"); ?>
 </body>
-</html>
\ No newline at end of file
+</html>
diff --git a/usr/local/www/diag_logs_filter_summary.php b/usr/local/www/diag_logs_filter_summary.php
index 4770ed2..c2d31dd 100644
--- a/usr/local/www/diag_logs_filter_summary.php
+++ b/usr/local/www/diag_logs_filter_summary.php
@@ -68,8 +68,8 @@ function cmp($a, $b) {
 function stat_block($summary, $stat, $num) {
 	global $gotlines, $fields;
 	uasort($summary[$stat] , 'cmp');
-	print "<table width=\"200\" cellpadding=\"3\" cellspacing=\"0\" border=\"1\" summary=\"source destination ip\">";
-	print "<tr><th colspan=\"2\">{$fields[$stat]} ".gettext("data")."</th></tr>";
+	print '<table width="200px" cellpadding="3" cellspacing="0" border="1">';
+	print "<tr><th colspan='2'>{$fields[$stat]} ".gettext("data")."</th></tr>";
 	$k = array_keys($summary[$stat]);
 	$total = 0;
 	$numentries = 0;
@@ -79,21 +79,21 @@ function stat_block($summary, $stat, $num) {
 			$numentries++;
 			$outstr = $k[$i];
 			if (is_ipaddr($outstr)) {
-				$outstr = "<a href=\"diag_dns.php?host={$outstr}\" title=\"".gettext("Reverse Resolve with DNS")."\"><img border=\"0\" src=\"/themes/{$g['theme']}/images/icons/icon_log.gif\" alt=\"log\" /></a> {$outstr}";
+				$outstr = "<a href=\"diag_dns.php?host={$outstr}\" title=\"".gettext("Reverse Resolve with DNS")."\"><img border=\"0\" src=\"/themes/{$g['theme']}/images/icons/icon_log.gif\"></a> {$outstr}";
 			} elseif (substr_count($outstr, '/') == 1) {
 				list($proto, $port) = explode('/', $outstr);
 				$service = getservbyport($port, strtolower($proto));
 				if ($service)
 					$outstr .= ": {$service}";
 			}
-			print "<tr><td>{$outstr}</td><td width=\"50\" align=\"right\">{$summary[$stat][$k[$i]]}</td></tr>";
+			print "<tr><td>{$outstr}</td><td width='50px' align='right'>{$summary[$stat][$k[$i]]}</td></tr>\n";
 		}
 	}
 	$leftover = $gotlines - $total;
 	if ($leftover > 0) {
-		print "<tr><td>Other</td><td width=\"50\" align=\"right\">{$leftover}</td></tr>";
+		print "<tr><td>Other</td><td width='50px' align='right'>{$leftover}</td></tr>\n";
 	}
-	print "</table>";
+	print '</table>';
 }
 
 function pie_block($summary, $stat, $num) {
@@ -103,7 +103,6 @@ function pie_block($summary, $stat, $num) {
 	$total = 0;
 	$numentries = 0;
 	print "\n<script language=\"javascript\" type=\"text/javascript\">\n";
-	print "//<![CDATA[\n";
 	for ($i=0; $i < $num; $i++) {
 		if ($k[$i]) {
 			$total += $summary[$stat][$k[$i]];
@@ -119,11 +118,11 @@ function pie_block($summary, $stat, $num) {
 	}
 
 	print "Event.observe(window, 'load', function() {\n";
-	print "	new Proto.Chart($('piechart{$stat}'),\n";
-	print "	[\n";
+	print "	new Proto.Chart($('piechart{$stat}'),           \n";
+	print "			[\n";
 	for ($i=0; $i < $num; $i++) {
 		if ($k[$i]) {
-			print "		{ data: d{$stat}{$i}, label: \"{$k[$i]}\"}";
+			print "			{ data: d{$stat}{$i}, label: \"{$k[$i]}\"}";
 			if (!(($i == ($numentries - 1)) && ($leftover <= 0)))
 				print ",\n";
 			else
@@ -131,19 +130,19 @@ function pie_block($summary, $stat, $num) {
 		}
 	}
 	if ($leftover > 0)
-		print "		{ data: d{$stat}{$i}, label: \"Other\"}\n";
-	print "	],\n";
-	print "	{\n";
-	print "		pies: {show: true, autoScale: true},\n";
-	print "		legend: {show: true, labelFormatter: lblfmt}\n";
-	print "	});\n";
+		print "			{ data: d{$stat}{$i}, label: \"Other\"}\n";
+	print "			],\n";
+	print "			{\n";
+	print "				pies: {show: true, autoScale: true},\n";
+	print "				legend: {show: true, labelFormatter: lblfmt}\n";
+	print "			});\n";
 	print "});\n";
-	print "//]]>\n";
-	print "</script>\n";
-	print "<table cellpadding=\"3\" cellspacing=\"0\" border=\"0\" summary=\"pie chart\">";
+
+	print "</script>";
+	print "<table cellpadding=\"3\" cellspacing=\"0\" border=\"0\">";
 	print "<tr><th><font size=\"+1\">{$fields[$stat]}</font></th></tr>";
-	print "<tr><td><div id=\"piechart{$stat}\" style=\"width:450px;height:300px\"></div>";
-	print "</table>\n";
+	print "<tr><td><div id=\"piechart{$stat}\" style=\"width:450px;height:300px\"></div>\n";
+	print "</table>";
 }
 
 foreach ($filterlog as $fe) {
@@ -173,15 +172,13 @@ include("head.inc"); ?>
 </script>
 <![endif]-->
 <script language="javascript" type="text/javascript">
-//<![CDATA[
 	function lblfmt(lbl) {
-		return '<font size=\"-2\">' + lbl + '<\/font>'
+		return '<font size=\"-2\">' + lbl + '</font>'
 	}
-//]]>
 </script>
 
 <?php include("fbegin.inc"); ?>
-<table width="100%" border="0" cellpadding="0" cellspacing="0" summary="logs filter summary">
+<table width="100%" border="0" cellpadding="0" cellspacing="0">
   <tr><td>
 <?php
 	$tab_array = array();
@@ -199,20 +196,13 @@ include("head.inc"); ?>
 	display_top_tabs($tab_array);
 ?>
  </td></tr>
-  <tr><td class="tabnavtbl">
-<?php
-	$tab_array = array();
-	$tab_array[] = array(gettext("Normal View"), false, "/diag_logs_filter.php");
-	$tab_array[] = array(gettext("Dynamic View"), false, "/diag_logs_filter_dynamic.php");
-	$tab_array[] = array(gettext("Summary View"), true, "/diag_logs_filter_summary.php");
-	display_top_tabs($tab_array);
-?>
-		</td>
-	</tr>
   <tr>
     <td>
 	<div id="mainarea">
-		<table class="tabcont" width="100%" border="0" cellpadding="0" cellspacing="0" align="center" summary="main area">
+		<table class="tabcont" width="100%" border="0" cellpadding="0" cellspacing="0" align="center">
+		<tr><td colspan="6" align="left">
+			<a href="diag_logs_filter.php"><?=gettext("Normal View");?></a> | <a href="diag_logs_filter_dynamic.php"><?=gettext("Dynamic View");?></a> | <?=gettext("Summary View");?><br/><br/>
+		</td></tr>
 		<tr><td align="center">
 
 <?php printf (gettext('This is a firewall log summary, of the last %1$s lines of the firewall log (Max %2$s).'), $gotlines, $lines)?><br />
@@ -232,5 +222,3 @@ foreach(array_keys($fields) as $field) {
   </tr>
 </table>
 <?php include("fend.inc"); ?>
-</body>
-</html>
\ No newline at end of file
diff --git a/usr/local/www/diag_logs_gateways.php b/usr/local/www/diag_logs_gateways.php
index df1d25d..7f574bd 100755
--- a/usr/local/www/diag_logs_gateways.php
+++ b/usr/local/www/diag_logs_gateways.php
@@ -71,7 +71,7 @@ include("head.inc");
 
 <body link="#0000CC" vlink="#0000CC" alink="#0000CC">
 <?php include("fbegin.inc"); ?>
-<table width="100%" border="0" cellpadding="0" cellspacing="0" summary="logs system gateways">
+<table width="100%" border="0" cellpadding="0" cellspacing="0">
 	<tr>
 		<td>
 <?php
@@ -106,7 +106,7 @@ include("head.inc");
 	<tr>
 		<td>
 			<div id="mainarea">
-			<table class="tabcont" width="100%" border="0" cellspacing="0" cellpadding="0" summary="main area">
+			<table class="tabcont" width="100%" border="0" cellspacing="0" cellpadding="0">
 				<tr>
 					<td colspan="2" class="listtopic"><?php printf(gettext("Last %s system log entries"),$nentries); ?></td>
 				</tr>
diff --git a/usr/local/www/diag_logs_ipsec.php b/usr/local/www/diag_logs_ipsec.php
index acb4240..98061bc 100755
--- a/usr/local/www/diag_logs_ipsec.php
+++ b/usr/local/www/diag_logs_ipsec.php
@@ -95,7 +95,7 @@ include("head.inc");
 ?>
 <body link="#0000CC" vlink="#0000CC" alink="#0000CC">
 <?php include("fbegin.inc"); ?>
-<table width="100%" border="0" cellpadding="0" cellspacing="0" summary="logs ipsec">
+<table width="100%" border="0" cellpadding="0" cellspacing="0">
  	<tr>
 		<td>
 <?php
@@ -118,7 +118,7 @@ include("head.inc");
 	<tr>
     	<td>
 			<div id="mainarea">
-			<table class="tabcont" width="100%" border="0" cellspacing="0" cellpadding="0" summary="main area">
+			<table class="tabcont" width="100%" border="0" cellspacing="0" cellpadding="0">
 		  		<tr>
 					<td colspan="2" class="listtopic"><?php printf(gettext("Last %s  IPsec log entries"),$nentries);?></td>
 		  		</tr>
@@ -133,7 +133,7 @@ include("head.inc");
 						$logent = preg_replace($search, $replace, $logent);
 					} else {
 						$searchs = "/(racoon: )([A-Z:].*?)([0-9].+\.[0-9].+.[0-9].+.[0-9].+\[[0-9].+\])(.*)/i";
-						$replaces = "$1<strong><font color=\"red\">[".gettext("Unknown Gateway/Dynamic")."]</font></strong>: $2$3$4";
+						$replaces = "$1<strong><font color=red>[".gettext("Unknown Gateway/Dynamic")."]</font></strong>: $2$3$4";
 						$logent = preg_replace($searchs, $replaces, $logent);
 					}
 					$logent = preg_split("/\s+/", $logent, 6);
@@ -146,9 +146,9 @@ include("head.inc");
 				?>
 				<tr>
 					<td>
-						<br/>
+						<br>
 						<form action="diag_logs_ipsec.php" method="post">
-						<input name="clear" type="submit" class="formbtn" value="<?=gettext("Clear log"); ?>" />
+						<input name="clear" type="submit" class="formbtn" value="<?=gettext("Clear log"); ?>">
 						</form>
 					</td>
 				</tr>
diff --git a/usr/local/www/diag_logs_ntpd.php b/usr/local/www/diag_logs_ntpd.php
index da4c609..f7b9fd2 100644
--- a/usr/local/www/diag_logs_ntpd.php
+++ b/usr/local/www/diag_logs_ntpd.php
@@ -59,7 +59,7 @@ include("head.inc");
 
 <body link="#0000CC" vlink="#0000CC" alink="#0000CC">
 <?php include("fbegin.inc"); ?>
-<table width="100%" border="0" cellpadding="0" cellspacing="0" summary="logs ntpd">
+<table width="100%" border="0" cellpadding="0" cellspacing="0">
   <tr><td>
 <?php
 	$tab_array = array();
@@ -80,19 +80,18 @@ include("head.inc");
   <tr>
     <td>
 	<div id="mainarea">
-		<table class="tabcont" width="100%" border="0" cellspacing="0" cellpadding="0" summary="main area">
+		<table class="tabcont" width="100%" border="0" cellspacing="0" cellpadding="0">
 		  <tr>
 			<td colspan="2" class="listtopic">
 			  <?php printf(gettext("Last %s NTP log entries"), $nentries);?></td>
 		  </tr>
 		  <?php dump_clog($ntpd_logfile, $nentries); ?>
-		<tr><td><br/>
+		<tr><td><br>
 		<form action="diag_logs_ntpd.php" method="post">
-			<input name="clear" type="submit" class="formbtn" value="<?=gettext("Clear log"); ?>" />
-</form>
-</td></tr>
+			<input name="clear" type="submit" class="formbtn" value="<?=gettext("Clear log"); ?>"></td></tr>
 		</table>
 	</div>
+</form>
 	</td>
   </tr>
 </table>
diff --git a/usr/local/www/diag_logs_openvpn.php b/usr/local/www/diag_logs_openvpn.php
index a86119c..a794697 100644
--- a/usr/local/www/diag_logs_openvpn.php
+++ b/usr/local/www/diag_logs_openvpn.php
@@ -62,7 +62,7 @@ include("head.inc");
 ?>
 <body link="#0000CC" vlink="#0000CC" alink="#0000CC">
 <?php include("fbegin.inc"); ?>
-<table width="100%" border="0" cellpadding="0" cellspacing="0" summary="logs openvpn">
+<table width="100%" border="0" cellpadding="0" cellspacing="0">
  	<tr>
 		<td>
 <?php
@@ -85,16 +85,16 @@ include("head.inc");
 	<tr>
     	<td>
 			<div id="mainarea">
-			<table class="tabcont" width="100%" border="0" cellspacing="0" cellpadding="0" summary="main area">
+			<table class="tabcont" width="100%" border="0" cellspacing="0" cellpadding="0">
 		  		<tr>
 					<td colspan="2" class="listtopic"><?php printf(gettext("Last %s OpenVPN log entries"),$nentries)?></td>
 		  		</tr>
 				<?php dump_clog($openvpn_logfile, $nentries); ?>
 				<tr>
 					<td>
-						<br/>
+						<br>
 						<form action="diag_logs_openvpn.php" method="post">
-						<input name="clear" type="submit" class="formbtn" value="<?=gettext("Clear log"); ?>" />
+						<input name="clear" type="submit" class="formbtn" value="<?=gettext("Clear log"); ?>">
 						</form>
 					</td>
 				</tr>
diff --git a/usr/local/www/diag_logs_ppp.php b/usr/local/www/diag_logs_ppp.php
index 0cd436d..0cd6be8 100755
--- a/usr/local/www/diag_logs_ppp.php
+++ b/usr/local/www/diag_logs_ppp.php
@@ -60,7 +60,7 @@ include("head.inc");
 ?>
 <body link="#0000CC" vlink="#0000CC" alink="#0000CC">
 <?php include("fbegin.inc"); ?>
-<table width="100%" border="0" cellpadding="0" cellspacing="0" summary="logs ppp">
+<table width="100%" border="0" cellpadding="0" cellspacing="0">
  	<tr>
 		<td>
 <?php
@@ -83,16 +83,16 @@ include("head.inc");
 	<tr>
     	<td>
 			<div id="mainarea">
-			<table class="tabcont" width="100%" border="0" cellspacing="0" cellpadding="0" summary="main area">
+			<table class="tabcont" width="100%" border="0" cellspacing="0" cellpadding="0">
 		  		<tr>
 					<td colspan="2" class="listtopic"><?php printf(gettext("Last %s PPP log entries"),$nentries);?></td>
 		  		</tr>
 				<?php dump_clog($ppp_logfile, $nentries); ?>
 				<tr>
 					<td>
-						<br/>
+						<br>
 						<form action="diag_logs_ppp.php" method="post">
-						<input name="clear" type="submit" class="formbtn" value="<?=gettext("Clear log"); ?>" />
+						<input name="clear" type="submit" class="formbtn" value="<?=gettext("Clear log"); ?>">
 						</form>
 					</td>
 				</tr>
diff --git a/usr/local/www/diag_logs_relayd.php b/usr/local/www/diag_logs_relayd.php
index ce1d7f7..b7973f3 100755
--- a/usr/local/www/diag_logs_relayd.php
+++ b/usr/local/www/diag_logs_relayd.php
@@ -60,7 +60,7 @@ include("head.inc");
 
 <body link="#0000CC" vlink="#0000CC" alink="#0000CC">
 <?php include("fbegin.inc"); ?>
-<table width="100%" border="0" cellpadding="0" cellspacing="0" summary="load balancer">
+<table width="100%" border="0" cellpadding="0" cellspacing="0">
   <tr><td>
 <?php
 	$tab_array = array();
@@ -81,16 +81,17 @@ include("head.inc");
   <tr>
     <td>
 	<div id="mainarea">
-		<table class="tabcont" width="100%" border="0" cellspacing="0" cellpadding="0" summary="main area">
+		<table class="tabcont" width="100%" border="0" cellspacing="0" cellpadding="0">
 		  <tr>
 			<td colspan="2" class="listtopic">
 			  <?php printf(gettext("Last %s Load Balancer log entries"),$nentries);?></td>
 		  </tr>
 		  <?php dump_clog($relayd_logfile, $nentries); ?>
-		<tr><td><br/><form action="diag_logs_relayd.php" method="post">
-<input name="clear" type="submit" class="formbtn" value="<?=gettext("Clear log"); ?>" /></form></td></tr>
+		<tr><td><br><form action="diag_logs_relayd.php" method="post">
+<input name="clear" type="submit" class="formbtn" value="<?=gettext("Clear log"); ?>"></td></tr>
 		</table>
 	</div>
+</form>
 	</td>
   </tr>
 </table>
diff --git a/usr/local/www/diag_logs_resolver.php b/usr/local/www/diag_logs_resolver.php
index f083c88..b5266c7 100755
--- a/usr/local/www/diag_logs_resolver.php
+++ b/usr/local/www/diag_logs_resolver.php
@@ -71,7 +71,7 @@ include("head.inc");
 
 <body link="#0000CC" vlink="#0000CC" alink="#0000CC">
 <?php include("fbegin.inc"); ?>
-<table width="100%" border="0" cellpadding="0" cellspacing="0" summary="logs system resolver">
+<table width="100%" border="0" cellpadding="0" cellspacing="0">
 	<tr>
 		<td>
 <?php
@@ -106,7 +106,7 @@ include("head.inc");
 	<tr>
 		<td>
 			<div id="mainarea">
-			<table class="tabcont" width="100%" border="0" cellspacing="0" cellpadding="0" summary="main area">
+			<table class="tabcont" width="100%" border="0" cellspacing="0" cellpadding="0">
 				<tr>
 					<td colspan="2" class="listtopic"><?php printf(gettext("Last %s system log entries"),$nentries); ?></td>
 				</tr>
diff --git a/usr/local/www/diag_logs_routing.php b/usr/local/www/diag_logs_routing.php
index 0adc9fa..57c6561 100644
--- a/usr/local/www/diag_logs_routing.php
+++ b/usr/local/www/diag_logs_routing.php
@@ -59,7 +59,7 @@ include("head.inc");
 
 <body link="#0000CC" vlink="#0000CC" alink="#0000CC">
 <?php include("fbegin.inc"); ?>
-<table width="100%" border="0" cellpadding="0" cellspacing="0" summary="logs system routing">
+<table width="100%" border="0" cellpadding="0" cellspacing="0">
   <tr><td>
 <?php
 	$tab_array = array();
@@ -92,16 +92,17 @@ include("head.inc");
   <tr>
     <td>
 	<div id="mainarea">
-		<table class="tabcont" width="100%" border="0" cellspacing="0" cellpadding="0" summary="main area">
+		<table class="tabcont" width="100%" border="0" cellspacing="0" cellpadding="0">
 		  <tr>
 			<td colspan="2" class="listtopic">
 			  <?php printf(gettext("Routing daemon log entries"),$nentries);?></td>
 		  </tr>
 		  <?php dump_clog($routing_logfile, $nentries); ?>
-		<tr><td><br/><form action="diag_logs_routing.php" method="post">
-<input name="clear" type="submit" class="formbtn" value="<?=gettext("Clear log"); ?>" /></form></td></tr>
+		<tr><td><br><form action="diag_logs_routing.php" method="post">
+<input name="clear" type="submit" class="formbtn" value="<?=gettext("Clear log"); ?>"></td></tr>
 		</table>
 	</div>
+</form>
 	</td>
   </tr>
 </table>
diff --git a/usr/local/www/diag_logs_settings.php b/usr/local/www/diag_logs_settings.php
index b7ba070..8e7513c 100755
--- a/usr/local/www/diag_logs_settings.php
+++ b/usr/local/www/diag_logs_settings.php
@@ -52,8 +52,6 @@ $pconfig['nentries'] = $config['syslog']['nentries'];
 $pconfig['remoteserver'] = $config['syslog']['remoteserver'];
 $pconfig['remoteserver2'] = $config['syslog']['remoteserver2'];
 $pconfig['remoteserver3'] = $config['syslog']['remoteserver3'];
-$pconfig['sourceip'] = $config['syslog']['sourceip'];
-$pconfig['ipproto'] = $config['syslog']['ipproto'];
 $pconfig['filter'] = isset($config['syslog']['filter']);
 $pconfig['dhcp'] = isset($config['syslog']['dhcp']);
 $pconfig['portalauth'] = isset($config['syslog']['portalauth']);
@@ -71,7 +69,6 @@ $pconfig['loglighttpd'] = !isset($config['syslog']['nologlighttpd']);
 $pconfig['rawfilter'] = isset($config['syslog']['rawfilter']);
 $pconfig['filterdescriptions'] = $config['syslog']['filterdescriptions'];
 $pconfig['disablelocallogging'] = isset($config['syslog']['disablelocallogging']);
-$pconfig['logfilesize'] = $config['syslog']['logfilesize'];
 
 if (!$pconfig['nentries'])
 	$pconfig['nentries'] = 50;
@@ -83,9 +80,7 @@ function is_valid_syslog_server($target) {
 		|| is_hostnamewithport($target));
 }
 
-if ($_POST['resetlogs'] == gettext("Reset Log Files")) {
-	clear_all_log_files();
-} elseif ($_POST) {
+if ($_POST) {
 
 	unset($input_errors);
 	$pconfig = $_POST;
@@ -105,20 +100,12 @@ if ($_POST['resetlogs'] == gettext("Reset Log Files")) {
 		$input_errors[] = gettext("Number of log entries to show must be between 5 and 2000.");
 	}
 
-	if (isset($_POST['logfilesize']) && (strlen($_POST['logfilesize']) > 0)) {
-		if (!is_numeric($_POST['logfilesize']) || ($_POST['logfilesize'] < 5120)) {
-			$input_errors[] = gettext("Log file size must be a positive integer greater than 5120.");
-		}
-	}
 	if (!$input_errors) {
 		$config['syslog']['reverse'] = $_POST['reverse'] ? true : false;
 		$config['syslog']['nentries'] = (int)$_POST['nentries'];
-		$config['syslog']['logfilesize'] = (int)$_POST['logfilesize'];
 		$config['syslog']['remoteserver'] = $_POST['remoteserver'];
 		$config['syslog']['remoteserver2'] = $_POST['remoteserver2'];
 		$config['syslog']['remoteserver3'] = $_POST['remoteserver3'];
-		$config['syslog']['sourceip'] = $_POST['sourceip'];
-		$config['syslog']['ipproto'] = $_POST['ipproto'];
 		$config['syslog']['filter'] = $_POST['filter'] ? true : false;
 		$config['syslog']['dhcp'] = $_POST['dhcp'] ? true : false;
 		$config['syslog']['portalauth'] = $_POST['portalauth'] ? true : false;
@@ -173,14 +160,13 @@ if ($_POST['resetlogs'] == gettext("Reset Log Files")) {
 }
 
 $pgtitle = array(gettext("Status"), gettext("System logs"), gettext("Settings"));
-$closehead = false;
 include("head.inc");
 
 ?>
 
 
-<script type="text/javascript">
-//<![CDATA[
+<script language="JavaScript">
+<!--
 function enable_change(enable_over) {
 	if (document.iform.enable.checked || enable_over) {
 		document.iform.remoteserver.disabled = 0;
@@ -240,15 +226,15 @@ function check_everything() {
 		document.iform.system.disabled = 0;
 	}
 }
-//]]>
+// -->
 </script>
-</head>
+
 <body link="#0000CC" vlink="#0000CC" alink="#0000CC">
 <?php include("fbegin.inc"); ?>
 <form action="diag_logs_settings.php" method="post" name="iform" id="iform">
 <?php if ($input_errors) print_input_errors($input_errors); ?>
 <?php if ($savemsg) print_info_box($savemsg); ?>
-<table width="100%" border="0" cellpadding="0" cellspacing="0" summary="logs settings">
+<table width="100%" border="0" cellpadding="0" cellspacing="0">
 <tr><td>
 <?php
 	$tab_array = array();
@@ -269,75 +255,63 @@ function check_everything() {
 <tr>
 	<td>
 	<div id="mainarea">
-	<table class="tabcont" width="100%" border="0" cellpadding="6" cellspacing="0" summary="main area">
+	<table class="tabcont" width="100%" border="0" cellpadding="6" cellspacing="0">
 		<tr>
 			<td colspan="2" valign="top" class="listtopic"><?=gettext("General Logging Options");?></td>
 		</tr>
 		<tr>
 			<td width="22%" valign="top" class="vtable">Forward/Reverse Display</td>
-			<td width="78%" class="vtable"> <input name="reverse" type="checkbox" id="reverse" value="yes" <?php if ($pconfig['reverse']) echo "checked=\"checked\""; ?> />
+			<td width="78%" class="vtable"> <input name="reverse" type="checkbox" id="reverse" value="yes" <?php if ($pconfig['reverse']) echo "checked"; ?>>
 			<strong><?=gettext("Show log entries in reverse order (newest entries on top)");?></strong></td>
 		</tr>
 		<tr>
 			<td width="22%" valign="top" class="vtable">GUI Log Entries to Display</td>
 			<td width="78%" class="vtable">
-			<input name="nentries" id="nentries" type="text" class="formfld unknown" size="4" value="<?=htmlspecialchars($pconfig['nentries']);?>" /><br/>
+			<input name="nentries" id="nentries" type="text" class="formfld unknown" size="4" value="<?=htmlspecialchars($pconfig['nentries']);?>"><br/>
 			<?=gettext("Hint: This is only the number of log entries displayed in the GUI. It does not affect how many entries are contained in the actual log files.") ?></td>
 		</tr>
 		<tr>
-			<td width="22%" valign="top" class="vtable">Log File Size</td>
-			<td width="78%" class="vtable">
-			<input name="logfilesize" id="logfilesize" type="text" class="formfld unknown" size="8" value="<?=htmlspecialchars($pconfig['logfilesize']);?>" /><br/>
-			<?=gettext("Logs are held in constant-size circular log files. This field controls how large each log file is, and thus how many entries may exist inside the log By default this is approximately 500KB per log file, and there are nearly 20 such log files.") ?>
-			<br/><br/>
-			<?=gettext("NOTE: Log sizes are changed the next time a log file is cleared or deleted. To immediately increase the size of the log files, you must clear all logs using the \"Reset Log Files\" option farther down this page. "); ?>
-			<?=gettext("Be aware that increasing this value increases every log file size, so disk usage will increase significantly."); ?>
-			<?=gettext("Disk space currently used by log files: ") ?><?= exec("/usr/bin/du -sh /var/log | /usr/bin/awk '{print $1;}'"); ?>.
-			<?=gettext("Remaining disk space for log files: ") ?><?= exec("/bin/df -h /var/log | /usr/bin/awk '{print $4;}'"); ?>.
-			</td>
-		</tr>
-		<tr>
 			<td valign="top" class="vtable">Log Firewall Default Blocks</td>
 			<td class="vtable">
-				<input name="logdefaultblock" type="checkbox" id="logdefaultblock" value="yes" <?php if ($pconfig['logdefaultblock']) echo "checked=\"checked\""; ?> />
+				<input name="logdefaultblock" type="checkbox" id="logdefaultblock" value="yes" <?php if ($pconfig['logdefaultblock']) echo "checked"; ?>>
 				<strong><?=gettext("Log packets blocked by the default rule");?></strong><br/>
 				<?=gettext("Hint: packets that are blocked by the implicit default block rule will not be logged if you uncheck this option. Per-rule logging options are still respected.");?>
 				<br/>
-				<input name="logbogons" type="checkbox" id="logbogons" value="yes" <?php if ($pconfig['logbogons']) echo "checked=\"checked\""; ?> />
+				<input name="logbogons" type="checkbox" id="logbogons" value="yes" <?php if ($pconfig['logbogons']) echo "checked"; ?>>
 				<strong><?=gettext("Log packets blocked by 'Block Bogon Networks' rules");?></strong><br/>
 				<br/>
-				<input name="logprivatenets" type="checkbox" id="logprivatenets" value="yes" <?php if ($pconfig['logprivatenets']) echo "checked=\"checked\""; ?> />
+				<input name="logprivatenets" type="checkbox" id="logprivatenets" value="yes" <?php if ($pconfig['logprivatenets']) echo "checked"; ?>>
 				<strong><?=gettext("Log packets blocked by 'Block Private Networks' rules");?></strong><br/>
 			</td>
 		</tr>
 		<tr>
 			<td valign="top" class="vtable">Web Server Log</td>
-			<td class="vtable"> <input name="loglighttpd" type="checkbox" id="loglighttpd" value="yes" <?php if ($pconfig['loglighttpd']) echo "checked=\"checked\""; ?> />
-			<strong><?=gettext("Log errors from the web server process.");?></strong><br/>
+			<td class="vtable"> <input name="loglighttpd" type="checkbox" id="loglighttpd" value="yes" <?php if ($pconfig['loglighttpd']) echo "checked"; ?>>
+			<strong><?=gettext("Log errors from the web server process.");?></strong><br>
 			<?=gettext("Hint: If this is checked, errors from the lighttpd web server process for the GUI or Captive Portal will appear in the main system log.");?></td>
 		</tr>
 		<tr>
 			<td valign="top" class="vtable">Raw Logs</td>
-			<td class="vtable"> <input name="rawfilter" type="checkbox" id="rawfilter" value="yes" <?php if ($pconfig['rawfilter']) echo "checked=\"checked\""; ?> />
-			<strong><?=gettext("Show raw filter logs");?></strong><br/>
+			<td class="vtable"> <input name="rawfilter" type="checkbox" id="rawfilter" value="yes" <?php if ($pconfig['rawfilter']) echo "checked"; ?>>
+			<strong><?=gettext("Show raw filter logs");?></strong><br>
 			<?=gettext("Hint: If this is checked, filter logs are shown as generated by the packet filter, without any formatting. This will reveal more detailed information, but it is more difficult to read.");?></td>
 		</tr>
 		<tr>
 			<td valign="top" class="vtable">Filter descriptions</td>
 			<td class="vtable">
 				<select name="filterdescriptions" id="filterdescriptions" >
-				  <option value="0"<?=!isset($pconfig['filterdescriptions'])?" selected=\"selected\"":""?>>Dont load descriptions</option>
-				  <option value="1"<?=($pconfig['filterdescriptions'])==="1"?" selected=\"selected\"":""?>>Display as column</option>
-				  <option value="2"<?=($pconfig['filterdescriptions'])==="2"?" selected=\"selected\"":""?>>Display as second row</option>
+				  <option value="0"<?=!isset($pconfig['filterdescriptions'])?" selected":""?>>Dont load descriptions</option>
+				  <option value="1"<?=($pconfig['filterdescriptions'])==="1"?" selected":""?>>Display as column</option>
+				  <option value="2"<?=($pconfig['filterdescriptions'])==="2"?" selected":""?>>Display as second row</option>
 				</select>
 				<strong><?=gettext("Show the applied rule description below or in the firewall log rows.");?></strong>
 				<br/>
-				<?=gettext("Displaying rule descriptions for all lines in the log might affect performance with large rule sets.");?>
+				<?=gettext("Displaying rule descriptions for all lines in the log might affect performance with large rule sets.");?></td>
 			</td>
 		</tr>
 		<tr>
 			<td width="22%" valign="top" class="vtable">Local Logging</td>
-			<td width="78%" class="vtable"> <input name="disablelocallogging" type="checkbox" id="disablelocallogging" value="yes" <?php if ($pconfig['disablelocallogging']) echo "checked=\"checked\""; ?> onclick="enable_change(false)" />
+			<td width="78%" class="vtable"> <input name="disablelocallogging" type="checkbox" id="disablelocallogging" value="yes" <?php if ($pconfig['disablelocallogging']) echo "checked"; ?> onClick="enable_change(false)">
 			<?php if ($g['platform'] == "pfSense"): ?>
 			<strong><?=gettext("Disable writing log files to the local disk");?></strong></td>
 			<?php else: ?>
@@ -345,73 +319,31 @@ function check_everything() {
 			<?php endif; ?>
 		</tr>
 		<tr>
-			<td width="22%" valign="top">Reset Logs</td>
-			<td width="78%">
-				<input name="resetlogs" type="submit" class="formbtn" value="<?=gettext("Reset Log Files"); ?>"  onclick="return confirm('<?=gettext('Do you really want to reset the log files? This will erase all local log data.');?>')" />
-				<br/><br/>
-				<?= gettext("Note: Clears all local log files and reinitializes them as empty logs. This also restarts the DHCP daemon."); ?>
-			</td>
-		</tr>
-		<tr>
 			<td colspan="2" valign="top">&nbsp;</td>
 		</tr>
 		<tr>
 			<td colspan="2" valign="top" class="listtopic"><?=gettext("Remote Logging Options");?></td>
 		</tr>
 		<tr>
-			<td width="22%" valign="top" class="vncell"><?=gettext("Source Address"); ?></td>
-			<td width="78%" class="vtable">
-				<select name="sourceip" class="formselect">
-					<option value="">Default (any)</option>
-				<?php $sourceips = get_possible_traffic_source_addresses(false);
-					foreach ($sourceips as $sip):
-						$selected = "";
-						if (!link_interface_to_bridge($sip['value']) && ($sip['value'] == $pconfig['sourceip']))
-							$selected = 'selected="selected"';
-				?>
-					<option value="<?=$sip['value'];?>" <?=$selected;?>>
-						<?=htmlspecialchars($sip['name']);?>
-					</option>
-					<?php endforeach; ?>
-				</select>
-				<br/>
-				<?= gettext("This option will allow the logging daemon to bind to a single IP address, rather than all IP addresses."); ?>
-				<?= gettext("If you pick a single IP, remote syslog severs must all be of that IP type. If you wish to mix IPv4 and IPv6 remote syslog servers, you must bind to all interfaces."); ?>
-				<br/><br/>
-				<?= gettext("NOTE: If an IP address cannot be located on the chosen interface, the daemon will bind to all addresses."); ?>
-			</td>
-		</tr>
-		<tr>
-			<td width="22%" valign="top" class="vncell"><?=gettext("IP Protocol"); ?></td>
-			<td width="78%" class="vtable">
-				<select name="ipproto" class="formselect">
-					<option value="ipv4" <?php if ($ipproto == "ipv4") echo 'selected="selected"' ?>>IPv4</option>
-					<option value="ipv6" <?php if ($ipproto == "ipv6") echo 'selected="selected"' ?>>IPv6</option>
-				</select>
-				<br/>
-				<?= gettext("This option is only used when a non-default address is chosen as the source above. This option only expresses a preference; If an IP address of the selected type is not found on the chosen interface, the other type will be tried."); ?>
-			</td>
-		</tr>
-		<tr>
 			<td width="22%" valign="top" class="vncell"><?=gettext("Enable Remote Logging");?></td>
-			<td width="78%" class="vtable"> <input name="enable" type="checkbox" id="enable" value="yes" <?php if ($pconfig['enable']) echo "checked=\"checked\""; ?> onclick="enable_change(false)" />
+			<td width="78%" class="vtable"> <input name="enable" type="checkbox" id="enable" value="yes" <?php if ($pconfig['enable']) echo "checked"; ?> onClick="enable_change(false)">
 				<strong><?=gettext("Send log messages to remote syslog server");?></strong></td>
 		</tr>
 		<tr>
 			<td width="22%" valign="top" class="vncell"><?=gettext("Remote Syslog Servers");?></td>
 			<td width="78%" class="vtable">
-				<table summary="remtote syslog servers">
+				<table>
 					<tr>
 						<td><?=gettext("Server") . " 1";?></td>
-						<td><input name="remoteserver" id="remoteserver" type="text" class="formfld host" size="20" value="<?=htmlspecialchars($pconfig['remoteserver']);?>" /></td>
+						<td><input name="remoteserver" id="remoteserver" type="text" class="formfld host" size="20" value="<?=htmlspecialchars($pconfig['remoteserver']);?>"></td>
 					</tr>
 					<tr>
 						<td><?=gettext("Server") . " 2";?></td>
-						<td><input name="remoteserver2" id="remoteserver2" type="text" class="formfld host" size="20" value="<?=htmlspecialchars($pconfig['remoteserver2']);?>" /></td>
+						<td><input name="remoteserver2" id="remoteserver2" type="text" class="formfld host" size="20" value="<?=htmlspecialchars($pconfig['remoteserver2']);?>"></td>
 					</tr>
 					<tr>
 						<td><?=gettext("Server") . " 3";?></td>
-						<td><input name="remoteserver3" id="remoteserver3" type="text" class="formfld host" size="20" value="<?=htmlspecialchars($pconfig['remoteserver3']);?>" /></td>
+						<td><input name="remoteserver3" id="remoteserver3" type="text" class="formfld host" size="20" value="<?=htmlspecialchars($pconfig['remoteserver3']);?>"></td>
 					</tr>
 					<tr>
 						<td>&nbsp;</td>
@@ -422,34 +354,34 @@ function check_everything() {
 		<tr>
 			<td width="22%" valign="top" class="vncell"><?=gettext("Remote Syslog Contents");?></td>
 			<td width="78%" class="vtable">
-				<input name="logall" id="logall" type="checkbox" value="yes" <?php if ($pconfig['logall']) echo "checked=\"checked\""; ?> onclick="check_everything();" />
+				<input name="logall" id="logall" type="checkbox" value="yes" <?php if ($pconfig['logall']) echo "checked"; ?> onclick="check_everything();">
 				<?=gettext("Everything");?><br/><br/>
-				<input name="system" id="system" type="checkbox" value="yes" onclick="enable_change(false)" <?php if ($pconfig['system']) echo "checked=\"checked\""; ?> />
+				<input name="system" id="system" type="checkbox" value="yes" onclick="enable_change(false)" <?php if ($pconfig['system']) echo "checked"; ?>>
 				<?=gettext("System events");?><br/>
-				<input name="filter" id="filter" type="checkbox" value="yes" <?php if ($pconfig['filter']) echo "checked=\"checked\""; ?> />
+				<input name="filter" id="filter" type="checkbox" value="yes" <?php if ($pconfig['filter']) echo "checked"; ?>>
 				<?=gettext("Firewall events");?><br/>
-				<input name="dhcp" id="dhcp" type="checkbox" value="yes" <?php if ($pconfig['dhcp']) echo "checked=\"checked\""; ?> />
+				<input name="dhcp" id="dhcp" type="checkbox" value="yes" <?php if ($pconfig['dhcp']) echo "checked"; ?>>
 				<?=gettext("DHCP service events");?><br/>
-				<input name="portalauth" id="portalauth" type="checkbox" value="yes" <?php if ($pconfig['portalauth']) echo "checked=\"checked\""; ?> />
+				<input name="portalauth" id="portalauth" type="checkbox" value="yes" <?php if ($pconfig['portalauth']) echo "checked"; ?>>
 				<?=gettext("Portal Auth events");?><br/>
-				<input name="vpn" id="vpn" type="checkbox" value="yes" <?php if ($pconfig['vpn']) echo "checked=\"checked\""; ?> />
+				<input name="vpn" id="vpn" type="checkbox" value="yes" <?php if ($pconfig['vpn']) echo "checked"; ?>>
 				<?=gettext("VPN (PPTP, IPsec, OpenVPN) events");?><br/>
-				<input name="apinger" id="apinger" type="checkbox" value="yes" <?php if ($pconfig['apinger']) echo "checked=\"checked\""; ?> />
+				<input name="apinger" id="apinger" type="checkbox" value="yes" <?php if ($pconfig['apinger']) echo "checked"; ?>>
 				<?=gettext("Gateway Monitor events");?><br/>
-				<input name="relayd" id="relayd" type="checkbox" value="yes" <?php if ($pconfig['relayd']) echo "checked=\"checked\""; ?> />
+				<input name="relayd" id="relayd" type="checkbox" value="yes" <?php if ($pconfig['relayd']) echo "checked"; ?>>
 				<?=gettext("Server Load Balancer events");?><br/>
-				<input name="hostapd" id="hostapd" type="checkbox" value="yes" <?php if ($pconfig['hostapd']) echo "checked=\"checked\""; ?> />
+				<input name="hostapd" id="hostapd" type="checkbox" value="yes" <?php if ($pconfig['hostapd']) echo "checked"; ?>>
 				<?=gettext("Wireless events");?><br/>
 			</td>
 		</tr>
 		<tr>
 			<td width="22%" valign="top">&nbsp;</td>
-			<td width="78%"> <input name="Submit" type="submit" class="formbtn" value="<?=gettext("Save"); ?>" onclick="enable_change(true)" />
+			<td width="78%"> <input name="Submit" type="submit" class="formbtn" value="<?=gettext("Save"); ?>" onclick="enable_change(true)">
 			</td>
 		</tr>
 		<tr>
 			<td width="22%" height="53" valign="top">&nbsp;</td>
-			<td width="78%"><strong><span class="red"><?=gettext("Note:")?></span></strong><br/>
+			<td width="78%"><strong><span class="red"><?=gettext("Note:")?></span></strong><br>
 			<?=gettext("syslog sends UDP datagrams to port 514 on the specified " .
 			"remote syslog server, unless another port is specified. Be sure to set syslogd on the " .
 			"remote server to accept syslog messages from");?> <?=$g['product_name']?>.
@@ -460,11 +392,11 @@ function check_everything() {
 </td></tr>
 </table>
 </form>
-<script type="text/javascript">
-//<![CDATA[
+<script language="JavaScript">
+<!--
 enable_change(false);
-//]]>
+//-->
 </script>
 <?php include("fend.inc"); ?>
 </body>
-</html>
\ No newline at end of file
+</html>
diff --git a/usr/local/www/diag_logs_vpn.php b/usr/local/www/diag_logs_vpn.php
index 7920306..db64753 100755
--- a/usr/local/www/diag_logs_vpn.php
+++ b/usr/local/www/diag_logs_vpn.php
@@ -101,12 +101,12 @@ function dump_clog_vpn($logfile, $tail) {
 		if ($iftype != $vpntype)
 			continue;
 		echo "<tr>\n";
-		echo "<td class=\"listlr nowrap\">" . htmlspecialchars(join(" ", array_slice($logent, 0, 3))) . "</td>\n";
+		echo "<td class=\"listlr\" nowrap>" . htmlspecialchars(join(" ", array_slice($logent, 0, 3))) . "</td>\n";
 
 		if ($llent[0] == "login")
-			echo "<td class=\"listr\"><img src=\"/themes/{$g['theme']}/images/icons/icon_in.gif\" width=\"11\" height=\"11\" title=\"login\" alt=\"in\" /></td>\n";
+			echo "<td class=\"listr\"><img src=\"/themes/{$g['theme']}/images/icons/icon_in.gif\" width=\"11\" height=\"11\" title=\"login\"></td>\n";
 		else
-			echo "<td class=\"listr\"><img src=\"/themes/{$g['theme']}/images/icons/icon_out.gif\" width=\"11\" height=\"11\" title=\"logout\" alt=\"out\" /></td>\n";
+			echo "<td class=\"listr\"><img src=\"/themes/{$g['theme']}/images/icons/icon_out.gif\" width=\"11\" height=\"11\" title=\"logout\"></td>\n";
 
 		echo "<td class=\"listr\">" . htmlspecialchars($llent[3]) . "</td>\n";
 		echo "<td class=\"listr\">" . htmlspecialchars($llent[2]) . "&nbsp;</td>\n";
@@ -119,7 +119,7 @@ include("head.inc");
 ?>
 <body link="#0000CC" vlink="#0000CC" alink="#0000CC">
 <?php include("fbegin.inc"); ?>
-<table width="100%" border="0" cellpadding="0" cellspacing="0" summary="logs vpn">
+<table width="100%" border="0" cellpadding="0" cellspacing="0">
   <tr><td class="tabnavtbl">
 <?php
 	$tab_array = array();
@@ -145,26 +145,26 @@ include("head.inc");
 				"/diag_logs_vpn.php?vpntype=pptp");
 	$tab_array[] = array(gettext("PPTP Raw"),
 				(($vpntype == "pptp") && ($mode == "raw")),
-				"/diag_logs_vpn.php?vpntype=pptp&amp;mode=raw");
+				"/diag_logs_vpn.php?vpntype=pptp&mode=raw");
 	$tab_array[] = array(gettext("PPPoE Logins"),
 				(($vpntype == "poes") && ($mode != "raw")),
 				"/diag_logs_vpn.php?vpntype=poes");
 	$tab_array[] = array(gettext("PPPoE Raw"),
 				(($vpntype == "poes") && ($mode == "raw")),
-				"/diag_logs_vpn.php?vpntype=poes&amp;mode=raw");
+				"/diag_logs_vpn.php?vpntype=poes&mode=raw");
 	$tab_array[] = array(gettext("L2TP Logins"),
 				(($vpntype == "l2tp") && ($mode != "raw")),
 				"/diag_logs_vpn.php?vpntype=l2tp");
 	$tab_array[] = array(gettext("L2TP Raw"),
 				(($vpntype == "l2tp") && ($mode == "raw")),
-				"/diag_logs_vpn.php?vpntype=l2tp&amp;mode=raw");
+				"/diag_logs_vpn.php?vpntype=l2tp&mode=raw");
 	display_top_tabs($tab_array);
 ?>
   </td></tr>
   <tr>
     <td class="tabcont">
 	<form action="diag_logs_vpn.php" method="post">
-	<table width="100%" border="0" cellpadding="0" cellspacing="0" summary="main area">
+	<table width="100%" border="0" cellpadding="0" cellspacing="0"><tr>
 		<tr>
 		<td colspan="4" class="listtopic">
 			<?php printf(gettext('Last %1$s %2$s VPN log entries'),$nentries,$vpns[$vpntype]);?></td>
@@ -182,13 +182,11 @@ include("head.inc");
 		      endif; ?>
 	</table>
 	<br />
-	<input type="hidden" name="vpntype" id="vpntype" value="<?=$vpntype;?>" />
-	<input type="hidden" name="mode" id="mode" value="<?=$mode;?>" />
-	<input name="clear" type="submit" class="formbtn" value="<?=gettext("Clear log"); ?>" />
+	<input type="hidden" name="vpntype" id="vpntype" value="<?=$vpntype;?>">
+	<input type="hidden" name="mode" id="mode" value="<?=$mode;?>">
+	<input name="clear" type="submit" class="formbtn" value="<?=gettext("Clear log"); ?>">
 	</form>
 	</td>
   </tr>
 </table>
 <?php include("fend.inc"); ?>
-</body>
-</html>
\ No newline at end of file
diff --git a/usr/local/www/diag_logs_wireless.php b/usr/local/www/diag_logs_wireless.php
index 6dc462e..fe86bd7 100644
--- a/usr/local/www/diag_logs_wireless.php
+++ b/usr/local/www/diag_logs_wireless.php
@@ -61,7 +61,7 @@ include("head.inc");
 
 <body link="#0000CC" vlink="#0000CC" alink="#0000CC">
 <?php include("fbegin.inc"); ?>
-<table width="100%" border="0" cellpadding="0" cellspacing="0" summary="logs system wireless">
+<table width="100%" border="0" cellpadding="0" cellspacing="0">
   <tr><td>
 <?php
 	$tab_array = array();
@@ -94,16 +94,17 @@ include("head.inc");
   <tr>
     <td>
 	<div id="mainarea">
-		<table class="tabcont" width="100%" border="0" cellspacing="0" cellpadding="0" summary="main area">
+		<table class="tabcont" width="100%" border="0" cellspacing="0" cellpadding="0">
 		  <tr>
 			<td colspan="2" class="listtopic">
 			  <?php printf(gettext("Wireless (hostapd) log entries"),$nentries);?></td>
 		  </tr>
 		  <?php dump_clog($wireless_logfile, $nentries); ?>
-		<tr><td><br/><form action="diag_logs_wireless.php" method="post">
-<input name="clear" type="submit" class="formbtn" value="<?=gettext("Clear log"); ?>" /></form></td></tr>
+		<tr><td><br><form action="diag_logs_wireless.php" method="post">
+<input name="clear" type="submit" class="formbtn" value="<?=gettext("Clear log"); ?>"></td></tr>
 		</table>
 	</div>
+</form>
 	</td>
   </tr>
 </table>
diff --git a/usr/local/www/diag_nanobsd.php b/usr/local/www/diag_nanobsd.php
index 804b3b4..54b4bf1 100755
--- a/usr/local/www/diag_nanobsd.php
+++ b/usr/local/www/diag_nanobsd.php
@@ -108,11 +108,14 @@ if ($_POST['changero']) {
 }
 
 if ($_POST['setrw']) {
-	conf_mount_rw();
-	if (isset($_POST['nanobsd_force_rw']))
+	if (isset($_POST['nanobsd_force_rw'])) {
+		if (!is_writable("/")) {
+			conf_mount_rw();
+		}
 		$config['system']['nanobsd_force_rw'] = true;
-	else
+	} else {
 		unset($config['system']['nanobsd_force_rw']);
+	}
 
 	write_config("Changed Permanent Read/Write Setting");
 	conf_mount_ro();
@@ -172,8 +175,7 @@ if ($savemsg)
 							<form action="diag_nanobsd.php" method="post" name="iform">
 							<?php if (is_writable("/")) {
 								$refcount = refcount_read(1000);
-								/* refcount_read returns -1 when shared memory section does not exist */
-								if ($refcount == 1 || $refcount == -1) {
+								if ($refcount == 1) {
 									$refdisplay = "";
 								} else {
 									$refdisplay = " (reference count " . $refcount . ")";
@@ -245,15 +247,15 @@ if ($savemsg)
 						<td width="22%" valign="top" class="vncell"><?=gettext("View previous upgrade log");?></td>
 						<td width="78%" class="vtable">
 						<?php
-							if ($_POST['viewupgradelog']) {
+							if($_POST['viewupgradelog']) {
 								echo "<textarea name='log' cols='80' rows='40'>";
-								echo str_ireplace("pfsense", $g['product_name'], file_get_contents("/conf/upgrade_log.txt"));
+								echo file_get_contents("/conf/upgrade_log.txt");
 								echo "\nFile list:\n";
-								echo str_ireplace("pfsense", $g['product_name'], file_get_contents("/conf/file_upgrade_log.txt"));
+								echo file_get_contents("/conf/file_upgrade_log.txt");
 								echo "\nMisc log:\n";
-								echo str_ireplace("pfsense", $g['product_name'], file_get_contents("/conf/firmware_update_misc_log.txt"));
+								echo file_get_contents("/conf/firmware_update_misc_log.txt");
 								echo "\nfdisk/bsdlabel log:\n";
-								echo str_ireplace("pfsense", $g['product_name'], file_get_contents("/conf/fdisk_upgrade_log.txt"));
+								echo file_get_contents("/conf/fdisk_upgrade_log.txt");
 								echo "</textarea>";
 							} else {
 								echo "<form action='diag_nanobsd.php' method='post' name='iform'>";
diff --git a/usr/local/www/diag_pf_info.php b/usr/local/www/diag_pf_info.php
index 71430df..e7b0e35 100644
--- a/usr/local/www/diag_pf_info.php
+++ b/usr/local/www/diag_pf_info.php
@@ -33,10 +33,10 @@
 */
 
 ##|+PRIV
-##|*IDENT=page-diagnostics-pf-info
-##|*NAME=Diagnostics: pfInfo
-##|*DESCR=Allows access to the 'Diagnostics: pfInfo' page
-##|*MATCH=diag_pf_info.php*
+##|*IDENT=page-diag-system-activity
+##|*NAME=Diagnostics: System Activity
+##|*DESCR=Allows access to the 'Diagnostics: System Activity' page
+##|*MATCH=diag_system_activity*
 ##|-PRIV
 
 require("guiconfig.inc");
@@ -114,4 +114,4 @@ jQuery(document).ready(function() {setTimeout('getpfinfo()', 5000);});
 </form>
 <?php include("fend.inc"); ?>
 </body>
-</html>
+</html>
\ No newline at end of file
diff --git a/usr/local/www/diag_ping.php b/usr/local/www/diag_ping.php
index 391d939..6bb9184 100755
--- a/usr/local/www/diag_ping.php
+++ b/usr/local/www/diag_ping.php
@@ -55,7 +55,7 @@ if ($_POST || $_REQUEST['host']) {
 	/* input validation */
 	$reqdfields = explode(" ", "host count");
 	$reqdfieldsn = array(gettext("Host"),gettext("Count"));
-	do_input_validation($_REQUEST, $reqdfields, $reqdfieldsn, $input_errors);
+	do_input_validation($_REQUEST, $reqdfields, $reqdfieldsn, &$input_errors);
 
 	if (($_REQUEST['count'] < 1) || ($_REQUEST['count'] > MAX_COUNT)) {
 		$input_errors[] = sprintf(gettext("Count must be between 1 and %s"), MAX_COUNT);
diff --git a/usr/local/www/diag_system_activity.php b/usr/local/www/diag_system_activity.php
index 6d62569..05118cf 100644
--- a/usr/local/www/diag_system_activity.php
+++ b/usr/local/www/diag_system_activity.php
@@ -33,10 +33,10 @@
 */
 
 ##|+PRIV
-##|*IDENT=page-diagnostics-system-activity
+##|*IDENT=page-diag-system-activity
 ##|*NAME=Diagnostics: System Activity
 ##|*DESCR=Allows access to the 'Diagnostics: System Activity' page
-##|*MATCH=diag_system_activity.php*
+##|*MATCH=diag_system_activity*
 ##|-PRIV
 
 require("guiconfig.inc");
diff --git a/usr/local/www/diag_system_pftop.php b/usr/local/www/diag_system_pftop.php
index 97c1b7a..87dbc65 100644
--- a/usr/local/www/diag_system_pftop.php
+++ b/usr/local/www/diag_system_pftop.php
@@ -32,9 +32,9 @@
 */
 
 ##|+PRIV
-##|*IDENT=page-diagnostics-system-pftop
-##|*NAME=Diagnostics: pfTop
-##|*DESCR=Allows access to the 'Diagnostics: pfTop' page
+##|*IDENT=page-diag-system-activity
+##|*NAME=Diagnostics: System Activity
+##|*DESCR=Allows access to the 'Diagnostics: System Activity' page
 ##|*MATCH=diag_system_pftop.php*
 ##|-PRIV
 
@@ -213,4 +213,4 @@ jQuery("#viewtype").change(function() {
 });
 </script>
 </body>
-</html>
+</html>
\ No newline at end of file
diff --git a/usr/local/www/diag_testport.php b/usr/local/www/diag_testport.php
index 67d4d9e..c8aa6a3 100644
--- a/usr/local/www/diag_testport.php
+++ b/usr/local/www/diag_testport.php
@@ -58,7 +58,7 @@ if ($_POST || $_REQUEST['host']) {
 	/* input validation */
 	$reqdfields = explode(" ", "host port");
 	$reqdfieldsn = array(gettext("Host"),gettext("Port"));
-	do_input_validation($_REQUEST, $reqdfields, $reqdfieldsn, $input_errors);
+	do_input_validation($_REQUEST, $reqdfields, $reqdfieldsn, &$input_errors);
 
 	if (!is_ipaddr($_REQUEST['host']) && !is_hostname($_REQUEST['host'])) {
 		$input_errors[] = gettext("Please enter a valid IP or hostname.");
diff --git a/usr/local/www/diag_traceroute.php b/usr/local/www/diag_traceroute.php
index 35b40e1..1e27020 100755
--- a/usr/local/www/diag_traceroute.php
+++ b/usr/local/www/diag_traceroute.php
@@ -61,7 +61,7 @@ if ($_POST || $_REQUEST['host']) {
 	/* input validation */
 	$reqdfields = explode(" ", "host ttl");
 	$reqdfieldsn = array(gettext("Host"),gettext("ttl"));
-	do_input_validation($_REQUEST, $reqdfields, $reqdfieldsn, $input_errors);
+	do_input_validation($_REQUEST, $reqdfields, $reqdfieldsn, &$input_errors);
 
 	if (($_REQUEST['ttl'] < 1) || ($_REQUEST['ttl'] > MAX_TTL)) {
 		$input_errors[] = sprintf(gettext("Maximum number of hops must be between 1 and %s"), MAX_TTL);
diff --git a/usr/local/www/edit.php b/usr/local/www/edit.php
index f48b9bf..f700fcf 100644
--- a/usr/local/www/edit.php
+++ b/usr/local/www/edit.php
@@ -199,7 +199,7 @@ outputJavaScriptFileInline("javascript/base64.js");
 <!-- file viewer/editor -->
 <table width="100%">
 	<tr>
-		<td valign="top">
+		<td valign="top" class="label">
 			<div style="background:#eeeeee;" id="fileOutput">
 				<textarea id="fileContent" name="fileContent" style="width:100%;" rows="30" wrap="off"></textarea>
 			</div>
diff --git a/usr/local/www/exec.php b/usr/local/www/exec.php
index 2b84d74..eda1321 100755
--- a/usr/local/www/exec.php
+++ b/usr/local/www/exec.php
@@ -83,7 +83,7 @@ function puts( $arg ) { echo "$arg\n"; }
 // "Constants".
 
 $Version    = '';
-$ScriptName = $REQUEST['SCRIPT_NAME'];
+$ScriptName = $HTTP_SERVER_VARS['SCRIPT_NAME'];
 
 // Get year.
 
diff --git a/usr/local/www/firewall_aliases_edit.php b/usr/local/www/firewall_aliases_edit.php
index 7bef3d6..cee13ef 100755
--- a/usr/local/www/firewall_aliases_edit.php
+++ b/usr/local/www/firewall_aliases_edit.php
@@ -44,6 +44,10 @@
 ##|*MATCH=firewall_aliases_edit.php*
 ##|-PRIV
 
+
+// Keywords not allowed in names
+$reserved_keywords = array("all", "pass", "block", "out", "queue", "max", "min", "pptp", "pppoe", "L2TP", "OpenVPN", "IPsec");
+
 require("guiconfig.inc");
 require_once("functions.inc");
 require_once("filter.inc");
@@ -51,16 +55,8 @@ require_once("shaper.inc");
 
 $pgtitle = array(gettext("Firewall"),gettext("Aliases"),gettext("Edit"));
 
-// Keywords not allowed in names
-$reserved_keywords = array("all", "pass", "block", "out", "queue", "max", "min", "pptp", "pppoe", "L2TP", "OpenVPN", "IPsec");
-
-// Add all Load balance names to reserved_keywords
-if (is_array($config['load_balancer']['lbpool']))
-	foreach ($config['load_balancer']['lbpool'] as $lbpool)
-		$reserved_keywords[] = $lbpool['name'];
-
 $reserved_ifs = get_configured_interface_list(false, true);
-$reserved_keywords = array_merge($reserved_keywords, $reserved_ifs, $reserved_table_names);
+$reserved_keywords = array_merge($reserved_keywords, $reserved_ifs);
 
 if (!is_array($config['aliases']['alias']))
 	$config['aliases']['alias'] = array();
@@ -110,11 +106,12 @@ if (isset($id) && $a_aliases[$id]) {
 		if($ifdesc == $pconfig['descr'])
 			$input_errors[] = sprintf(gettext("Sorry, an interface is already named %s."), $pconfig['descr']);
 
-	if(preg_match("/urltable/i", $a_aliases[$id]['type'])) {
+	if($a_aliases[$id]['type'] == "urltable") {
 		$pconfig['address'] = $a_aliases[$id]['url'];
 		$pconfig['updatefreq'] = $a_aliases[$id]['updatefreq'];
 	}
 	if($a_aliases[$id]['aliasurl'] <> "") {
+		$pconfig['type'] = "url";
 		if(is_array($a_aliases[$id]['aliasurl']))
 			$pconfig['address'] = implode(" ", $a_aliases[$id]['aliasurl']);
 		else
@@ -124,14 +121,13 @@ if (isset($id) && $a_aliases[$id]) {
 
 if ($_POST) {
 	unset($input_errors);
-	$vertical_bar_err_text = gettext("Vertical bars (|) at start or end, or double in the middle of descriptions not allowed. Descriptions have been cleaned. Check and save again.");
 
 	/* input validation */
 
 	$reqdfields = explode(" ", "name");
 	$reqdfieldsn = array(gettext("Name"));
 
-	do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+	do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 
 	$x = is_validaliasname($_POST['name']);
 	if (!isset($x)) {
@@ -170,11 +166,11 @@ if ($_POST) {
 	$final_address_details = array();
 	$alias['name'] = $_POST['name'];
 
-	if (preg_match("/urltable/i", $_POST['type'])) {
+	if ($_POST['type'] == "urltable") {
 		$address = "";
 		$isfirst = 0;
 
-		/* item is a url table type */
+		/* item is a url type */
 		if ($_POST['address0']) {
 			/* fetch down and add in */
 			$_POST['address0'] = trim($_POST['address0']);
@@ -184,25 +180,19 @@ if ($_POST) {
 			$alias['updatefreq'] = $_POST['address_subnet0'] ? $_POST['address_subnet0'] : 7;
 			if (!is_URL($alias['url']) || empty($alias['url'])) {
 				$input_errors[] = gettext("You must provide a valid URL.");
+				$dont_update = true;
 			} elseif (! process_alias_urltable($alias['name'], $alias['url'], 0, true)) {
 				$input_errors[] = gettext("Unable to fetch usable data.");
+				$dont_update = true;
 			}
-			if ($_POST["detail0"] <> "") {
-				if ((strpos($_POST["detail0"], "||") === false) && (substr($_POST["detail0"], 0, 1) != "|") && (substr($_POST["detail0"], -1, 1) != "|")) {
-					$final_address_details[] = $_POST["detail0"];
-				} else {
-					/* Remove leading and trailing vertical bars and replace multiple vertical bars with single, */
-					/* and put in the output array so the text is at least redisplayed for the user. */
-					$final_address_details[] = preg_replace('/\|\|+/', '|', trim($_POST["detail0"], "|"));
-					$input_errors[] = $vertical_bar_err_text;
-				}
-			} else
+			if ($_POST["detail0"] <> "")
+				$final_address_details[] = $_POST["detail0"];
+			else
 				$final_address_details[] = sprintf(gettext("Entry added %s"), date('r'));
 		}
-	} else if ($_POST['type'] == "url" || $_POST['type'] == "url_ports") {
+	} elseif($_POST['type'] == "url") {
 		$isfirst = 0;
 		$address_count = 2;
-		$desc_fmt_err_found = false;
 
 		/* item is a url type */
 		for($x=0; $x<4999; $x++) {
@@ -212,10 +202,8 @@ if ($_POST) {
 				$isfirst = 0;
 				$temp_filename = tempnam("{$g['tmp_path']}/", "alias_import");
 				unlink($temp_filename);
-				$verify_ssl = isset($config['system']['checkaliasesurlcert']);
 				mwexec("/bin/mkdir -p {$temp_filename}");
-				download_file($_POST['address' . $x], $temp_filename . "/aliases", $verify_ssl);
-
+				mwexec("/usr/bin/fetch -q -o \"{$temp_filename}/aliases\" \"" . $_POST['address' . $x] . "\"");
 				/* if the item is tar gzipped then extract */
 				if(stristr($_POST['address' . $x], ".tgz"))
 					process_alias_tgz($temp_filename);
@@ -226,19 +214,9 @@ if ($_POST) {
 					$alias['aliasurl'] = array();
 
 				$alias['aliasurl'][] = $_POST['address' . $x];
-				if ($_POST["detail{$x}"] <> "") {
-					if ((strpos($_POST["detail{$x}"], "||") === false) && (substr($_POST["detail{$x}"], 0, 1) != "|") && (substr($_POST["detail{$x}"], -1, 1) != "|")) {
-						$final_address_details[] = $_POST["detail{$x}"];
-					} else {
-						/* Remove leading and trailing vertical bars and replace multiple vertical bars with single, */
-						/* and put in the output array so the text is at least redisplayed for the user. */
-						$final_address_details[] = preg_replace('/\|\|+/', '|', trim($_POST["detail{$x}"], "|"));
-						if (!$desc_fmt_err_found) {
-							$input_errors[] = $vertical_bar_err_text;
-							$desc_fmt_err_found = true;
-						}
-					}
-				} else
+				if ($_POST["detail{$x}"] <> "")
+					$final_address_details[] = $_POST["detail{$x}"];
+				else
 					$final_address_details[] = sprintf(gettext("Entry added %s"), date('r'));
 
 				if(file_exists("{$temp_filename}/aliases")) {
@@ -255,12 +233,7 @@ if ($_POST) {
 							$tmp = trim($tmp_split[0]);
 						}
 						$tmp = trim($tmp);
-						if ($_POST['type'] == "url")
-							$is_valid = (is_ipaddr($tmp) || is_subnet($tmp));
-						else
-							$is_valid = (is_port($tmp) || is_portrange($tmp));
-
-						if (!empty($tmp) && $is_valid) {
+						if(!empty($tmp) && (is_ipaddr($tmp) || is_subnet($tmp))) {
 							$address[] = $tmp;
 							$isfirst = 1;
 							$address_count++;
@@ -269,20 +242,28 @@ if ($_POST) {
 					if($isfirst == 0) {
 						/* nothing was found */
 						$input_errors[] = sprintf(gettext("You must provide a valid URL. Could not fetch usable data from '%s'."), $_POST['address' . $x]);
+						$dont_update = true;
 					}
 					mwexec("/bin/rm -rf {$temp_filename}");
 				} else {
 					$input_errors[] = sprintf(gettext("URL '%s' is not valid."), $_POST['address' . $x]);
+					$dont_update = true;
 				}
 			}
 		}
-		unset($desc_fmt_err_found);
-		if ($_POST['type'] == "url_ports")
-			$address = group_ports($address);
 	} else {
 		/* item is a normal alias type */
+		$used_for_routes = 0;
+		if (isset($config['staticroutes']['route']) && is_array($config['staticroutes']['route'])) {
+			foreach($config['staticroutes']['route'] as $route) {
+				if ($route['network'] == $_POST['origname']) {
+					$used_for_routes = 1;
+					break;
+				}
+			}
+		}
 		$wrongaliases = "";
-		$desc_fmt_err_found = false;
+		$wrongaliases_fqdn = "";
 		for($x=0; $x<4999; $x++) {
 			if($_POST["address{$x}"] <> "") {
 				$_POST["address{$x}"] = trim($_POST["address{$x}"]);
@@ -290,8 +271,20 @@ if ($_POST) {
 					if (!alias_same_type($_POST["address{$x}"], $_POST['type']))
 						// But alias type network can include alias type urltable. Feature#1603.
 						if (!($_POST['type'] == 'network' &&
-						      preg_match("/urltable/i", alias_get_type($_POST["address{$x}"]))))
+						      alias_get_type($_POST["address{$x}"]) == 'urltable'))
 							$wrongaliases .= " " . $_POST["address{$x}"];
+					if ($used_for_routes === 1) {
+						foreach (filter_expand_alias_array($_POST["address{$x}"], true) as $tgt) {
+							if (is_ipaddrv4($tgt))
+								$tgt .= "/32";
+							if (is_ipaddrv6($tgt))
+								$tgt .= "/128";
+							if (!is_subnet($tgt) && is_fqdn($tgt)) {
+								$wrongaliases_fqdn .= " " . $_POST["address{$x}"];
+								break;
+							}
+						}
+					}
 				} else if ($_POST['type'] == "port") {
 					if (!is_port($_POST["address{$x}"]))
 						$input_errors[] = $_POST["address{$x}"] . " " . gettext("is not a valid port or alias.");
@@ -300,6 +293,11 @@ if ($_POST) {
 					 && !is_hostname($_POST["address{$x}"])
 					 && !is_iprange($_POST["address{$x}"]))
 						$input_errors[] = sprintf(gettext('%1$s is not a valid %2$s alias.'), $_POST["address{$x}"], $_POST['type']);
+					if (($used_for_routes === 1)
+					 && !is_ipaddr($_POST["address{$x}"])
+					 && !is_iprange($_POST["address{$x}"])
+					 && is_hostname($_POST["address{$x}"]))
+						$input_errors[] = gettext('This alias is used on a static route and cannot contain FQDNs.');
 				}
 				if (is_iprange($_POST["address{$x}"])) {
 					list($startip, $endip) = explode('-', $_POST["address{$x}"]);
@@ -311,29 +309,18 @@ if ($_POST) {
 						$tmpaddress .= "/" . $_POST["address_subnet{$x}"];
 					$address[] = $tmpaddress;
 				}
-				if ($_POST["detail{$x}"] <> "") {
-					if ((strpos($_POST["detail{$x}"], "||") === false) && (substr($_POST["detail{$x}"], 0, 1) != "|") && (substr($_POST["detail{$x}"], -1, 1) != "|")) {
-						$final_address_details[] = $_POST["detail{$x}"];
-					} else {
-						/* Remove leading and trailing vertical bars and replace multiple vertical bars with single, */
-						/* and put in the output array so the text is at least redisplayed for the user. */
-						$final_address_details[] = preg_replace('/\|\|+/', '|', trim($_POST["detail{$x}"], "|"));
-						if (!$desc_fmt_err_found) {
-							$input_errors[] = $vertical_bar_err_text;
-							$desc_fmt_err_found = true;
-						}
-					}
-				} else
+				if ($_POST["detail{$x}"] <> "")
+					$final_address_details[] = $_POST["detail{$x}"];
+				else
 					$final_address_details[] = sprintf(gettext("Entry added %s"), date('r'));
 			}
 		}
-		unset($desc_fmt_err_found);
 		if ($wrongaliases <> "")
 			$input_errors[] = sprintf(gettext('The alias(es): %s cannot be nested because they are not of the same type.'), $wrongaliases);
+		if ($wrongaliases_fqdn <> "")
+			$input_errors[] = sprintf(gettext('The alias(es): %s cannot be nested because they contain FQDNs and this alias is used on at least one static route.'), $wrongaliases_fqdn);
 	}
 
-	unset($vertical_bar_err_text);
-
 	// Allow extending of the firewall edit page and include custom input validation
 	pfSense_handle_custom_code("/usr/local/pkg/firewall_aliases_edit/input_validation");
 
@@ -413,7 +400,7 @@ if ($_POST) {
 	{
 		$pconfig['name'] = $_POST['name'];
 		$pconfig['descr'] = $_POST['descr'];
-		if (($_POST['type'] == 'url') || ($_POST['type'] == 'url_ports'))
+		if ($_POST['type'] == 'url')
 			$pconfig['address'] = implode(" ", $alias['aliasurl']);
 		else
 			$pconfig['address'] = implode(" ", $address);
@@ -430,40 +417,68 @@ $jscriptstr = <<<EOD
 //<![CDATA[
 var objAlias = new Array(4999);
 function typesel_change() {
-	var field_disabled = 0;
-	var field_value = "";
-	var set_value = false;
 	switch (document.iform.type.selectedIndex) {
 		case 0:	/* host */
-			field_disabled = 1;
-			field_value = "";
-			set_value = true;
+			var cmd;
+
+			newrows = totalrows;
+			for(i=0; i<newrows; i++) {
+				comd = 'document.iform.address_subnet' + i + '.disabled = 1;';
+				eval(comd);
+				comd = 'document.iform.address_subnet' + i + '.value = "";';
+				eval(comd);
+			}
 			break;
 		case 1:	/* network */
-			field_disabled = 0;
+			var cmd;
+
+			newrows = totalrows;
+			for(i=0; i<newrows; i++) {
+				comd = 'document.iform.address_subnet' + i + '.disabled = 0;';
+				eval(comd);
+			}
 			break;
 		case 2:	/* port */
-			field_disabled = 1;
-			field_value = "128";
-			set_value = true;
-			break;
-		case 3:	/* url */
-			field_disabled = 1;
+			var cmd;
+
+			newrows = totalrows;
+			for(i=0; i<newrows; i++) {
+				comd = 'document.iform.address_subnet' + i + '.disabled = 1;';
+				eval(comd);
+				comd = 'document.iform.address_subnet' + i + '.value = "128";';
+				eval(comd);
+			}
 			break;
-		case 4:	/* url_ports */
-			field_disabled = 1;
+/*		case 3:	// OpenVPN Users
+			var cmd;
+
+			newrows = totalrows;
+			for(i=0; i<newrows; i++) {
+				comd = 'document.iform.address_subnet' + i + '.disabled = 1;';
+				eval(comd);
+				comd = 'document.iform.address_subnet' + i + '.value = "";';
+				eval(comd);
+			}
 			break;
-		case 5:	/* urltable */
-			field_disabled = 0;
+*/
+		case 3:	/* url */
+			var cmd;
+			newrows = totalrows;
+			for(i=0; i<newrows; i++) {
+				comd = 'document.iform.address_subnet' + i + '.disabled = 1;';
+				eval(comd);
+			}
 			break;
-		case 6:	/* urltable_ports */
-			field_disabled = 0;
+
+		case 4:	/* urltable */
+			var cmd;
+			newrows = totalrows;
+			for(i=0; i<newrows; i++) {
+				comd = 'document.iform.address_subnet' + i + '.disabled = 0;';
+				eval(comd);
+			}
 			break;
 	}
-
-	jQuery("select[id='address_subnet']").prop("disabled", field_disabled);
-	if (set_value == true);
-		jQuery("select[id='address_subnet']").prop("value", field_value);
 }
 
 function add_alias_control() {
@@ -483,19 +498,15 @@ $hosts_str = gettext("Host(s)");
 $ip_str = gettext("IP");
 $ports_str = gettext("Port(s)");
 $port_str = gettext("Port");
-$url_str = gettext("URL (IPs)");
-$url_ports_str = gettext("URL (Ports)");
-$urltable_str = gettext("URL Table (IPs)");
-$urltable_ports_str = gettext("URL Table (Ports)");
-$update_freq_str = gettext("Update Freq. (days)");
+$url_str = gettext("URL");
+$urltable_str = gettext("URL Table");
+$update_freq_str = gettext("Update Freq.");
 
 $networks_help = gettext("Networks are specified in CIDR format.  Select the CIDR mask that pertains to each entry. /32 specifies a single IPv4 host, /128 specifies a single IPv6 host, /24 specifies 255.255.255.0, /64 specifies a normal IPv6 network, etc. Hostnames (FQDNs) may also be specified, using a /32 mask for IPv4 or /128 for IPv6. You may also enter an IP range such as 192.168.1.1-192.168.1.254 and a list of CIDR networks will be derived to fill the range.");
 $hosts_help = gettext("Enter as many hosts as you would like.  Hosts must be specified by their IP address or fully qualified domain name (FQDN). FQDN hostnames are periodically re-resolved and updated. If multiple IPs are returned by a DNS query, all are used.");
 $ports_help = gettext("Enter as many ports as you wish.  Port ranges can be expressed by separating with a colon.");
 $url_help = sprintf(gettext("Enter as many URLs as you wish. After saving %s will download the URL and import the items into the alias. Use only with small sets of IP addresses (less than 3000)."), $g['product_name']);
-$url_ports_help = sprintf(gettext("Enter as many URLs as you wish. After saving %s will download the URL and import the items into the alias. Use only with small sets of Ports (less than 3000)."), $g['product_name']);
 $urltable_help = sprintf(gettext("Enter a single URL containing a large number of IPs and/or Subnets. After saving %s will download the URL and create a table file containing these addresses. This will work with large numbers of addresses (30,000+) or small numbers."), $g['product_name']);
-$urltable_ports_help = sprintf(gettext("Enter a single URL containing a list of Port numbers and/or Port ranges. After saving %s will download the URL."), $g['product_name']);
 
 $openvpn_str = gettext("Username");
 $openvpn_user_str = gettext("OpenVPN Users");
@@ -535,13 +546,6 @@ function update_box_type() {
 		document.getElementById ("threecolumn").firstChild.data = "{$description_str}";
 		document.getElementById ("itemhelp").firstChild.data = "{$url_help}";
 		document.getElementById ("addrowbutton").style.display = 'block';
-	} else if(selected == '{$url_ports_str}') {
-		document.getElementById ("addressnetworkport").firstChild.data = "{$url_ports_str}";
-		document.getElementById ("onecolumn").firstChild.data = "{$url_ports_str}";
-		document.getElementById ("twocolumn").firstChild.data = "";
-		document.getElementById ("threecolumn").firstChild.data = "{$description_str}";
-		document.getElementById ("itemhelp").firstChild.data = "{$url_ports_help}";
-		document.getElementById ("addrowbutton").style.display = 'block';
 	} else if(selected == '{$openvpn_user_str}') {
 		document.getElementById ("addressnetworkport").firstChild.data = "{$openvpn_user_str}";
 		document.getElementById ("onecolumn").firstChild.data = "{$openvpn_str}";
@@ -562,19 +566,6 @@ function update_box_type() {
 		document.getElementById ("threecolumn").style.display = 'none';
 		document.getElementById ("itemhelp").firstChild.data = "{$urltable_help}";
 		document.getElementById ("addrowbutton").style.display = 'none';
-	} else if(selected == '{$urltable_ports_str}') {
-		if ((typeof(totalrows) == "undefined") || (totalrows < 1)) {
-			addRowTo('maintable', 'formfldalias');
-			typesel_change();
-			add_alias_control(this);
-		}
-		document.getElementById ("addressnetworkport").firstChild.data = "{$url_str}";
-		document.getElementById ("onecolumn").firstChild.data = "{$url_str}";
-		document.getElementById ("twocolumn").firstChild.data = "{$update_freq_str}";
-		document.getElementById ("threecolumn").firstChild.data = "";
-		document.getElementById ("threecolumn").style.display = 'none';
-		document.getElementById ("itemhelp").firstChild.data = "{$urltable_ports_help}";
-		document.getElementById ("addrowbutton").style.display = 'none';
 	}
 }
 //]]>
@@ -621,7 +612,7 @@ EOD;
 <form action="firewall_aliases_edit.php" method="post" name="iform" id="iform">
 <?php
 if (empty($tab)) {
-	if (preg_match("/url/i", $pconfig['type']))
+	if ($pconfig['type'] == 'urltable')
 		$tab = 'url';
 	else if ($pconfig['type'] == 'host')
 		$tab = 'ip';
@@ -667,10 +658,8 @@ if (empty($tab)) {
 				<option value="network" <?php if ($pconfig['type'] == "network") echo "selected=\"selected\""; ?>><?=gettext("Network(s)"); ?></option>
 				<option value="port" <?php if (($pconfig['type'] == "port") || (empty($pconfig['type']) && ($tab == "port"))) echo "selected=\"selected\""; ?>><?=gettext("Port(s)"); ?></option>
 				<!--<option value="openvpn" <?php if ($pconfig['type'] == "openvpn") echo "selected=\"selected\""; ?>><?=gettext("OpenVPN Users"); ?></option> -->
-				<option value="url" <?php if (($pconfig['type'] == "url") || (empty($pconfig['type']) && ($tab == "url"))) echo "selected=\"selected\""; ?>><?=gettext("URL (IPs)");?></option>
-				<option value="url_ports" <?php if ($pconfig['type'] == "url_ports") echo "selected=\"selected\""; ?>><?=gettext("URL (Ports)");?></option>
-				<option value="urltable" <?php if ($pconfig['type'] == "urltable") echo "selected=\"selected\""; ?>><?=gettext("URL Table (IPs)"); ?></option>
-				<option value="urltable_ports" <?php if ($pconfig['type'] == "urltable_ports") echo "selected=\"selected\""; ?>><?=gettext("URL Table (Ports)"); ?></option>
+				<option value="url" <?php if (($pconfig['type'] == "url") || (empty($pconfig['type']) && ($tab == "url"))) echo "selected=\"selected\""; ?>><?=gettext("URL");?></option>
+				<option value="urltable" <?php if ($pconfig['type'] == "urltable") echo "selected=\"selected\""; ?>><?=gettext("URL Table"); ?></option>
 			</select>
 		</td>
 	</tr>
@@ -692,23 +681,30 @@ if (empty($tab)) {
 
 					<?php
 					$counter = 0;
-					if ($pconfig['address'] <> ""):
-						$addresses = explode(" ", $pconfig['address']);
-						$details = explode("||", $pconfig['detail']);
-						while ($counter < count($addresses)):
-							if (is_subnet($addresses[$counter])) {
-								list($address, $address_subnet) = explode("/", $addresses[$counter]);
-							} else {
-								$address = $addresses[$counter];
-								$address_subnet = "";
+					$address = $pconfig['address'];
+					if ($address <> "") {
+						$item = explode(" ", $address);
+						$item3 = explode("||", $pconfig['detail']);
+						foreach($item as $ww) {
+							$address = $item[$counter];
+							$address_subnet = "";
+							$item2 = explode("/", $address);
+							foreach($item2 as $current) {
+								if($item2[1] <> "") {
+									$address = $item2[0];
+									$address_subnet = $item2[1];
+								}
+
 							}
+							$item4 = $item3[$counter];
+							$tracker = $counter;
 					?>
 					<tr>
 						<td>
-							<input autocomplete="off" name="address<?php echo $counter; ?>" type="text" class="formfldalias ipv4v6" id="address<?php echo $counter; ?>" size="30" value="<?=htmlspecialchars($address);?>" />
+							<input autocomplete="off" name="address<?php echo $tracker; ?>" type="text" class="formfldalias ipv4v6" id="address<?php echo $tracker; ?>" size="30" value="<?=htmlspecialchars($address);?>" />
 						</td>
 						<td>
-							<select name="address_subnet<?php echo $counter; ?>" class="formselect ipv4v6" id="address_subnet<?php echo $counter; ?>">
+							<select name="address_subnet<?php echo $tracker; ?>" class="formselect ipv4v6" id="address_subnet<?php echo $tracker; ?>">
 								<option></option>
 								<?php for ($i = 128; $i >= 1; $i--): ?>
 									<option value="<?=$i;?>" <?php if (($i == $address_subnet) || ($i == $pconfig['updatefreq'])) echo "selected=\"selected\""; ?>><?=$i;?></option>
@@ -716,7 +712,7 @@ if (empty($tab)) {
 							</select>
 						</td>
 						<td>
-							<input name="detail<?php echo $counter; ?>" type="text" class="formfld unknown" id="detail<?php echo $counter; ?>" size="50" value="<?=$details[$counter];?>" />
+							<input name="detail<?php echo $tracker; ?>" type="text" class="formfld unknown" id="detail<?php echo $tracker; ?>" size="50" value="<?=$item4;?>" />
 						</td>
 						<td>
 							<a onclick="removeRow(this); return false;" href="#"><img border="0" src="/themes/<?echo $g['theme'];?>/images/icons/icon_x.gif" alt="" title="<?=gettext("remove this entry"); ?>" /></a>
@@ -725,8 +721,8 @@ if (empty($tab)) {
 					<?php
 						$counter++;
 
-						endwhile;
-					endif;
+						} // end foreach
+					} // end if
 					?>
 				</tbody>
 			</table>
diff --git a/usr/local/www/firewall_aliases_import.php b/usr/local/www/firewall_aliases_import.php
index 276dfb5..9b9d735 100755
--- a/usr/local/www/firewall_aliases_import.php
+++ b/usr/local/www/firewall_aliases_import.php
@@ -1,7 +1,7 @@
 <?php
 /* $Id$ */
 /*
-	firewall_aliases_import.php
+	firewall_aliases_edit.php
 	Copyright (C) 2005 Scott Ullrich
 	All rights reserved.
 
@@ -38,8 +38,7 @@
 ##|-PRIV
 
 
-// Keywords not allowed in names
-$reserved_keywords = array("all", "pass", "block", "out", "queue", "max", "min", "pptp", "pppoe", "L2TP", "OpenVPN", "IPsec");
+$reserved_keywords = array("pass", "out", "queue", "max", "min", "pptp", "pppoe", "L2TP", "OpenVPN", "IPsec");
 
 require("guiconfig.inc");
 require_once("util.inc");
@@ -48,13 +47,8 @@ require("shaper.inc");
 
 $pgtitle = array(gettext("Firewall"),gettext("Aliases"),gettext("Bulk import"));
 
-// Add all Load balance names to reserved_keywords
-if (is_array($config['load_balancer']['lbpool']))
-	foreach ($config['load_balancer']['lbpool'] as $lbpool)
-		$reserved_keywords[] = $lbpool['name'];
-
 $reserved_ifs = get_configured_interface_list(false, true);
-$reserved_keywords = array_merge($reserved_keywords, $reserved_ifs, $reserved_table_names);
+$reserved_keywords = array_merge($reserved_keywords, $reserved_ifs);
 
 if (!is_array($config['aliases']['alias']))
         $config['aliases']['alias'] = array();
@@ -64,7 +58,7 @@ if($_POST['aliasimport'] <> "") {
 	$reqdfields = explode(" ", "name aliasimport");
 	$reqdfieldsn = array(gettext("Name"),gettext("Aliases"));
 
-	do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+	do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 		
 	if (is_validaliasname($_POST['name']) == false)
 		$input_errors[] = gettext("The alias name may only consist of the characters") . " a-z, A-Z, 0-9, _.";
@@ -89,56 +83,27 @@ if($_POST['aliasimport'] <> "") {
 
 	if ($_POST['aliasimport']) {
 		$tocheck = explode("\n", $_POST['aliasimport']);
-		$imported_ips = array();
-		$imported_descs = array();
-		$desc_len_err_found = false;
-		$desc_fmt_err_found = false;
-		foreach ($tocheck as $impline) {
-			$implinea = explode(" ",trim($impline),2);
-			$impip = $implinea[0];
-			$impdesc = trim($implinea[1]);
-			if (strlen($impdesc) < 200) {
-				if ((strpos($impdesc, "||") === false) && (substr($impdesc, 0, 1) != "|") && (substr($impdesc, -1, 1) != "|")) {
-					if (is_iprange($impip)) {
-						list($startip, $endip) = explode('-', $impip);
-						$rangesubnets = ip_range_to_subnet_array($startip, $endip);
-						$imported_ips = array_merge($imported_ips, $rangesubnets);
-						$rangedescs = array_fill(0, count($rangesubnets), $impdesc);
-						$imported_descs = array_merge($imported_descs, $rangedescs);
-					} else if (!is_ipaddr($impip) && !is_subnet($impip) && !empty($impip)) {
-						$input_errors[] = sprintf(gettext("%s is not an IP address. Please correct the error to continue"), $impip);
-					} elseif (!empty($impip)) {
-						$imported_ips[] = $impip;
-						$imported_descs[] = $impdesc;
-					}
-				}
-				else {
-					if (!$desc_fmt_err_found) {
-						$input_errors[] = gettext("Descriptions may not start or end with vertical bar (|) or contain double vertical bar ||.");
-						$desc_fmt_err_found = true;
-					}
-				}
-			}
-			else {
-				if (!$desc_len_err_found) {
-					/* Note: The 200 character limit is just a practical check to avoid accidents */
-					/* if the user pastes a large number of IP addresses without line breaks.     */
-					$input_errors[] = gettext("Descriptions must be less than 200 characters long.");
-					$desc_len_err_found = true;
-				}
+		$imported = array();
+		foreach ($tocheck as $impip) {
+			$impip = trim($impip);
+			if (is_iprange($impip)) {
+				list($startip, $endip) = explode('-', $impip);
+				$rangesubnets = ip_range_to_subnet_array($startip, $endip);
+				$address .= implode(" ", $rangesubnets);
+			} else if (!is_ipaddr($impip) && !is_subnet($impip) && !empty($impip)) {
+				$input_errors[] = sprintf(gettext("%s is not an IP address. Please correct the error to continue"), $impip);
+			} elseif (!empty($impip)) {
+				$imported[] = $impip;
 			}
 		}
-		unset($desc_len_err_found, $desc_fmt_err_found);
 	}
 
-	if (!$input_errors && is_array($imported_ips)) {
+	if (!$input_errors && is_array($imported)) {
 		$alias = array();
-		$alias['address'] = implode(" ", $imported_ips);
-		$alias['detail'] = implode("||", $imported_descs);
+		$alias['address'] = implode(" ", $imported);
 		$alias['name'] = $_POST['name'];
 		$alias['type'] = "network";
 		$alias['descr'] = $_POST['descr'];
-		unset($imported_ips, $imported_descs);
 		$a_aliases[] = $alias;
 
 		// Sort list
@@ -180,14 +145,8 @@ include("head.inc");
 	<tr>
 	  <td valign="top" class="vncellreq"><?=gettext("Aliases to import"); ?></td>
 	  <td class="vtable"><textarea name="aliasimport" rows="15" cols="40"><?php echo $_POST['aliasimport']; ?></textarea>
-		<br /> <span class="vexpl"><?=gettext("Paste in the aliases to import separated by a carriage return.  Common examples are lists of IPs, networks, blacklists, etc."); ?> 
-		<br /> <?=gettext("The list may contain IP addresses, with or without CIDR prefix, IP ranges, blank lines (ignored) and an optional description after each IP. e.g.:"); ?>
-		<br />172.16.1.2
-		<br />172.16.0.0/24
-		<br />10.11.12.100-10.11.12.200
-		<br />192.168.1.254 Home router
-		<br />10.20.0.0/16 Office network
-		<br />10.40.1.10-10.40.1.19 Managed switches</span></td>
+	    <br /> <span class="vexpl"><?=gettext("Paste in the aliases to import separated by a carriage return.  Common examples are lists of IPs, networks, blacklists, etc."); ?> 
+	    <br /> <?=gettext("The list may contain only IP addresses."); ?> </span></td>
 	</tr>
 	<tr>
 	  <td width="22%" valign="top">&nbsp;</td>
diff --git a/usr/local/www/firewall_nat_1to1.php b/usr/local/www/firewall_nat_1to1.php
index 8c3e2d9..e682d22 100755
--- a/usr/local/www/firewall_nat_1to1.php
+++ b/usr/local/www/firewall_nat_1to1.php
@@ -44,12 +44,13 @@ require_once("functions.inc");
 require_once("filter.inc");
 require_once("shaper.inc");
 
-if (!is_array($config['nat']['onetoone']))
+if (!is_array($config['nat']['onetoone'])) {
 	$config['nat']['onetoone'] = array();
-
+}
 $a_1to1 = &$config['nat']['onetoone'];
 
 if ($_POST) {
+
 	$pconfig = $_POST;
 
 	if ($_POST['apply']) {
@@ -74,75 +75,6 @@ if ($_GET['act'] == "del") {
 	}
 }
 
-if (isset($_POST['del_x'])) {
-	/* delete selected rules */
-	if (is_array($_POST['rule']) && count($_POST['rule'])) {
-		foreach ($_POST['rule'] as $rulei) {
-			unset($a_1to1[$rulei]);
-		}
-		if (write_config())
-			mark_subsystem_dirty('natconf');
-		header("Location: firewall_nat_1to1.php");
-		exit;
-	}
-
-} else if ($_GET['act'] == "toggle") {
-	if ($a_1to1[$_GET['id']]) {
-		if(isset($a_1to1[$_GET['id']]['disabled']))
-			unset($a_1to1[$_GET['id']]['disabled']);
-		else
-			$a_1to1[$_GET['id']]['disabled'] = true;
-		if (write_config("Firewall: NAT: Outbound, enable/disable NAT rule"))
-			mark_subsystem_dirty('natconf');
-		header("Location: firewall_nat_1to1.php");
-		exit;
-	}
-} else {
-	/* yuck - IE won't send value attributes for image buttons, while Mozilla does - so we use .x/.y to find move button clicks instead... */
-	unset($movebtn);
-	foreach ($_POST as $pn => $pd) {
-		if (preg_match("/move_(\d+)_x/", $pn, $matches)) {
-			$movebtn = $matches[1];
-			break;
-		}
-	}
-	/* move selected rules before this rule */
-	if (isset($movebtn) && is_array($_POST['rule']) && count($_POST['rule'])) {
-		$a_1to1_new = array();
-
-		/* copy all rules < $movebtn and not selected */
-		for ($i = 0; $i < $movebtn; $i++) {
-			if (!in_array($i, $_POST['rule']))
-				$a_1to1_new[] = $a_1to1[$i];
-		}
-
-		/* copy all selected rules */
-		for ($i = 0; $i < count($a_1to1); $i++) {
-			if ($i == $movebtn)
-				continue;
-			if (in_array($i, $_POST['rule']))
-				$a_1to1_new[] = $a_1to1[$i];
-		}
-
-		/* copy $movebtn rule */
-		if ($movebtn < count($a_1to1))
-			$a_1to1_new[] = $a_1to1[$movebtn];
-
-		/* copy all rules > $movebtn and not selected */
-		for ($i = $movebtn+1; $i < count($a_1to1); $i++) {
-			if (!in_array($i, $_POST['rule']))
-				$a_1to1_new[] = $a_1to1[$i];
-		}
-		if (count($a_1to1_new) > 0)
-			$a_1to1 = $a_1to1_new;
-
-		if (write_config())
-			mark_subsystem_dirty('natconf');
-		header("Location: firewall_nat_1to1.php");
-		exit;
-	}
-}
-
 $pgtitle = array(gettext("Firewall"),gettext("NAT"),gettext("1:1"));
 include("head.inc");
 
@@ -150,203 +82,110 @@ include("head.inc");
 <body link="#0000CC" vlink="#0000CC" alink="#0000CC">
 <?php include("fbegin.inc"); ?>
 <form action="firewall_nat_1to1.php" method="post">
-<script type="text/javascript" language="javascript" src="/javascript/row_toggle.js"></script>
-<?php
-if ($savemsg)
-	print_info_box($savemsg);
-if (is_subsystem_dirty('natconf'))
-	print_info_box_np(gettext("The NAT configuration has been changed.") .
-		"<br/>" .
-		gettext("You must apply the changes in order for them to take effect."));
-?>
-<br/>
-<table width="100%" border="0" cellpadding="0" cellspacing="0" summary="firewall nat 1to1">
-	<tr><td>
-<?php
-		$tab_array = array();
-		$tab_array[] = array(gettext("Port Forward"), false, "firewall_nat.php");
-		$tab_array[] = array(gettext("1:1"), true, "firewall_nat_1to1.php");
-		$tab_array[] = array(gettext("Outbound"), false, "firewall_nat_out.php");
-		$tab_array[] = array(gettext("NPt"), false, "firewall_nat_npt.php");
-		display_top_tabs($tab_array);
-?>
-	</td></tr>
-	<tr><td>
-		<div id="mainarea">
-		<table class="tabcont" width="100%" border="0" cellpadding="0" cellspacing="0" summary="main area">
-			<tr id="frheader">
-				<td width="3%" class="list">&nbsp;</td>
-				<td width="3%" class="list">&nbsp;</td>
-				<td width="10%" class="listhdrr"><?=gettext("Interface"); ?></td>
-				<td width="15%" class="listhdrr"><?=gettext("External IP"); ?></td>
-				<td width="15%" class="listhdrr"><?=gettext("Internal IP"); ?></td>
-				<td width="15%" class="listhdrr"><?=gettext("Destination IP"); ?></td>
-				<td width="29%" class="listhdr"><?=gettext("Description"); ?></td>
-				<td width="10%" class="list">
-					<table border="0" cellspacing="0" cellpadding="1" summary="edit">
-						<tr>
-							<td width="17"></td>
-							<td valign="middle">
-								<a href="firewall_nat_1to1_edit.php">
-									<img src="/themes/<?= $g['theme']; ?>/images/icons/icon_plus.gif" width="17" height="17" border="0" title="<?=gettext("add rule"); ?>" alt="add" />
-								</a>
-							</td>
-						</tr>
-					</table>
-				</td>
-			</tr>
-<?php
-		$textse = "</span>";
-		$i = 0;
-		foreach ($a_1to1 as $natent):
-			if (isset($natent['disabled'])) {
+<?php if ($savemsg) print_info_box($savemsg); ?>
+<?php if (is_subsystem_dirty('natconf')): ?>
+<?php print_info_box_np(gettext("The NAT configuration has been changed") . ".<br/>" . gettext("You must apply the changes in order for them to take effect."));?><br/>
+<?php endif; ?>
+<table width="100%" border="0" cellpadding="0" cellspacing="0" summary="fireall nat 1to1">  <tr><td>
+<?php
+	$tab_array = array();
+	$tab_array[] = array(gettext("Port Forward"), false, "firewall_nat.php");
+	$tab_array[] = array(gettext("1:1"), true, "firewall_nat_1to1.php");
+	$tab_array[] = array(gettext("Outbound"), false, "firewall_nat_out.php");
+	$tab_array[] = array(gettext("NPt"), false, "firewall_nat_npt.php");
+	display_top_tabs($tab_array);
+?>
+  </td></tr>
+  <tr>
+    <td>
+	<div id="mainarea">
+              <table class="tabcont" width="100%" border="0" cellpadding="0" cellspacing="0" summary="main area">
+                <tr>
+		  <td width="10%" class="listhdrr"><?=gettext("Interface"); ?></td>
+                  <td width="20%" class="listhdrr"><?=gettext("External IP"); ?></td>
+                  <td width="15%" class="listhdrr"><?=gettext("Internal IP"); ?></td>
+                  <td width="15%" class="listhdrr"><?=gettext("Destination IP"); ?></td>
+                  <td width="30%" class="listhdr"><?=gettext("Description"); ?></td>
+                  <td width="10%" class="list">
+                    <table border="0" cellspacing="0" cellpadding="1" summary="edit">
+                      <tr>
+			<td width="17"></td>
+                        <td valign="middle"><a href="firewall_nat_1to1_edit.php"><img src="/themes/<?= $g['theme']; ?>/images/icons/icon_plus.gif" width="17" height="17" border="0" title="<?=gettext("add rule"); ?>" alt="add" /></a></td>
+                      </tr>
+                    </table>
+		  </td>
+				</tr>
+	  <?php 
+			$textse = "</span>";
+
+			$i = 0; foreach ($a_1to1 as $natent):
+
+			if (isset($natent['disabled']))
 				$textss = "<span class=\"gray\">";
-				$iconfn = "pass_d";
-			} else {
-				$textss = "<span>";
-				$iconfn = "pass";
-			}
-?>
-			<tr valign="top" id="fr<?=$i;?>">
-				<td class="listt">
-					<input type="checkbox" id="frc<?=$i;?>" name="rule[]" value="<?=$i;?>" onclick="fr_bgcolor('<?=$i;?>')" style="margin: 0; padding: 0; width: 15px; height: 15px;" />
-				</td>
-				<td class="listt" align="center">
-					<a href="?act=toggle&amp;id=<?=$i;?>">
-						<img src="./themes/<?= $g['theme']; ?>/images/icons/icon_<?=$iconfn;?>.gif" width="11" height="11" border="0"
-							title="<?=gettext("click to toggle enabled/disabled status");?>" alt="icon" />
-					</a>
-				</td>
-				<td class="listlr" onclick="fr_toggle(<?=$i;?>)" id="frd<?=$i;?>" ondblclick="document.location='firewall_nat_1to1_edit.php?id=<?=$i;?>';">
-<?php
-					echo $textss;
+			else
+				$textss = "<span>"; ?>
+                <tr>
+		  <td class="listlr" ondblclick="document.location='firewall_nat_1to1_edit.php?id=<?=$i;?>';">
+                  <?php
+			echo $textss;
 					if (!$natent['interface'])
 						echo htmlspecialchars(convert_friendly_interface_to_friendly_descr("wan"));
 					else
 						echo htmlspecialchars(convert_friendly_interface_to_friendly_descr($natent['interface']));
-					echo $textse;
-?>
-				</td>
-				<td class="listr" onclick="fr_toggle(<?=$i;?>)" id="frd<?=$i;?>" ondblclick="document.location='firewall_nat_1to1_edit.php?id=<?=$i;?>';">
-<?php
-					$source_net = pprint_address($natent['source']);
-					$source_cidr = strstr($source_net, '/');
-					echo $textss . $natent['external'] . $source_cidr . $textse;
-?>
-				</td>
-				<td class="listr" onclick="fr_toggle(<?=$i;?>)" id="frd<?=$i;?>" ondblclick="document.location='firewall_nat_1to1_edit.php?id=<?=$i;?>';">
-<?php
-					echo $textss . $source_net . $textse;
-?>
-				</td>
-				<td class="listr" onclick="fr_toggle(<?=$i;?>)" id="frd<?=$i;?>" ondblclick="document.location='firewall_nat_1to1_edit.php?id=<?=$i;?>';">
-<?php
-					echo $textss . pprint_address($natent['destination']) . $textse;
-?>
-				</td>
-				<td class="listbg" onclick="fr_toggle(<?=$i;?>)" ondblclick="document.location='firewall_nat_1to1_edit.php?id=<?=$i;?>';">
-<?php
-					echo $textss . htmlspecialchars($natent['descr']) . '&nbsp;' . $textse;
-?>
-				</td>
-				<td class="list nowrap" valign="middle">
-					<table border="0" cellspacing="0" cellpadding="1" summary="move">
-						<tr>
-							<td>
-								<input onmouseover="fr_insline(<?=$i;?>, true)" onmouseout="fr_insline(<?=$i;?>, false)" name="move_<?=$i;?>"
-									src="/themes/<?= $g['theme']; ?>/images/icons/icon_left.gif"
-									title="<?=gettext("move selected rules before this rule");?>"
-									type="image" style="height:17;width:17;border:0" />
-							</td>
-							<td>
-								<a href="firewall_nat_1to1_edit.php?id=<?=$i;?>">
-									<img src="/themes/<?= $g['theme']; ?>/images/icons/icon_e.gif" width="17" height="17" border="0" title="<?=gettext("edit rule");?>" alt="edit" />
-								</a>
-							</td>
-						</tr>
-						<tr>
-							<td align="center" valign="middle">
-								<a href="firewall_nat_1to1.php?act=del&amp;id=<?=$i;?>" onclick="return confirm('<?=gettext("Do you really want to delete this rule?");?>')">
-									<img src="./themes/<?= $g['theme']; ?>/images/icons/icon_x.gif" width="17" height="17" border="0" title="<?=gettext("delete rule");?>" alt="delete" />
-								</a>
-							</td>
-							<td>
-								<a href="firewall_nat_1to1_edit.php?dup=<?=$i;?>">
-									<img src="/themes/<?= $g['theme']; ?>/images/icons/icon_plus.gif" title="<?=gettext("add a new rule based on this one");?>" width="17" height="17" border="0" alt="duplicate" />
-								</a>
-							</td>
-						</tr>
-					</table>
-				</td>
-			</tr>
-<?php
-			$i++;
-		endforeach;
-?>
-			<tr>
-				<td class="list" colspan="7"></td>
-				<td class="list nowrap" valign="middle">
-					<table border="0" cellspacing="0" cellpadding="1" summary="edit">
-						<tr>
-							<td>
-<?php
-							if ($i == 0):
-?>
-								<img src="/themes/<?= $g['theme']; ?>/images/icons/icon_left_d.gif" width="17" height="17"
-									title="<?=gettext("move selected mappings to end");?>" border="0" alt="move" />
-<?php
-							else:
-?>
-								<input name="move_<?=$i;?>" type="image" src="/themes/<?= $g['theme']; ?>/images/icons/icon_left.gif"
-									style="width:17;height:17;border:0" title="<?=gettext("move selected mappings to end");?>" />
-<?php
-							endif;
-?>
-							</td>
-							<td>
-								<a href="firewall_nat_1to1_edit.php">
-									<img src="/themes/<?= $g['theme']; ?>/images/icons/icon_plus.gif" width="17" height="17" border="0"
-									title="<?=gettext("add new mapping");?>" alt="add" />
-								</a>
-							</td>
-						</tr>
-						<tr>
-							<td>
-<?php
-							if ($i == 0):
-?>
-								<img src="/themes/<?= $g['theme']; ?>/images/icons/icon_x_d.gif" width="17" height="17"
-									title="<?=gettext("delete selected rules");?>" border="0" alt="delete" />
-<?php
-							else:
-?>
-								<input name="del" type="image" src="/themes/<?= $g['theme']; ?>/images/icons/icon_x.gif"
-									style="width:17;height:17" title="<?=gettext("delete selected mappings");?>"
-									onclick="return confirm('<?=gettext("Do you really want to delete the selected mappings?");?>')" />
-<?php
-							endif;
-?>
-							</td>
-						</tr>
-					</table>
-				</td>
-			</tr>
-			<tr>
-				<td colspan="7">
-					<p><span class="vexpl">
-						<span class="red"><strong><?=gettext("Note:"); ?><br/></strong></span>
-						<?=gettext("Depending on the way your WAN connection is setup, you may also need a"); ?>
-						<a href="firewall_virtual_ip.php"><?=gettext("Virtual IP."); ?></a><br/>
-						<?=gettext("If you add a 1:1 NAT entry for any of the interface IPs on this system, " .
-							"it will make this system inaccessible on that IP address. i.e. if " .
-							"you use your WAN IP address, any services on this system (IPsec, OpenVPN server, etc.) " .
-							"using the WAN IP address will no longer function."); ?>
-					</span></p>
-				</td>
-			</tr>
-		</table>
-		</div>
-	</td></tr>
+			echo $textse;
+				  ?>
+                  </td>
+                  <td class="listr" ondblclick="document.location='firewall_nat_1to1_edit.php?id=<?=$i;?>';">
+                    <?php 
+			$source_net = pprint_address($natent['source']);
+			$source_cidr = strstr($source_net, '/');
+			echo $textss . $natent['external'] . $source_cidr . $textse;
+                    ?>
+                  </td>
+                  <td class="listr" ondblclick="document.location='firewall_nat_1to1_edit.php?id=<?=$i;?>';">
+                    <?php 		echo $textss . $source_net . $textse; ?>
+                  </td>
+                  <td class="listr" ondblclick="document.location='firewall_nat_1to1_edit.php?id=<?=$i;?>';">
+                    <?php 		echo $textss . pprint_address($natent['destination']) . $textse; ?>
+                  </td>
+                  <td class="listbg" ondblclick="document.location='firewall_nat_1to1_edit.php?id=<?=$i;?>';">
+			<?=$textss;?>
+                    <?=htmlspecialchars($natent['descr']);?>&nbsp;
+			<?=$textse;?>
+                  </td>
+                  <td class="list nowrap">
+                    <table border="0" cellspacing="0" cellpadding="1" summary="edit">
+                      <tr>
+                        <td valign="middle"><a href="firewall_nat_1to1_edit.php?id=<?=$i;?>"><img src="/themes/<?= $g['theme']; ?>/images/icons/icon_e.gif" width="17" height="17" border="0" title="<?=gettext("edit rule"); ?>" alt="edit" /></a></td>
+			<td valign="middle"><a href="firewall_nat_1to1.php?act=del&amp;id=<?=$i;?>" onclick="return confirm('<?=gettext("Do you really want to delete this mapping?");?>')"><img src="/themes/<?= $g['theme']; ?>/images/icons/icon_x.gif" width="17" height="17" border="0" title="<?=gettext("delete rule"); ?>" alt="delete" /></a></td>
+                      </tr>
+                    </table>
+                  </td>
+                </tr>
+		<?php $i++; endforeach; ?>
+                <tr>
+                  <td class="list" colspan="5"></td>
+                  <td class="list">
+                    <table border="0" cellspacing="0" cellpadding="1" summary="add">
+                      <tr>
+			<td width="17"></td>
+                        <td valign="middle"><a href="firewall_nat_1to1_edit.php"><img src="/themes/<?= $g['theme']; ?>/images/icons/icon_plus.gif" width="17" height="17" border="0" title="<?=gettext("add rule"); ?>" alt="add" /></a></td>
+                      </tr>
+                    </table>
+                  </td>
+                </tr>
+		<tr>
+		  <td colspan="5">
+		        <p><span class="vexpl"><span class="red"><strong><?=gettext("Note:"); ?><br/>
+                      </strong></span><?=gettext("Depending on the way your WAN connection is setup, you may also need a"); ?> <a href="firewall_virtual_ip.php"><?=gettext("Virtual IP."); ?></a><br/>
+			<?=gettext("If you add a 1:1 NAT entry for any of the interface IPs on this system, it will make this system inaccessible on that IP address. i.e. if " .
+			"you use your WAN IP address, any services on this system (IPsec, OpenVPN server, etc.) using the WAN IP address will no longer function."); ?></span></p>
+		  </td>
+		</tr>
+              </table>
+	    </div>
+	</td>
+</tr>
 </table>
 </form>
 <?php include("fend.inc"); ?>
diff --git a/usr/local/www/firewall_nat_npt.php b/usr/local/www/firewall_nat_npt.php
index f85d321..4c99b6d 100644
--- a/usr/local/www/firewall_nat_npt.php
+++ b/usr/local/www/firewall_nat_npt.php
@@ -86,7 +86,7 @@ include("head.inc");
 <?php if (is_subsystem_dirty('natconf')): ?>
 <?php print_info_box_np(gettext("The NAT configuration has been changed") . ".<br/>" . gettext("You must apply the changes in order for them to take effect."));?><br/>
 <?php endif; ?>
-<table width="100%" border="0" cellpadding="0" cellspacing="0" summary="firewall nat npt">  <tr><td>
+<table width="100%" border="0" cellpadding="0" cellspacing="0" summary="firwall nat npt">  <tr><td>
 <?php
 	$tab_array = array();
 	$tab_array[] = array(gettext("Port Forward"), false, "firewall_nat.php");
diff --git a/usr/local/www/firewall_nat_npt_edit.php b/usr/local/www/firewall_nat_npt_edit.php
index ace491d..f0ffbab 100644
--- a/usr/local/www/firewall_nat_npt_edit.php
+++ b/usr/local/www/firewall_nat_npt_edit.php
@@ -107,7 +107,7 @@ if ($_POST) {
         $reqdfields[] = "dst";
         $reqdfieldsn[] = gettext("Destination prefix");
 	
-	do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+	do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 
 	if (!$input_errors) {
 		$natent = array();
diff --git a/usr/local/www/firewall_nat_out.php b/usr/local/www/firewall_nat_out.php
index 7ed846a..5d40aa5 100755
--- a/usr/local/www/firewall_nat_out.php
+++ b/usr/local/www/firewall_nat_out.php
@@ -1,34 +1,34 @@
 <?php
 /* $Id$ */
 /*
-	firewall_nat_out.php
-	Copyright (C) 2004 Scott Ullrich
-	All rights reserved.
-
-	originally part of m0n0wall (http://m0n0.ch/wall)
-	Copyright (C) 2003-2004 Manuel Kasper <mk@neon1.net>.
-	All rights reserved.
-
-	Redistribution and use in source and binary forms, with or without
-	modification, are permitted provided that the following conditions are met:
-
-	1. Redistributions of source code must retain the above copyright notice,
-	   this list of conditions and the following disclaimer.
-
-	2. Redistributions in binary form must reproduce the above copyright
-	   notice, this list of conditions and the following disclaimer in the
-	   documentation and/or other materials provided with the distribution.
-
-	THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES,
-	INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY
-	AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
-	AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY,
-	OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
-	SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
-	INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
-	CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
-	ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
-	POSSIBILITY OF SUCH DAMAGE.
+    firewall_nat_out.php
+    Copyright (C) 2004 Scott Ullrich
+    All rights reserved.
+
+    originally part of m0n0wall (http://m0n0.ch/wall)
+    Copyright (C) 2003-2004 Manuel Kasper <mk@neon1.net>.
+    All rights reserved.
+
+    Redistribution and use in source and binary forms, with or without
+    modification, are permitted provided that the following conditions are met:
+
+    1. Redistributions of source code must retain the above copyright notice,
+       this list of conditions and the following disclaimer.
+
+    2. Redistributions in binary form must reproduce the above copyright
+       notice, this list of conditions and the following disclaimer in the
+       documentation and/or other materials provided with the distribution.
+
+    THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES,
+    INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY
+    AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
+    AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY,
+    OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
+    SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
+    INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
+    CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
+    ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
+    POSSIBILITY OF SUCH DAMAGE.
 */
 /*
 	pfSense_MODULE:	nat
@@ -46,20 +46,13 @@ require_once("functions.inc");
 require_once("filter.inc");
 require_once("shaper.inc");
 
-global $FilterIflist;
+if (!is_array($config['nat']['advancedoutbound']))
+	$config['nat']['advancedoutbound'] = array();
 
-if (!is_array($config['nat']['outbound']))
-	$config['nat']['outbound'] = array();
+if (!is_array($config['nat']['advancedoutbound']['rule']))
+	$config['nat']['advancedoutbound']['rule'] = array();
 
-if (!is_array($config['nat']['outbound']['rule']))
-	$config['nat']['outbound']['rule'] = array();
-
-$a_out = &$config['nat']['outbound']['rule'];
-
-if (!isset($config['nat']['outbound']['mode']))
-	$config['nat']['outbound']['mode'] = "automatic";
-
-$mode = $config['nat']['outbound']['mode'];
+$a_out = &$config['nat']['advancedoutbound']['rule'];
 
 if ($_POST['apply']) {
 	write_config();
@@ -75,56 +68,163 @@ if ($_POST['apply']) {
 	if ($retval == 0) {
 		clear_subsystem_dirty('natconf');
 		clear_subsystem_dirty('filter');
-	}
+        }
 }
 
+
+
 if (isset($_POST['save']) && $_POST['save'] == "Save") {
 	/* mutually exclusive settings - if user wants advanced NAT, we don't generate automatic rules */
-	if ($_POST['mode'] == "advanced" && ($mode == "automatic" || $mode == "hybrid")) {
-		/*
-		 *    user has enabled advanced outbound NAT and doesn't have rules
-		 *    lets automatically create entries
-		 *    for all of the interfaces to make life easier on the pip-o-chap
-		 */
-		if(empty($FilterIflist))
-			filter_generate_optcfg_array();
-		$tonathosts = filter_nat_rules_automatic_tonathosts(true);
-		$automatic_rules = filter_nat_rules_outbound_automatic("");
-
-		foreach ($tonathosts as $tonathost) {
-			foreach ($automatic_rules as $natent) {
-				$natent['source']['network'] = $tonathost['subnet'];
-				$natent['descr'] .= sprintf(gettext(' - %1$s to %2$s'),
-					$tonathost['descr'],
-					convert_real_interface_to_friendly_descr($natent['interface']));
-				$natent['created'] = make_config_revision_entry(null, gettext("Manual Outbound NAT Switch"));
+	switch ($_POST['advancedoripsec']) {
+	case "ipsecpassthru":
+               	$config['nat']['ipsecpassthru']['enable'] = true;
+               	unset($config['nat']['advancedoutbound']['enable']);
+		break;
+	case "advancedoutboundnat":
+        	if (!isset($config['nat']['advancedoutbound']['enable'])) {
+			$config['nat']['advancedoutbound']['enable'] = true;
+			// if there are already AON rules configured, don't generate default ones
+			if(!empty($a_out))
+				continue;
+			/*
+			 *    user has enabled advanced outbound NAT and doesn't have rules
+			 *    lets automatically create entries
+			 *    for all of the interfaces to make life easier on the pip-o-chap
+			 */
+			$ifdescrs = get_configured_interface_with_descr();
+				
+			foreach($ifdescrs as $if => $ifdesc) {
+				if (!interface_has_gateway($if))
+					continue;
+				foreach ($ifdescrs as $if2 => $ifdesc2) {
+					if (interface_has_gateway($if2))
+						continue;
+
+					$osipaddr = get_interface_ip($if2);
+					$ossubnet = get_interface_subnet($if2);
+					if (!is_ipaddr($osipaddr) || empty($ossubnet))
+						continue;
+					$osn = gen_subnet($osipaddr, $ossubnet);
+
+					$natent = array();
+					$natent['source']['network'] = "{$osn}/{$ossubnet}";
+					$natent['dstport'] = "500";
+					$natent['descr'] = sprintf(gettext('Auto created rule for ISAKMP - %1$s to %2$s'),$ifdesc2,$ifdesc);
+					$natent['target'] = "";
+					$natent['interface'] = $if;
+					$natent['destination']['any'] = true;
+					$natent['staticnatport'] = true;
+					$natent['created'] = make_config_revision_entry(null, gettext("Manual Outbound NAT Switch"));
+					$a_out[] = $natent;
 
-				/* Try to detect already auto created rules and avoid duplicate them */
-				$found = false;
-				foreach ($a_out as $rule) {
-					if ($rule['interface'] == $natent['interface'] &&
-					    $rule['source']['network'] == $natent['source']['network'] &&
-					    $rule['dstport'] == $natent['dstport'] &&
-					    $rule['target'] == $natent['target'] &&
-					    $rule['descr'] == $natent['descr']) {
-						$found = true;
-						break;
+					$natent = array();
+					$natent['source']['network'] = "{$osn}/{$ossubnet}";
+					$natent['sourceport'] = "";
+					$natent['descr'] = sprintf(gettext('Auto created rule for %1$s to %2$s'),$ifdesc2,$ifdesc);
+					$natent['target'] = "";
+					$natent['interface'] = $if;
+					$natent['destination']['any'] = true;
+					$natent['natport'] = "";
+					$natent['created'] = make_config_revision_entry(null, gettext("Manual Outbound NAT Switch"));
+					$a_out[] = $natent;
+				}
+				/* Localhost */
+				$natent = array();
+				$natent['source']['network'] = "127.0.0.0/8";
+				$natent['dstport'] = "";
+				$natent['descr'] = sprintf(gettext('Auto created rule for localhost to %1$s'),$ifdesc);
+				$natent['target'] = "";
+				$natent['interface'] = $if;
+				$natent['destination']['any'] = true;
+				$natent['staticnatport'] = false;
+				$natent['natport'] = "1024:65535";
+				$natent['created'] = make_config_revision_entry(null, gettext("Manual Outbound NAT Switch"));
+				$a_out[] = $natent;
+				/* PPTP subnet */
+				if (($config['pptpd']['mode'] == "server") && is_private_ip($config['pptpd']['remoteip'])) {
+					$pptp_size = empty($config['pptpd']['n_pptp_units']) ? 16 : $config['pptpd']['n_pptp_units'];
+					$pptptopip = $pptp_size - 1;
+					$pptp_subnets = ip_range_to_subnet_array($config['pptpd']['remoteip'], long2ip32(ip2long($config['pptpd']['remoteip'])+$pptptopip));
+					foreach ($pptp_subnets as $pptpsn) {
+						$natent = array();
+						$natent['source']['network'] = $pptpsn;
+						$natent['sourceport'] = "";
+						$natent['descr'] = gettext("Auto created rule for PPTP server");
+						$natent['target'] = "";
+						$natent['interface'] = $if;
+						$natent['destination']['any'] = true;
+						$natent['natport'] = "";
+						$natent['created'] = make_config_revision_entry(null, gettext("Manual Outbound NAT Switch"));
+						$a_out[] = $natent;
+					}
+				}
+				/* PPPoE subnet */
+				if (is_pppoe_server_enabled() && have_ruleint_access("pppoe")) {
+					foreach ($config['pppoes']['pppoe'] as $pppoes) {
+						if (($pppoes['mode'] == "server") && is_ipaddr($pppoes['localip'])) {
+							if($pppoes['pppoe_subnet'] <> "")
+								$ossubnet = $pppoes['pppoe_subnet'];
+							else
+								$ossubnet = "32";
+							$osn = gen_subnet($pppoes['localip'], $ossubnet);
+							$natent = array();
+							$natent['source']['network'] = "{$osn}/{$ossubnet}";
+							$natent['sourceport'] = "";
+							$natent['descr'] = gettext("Auto created rule for PPPoE server");
+							$natent['target'] = "";
+							$natent['interface'] = $if;
+							$natent['destination']['any'] = true;
+							$natent['natport'] = "";
+							$natent['created'] = make_config_revision_entry(null, gettext("Manual Outbound NAT Switch"));
+							$a_out[] = $natent;
+						}
+					}
+				}
+				/* L2TP subnet */
+				if($config['l2tp']['mode'] == "server") {
+					if (is_ipaddr($config['l2tp']['localip'])) {
+						if($config['l2tp']['l2tp_subnet'] <> "")
+							$ossubnet = $config['l2tp']['l2tp_subnet'];
+						else
+							$ossubnet = "32";
+						$osn = gen_subnet($config['l2tp']['localip'], $ossubnet);
+						$natent = array();
+						$natent['source']['network'] = "{$osn}/{$ossubnet}";
+						$natent['sourceport'] = "";
+						$natent['descr'] = gettext("Auto created rule for L2TP server");
+						$natent['target'] = "";
+						$natent['interface'] = $if;
+						$natent['destination']['any'] = true;
+						$natent['natport'] = "";
+						$natent['created'] = make_config_revision_entry(null, gettext("Manual Outbound NAT Switch"));
+						$a_out[] = $natent;
+					}
+				}
+				/* add openvpn interfaces */
+				if($config['openvpn']['openvpn-server']) {
+					foreach ($config['openvpn']['openvpn-server'] as $ovpnsrv) {
+						$natent = array();
+						$natent['source']['network'] = $ovpnsrv['tunnel_network'];
+						$natent['sourceport'] = "";
+						$natent['descr'] = gettext("Auto created rule for OpenVPN server");
+						$natent['target'] = "";
+						$natent['interface'] = $if;
+						$natent['destination']['any'] = true;
+						$natent['natport'] = "";
+						$natent['created'] = make_config_revision_entry(null, gettext("Manual Outbound NAT Switch"));
+						$a_out[] = $natent;
 					}
 				}
-
-				if ($found === false)
-					$a_out[] = $natent;
 			}
+
+			$savemsg = gettext("Default rules for each interface have been created.");
 		}
-		$savemsg = gettext("Default rules for each interface have been created.");
+		break;
 	}
-
-	$config['nat']['outbound']['mode'] = $_POST['mode'];
-
 	if (write_config())
 		mark_subsystem_dirty('natconf');
-	header("Location: firewall_nat_out.php");
-	exit;
+        header("Location: firewall_nat_out.php");
+        exit;
 }
 
 if ($_GET['act'] == "del") {
@@ -138,74 +238,66 @@ if ($_GET['act'] == "del") {
 }
 
 if (isset($_POST['del_x'])) {
-	/* delete selected rules */
-	if (is_array($_POST['rule']) && count($_POST['rule'])) {
-		foreach ($_POST['rule'] as $rulei) {
-			unset($a_out[$rulei]);
-		}
+        /* delete selected rules */
+        if (is_array($_POST['rule']) && count($_POST['rule'])) {
+                foreach ($_POST['rule'] as $rulei) {
+                        unset($a_out[$rulei]);
+                }
 		if (write_config())
 			mark_subsystem_dirty('natconf');
-		header("Location: firewall_nat_out.php");
-		exit;
-	}
+                header("Location: firewall_nat_out.php");
+                exit;
+        }
 
-} else if ($_GET['act'] == "toggle") {
-	if ($a_out[$_GET['id']]) {
-		if(isset($a_out[$_GET['id']]['disabled']))
-			unset($a_out[$_GET['id']]['disabled']);
-		else
-			$a_out[$_GET['id']]['disabled'] = true;
-		if (write_config("Firewall: NAT: Outbound, enable/disable NAT rule"))
-			mark_subsystem_dirty('natconf');
-		header("Location: firewall_nat_out.php");
-		exit;
-	}
 } else {
-	/* yuck - IE won't send value attributes for image buttons, while Mozilla does - so we use .x/.y to find move button clicks instead... */
-	unset($movebtn);
-	foreach ($_POST as $pn => $pd) {
-		if (preg_match("/move_(\d+)_x/", $pn, $matches)) {
-			$movebtn = $matches[1];
-			break;
-		}
-	}
-	/* move selected rules before this rule */
-	if (isset($movebtn) && is_array($_POST['rule']) && count($_POST['rule'])) {
-		$a_out_new = array();
-
-		/* copy all rules < $movebtn and not selected */
-		for ($i = 0; $i < $movebtn; $i++) {
-			if (!in_array($i, $_POST['rule']))
-				$a_out_new[] = $a_out[$i];
-		}
-
-		/* copy all selected rules */
-		for ($i = 0; $i < count($a_out); $i++) {
-			if ($i == $movebtn)
-				continue;
-			if (in_array($i, $_POST['rule']))
-				$a_out_new[] = $a_out[$i];
-		}
-
-		/* copy $movebtn rule */
-		if ($movebtn < count($a_out))
-			$a_out_new[] = $a_out[$movebtn];
-
-		/* copy all rules > $movebtn and not selected */
-		for ($i = $movebtn+1; $i < count($a_out); $i++) {
-			if (!in_array($i, $_POST['rule']))
-				$a_out_new[] = $a_out[$i];
-		}
-		if (count($a_out_new) > 0)
+        /* yuck - IE won't send value attributes for image buttons, while Mozilla does - so we use .x/.y to find move button clicks instead... */
+        unset($movebtn);
+        foreach ($_POST as $pn => $pd) {
+                if (preg_match("/move_(\d+)_x/", $pn, $matches)) {
+                        $movebtn = $matches[1];
+                        break;
+                }
+        }
+        /* move selected rules before this rule */
+        if (isset($movebtn) && is_array($_POST['rule']) && count($_POST['rule'])) {
+                $a_out_new = array();
+
+                /* copy all rules < $movebtn and not selected */
+                for ($i = 0; $i < $movebtn; $i++) {
+                        if (!in_array($i, $_POST['rule']))
+                                $a_out_new[] = $a_out[$i];
+                }
+
+                /* copy all selected rules */
+                for ($i = 0; $i < count($a_out); $i++) {
+                        if ($i == $movebtn)
+                                continue;
+                        if (in_array($i, $_POST['rule']))
+                                $a_out_new[] = $a_out[$i];
+                }
+
+                /* copy $movebtn rule */
+                if ($movebtn < count($a_out))
+                        $a_out_new[] = $a_out[$movebtn];
+
+                /* copy all rules > $movebtn and not selected */
+                for ($i = $movebtn+1; $i < count($a_out); $i++) {
+                        if (!in_array($i, $_POST['rule']))
+                                $a_out_new[] = $a_out[$i];
+                }
+                if (count($a_out_new) > 0)
 			$a_out = $a_out_new;
+		else
+			unset($config['nat']['advancedoutbound']);
 
 		if (write_config())
 			mark_subsystem_dirty('natconf');
-		header("Location: firewall_nat_out.php");
-		exit;
-	}
+                header("Location: firewall_nat_out.php");
+                exit;
+        }
 }
 
+
 $pgtitle = array(gettext("Firewall"),gettext("NAT"),gettext("Outbound"));
 include("head.inc");
 
@@ -214,440 +306,195 @@ include("head.inc");
 <?php include("fbegin.inc"); ?>
 <form action="firewall_nat_out.php" method="post" name="iform">
 <script type="text/javascript" language="javascript" src="/javascript/row_toggle.js"></script>
+<?php if ($savemsg) print_info_box($savemsg); ?>
+<?php if (is_subsystem_dirty('natconf')): ?>
+<?php print_info_box_np(gettext("The NAT configuration has been changed.")."<br/>".gettext("You must apply the changes in order for them to take effect."));?><br/>
+<?php endif; ?>
+<table width="100%" border="0" cellpadding="0" cellspacing="0" summary="firwall nat outbound">  <tr><td>
 <?php
-if ($savemsg)
-	print_info_box($savemsg);
-if (is_subsystem_dirty('natconf'))
-	print_info_box_np(gettext("The NAT configuration has been changed.")."<br/>".gettext("You must apply the changes in order for them to take effect."));
+	$tab_array = array();
+	$tab_array[] = array(gettext("Port Forward"), false, "firewall_nat.php");
+	$tab_array[] = array(gettext("1:1"), false, "firewall_nat_1to1.php");
+	$tab_array[] = array(gettext("Outbound"), true, "firewall_nat_out.php");
+	$tab_array[] = array(gettext("NPt"), false, "firewall_nat_npt.php");
+	display_top_tabs($tab_array);
 ?>
-<br/>
-<table width="100%" border="0" cellpadding="0" cellspacing="0" summary="firewall nat outbound">
-	<tr><td>
-<?php
-		$tab_array = array();
-		$tab_array[] = array(gettext("Port Forward"), false, "firewall_nat.php");
-		$tab_array[] = array(gettext("1:1"), false, "firewall_nat_1to1.php");
-		$tab_array[] = array(gettext("Outbound"), true, "firewall_nat_out.php");
-		$tab_array[] = array(gettext("NPt"), false, "firewall_nat_npt.php");
-		display_top_tabs($tab_array);
-?>
-	</td></tr>
-	<tr>
-		<td>
-			<div id="mainarea">
-			<table class="tabcont" width="100%" border="0" cellpadding="0" cellspacing="0" summary="main area">
-				<tr>
-					<td rowspan="3" align="right" valign="middle"><b><?=gettext("Mode:"); ?></b></td>
-					<td>
-						<input name="mode" type="radio" id="automatic" value="automatic" <?php if ($mode == "automatic") echo "checked=\"checked\"";?> />
-					</td>
-					<td>
-						<strong>
-							<?=gettext("Automatic outbound NAT rule generation"); ?><br/>
-							<?=gettext("(IPsec passthrough included)");?>
-						</strong>
-					</td>
-					<td>
-						<input name="mode" type="radio" id="hybrid" value="hybrid" <?php if ($mode == "hybrid") echo "checked=\"checked\"";?> />
-					</td>
-					<td>
-						<strong>
-							<?=gettext("Hybrid Outbound NAT rule generation"); ?><br/>
-							<?=gettext("(Automatic Outbound NAT + rules below)");?>
-						</strong>
-					</td>
-					<td rowspan="3" valign="middle" align="left">
-						<input name="save" type="submit" class="formbtn" value="<?=gettext("Save");?>" />
-					</td>
-				</tr>
+  </td></tr>
+  <tr>
+    <td>
+	<div id="mainarea">
+              <table class="tabcont" width="100%" border="0" cellpadding="0" cellspacing="0" summary="main area">
+				<tr><td align="right"><b><?=gettext("Mode:"); ?></b></td>
+                  <td>
+                      &nbsp;&nbsp;<input name="advancedoripsec" type="radio" id="ipsecpassthru" value="ipsecpassthru" <?php if (isset($config['nat']['ipsecpassthru']['enable'])) echo "checked=\"checked\"";?> />
+                      <strong><?=gettext("Automatic outbound NAT rule generation"); ?><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<?=gettext("(IPsec passthrough included)");?></strong>
+                  </td>
+
+                  <td>
+                      &nbsp;&nbsp;<input name="advancedoripsec" type="radio" id="advancedoutbound" value="advancedoutboundnat" <?php if (isset($config['nat']['advancedoutbound']['enable'])) echo "checked=\"checked\"";?> />
+                      <strong><?=gettext("Manual Outbound NAT rule generation") . "<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" . gettext("(AON - Advanced Outbound NAT)");?></strong></td>
+                  <td valign="middle" align="left">
+					<input name="save" type="submit" class="formbtn" value="<?=gettext("Save");?>" />
+					&nbsp;<br/>&nbsp;
+                  </td>
+                </tr>
 				<tr>
-					<td colspan="4">
+					<td colspan="5">
 						&nbsp;
 					</td>
 				</tr>
 				<tr>
-					<td>
-						<input name="mode" type="radio" id="advanced" value="advanced" <?php if ($mode == "advanced") echo "checked=\"checked\"";?> />
-					</td>
-					<td>
-						<strong>
-							<?=gettext("Manual Outbound NAT rule generation"); ?><br/>
-							<?=gettext("(AON - Advanced Outbound NAT)");?>
-						</strong>
-					</td>
-					<td>
-						<input name="mode" type="radio" id="disabled" value="disabled" <?php if ($mode == "disabled") echo "checked=\"checked\"";?> />
-					</td>
-					<td>
-						<strong>
-							<?=gettext("Disable Outbound NAT rule generation"); ?><br/>
-							<?=gettext("(No Outbound NAT rules)");?>
-						</strong>
-					</td>
-				</tr>
-				<tr>
-					<td colspan="6">
+					<td  class="vtable" colspan="5">
 						&nbsp;
 					</td>
 				</tr>
-			</table>
-			<table class="tabcont" width="100%" border="0" cellpadding="0" cellspacing="0" summary="mappings">
+              </table>
+              <table class="tabcont" width="100%" border="0" cellpadding="0" cellspacing="0" summary="mappings">
 				<tr><td colspan="5"><b>&nbsp;<?=gettext("Mappings:"); ?></b></td></tr>
 				<tr><td>&nbsp;</td></tr>
-				<tr id="frheader">
-					<td width="3%" class="list">&nbsp;</td>
-					<td width="3%" class="list">&nbsp;</td>
-					<td width="10%" class="listhdrr"><?=gettext("Interface");?></td>
-					<td width="15%" class="listhdrr"><?=gettext("Source");?></td>
-					<td width="10%" class="listhdrr"><?=gettext("Source Port");?></td>
-					<td width="15%" class="listhdrr"><?=gettext("Destination");?></td>
-					<td width="10%" class="listhdrr"><?=gettext("Destination Port");?></td>
-					<td width="15%" class="listhdrr"><?=gettext("NAT Address");?></td>
-					<td width="10%" class="listhdrr"><?=gettext("NAT Port");?></td>
-					<td width="10%" class="listhdrr"><?=gettext("Static Port");?></td>
-					<td width="25%" class="listhdr"><?=gettext("Description");?></td>
-					<td width="5%" class="list">
-						<table border="0" cellspacing="0" cellpadding="1" summary="add">
-							<tr>
-								<td width="17"></td>
-								<td>
-									<a href="firewall_nat_out_edit.php?after=-1">
-										<img src="/themes/<?= $g['theme']; ?>/images/icons/icon_plus.gif" width="17" height="17" border="0" title="<?=gettext("add new mapping");?>" alt="add" />
-									</a>
-								</td>
-							</tr>
-						</table>
-					</td>
-				</tr>
-<?php
-			$i = 0;
-			foreach ($a_out as $natent):
-				$iconfn = "pass";
-				$textss = $textse = "";
-				if ($mode == "disabled" || $mode == "automatic" || isset($natent['disabled'])) {
-					$textss = "<span class=\"gray\">";
-					$textse = "</span>";
-					$iconfn .= "_d";
-				}
-
-				//build Alias popup box
-				$alias_src_span_begin = "";
-				$alias_src_port_span_begin = "";
-				$alias_dst_span_begin = "";
-				$alias_dst_port_span_begin = "";
-
-				$alias_popup = rule_popup($natent['source']['network'],pprint_port($natent['sourceport']),$natent['destination']['address'],pprint_port($natent['dstport']));
-
-				$alias_src_span_begin = $alias_popup["src"];
-				$alias_src_port_span_begin = $alias_popup["srcport"];
-				$alias_dst_span_begin = $alias_popup["dst"];
-				$alias_dst_port_span_begin = $alias_popup["dstport"];
-
-				$alias_src_span_end = $alias_popup["src_end"];
-				$alias_src_port_span_end = $alias_popup["srcport_end"];
-				$alias_dst_span_end = $alias_popup["dst_end"];
-				$alias_dst_port_span_end = $alias_popup["dstport_end"];
-?>
-				<tr valign="top" id="fr<?=$i;?>">
-					<td class="listt">
-						<input type="checkbox" id="frc<?=$i;?>" name="rule[]" value="<?=$i;?>" onclick="fr_bgcolor('<?=$i;?>')" style="margin: 0; padding: 0; width: 15px; height: 15px;" />
-					</td>
-					<td class="listt" align="center">
-<?php
-					if ($mode == "disabled" || $mode == "automatic"):
-?>
-						<img src="./themes/<?= $g['theme']; ?>/images/icons/icon_<?=$iconfn;?>.gif" width="11" height="11" border="0"
-							title="<?=gettext("This rule is being ignored");?>" alt="icon" />
-<?php
-					else:
-?>
-						<a href="?act=toggle&amp;id=<?=$i;?>">
-							<img src="./themes/<?= $g['theme']; ?>/images/icons/icon_<?=$iconfn;?>.gif" width="11" height="11" border="0"
-								title="<?=gettext("click to toggle enabled/disabled status");?>" alt="icon" />
-						</a>
-<?php
-						endif;
-?>
-					</td>
-					<td class="listlr" onclick="fr_toggle(<?=$i;?>)" id="frd<?=$i;?>" ondblclick="document.location='firewall_nat_out_edit.php?id=<?=$i;?>';">
-						<?php echo $textss . htmlspecialchars(convert_friendly_interface_to_friendly_descr($natent['interface'])) . $textse; ?>
-						&nbsp;
-					</td>
-					<td class="listr" onclick="fr_toggle(<?=$i;?>)" id="frd<?=$i;?>" ondblclick="document.location='firewall_nat_out_edit.php?id=<?=$i;?>';">
-						<?php echo $textss . $alias_src_span_begin . $natent['source']['network'] . $alias_src_span_end . $textse;?>
-					</td>
-					<td class="listr" onclick="fr_toggle(<?=$i;?>)" id="frd<?=$i;?>" ondblclick="document.location='firewall_nat_out_edit.php?id=<?=$i;?>';">
-<?php
-						echo $textss;
-						echo ($natent['protocol']) ? $natent['protocol'] . '/' : "" ;
-						if (!$natent['sourceport'])
-							echo "*";
-						else
-							echo $alias_src_port_span_begin . $natent['sourceport'] . $alias_src_port_span_end;
-						echo $textse;
-?>
-					</td>
-					<td class="listr" onclick="fr_toggle(<?=$i;?>)" id="frd<?=$i;?>" ondblclick="document.location='firewall_nat_out_edit.php?id=<?=$i;?>';">
-<?php
-						echo $textss;
-						if (isset($natent['destination']['any']))
-							echo "*";
-						else {
-							if (isset($natent['destination']['not']))
-								echo "!&nbsp;";
-							echo $alias_dst_span_begin . $natent['destination']['address'] . $alias_dst_span_end;
-						}
-						echo $textse;
-?>
-					</td>
-					<td class="listr" onclick="fr_toggle(<?=$i;?>)" id="frd<?=$i;?>" ondblclick="document.location='firewall_nat_out_edit.php?id=<?=$i;?>';">
-<?php
-						echo $textss;
-						echo ($natent['protocol']) ? $natent['protocol'] . '/' : "" ;
-						if (!$natent['dstport'])
-							echo "*";
-						else
-							echo $alias_dst_port_span_begin . $natent['dstport'] . $alias_dst_port_span_end;
-						echo $textse;
-?>
-					</td>
-					<td class="listr" onclick="fr_toggle(<?=$i;?>)" id="frd<?=$i;?>" ondblclick="document.location='firewall_nat_out_edit.php?id=<?=$i;?>';">
-<?php
-						echo $textss;
-						if (isset($natent['nonat']))
-							echo '<I>NO NAT</I>';
-						elseif (!$natent['target'])
-							echo htmlspecialchars(convert_friendly_interface_to_friendly_descr($natent['interface'])) . " address";
-						elseif ($natent['target'] == "other-subnet")
-							echo $natent['targetip'] . '/' . $natent['targetip_subnet'];
-						else
-							echo $natent['target'];
-						echo $textse;
-?>
-					</td>
-					<td class="listr" onclick="fr_toggle(<?=$i;?>)" id="frd<?=$i;?>" ondblclick="document.location='firewall_nat_out_edit.php?id=<?=$i;?>';">
-<?php
-						echo $textss;
-						if (!$natent['natport'])
-							echo "*";
-						else
-							echo $natent['natport'];
-						echo $textse;
-?>
-					</td>
-					<td class="listr" onclick="fr_toggle(<?=$i;?>)" id="frd<?=$i;?>" ondblclick="document.location='firewall_nat_out_edit.php?id=<?=$i;?>';" align="center">
-<?php
-						echo $textss;
-						if(isset($natent['staticnatport']))
-							echo gettext("YES");
-						else
-							echo gettext("NO");
-						echo $textse;
-?>
-					</td>
-					<td class="listbg" onclick="fr_toggle(<?=$i;?>)" ondblclick="document.location='firewall_nat_out_edit.php?id=<?=$i;?>';">
-						<?=htmlspecialchars($natent['descr']);?>&nbsp;
-					</td>
-					<td class="list nowrap" valign="middle">
-						<table border="0" cellspacing="0" cellpadding="1" summary="move">
-							<tr>
-								<td><input onmouseover="fr_insline(<?=$i;?>, true)" onmouseout="fr_insline(<?=$i;?>, false)" name="move_<?=$i;?>" src="/themes/<?= $g['theme']; ?>/images/icons/icon_left.gif" title="<?=gettext("move selected rules before this rule");?>" type="image" style="height:17;width:17;border:0" /></td>
-								<td>
-									<a href="firewall_nat_out_edit.php?id=<?=$i;?>">
-										<img src="/themes/<?= $g['theme']; ?>/images/icons/icon_e.gif" width="17" height="17" border="0" title="<?=gettext("edit mapping");?>" alt="edit" />
-									</a>
-								</td>
-							</tr>
-							<tr>
-								<td align="center" valign="middle">
-									<a href="firewall_nat_out.php?act=del&amp;id=<?=$i;?>" onclick="return confirm('<?=gettext("Do you really want to delete this rule?");?>')">
-										<img src="./themes/<?= $g['theme']; ?>/images/icons/icon_x.gif" width="17" height="17" border="0" title="<?=gettext("delete rule");?>" alt="delete" />
-									</a>
-								</td>
-								<td>
-									<a href="firewall_nat_out_edit.php?dup=<?=$i;?>">
-										<img src="/themes/<?= $g['theme']; ?>/images/icons/icon_plus.gif" title="<?=gettext("add a new NAT based on this one");?>" width="17" height="17" border="0" alt="duplicate" />
-									</a>
-								</td>
-							</tr>
-						</table>
-					</td>
-				</tr>
-<?php
-				$i++;
-			endforeach;
-?>
-				<tr>
-					<td class="list" colspan="11"></td>
-					<td class="list nowrap" valign="middle">
-						<table border="0" cellspacing="0" cellpadding="1" summary="edit">
-							<tr>
-								<td>
-<?php
-								if ($i == 0):
-?>
-									<img src="/themes/<?= $g['theme']; ?>/images/icons/icon_left_d.gif" width="17" height="17" title="<?=gettext("move selected mappings to end");?>" border="0" alt="move" />
-<?php
-								else:
-?>
-									<input name="move_<?=$i;?>" type="image" src="/themes/<?= $g['theme']; ?>/images/icons/icon_left.gif" style="width:17;height:17;border:0" title="<?=gettext("move selected mappings to end");?>" />
-<?php
-								endif;
-?>
-								</td>
-								<td>
-									<a href="firewall_nat_out_edit.php">
-										<img src="/themes/<?= $g['theme']; ?>/images/icons/icon_plus.gif" width="17" height="17" border="0" title="<?=gettext("add new mapping");?>" alt="add" />
-									</a>
-								</td>
-							</tr>
-							<tr>
-								<td>
-<?php
-								if ($i == 0):
-?>
-									<img src="/themes/<?= $g['theme']; ?>/images/icons/icon_x_d.gif" width="17" height="17" title="<?=gettext("delete selected rules");?>" border="0" alt="delete" />
-<?php
-								else:
-?>
-									<input name="del" type="image" src="/themes/<?= $g['theme']; ?>/images/icons/icon_x.gif" style="width:17;height:17" title="<?=gettext("delete selected mappings");?>" onclick="return confirm('<?=gettext("Do you really want to delete the selected mappings?");?>')" />
-<?php
-								endif;
-?>
-								</td>
-							</tr>
-						</table>
-					</td>
-				</tr>
-<?php
-			if ($mode == "automatic" || $mode == "hybrid"):
-				if(empty($FilterIflist))
-					filter_generate_optcfg_array();
-				$automatic_rules = filter_nat_rules_outbound_automatic(implode(" ", filter_nat_rules_automatic_tonathosts()));
-?>
-				<tr><td colspan="5"><b>&nbsp;<?=gettext("Automatic rules:"); ?></b></td></tr>
-				<tr><td>&nbsp;</td></tr>
-				<tr id="frheader">
-					<td width="3%" class="list">&nbsp;</td>
-					<td width="3%" class="list">&nbsp;</td>
-					<td width="10%" class="listhdrr"><?=gettext("Interface");?></td>
-					<td width="15%" class="listhdrr"><?=gettext("Source");?></td>
-					<td width="10%" class="listhdrr"><?=gettext("Source Port");?></td>
-					<td width="15%" class="listhdrr"><?=gettext("Destination");?></td>
-					<td width="10%" class="listhdrr"><?=gettext("Destination Port");?></td>
-					<td width="15%" class="listhdrr"><?=gettext("NAT Address");?></td>
-					<td width="10%" class="listhdrr"><?=gettext("NAT Port");?></td>
-					<td width="10%" class="listhdrr"><?=gettext("Static Port");?></td>
-					<td width="25%" class="listhdr"><?=gettext("Description");?></td>
-					<td width="5%" class="list">&nbsp;</td>
-				</tr>
-<?php
-				foreach ($automatic_rules as $natent):
-?>
-					<tr valign="top">
-						<td class="list">&nbsp;</td>
-						<td class="listt" align="center">
-							<img src="./themes/<?= $g['theme']; ?>/images/icons/icon_pass.gif" width="11" height="11" border="0" title="<?=gettext("automatic outbound nat");?>" alt="icon" />
-						</td>
-						<td class="listlr" style="background-color: #E0E0E0">
-							<?php echo htmlspecialchars(convert_friendly_interface_to_friendly_descr($natent['interface'])); ?>
-							&nbsp;
-						</td>
-						<td class="listr" style="background-color: #E0E0E0">
-							<?=$natent['source']['network'];?>
-						</td>
-						<td class="listr" style="background-color: #E0E0E0">
-<?php
-							echo ($natent['protocol']) ? $natent['protocol'] . '/' : "" ;
-							if (!$natent['sourceport'])
-								echo "*";
-							else
-								echo $natent['sourceport'];
-?>
-						</td>
-						<td class="listr" style="background-color: #E0E0E0">
-<?php
-							if (isset($natent['destination']['any']))
-								echo "*";
-							else {
-								if (isset($natent['destination']['not']))
-									echo "!&nbsp;";
-								echo $natent['destination']['address'];
-							}
-?>
-						</td>
-						<td class="listr" style="background-color: #E0E0E0">
-<?php
-							echo ($natent['protocol']) ? $natent['protocol'] . '/' : "" ;
-							if (!$natent['dstport'])
-								echo "*";
-							else
-								echo $natent['dstport'];
-?>
-						</td>
-						<td class="listr" style="background-color: #E0E0E0">
-<?php
-							if (isset($natent['nonat']))
-								echo '<I>NO NAT</I>';
-							elseif (!$natent['target'])
-								echo htmlspecialchars(convert_friendly_interface_to_friendly_descr($natent['interface'])) . " address";
-							elseif ($natent['target'] == "other-subnet")
-								echo $natent['targetip'] . '/' . $natent['targetip_subnet'];
-							else
-								echo $natent['target'];
-?>
-						</td>
-						<td class="listr" style="background-color: #E0E0E0">
-<?php
-							if (!$natent['natport'])
-								echo "*";
-							else
-								echo $natent['natport'];
-?>
-						</td>
-						<td class="listr" style="background-color: #E0E0E0">
-<?php
-							if(isset($natent['staticnatport']))
-								echo gettext("YES");
-							else
-								echo gettext("NO");
-?>
-						</td>
-						<td class="listbg">
-							<?=htmlspecialchars($natent['descr']);?>&nbsp;
-						</td>
-						<td class="list">&nbsp;</td>
-					</tr>
-<?php
-				endforeach;
-			endif;
-?>
-				<tr>
-					<td colspan="12">
-						<p><span class="vexpl">
-							<span class="red"><strong><?=gettext("Note:"); ?><br/></strong></span>
-							<?=gettext("If automatic outbound NAT selected, a mapping is automatically created " .
-								"for each interface's subnet (except WAN-type connections) and the rules " .
-								"on \"Mappings\" section of this page are ignored.<br/><br/> " .
-								"If manual outbound NAT is selected, outbound NAT rules will not be " .
-								"automatically generated and only the mappings you specify on this page " .
-								"will be used. <br/><br/> " .
-								"If hybrid outbound NAT is selected, mappings you specify on this page will " .
-								"be used, followed by the automatically generated ones. <br/><br/>" .
-								"If disable outbound NAT is selected, no rules will be used. <br/><br/>" .
-								"If a target address other than a WAN-type interface's IP address is used, " .
-								"then depending on the way the WAN connection is setup, a "); ?>
-								<a href="firewall_virtual_ip.php"><?=gettext("Virtual IP"); ?></a>
-								<?= gettext(" may also be required.") ?>
-						</span></p>
-					</td>
-				</tr>
-			</table>
-			</div>
-		</td>
-	</tr>
+                <tr id="frheader">
+                  <td width="3%" class="list">&nbsp;</td>
+                  <td width="3%" class="list">&nbsp;</td>
+                  <td width="10%" class="listhdrr"><?=gettext("Interface");?></td>
+                  <td width="15%" class="listhdrr"><?=gettext("Source");?></td>
+                  <td width="10%" class="listhdrr"><?=gettext("Source Port");?></td>
+                  <td width="15%" class="listhdrr"><?=gettext("Destination");?></td>
+                  <td width="10%" class="listhdrr"><?=gettext("Destination Port");?></td>
+                  <td width="15%" class="listhdrr"><?=gettext("NAT Address");?></td>
+                  <td width="10%" class="listhdrr"><?=gettext("NAT Port");?></td>
+		  <td width="10%" class="listhdrr"><?=gettext("Static Port");?></td>
+                  <td width="25%" class="listhdr"><?=gettext("Description");?></td>
+                  <td width="5%" class="list">
+                    <table border="0" cellspacing="0" cellpadding="1" summary="add">
+                      <tr>
+			<td width="17"></td>
+                        <td><a href="firewall_nat_out_edit.php?after=-1"><img src="/themes/<?= $g['theme']; ?>/images/icons/icon_plus.gif" width="17" height="17" border="0" title="<?=gettext("add new mapping");?>" alt="add" /></a></td>
+                      </tr>
+                    </table>
+		  </td>
+                </tr>
+              <?php $nnats = $i = 0; foreach ($a_out as $natent): ?>
+                <tr valign="top" id="fr<?=$nnats;?>">
+                  <td class="listt"><input type="checkbox" id="frc<?=$nnats;?>" name="rule[]" value="<?=$i;?>" onclick="fr_bgcolor('<?=$nnats;?>')" style="margin: 0; padding: 0; width: 15px; height: 15px;" /></td>
+                  <td class="listt" align="center"></td>
+                  <td class="listlr" onclick="fr_toggle(<?=$nnats;?>)" id="frd<?=$nnats;?>" ondblclick="document.location='firewall_nat_out_edit.php?id=<?=$nnats;?>';">
+                    <?php echo htmlspecialchars(convert_friendly_interface_to_friendly_descr($natent['interface'])); ?>
+                                        &nbsp;
+                  </td>
+                  <td class="listr" onclick="fr_toggle(<?=$nnats;?>)" id="frd<?=$nnats;?>" ondblclick="document.location='firewall_nat_out_edit.php?id=<?=$nnats;?>';">
+                    <?=$natent['source']['network'];?>
+                  </td>
+                  <td class="listr" onclick="fr_toggle(<?=$nnats;?>)" id="frd<?=$nnats;?>" ondblclick="document.location='firewall_nat_out_edit.php?id=<?=$nnats;?>';">
+                    <?php
+			echo ($natent['protocol']) ? $natent['protocol'] . '/' : "" ;
+                      if (!$natent['sourceport'])
+                          echo "*";
+                      else
+                          echo $natent['sourceport'];
+                    ?>
+                  </td>
+                  <td class="listr" onclick="fr_toggle(<?=$nnats;?>)" id="frd<?=$nnats;?>" ondblclick="document.location='firewall_nat_out_edit.php?id=<?=$nnats;?>';">
+                    <?php
+                      if (isset($natent['destination']['any']))
+                          echo "*";
+                      else {
+                          if (isset($natent['destination']['not']))
+                              echo "!&nbsp;";
+                          echo $natent['destination']['address'];
+                      }
+                    ?>
+                  </td>
+                  <td class="listr" onclick="fr_toggle(<?=$nnats;?>)" id="frd<?=$nnats;?>" ondblclick="document.location='firewall_nat_out_edit.php?id=<?=$nnats;?>';">
+                    <?php
+			echo ($natent['protocol']) ? $natent['protocol'] . '/' : "" ;
+                      if (!$natent['dstport'])
+                          echo "*";
+                      else
+                          echo $natent['dstport'];
+                    ?>
+                  </td>
+                  <td class="listr" onclick="fr_toggle(<?=$nnats;?>)" id="frd<?=$nnats;?>" ondblclick="document.location='firewall_nat_out_edit.php?id=<?=$nnats;?>';">
+                    <?php
+					if (isset($natent['nonat']))
+						echo '<I>NO NAT</I>';
+					elseif (!$natent['target'])
+						echo htmlspecialchars(convert_friendly_interface_to_friendly_descr($natent['interface'])) . " address";
+					elseif ($natent['target'] == "other-subnet")
+						echo $natent['targetip'] . '/' . $natent['targetip_subnet'];
+					else
+						echo $natent['target'];
+                    ?>
+                  </td>
+                  <td class="listr" onclick="fr_toggle(<?=$nnats;?>)" id="frd<?=$nnats;?>" ondblclick="document.location='firewall_nat_out_edit.php?id=<?=$nnats;?>';">
+                    <?php
+                      if (!$natent['natport'])
+                          echo "*";
+                      else
+                          echo $natent['natport'];
+                    ?>
+                  </td>
+                  <td class="listr" onclick="fr_toggle(<?=$nnats;?>)" id="frd<?=$nnats;?>" ondblclick="document.location='firewall_nat_out_edit.php?id=<?=$nnats;?>';" align="center">
+                    <?php
+			if(isset($natent['staticnatport']))
+			    echo gettext("YES");
+			else
+			    echo gettext("NO");
+                    ?>		    
+                  </td>
+                  <td class="listbg" onclick="fr_toggle(<?=$nnats;?>)" ondblclick="document.location='firewall_nat_out_edit.php?id=<?=$nnats;?>';">
+                    <?=htmlspecialchars($natent['descr']);?>&nbsp;
+                  </td>
+                  <td class="list nowrap" valign="middle">
+                    <table border="0" cellspacing="0" cellpadding="1" summary="move">
+                      <tr>
+                        <td><input onmouseover="fr_insline(<?=$nnats;?>, true)" onmouseout="fr_insline(<?=$nnats;?>, false)" name="move_<?=$i;?>" src="/themes/<?= $g['theme']; ?>/images/icons/icon_left.gif" title="<?=gettext("move selected rules before this rule");?>" type="image" style="height:17;width:17;border:0" /></td>
+                        <td><a href="firewall_nat_out_edit.php?id=<?=$i;?>"><img src="/themes/<?= $g['theme']; ?>/images/icons/icon_e.gif" width="17" height="17" border="0" title="<?=gettext("edit mapping");?>" alt="edit" /></a></td>
+                      </tr>
+                      <tr>
+			<td align="center" valign="middle"><a href="firewall_nat_out.php?act=del&amp;id=<?=$i;?>" onclick="return confirm('<?=gettext("Do you really want to delete this rule?");?>')"><img src="./themes/<?= $g['theme']; ?>/images/icons/icon_x.gif" width="17" height="17" border="0" title="<?=gettext("delete rule");?>" alt="delete" /></a></td>
+                        <td><a href="firewall_nat_out_edit.php?dup=<?=$i;?>"><img src="/themes/<?= $g['theme']; ?>/images/icons/icon_plus.gif" title="<?=gettext("add a new NAT based on this one");?>" width="17" height="17" border="0" alt="duplicate" /></a></td>
+                      </tr>
+                    </table>
+              <?php $i++; $nnats++; endforeach; ?>
+                <tr>
+                  <td class="list" colspan="11"></td>
+                  <td class="list nowrap" valign="middle">
+                    <table border="0" cellspacing="0" cellpadding="1" summary="edit">
+                      <tr>
+                        <td><?php if ($nnats == 0): ?><img src="/themes/<?= $g['theme']; ?>/images/icons/icon_left_d.gif" width="17" height="17" title="<?=gettext("move selected mappings to end");?>" border="0" alt="move" /><?php else: ?><input name="move_<?=$i;?>" type="image" src="/themes/<?= $g['theme']; ?>/images/icons/icon_left.gif" style="width:17;height:17;border:0" title="<?=gettext("move selected mappings to end");?>" /><?php endif; ?></td>
+                        <td><a href="firewall_nat_out_edit.php"><img src="/themes/<?= $g['theme']; ?>/images/icons/icon_plus.gif" width="17" height="17" border="0" title="<?=gettext("add new mapping");?>" alt="add" /></a></td>
+                      </tr>
+                      <tr>
+                        <td><?php if ($nnats == 0): ?><img src="/themes/<?= $g['theme']; ?>/images/icons/icon_x_d.gif" width="17" height="17" title="<?=gettext("delete selected rules");?>" border="0" alt="delete" /><?php else: ?><input name="del" type="image" src="/themes/<?= $g['theme']; ?>/images/icons/icon_x.gif" style="width:17;height:17" title="<?=gettext("delete selected mappings");?>" onclick="return confirm('<?=gettext("Do you really want to delete the selected mappings?");?>')" /><?php endif; ?></td>
+                      </tr>
+                    </table></td>
+                </tr>
+                <tr>
+                  <td colspan="12">
+			<p><span class="vexpl"><span class="red"><strong><?=gettext("Note:"); ?><br/>
+			</strong></span>
+			<?=gettext("With automatic outbound NAT enabled, a mapping is automatically created " .
+			"for each interface's subnet (except WAN-type connections) and the rules " .
+			"on this page are ignored.<br/><br/> " .
+			"If manual outbound NAT is enabled, outbound NAT rules will not be " .
+			"automatically generated and only the mappings you specify on this page " .
+			"will be used. <br/><br/> " .
+			"If a target address other than a WAN-type interface's IP address is used, " .
+			"then depending on the way the WAN connection is setup, a "); ?>
+			<a href="firewall_virtual_ip.php"><?=gettext("Virtual IP"); ?></a>
+			<?= gettext(" may also be required.") ?>
+			<br/><br/>
+			<?= gettext("To completely disable outbound NAT, switch to Manual Outbound NAT then delete any " .
+			"NAT rules that appear in the list.") ?></span></p>
+                    </td>
+                </tr>
+
+              </table>
+	    </div>
+</td>
+  </tr>
 </table>
-</form>
+            </form>
 <?php include("fend.inc"); ?>
 </body>
 </html>
diff --git a/usr/local/www/firewall_rules_edit.php b/usr/local/www/firewall_rules_edit.php
index 2daf3a1..f0fdfa5 100755
--- a/usr/local/www/firewall_rules_edit.php
+++ b/usr/local/www/firewall_rules_edit.php
@@ -157,7 +157,6 @@ if (isset($id) && $a_filter[$id]) {
 	$pconfig['max-src-states'] = $a_filter[$id]['max-src-states'];
 	$pconfig['statetype'] = $a_filter[$id]['statetype'];
 	$pconfig['statetimeout'] = $a_filter[$id]['statetimeout'];
-	$pconfig['nopfsync'] = isset($a_filter[$id]['nopfsync']);
 
 	/* advanced - nosync */
 	$pconfig['nosync'] = isset($a_filter[$id]['nosync']);
@@ -183,8 +182,6 @@ if (isset($id) && $a_filter[$id]) {
 	if (!isset($_GET['dup']))
 		$pconfig['associated-rule-id'] = $a_filter[$id]['associated-rule-id'];
 
-	$pconfig['tracker'] = $a_filter[$id]['tracker'];
-
 } else {
 	/* defaults */
 	if ($_GET['if'])
@@ -345,7 +342,7 @@ if ($_POST) {
 		$reqdfieldsn[] = gettext("Destination bit count");
 	}
 
-	do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+	do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 
 	if (!$_POST['srcbeginport']) {
 		$_POST['srcbeginport'] = 0;
@@ -533,9 +530,6 @@ if ($_POST) {
 	if (!$input_errors) {
 		$filterent = array();
 		$filterent['id'] = $_POST['ruleid']>0?$_POST['ruleid']:'';
-
-		$filterent['tracker'] = empty($_POST['tracker']) ? (int)microtime(true) : $_POST['tracker'];
-
 		$filterent['type'] = $_POST['type'];
 		if (isset($_POST['interface'] ))
 			$filterent['interface'] = $_POST['interface'];
@@ -591,10 +585,6 @@ if ($_POST) {
 		$filterent['statetimeout'] = $_POST['statetimeout'];
 		$filterent['statetype'] = $_POST['statetype'];
 		$filterent['os'] = $_POST['os'];
-		if($_POST['nopfsync'] <> "")
-			$filterent['nopfsync'] = true;
-		else
-			unset($filterent['nopfsync']);
 
 		/* Nosync directive - do not xmlrpc sync this item */
 		if($_POST['nosync'] <> "")
@@ -1320,24 +1310,16 @@ $i--): ?>
 		<tr>
 			<td width="22%" valign="top" class="vncell"><?=gettext("State Type");?></td>
 			<td width="78%" class="vtable">
-				<div id="showadvstatebox" <?php if (!empty($pconfig['nopfsync']) || (!empty($pconfig['statetype']) && $pconfig['statetype'] != "keep state")) echo "style='display:none'"; ?>>
+				<div id="showadvstatebox" <?php if (!empty($pconfig['statetype']) && $pconfig['statetype'] != "keep state") echo "style='display:none'"; ?>>
 					<input type="button" onclick="show_advanced_state()" value="<?=gettext("Advanced"); ?>" /> - <?=gettext("Show advanced option");?>
 				</div>
-				<div id="showstateadv" <?php if (empty($pconfig['nopfsync']) && (empty($pconfig['statetype']) || $pconfig['statetype'] == "keep state")) echo "style='display:none'"; ?>>
-					<input name="nopfsync" type="checkbox" id="nopfsync" value="yes" <?php if ($pconfig['nopfsync']) echo "checked=\"checked\""; ?> />
-					<span class="vexpl">
-						NO pfsync<br/>
-						<?=gettext("Hint: This prevents states created by this rule to be sync'ed over pfsync.");?><br/>
-					</span><br/>
+				<div id="showstateadv" <?php if (empty($pconfig['statetype']) || $pconfig['statetype'] == "keep state") echo "style='display:none'"; ?>>
 					<select name="statetype">
 						<option value="keep state" <?php if(!isset($pconfig['statetype']) or $pconfig['statetype'] == "keep state") echo "selected=\"selected\""; ?>><?=gettext("keep state");?></option>
 						<option value="sloppy state" <?php if($pconfig['statetype'] == "sloppy state") echo "selected=\"selected\""; ?>><?=gettext("sloppy state");?></option>
 						<option value="synproxy state"<?php if($pconfig['statetype'] == "synproxy state")  echo "selected=\"selected\""; ?>><?=gettext("synproxy state");?></option>
 						<option value="none"<?php if($pconfig['statetype'] == "none") echo "selected=\"selected\""; ?>><?=gettext("none");?></option>
-					</select><br/>
-					<span class="vexpl">
-						<?=gettext("Hint: Select which type of state tracking mechanism you would like to use.  If in doubt, use keep state.");?>
-					</span>
+					</select><br/><?=gettext("Hint: Select which type of state tracking mechanism you would like to use.  If in doubt, use keep state.");?>
 					<table width="90%">
 						<tr><td width="25%"><ul><li><?=gettext("keep state");?></li></ul></td><td><?=gettext("Works with all IP protocols.");?></td></tr>
 						<tr><td width="25%"><ul><li><?=gettext("sloppy state");?></li></ul></td><td><?=gettext("Works with all IP protocols.");?></td></tr>
@@ -1670,7 +1652,6 @@ $has_updated_time = (isset($a_filter[$id]['updated']) && is_array($a_filter[$id]
 				<input name="Submit" type="submit" class="formbtn" value="<?=gettext("Save"); ?>" />  <input type="button" class="formbtn" value="<?=gettext("Cancel"); ?>" onclick="history.back()" />
 <?php			if (isset($id) && $a_filter[$id]): ?>
 					<input name="id" type="hidden" value="<?=htmlspecialchars($id);?>" />
-					<input name="tracker" type="hidden" value="<?=htmlspecialchars($pconfig['tracker']);?>">
 <?php 			endif; ?>
 				<input name="after" type="hidden" value="<?=htmlspecialchars($after);?>" />
 			</td>
@@ -1687,7 +1668,7 @@ $has_updated_time = (isset($a_filter[$id]['updated']) && is_array($a_filter[$id]
 	<?php endif; ?>
 
 	var addressarray = <?= json_encode(get_alias_list(array("host", "network", "openvpn", "urltable"))) ?>;
-	var customarray  = <?= json_encode(get_alias_list(array("port", "url_ports", "urltable_ports"))) ?>;
+	var customarray  = <?= json_encode(get_alias_list("port")) ?>;
 
 	var oTextbox1 = new AutoSuggestControl(document.getElementById("src"), new StateSuggestions(addressarray));
 	var oTextbox2 = new AutoSuggestControl(document.getElementById("srcbeginport_cust"), new StateSuggestions(customarray));
diff --git a/usr/local/www/firewall_shaper.php b/usr/local/www/firewall_shaper.php
index 53f4d64..fe181e9 100755
--- a/usr/local/www/firewall_shaper.php
+++ b/usr/local/www/firewall_shaper.php
@@ -225,11 +225,11 @@ if ($_GET) {
 			} 
 		$altq->SetAvailableBandwidth($altq->GetBandwidth() * $factor);
 		$altq->ReadConfig($_POST);
-		$altq->validate_input($_POST, $input_errors);
+		$altq->validate_input($_POST, &$input_errors);
 		if (!$input_errors) {
 			unset($tmppath);
 			$tmppath[] = $altq->GetInterface();
-			$altq->SetLink($tmppath);	
+			$altq->SetLink(&$tmppath);	
 			$altq->wconfig();
 			if (write_config())
 				mark_subsystem_dirty('shaper');
@@ -244,7 +244,7 @@ if ($_GET) {
 		if ($qtmp) {
 			$tmppath =& $qtmp->GetLink();
 			array_push($tmppath, $qname);
-			$tmp =& $qtmp->add_queue($interface, $_POST, $tmppath, $input_errors);
+			$tmp =& $qtmp->add_queue($interface, $_POST, $tmppath, &$input_errors);
 			if (!$input_errors) {
 				array_pop($tmppath);
 				$tmp->wconfig();
@@ -298,7 +298,7 @@ if ($_GET) {
 			}
 
 	} else if ($queue) {
-                $queue->validate_input($_POST, $input_errors);
+                $queue->validate_input($_POST, &$input_errors);
                 if (!$input_errors) {
                             $queue->update_altq_queue_data($_POST);
                             $queue->wconfig();
diff --git a/usr/local/www/firewall_shaper_layer7.php b/usr/local/www/firewall_shaper_layer7.php
index b1cfc7a..fe37735 100755
--- a/usr/local/www/firewall_shaper_layer7.php
+++ b/usr/local/www/firewall_shaper_layer7.php
@@ -137,7 +137,7 @@ else if ($_POST) {
 			$_POST['l7rules'][$i]['structure'] = $_POST['structure'][$i];
 			$_POST['l7rules'][$i]['behaviour'] = $_POST['behaviour'][$i];
 		}
-		$l7r->validate_input($_POST,$input_errors);
+		$l7r->validate_input($_POST,&$input_errors);
 		$l7r->ReadConfig($_POST['container'], $_POST);
 		//Before writing the results, we need to test for repeated protocols
 		$non_dupes = array();
diff --git a/usr/local/www/firewall_shaper_queues.php b/usr/local/www/firewall_shaper_queues.php
index db93524..c21d7e3 100755
--- a/usr/local/www/firewall_shaper_queues.php
+++ b/usr/local/www/firewall_shaper_queues.php
@@ -46,7 +46,7 @@ require_once("shaper.inc");
 require_once("rrd.inc");
 
 if($_GET['reset'] <> "") {
-	mwexec("killall -9 pfctl");
+	mwexec("killall -9 pfctl php");
 	exit;
 }
 
@@ -96,7 +96,7 @@ if ($_GET) {
                                 $qtmp =& $altq->find_queue("", $qname);
                                 if ($qtmp) {
                                         $copycfg = array();
-                                        $qtmp->copy_queue($interface, $copycfg);
+                                        $qtmp->copy_queue($interface, &$copycfg);
                                         $aq =& $altq_list_queues[$interface];
 					if ($qname == $qtmp->GetInterface()) {
                                                 $config['shaper']['queue'][] = $copycfg;
diff --git a/usr/local/www/firewall_shaper_vinterface.php b/usr/local/www/firewall_shaper_vinterface.php
index 73b98c6..7757505 100644
--- a/usr/local/www/firewall_shaper_vinterface.php
+++ b/usr/local/www/firewall_shaper_vinterface.php
@@ -46,7 +46,8 @@ require_once("filter.inc");
 require_once("shaper.inc");
 
 if($_GET['reset'] <> "") {
-	mwexec("/usr/bin/killall -9 pfctl");
+	/* XXX: Huh, why are we killing php? */
+	mwexec("/usr/bin/killall -9 pfctl php");
 	exit;
 }
 
@@ -98,7 +99,7 @@ if ($_GET) {
 			if (is_array($config['filter']['rule'])) {
 				foreach ($config['filter']['rule'] as $rule) {
 					if ($rule['dnpipe'] == $queue->GetQname() || $rule['pdnpipe'] == $queue->GetQname())
-						$input_errors[] = gettext("This pipe/queue is referenced in filter rules, please remove references from there before deleting.");
+						$input_errors[] = gettext("This pipe/queue is referenced in filter rules, please remove references from there before deleteing.");
 				}
 			}
 			if (!$input_errors) {
@@ -206,13 +207,13 @@ if ($_GET) {
 			$dnpipe =& new dnpipe_class();
 			
 			$dnpipe->ReadConfig($_POST);
-			$dnpipe->validate_input($_POST, $input_errors);
+			$dnpipe->validate_input($_POST, &$input_errors);
 			if (!$input_errors) {
 				$number = dnpipe_find_nextnumber();
 				$dnpipe->SetNumber($number);
 				unset($tmppath);
 				$tmppath[] = $dnpipe->GetQname();
-				$dnpipe->SetLink($tmppath);	
+				$dnpipe->SetLink(&$tmppath);	
 				$dnpipe->wconfig();
 				if (write_config())
 					mark_subsystem_dirty('shaper');
@@ -230,7 +231,7 @@ if ($_GET) {
 		else if ($dnpipe) {
 			$tmppath =& $dnpipe->GetLink();
 			array_push($tmppath, $qname);
-			$tmp =& $dnpipe->add_queue($pipe, $_POST, $tmppath, $input_errors);
+			$tmp =& $dnpipe->add_queue($pipe, $_POST, $tmppath, &$input_errors);
 			if (!$input_errors) {
 				array_pop($tmppath);
 				$tmp->wconfig();
@@ -271,7 +272,7 @@ if ($_GET) {
 			}
 
 	} else if ($queue) {
-                $queue->validate_input($_POST, $input_errors);
+                $queue->validate_input($_POST, &$input_errors);
                 if (!$input_errors) {
 			$queue->update_dn_data($_POST);
 			$queue->wconfig();
diff --git a/usr/local/www/firewall_shaper_wizards.php b/usr/local/www/firewall_shaper_wizards.php
index 57f7d02..455b932 100755
--- a/usr/local/www/firewall_shaper_wizards.php
+++ b/usr/local/www/firewall_shaper_wizards.php
@@ -45,7 +45,8 @@ require_once("filter.inc");
 require_once("shaper.inc");
 
 if($_GET['reset'] <> "") {
-	mwexec("/usr/bin/killall -9 pfctl");
+	/* XXX: Huh, why are we killing php? */
+	mwexec("/usr/bin/killall -9 pfctl php");
 	exit;
 }
 
diff --git a/usr/local/www/firewall_virtual_ip.php b/usr/local/www/firewall_virtual_ip.php
index 8e524a6..3a3cb3d 100755
--- a/usr/local/www/firewall_virtual_ip.php
+++ b/usr/local/www/firewall_virtual_ip.php
@@ -157,7 +157,14 @@ if ($_GET['act'] == "del") {
 
 			if ($found_carp === true && $found_other_alias === false)
 				$input_errors[] = gettext("This entry cannot be deleted because it is still referenced by a CARP IP with the description") . " {$vip['descr']}.";
+		} else if ($a_vip[$_GET['id']]['mode'] == "carp") {
+			$vipiface = "{$a_vip[$_GET['id']]['interface']}_vip{$a_vip[$_GET['id']]['vhid']}";
+			foreach ($a_vip as $vip) {
+				if ($vipiface == $vip['interface'] && $vip['mode'] == "ipalias")
+					$input_errors[] = gettext("This entry cannot be deleted because it is still referenced by an IP alias entry with the description") . " {$vip['descr']}.";
+			}
 		}
+
 		
 		if (!$input_errors) {
 			if (!session_id())
@@ -239,6 +246,9 @@ include("head.inc");
 		</tr>
 		<?php
 			$interfaces = get_configured_interface_with_descr(false, true);
+			$carplist = get_configured_carp_interface_list();
+			foreach ($carplist as $cif => $carpip)
+				$interfaces[$cif] = $carpip." (".get_vip_descr($carpip).")";
 			$interfaces['lo0'] = "Localhost";
 		?>
 			  <?php $i = 0; foreach ($a_vip as $vipent): ?>
diff --git a/usr/local/www/firewall_virtual_ip_edit.php b/usr/local/www/firewall_virtual_ip_edit.php
index 4fbaa65..b9993d4 100755
--- a/usr/local/www/firewall_virtual_ip_edit.php
+++ b/usr/local/www/firewall_virtual_ip_edit.php
@@ -113,7 +113,7 @@ if ($_POST) {
 	if ($_POST['subnet']) {
 		if (!is_ipaddr($_POST['subnet']))
 			$input_errors[] = gettext("A valid IP address must be specified.");
-		else if (is_ipaddr_configured($_POST['subnet'], "{$_POST['interface']}_vip{$id}"))
+		else if (is_ipaddr_configured($_POST['subnet'], "vip_" . $id))
 			$input_errors[] = gettext("This IP address is being used by another interface or VIP.");
 	}
 
@@ -123,6 +123,15 @@ if ($_POST) {
 			$input_errors[] = gettext("The interface chosen for the VIP has no IPv4 or IPv6 address configured so it cannot be used as a parent for the VIP.");
 	}
 
+	if(is_ipaddrv4($_POST['subnet'])) {
+		if(($_POST['subnet_bits'] == "31" or $_POST['subnet_bits'] == "32") and $_POST['mode'] == "carp")
+		 	$input_errors[] = gettext("The /31 and /32 subnet mask are invalid for CARP IPs.");
+	}
+	if(is_ipaddrv6($_POST['subnet'])) {
+		if(($_POST['subnet_bits'] == "127" or $_POST['subnet_bits'] == "128")  and $_POST['mode'] == "carp")
+		 	$input_errors[] = gettext("The /127 and /128 subnet mask are invalid for CARP IPs.");
+	}
+
 	/* ipalias and carp should not use network or broadcast address */
 	if ($_POST['mode'] == "ipalias" || $_POST['mode'] == "carp") {
 		if (is_ipaddrv4($_POST['subnet']) && $_POST['subnet_bits'] != "32") {
@@ -171,10 +180,31 @@ if ($_POST) {
 
 		if ($_POST['interface'] == "lo0")
 			$input_errors[] = gettext("For this type of vip localhost is not allowed.");
+		if (strstr($_POST['interface'], "_vip"))
+                        $input_errors[] = gettext("For this type of vip a carp parent is not allowed.");
+		break;
+	case "ipalias":
+		if (strstr($_POST['interface'], "_vip")) {
+			if (is_ipaddrv4($_POST['subnet'])) {
+				$parent_ip = get_interface_ip($_POST['interface']);
+				$parent_sn = get_interface_subnet($_POST['interface']);
+				$subnet = gen_subnet($parent_ip, $parent_sn);
+			} else if (is_ipaddrv6($_POST['subnet'])) {
+				$parent_ip = get_interface_ipv6($_POST['interface']);
+				$parent_sn = get_interface_subnetv6($_POST['interface']);
+				$subnet = gen_subnetv6($parent_ip, $parent_sn);
+			}
+			if (isset($parent_ip) && !ip_in_subnet($_POST['subnet'], "{$subnet}/{$parent_sn}") && !ip_in_interface_alias_subnet($_POST['interface'], $_POST['subnet'])) {
+				$cannot_find = $_POST['subnet'] . "/" . $_POST['subnet_bits'] ;
+				$input_errors[] = sprintf(gettext("Sorry, we could not locate an interface with a matching subnet for %s.  Please add an IP alias in this subnet on this interface."),$cannot_find);
+			}
+		}
 		break;
 	default:
 		if ($_POST['interface'] == "lo0")
 			$input_errors[] = gettext("For this type of vip localhost is not allowed.");
+		if (strstr($_POST['interface'], "_vip"))
+			$input_errors[] = gettext("For this type of VIP, a CARP parent is not allowed.");
 		break;
 	}
 
@@ -356,6 +386,9 @@ function typesel_change() {
 					<select name="interface" class="formselect">
 					<?php 
 					$interfaces = get_configured_interface_with_descr(false, true);
+					$carplist = get_configured_carp_interface_list();
+					foreach ($carplist as $cif => $carpip)
+						$interfaces[$cif] = $carpip." (".get_vip_descr($carpip).")";
 					$interfaces['lo0'] = "Localhost";
 					foreach ($interfaces as $iface => $ifacename): ?>
 						<option value="<?=$iface;?>" <?php if ($iface == $pconfig['interface']) echo "selected=\"selected\""; ?>>
diff --git a/usr/local/www/fred-bg.gif b/usr/local/www/fred-bg.gif
new file mode 100644
index 0000000000000000000000000000000000000000..003364ee688eac4362eb3ad04e7eeccad3b2b445
GIT binary patch
literal 47748
zcmV(wK<U3nNk%v~VVne11EB-}^Y!xf`Stqz`ThU=EC2ui0GtF=13&`)oR6u??GK}z
zwAzca-n{z{hT=$;=82~2%C_zc$MQ_q_KoNI&iDQg6bS@@pz(-IDwoWr^9hYgr_|;U
zKoleZSU|A~4vWX+viXcot3lY|m8)IP+Vr>lj?e4&{Jy`}#nm+w5cjtr$aVN45ZDNZ
z=LN7xS!sERnHlz0m<VYp*l4Ip^7g6r2$woa+UoiW8!Ox47D~v9XNooZ;U?;p3pdD1
zTx@)dyeKS8v`6=qY!N7kX3H6kovppi%~ZSG2%VM~Q22-oF^GOSh$Rl@JKfezUvEj2
zm};vqG@!ex&r?8w`3edux6WR&RbI68D|60Gp%V-h#c<>>Mx6dDRUD~Gs4%3+D7qHJ
z2@uL3$O{i8jB@y^%{fmr#l2j1YNQ`61>a2()v1e$D-1;)Sc!lYOruE)-jab&pHCnt
z5ztAg6PvGE-$G6M2aYFAoQ5L$leaZhIfM!U9?kh+RZ@QtkjCxVlGdc7Ynf8WS28O+
zuUyR8?a_6fid_sIr2yt2FC&kKWlTIvQ}CjJ)ZEsksVgT@r&AFzPSB6&R=6&oy871`
zrJKeeMM;hvdFAa5;VQSL(8xfXtNSz~p83`{4S=UP#LVZ?7Bh!?C+JJ8?oCGFn5QeZ
zE?l5r8`NhiHa>W)cE=X*VO3c@!s_O8UF=5f?{fX#fBt4RJDU(=QK5#^ed8TvT|zL?
z*HnCb(Q;pFY}IvuL7eD^o(UDj2bm7Pn8KSnUkE5)d*bcoSp(~|WXKmAnRE^aF#_O7
z4I9yDM}|Ip!&!vsI7cIc!0D$Og|w7%ULNsu$X$gG8Mq=kS(HT=g2Gj%lz~DvHh^Jq
zDc~TN{NRXzSZc`^P-x#}2n|qWmG(lA*Jyxaj4b>Y9*r7WX_5hu$$4OVU6zI8mLuFY
zkdAj&)YW$g<;W75@+H}To?lXAS2+Cm$Us957>Y_AVP5H5pmo(I!KhU>w##7~QOPH8
zYsRLkij$~`VV*Hw7bJ~+3C0tll7=@c2Za(v{->`nsnn!~y{=aRqCPDv6M%3g=;@V~
znow1P&njwSuj1ATCzNt-TLH2vR>tI{pgP%0iMd_5>3+pBdq|MEZgFpYch#BJlV!#8
zXuGGnq@r^a4WMjmGGRyDu)lOCZY_QF%ZIuQgIM9Uy~u-avK9MTVXXWBmnX$?EzIgX
z*J;Wdi{cC$0#lqB$5o-@Qp#nNwq+0x#(V{cnxRpm+~)(enry?npwMh8!&`E7EvE&R
z8l7RY9i^OZH$Iy11xst2t%<=tyR)3Sp3HT{I?H3u8Vthhr_e2L`?UtoovUvrMFgkm
zg1$B>m7Sf|324_UQRk$kOQmLBx~R4ODc3h9)ad8fmpqqdJFPzQ_uyi}%e7f7m5v+I
zJeaa1%^qxh=yz&IBUY|?Eo)M*9@p(K=SC*n+rAUXmcj0uy4Hc_0D55#nY*2fC+6|8
z<XAu#BUT-C4MknE#`qCQ;keq1|MuWLjtqG!#Gb#co``aGRqMT`n<ZE91=)h`kV=sS
zN?(cJtkg*ZEysFEh0ukjRXGQ8%rf55<n^gbjm|!Hs}j3{qZzUA4Ji-vh17lnqaj7h
zY!eI^F1|A`r6kZuX(AAPDi{|JP7g*oE7Y$-&>Y)zp&Tm+)`}MAG!oQ_K=cYn+~{?{
zZ)qescpFy>@&Y}&p@0aod6xc~l-E60vFAktQ=rt`5kLj3rF&RpfvTuj4t=FYHfiGE
zP&U?@EJzMUt^-#LK^L8^!H!>BFjxd0_5q#&NNHvCA`iyqm+jC7f%sV*=}s3eKV~s)
zM?@Lar06W8NfJoaGUQy=v@7AUfsLa8AVqwVL!+qgGq$PTod`6Vg>fou5c-|ow6;h1
zAZ${Znj!`dHNgrD!;Xt#-us+}r=+06c*L3`9F;ksT!JSuUJ~ZVeC0nZ9cn@d%hDS`
z$IVi-Oq6444l|?UD}zb%Q)(hl;lhZ3cg#j$fSRJRwBxQImWhsA@#XAn85w}_CU&!A
z83?1L6l50Yb$3}OG5&X;MjD1tfNU#h$*6g-Sx&{Fx!4Uy_4c}R&heunV_wnHhCvO^
zPf%1;A*tjct_`TMSglMO^pa>(MurG>0Xu0KH`#!KsnTEV`DJ2Waxaqd&sD$7ojXMe
zQg~kOpARjA5<gWds;;a|aWf+9fO;0FDpRMQaglovhqg{;WUaAc>ont-Dc#*rBMH?f
zT|1|>`&o|=PF>{A+J-yo1w^W7k|#_DVo^f!Y@TG5pkD=fu+Q8oT7`tgimEmWuobOO
zLR$w|Pf)<BzCtaMvD#wa;u4S9ML=menFGBxJb==s0^}qtEn^rjq)MccAm|p7K*<&V
z1Oh%DwPN6S{$~KO`m|Nb&76zsmeW%yCPE*oqa$HS*_C?8xKEPXKIgTmLe%z1u~irZ
z%b8fw(vEdh1yh*%B^08Xq`6#cp6e`{-bP};u8rNN4DYuV-U<<A|1GL9JIk#6Dv~bS
z@zF-xdpO8Cw^AsQluDU&)q{qNI}Vo6i;z&+?s>3&qkEO=lIK#?dD53sdgY2w+En$*
zxS<e!CLJRMG`rfWmtEA$)cR`A^Zs$RFRd}D^0U3`a#g7dQXlssxwAyBl4AIyO^*z>
zOVdayDB}a9RjQ1{@0rU-`F-OZA7@?|=(CKl`WOr;YTGzNC=1e?v7KRXwz2_DX)8P&
zD{8C$h4Bt5d`N7we1%}*Kb|qma29ee^pV8f4OW7k6Q2%scfiKwbX>wq6xky7S5>04
zv?t`7Kylc-7iS=q3uYRlAC0CRqKcu#Q(J+~xU?rfnSL}K*`0rlimhsK0$BX4FjwNf
zFzdIXO+gcn38msAg!s#sF?4^;Hn6J#DyM|1T-p-0Y0sq-V4KEHVgR934_sTBC|Gw=
zs+j^5{!!A)UO;n=Em<7{d*AmUuHL|kNn7F8)ykIYn`LA)>fP1>=QJ`%*?X=ude+te
z4vour^yTPU2XXM59mJe>qj_LDi->-+LgO+Kj<B=LXNi-eWt3(Jb&}sS2iI@}%*Xy1
z4x-x0Y!5E`Ji<K>EWm<>rh!x>XzM0RhN^K#IN26%_k~=EQFnEhV@hUcb5UT!3GuXN
zfDYv?^h*bNQj{yhL#(obtc*<bH;N7c-%d271+KZ>?><do6WQluA7Eu!zOD*Vx47ip
zWu~Z`GEoCy@r+;maO#)6#!H^@OPRdoFaM{>cNv@~Vcp`|__Joq*4aX?dt}R`Z#sc}
z!!S?xx*G3#yvu&}jJT5jaOm3G6K<@FPF1H;CC{Qs$?^3P{alEzaG;akTQIE=^7V>&
zb$<GDZrKjzi{SXnQw+0jaXjFQpR{z*H$M-gALGRw>)J2Je_yA)``^D4?EaEUHE9V7
z^Xz|rIriq@NP4RdFuyV#*Cdn&eT^3s-M4tm2Y}3Bc|3J_=COF@&^#=ne(>;W?3NDW
z2TcTcXz=HO9|(dv;(f1jer+Rpq9zfr$2E5Ydlm<K4cJ145FfnKaTV5rlBa<osDnGm
zgFRRe-X|cEr)AM67cFQNfukGGcRZSxI}L#lFE|>O=O>{vf;s4eSBQmKsD+lbYhM(7
z**7&}SAx8RIxd)fIl?P5$XboJg>C4DZwQBaL3Cdz6A37TsRuMS!7P(!7`AhQfn|W#
zL1jv~T&YuoV5ovUA~igbVEuG{llOTw2tV3Ed3;E8w-9@AsEL~>{v&9VP3%X9bU2Ab
zm^t1@M9C2{GRPdla){R#U>$^s@OB(T2Z}EUgOsN@&Qw(O#!fVJLQ^JLZBmD!7<mtP
zf|~at#PLppNPMkGi~x9y&li0jk^>|dKcVP}D#wZ2cn|pZjNkZ-ctn1_P%iveI{m^T
z-?u4aXoAsbiw1~*!_{$S2!Jbiim!ujPsD-Uv2oi&MU{w+r3jG5s2|Vhh2V&g38|2z
z7>|1~jY6m`ruRY8HC|$&OG%S$u$YEYcw!)gd^aLE?zoV|NQ0W!d?SgHl4z3ugNOu(
zh)vcGtpss3h;!Vy8~_P{L>L-I$8a%+XI2<*0*6y-;*4kh$c&JPA8lkv9~LtN2YzCs
zU=o)np*Ssx)JGB62}AgWd$W+cf|6Y+k`D-hxYQxncaUEhh|q*n!*rCpfRw_NfGC$o
zXBL4Nm>bymht7D2U3Y?!CV`ZAeIJLGqSz=~If5o>7?$TH0dkTnX^VR~4YCM_Tp5sJ
zQ&EIai=+rENd;c2R)OcGAOVJn6sR@0$dQNDl32-jTs9x!*fBK;Oig%$X%US_MVVjO
zPnk1(11XA_kvZLWb*&<hDLI%r*+MD9j5K*gMG1`!IDg;hO{@2Ek9CY42a1Y_ihwha
z=C}kprf*${P&s*v)fJa`$3EXVR0Y={=~9=0XIB0cGD~Y>GzIf6wSan{ghi{>CNYq9
zt44?=LSG7U6U>R1U)YemiG#zLpyH^2m%)({=8Ok<n-3T^Be+EbNLr<)eFWN<2f19u
z8B8o>n$8(#M|B#lmK%C$W<t3my0~xy6=U6`ku4T8XM!1T$DN~Ppyl+RThIv;ccQgX
zS>@u2>{m+a*nwlBp+LARK?O-T06H-mcObMB6rqBX5tq2Rme3h#^RYH1ScA6Gj0Orn
z2fC4V$d2ndl^@A_pYwbw$D9{Nn4##DVsoM?m!srY3h2m-x-ecqDJb9NSp8$87dT`?
zqD^<ideihUOsEY4sHF8We2A3**@RK?=>8+0^<L#^rxsc)g%o?U^q*ZNk&b06<CjKh
zx@4(}R9%uFwBSI7N-_u9mo4;>_1KCB#FtaYsTuc<K4f%7k{<)ut2d};g$9w3Hk@sF
zhY-1@C;~tB1&^Q6f$V6XrrL7HcaKU2b2AipOVC>GL8<}Ql>UcW=h%1CId_2ycLm2W
zukey5`lbpLqy|zN6gnwH+O9p89Lj-*SBZanB&7%y0kD~4{~A<F5?7~kczdT8@^LNg
zDVy2TmL$58)z+76sGA$>t4z3>FUncaa4Ub)VA|I%oG~J}ct3Hum(NO%5r_+N=dkV~
zd=Js93?OMhsyCUad;@2$#!|0y{xwC;A+we0vmpB$-4&=EKu$Rm5jVRNj=G4hs-$68
zSG9p`G|GbWWME*T8zd`}2uoN!mxnrswVjes2v@2aW{>V7QnO}da(O%{^>tropB$Qq
z)A~guJBFGUe52PSU^{?;b`qt?xBK`-QZb0!aivnGefMcg1*NJ;`*io1ZfrIyJZnHx
zLTiR7v3u5wjTS+v<uFi-ba@IKpPQ76`m@7I3D&c&JnA%1JFv>Owydil%{XEjB~vKE
zqOBVdr7}0O@neyKpQR=%|H7G1>R$sTXR(`HR^pc1Q=NuJWmCzDf##%*q##8!9Nd~<
zp|gF|hJf9%c4m2_;WtSBh=3cUb}9Ivyy}azV_Un?_Pn*ko^8;sql7UjwLcWlpGEa1
z%Xdv(lVUZxE?+h$m>{+5a~t#_B*6G?YfHPOgt**GvFp1?*AlTHK^eFhqhV*dR*}GF
zOSW1@VK5uI=tOLwVy|q&DhT0+2~r^9#dGruoZA~=kReU2*sL(yvb*S%$iZOt!xSp$
zeZm-o#)^=JHM@UyM&+oU|Mn&q?28B7vto)dI`(~7)0yaJm-jmq{nV=H1Za|ERD9OL
znCrnx@pHy75ZMI88rm`|!l}6ME>$z4n)I~=l}uV9obkl37QjrCn>$$CEGHLG=_wqY
z=Cx=mQR|qMVDkQNq8q(~TE7gFZ+2WA5&T%p`JPkkMRlpM@dPg$fqfF2k$lw@QA&pt
z#-Ku4$`}y9=ZdtPK!JkVQdzTfkn}jF#~u?#KPieeQgT9?e6&4@DbNPF`ILda*rP>k
z$gBjO^w4xzX@ACBPIse1`<uAK%)WI|8m7WHrqR94Bv~;0s`9JOJ==TiImxWs&gzOU
z{E-fD`*H&cux;!w26UAcS39%11v`An7llF3)j(d0g3X|WR-6tXoTLYEuTKe|{|PwB
zWwmg&M&5h{-h47uyuyHMbsiO>xCLJ$%*v2Vvv`)i*ouJ@gD_%CHo5tMm8Y0XGR|`|
zD%^u*CjL{AE1_Bp(zGnQz+tS?R|CBf&6vXnWQZU;Bizn%w5UXyyNCn;?Ps*~yfNu&
zyGxC|>?XojjmAY39%R#25`D@4A=ayVV>{-qavM-0O&9q&DFS>uV{_F^rF9}LI8doz
znamGW<C&m~&NU-b9L1m*%~`Hue}ZU}BP7<5E!mO%dU*Ui5R7ab;=4yix>{zvc}z$y
zovo&f!=s%<0VCNIrf9B`%y02vKcdxhn>$U*FqoCs@0N2q#~6{Va(OL%{pj0Qy@J;|
z*^xahdK|H-UDm9GEnJMuyf{wl$XT1@5P}w^?#WwJbX$P!)&OkO%Vs;cQEm4u*Uu}~
z{;1-Q5)5O4+P2fT){h-*#ckXgl+?>DkRr?~lXKpF2A5%oq|%_rNti+?YT9+WumgRB
zrdqr4OjL7Iuv+=Hdi>oAoVau_&r4ajUI-weL^4Jp-+?7(!d=-*$-R_(JiwFN^Obx}
z{Q>Q|ufV%I?}f;xH{vd;rdK`GED?Omds5j{6z7fA@NLaO1LWYevbX)45ys+$4WTnD
zM!%Sh`>o<3J>j~7<Om*U4q7YRy;;nCI8^@J<<&7sZZc$xJYBx6XDQjiDc^05n)2PB
z>O#1mht{sfA=aC7ka12P%+85b9#e`0|6Q)hELIi;XbQuBFRRIdF67+k&xj@d)*hot
zckz3bJ~=4C;1sju7Ifvimqb$z-LZkQc3dfFKF|A-aPn8JW3sJNq1+#u*Lc(nN=srP
z#DKBh=6Z}sV)P*H^|!wp*s*QmmwE%ie3$B`mKyEPf_ySE4NI6A+_ya%rPb)wP6{Cj
z<dJ^N!`9tN&6K>TPEj1r(P6I8#)$bn?g`%9ug>hox2A`fx|3bYZZ_+~@OXoE-T}HA
zJ-v=nu5;K5s2&5TKofkzbFy0=qG+c9Hep{pYwZsYf@r3o*<Re3Sy%pU=AC}pW0|UM
zzUDP`trnC6EV&~UZ#5B3L^+gT4!Pgt>H@)CDyHB+m1`r64jw_yVr%}6^AOMTJ)a?6
z5$I3*5X$xF@KPFP1prB(^cGW%pXbr25JvOFBS~LHN*{WWm|)F<x<1eKUH?#0q~1UP
zm{za!WpDNOzP>+fh8SXEm$vnl?CxGK_j6D8#*mMPboNa7?Rf`8FRS!HU+Q%)_=8XQ
zA!zo0A5}@Y)6iu(h41)}5BZTVT}$r{G5R;OY=}3S^pel{o$vXBuar`wTua}9-z&|e
z|M{t}`l}D$!gctsuMV((X<tDkCPw)K&-%Hq`@6qyQK$}&yeiK{yzW)@gXQqNkNnB6
z{4#b$0N_U=<@~p^9?`%2)o=aR&u^1xUTq)!-GBGk5B}jV{{G!iU4qBy=kEOJ@9g8x
z{_XGn>@W>Nj4v7do`LcH_mBVi{~F$}{?woT7exS5#sDOR#RH+mR~Jf~cmKgq9Ldr=
z(Nta8)_vhvp6S}Y@m$~e-v5C?;gDD~9vzECWdQh0JQs(;5NR%zPUM!`^?t!&@t9mT
zpV4Xcn!T00tI^CxqBS@y7G=HN_x}L{1qTTW4G$3$6=5#s@}e5<sHP(JAhI47H8(js
zJwHK1MMp_B>nx`}>LTeN8M2m2WoKz?ZEtaNb$5pvmnu&&tt?>^emSsMd6$`+ou8qj
zrKfu;Cn7Ymm5sH0U#<73#mC9Z&Ck)(`+PezKw_KX{@(Q9)$Q-`^Y!=n$N7@Fafq}4
z&lFg&w)IoEkYPiI4<UB>CdrsUI_`iOK(H!PM2{aqh7>sxVz?@-u+izb&B_%_Bw@ys
zIg@5hP?_Fb>IUwhu$}~M1{FG#Xi=lRlx%R)lAF&9rxG5OI+bcwt49Axf`ErffIX`i
zTopT(Y+1AWfQ9Yw>s2hCS<c3lJC|<VQc&yB$*^+ZOS^vo2Npb-%uA*!!>R?Cm2hLn
zk0D21aS$r9M|r}olDwI7XU~CqDm|Pao3T@$QKweD+UP3{EU%r^*_L%}+qZE$42JP5
zmSeer2Nyp48NHkYM+5wZ2?}xN&!I;j)V8<&U)czoH?1t4dw1{OkNCFs#+|BH1zjcu
zzn*=2_c4koP;18*g(mjzq<z1ie}Dgofq?^$yztmasqFqsP{9R>%V{349w@JgmDrMy
z!3#0WkTagFh_I1LEUe%-#WXC@#1rWXkSPlAnounZOasS46ltu{MxnN|%#J6rU~#QE
zZVXb$AxGi}s1x2YiO40HY|_amp^Q?>DXFZ|$}6$VQp+v5?9$6G!3<N(G07~`%rntU
zQ_VHmv`30I;f!-AU&adnKeQYiuo5}>?30H_oWbloh|;<wDnAiT6a~x%!sgIg>I=!6
zM-Mq*n`9Kt^t&YQgw#+;$9waWUmE_=)Ku`=3h+o$KBTlC2pHw0Q{#3#)z<FV(PKtV
zS_KKLP3Sc4R^Yt)i5O!M;)%uN!ZZ%Xn^+;S1rcFY!YeUa)nlF;INJ3OWdx0I*vE)@
zwgXq?^Qos`l0?>B>MS|MPC#u8cU44!B|^z`LroQ4OQrQ--z{`P7Y$?+wG_lWDDY}t
zT|1<=reN3IYJ{jd^h($~%*~<JBu!ungQu)zcGErZGx%WURE9yla}m@*+$bhIqEQ0L
z7`fabIn+#GaDsuwzVVdvjjf-OB>D-Kl(Q6_2jdeVz!FSe%Y=Z>rIgy1TktV!RSJ5m
z>ealdm5mX-wPEH`iyk!HRQ?X-7%!t+soQ2t(l!Dmr2Xsn7zt)D@?)-rU<pJLD(Dm!
zlIy`~1I1y!mxV`lmD=o!LzWuy7dYOW=JepbT(How9;2tcuTCnZ0ba9vQR`Hd+#4k8
zMyVBRuI2Vv&x4q?E!1mc7Ym9~aCB@C6g~jwb2Fzp2Za%@0z1)fl78UNsTR3(>{CG!
z_z+qqe1(oVm{IPB5l`x0Ov#dhR`GrK7x3|q1h+IA44-Ft_(vG}I^=wYziRQ1bMlB6
z^$4T9*(A#Zb}H6kj)y$AsNevIL)Z4YCpC|eFChfPmoTEIk_%o>ATa|U>M*z{@}(e!
zt_#`xrnMIm?8sQq{+r2*K*$B*iHe1^ffXch&=QWc!v%2@qD3e{DiU(eIzLDrT;!rH
zQU&mZU-2Mgc7QST!~=QJs~{LUXgFK+$WD?|$!i2uJS}1XfymHc2T`y+r-fj7%!6PH
z!MCkAxKM(7fujN%P_b{+!E0zKPw0rCqKOpoWszXT_ohV;>Ts`s-4js~0C|nw%wSa+
ziQm!8SR{@8i+ES;Pz<Z4wGu3mdl8g@D<Sy;Im%%ff%Ky)Rgt$lb%a}(6JZQI$UF+R
z5lMBNp(LkApE<UTbQN0R;#$`fAXTGU#_Zui?js;~XhS32WSs*_gBgA?p<3n>pY8UT
z8EkAMRi~l;-?{8#l0|x~H^JNm$B+dy`LK&{WyGUp_Qb#NnJ|)GeCD4}5X&uQ@1M+&
z;l-w=3NZ=<HiWaMQdsc4i=w2EBWP#|BQdWZ?FxeQNY~J^Wif%o5@^f8f=H+1NWJ9c
zqVJgHG*6IEqapKIt$X56JjX`nsMK=YI7!f6gp8M^z(PBN;teE}k(trr02DA928BwW
zodHs6N!z0@VJ6FVSk<b`xroM?fJBW<u}}=~5sYNVMMiWHtcj%7N6Enx@M+MaxBS`j
zR7Sa5)|8V=S>`cAs1lb%Rh-uA(IhE?oRS^(KrJ99xCAxW!ga8nU(Di3kQc~vDph#c
zOy&N*IE#{?W%ga`ql`T<LNtURWvFFH+)x=vQHf;{r<vT5D=i~~c|EWOswAk*7{#&i
zb%BaS+Ko)P+SR}k({c)hgvvA~8Vj-jXKv-49ffGkSMIhIzojhr@H$gRR+YNIwB9;9
zx+wFUS7wW$BVj{^5ee1}hkMlDQUUw3PJSf_z)i12K}o7!JcW<rU7o)l`pOjImn)u4
zqQNMfSosRGcoS%t+I}dP3}lyh=<Vo1g;`Z_tx_?R6T)#B;VR$?)V;6sFt`rf)e0wp
zfLs$Q1tWTeUSdOZG6k+pQL$I9$Yxp4rK=?OG_3)tlrqoz(M$<^v3&MYq9p!W^ZvFQ
zIPrqb2jq1D0yFG94(HJZ)&=5xb8Htv7IV$W10Iac1L7xWd5~$<t=wYMV9;ifMGs4k
zMJ3o{G9o&L;aOj)P`q5}*-5@->ya!8YiSr8>Z<I6K~w)0w6bQIl7SPM4ti8lCMx)n
zp{z!v)pkM$HrWCW9PtC$0wcL$#?UI>wH}s+zwjXm9N@_+^@^+$H&epLHDmJ(@k+T&
zHyaQ~E^!PCIZp~wgudfLsxobv#_L|&a>v3g49~1b0-A)M<G~?-T}B=K%=eFK{<FE#
z%(@>QPQroKhy&>=2>4n1%{o4_y}9ho@r^p)-FYh2qWvr$h8CjC@^cU4{;S<EFk0A?
zOY0zE6)O;9psdR-HMvoKY}|I5gl2ma6c99VkDFxK)({wF#++i7r7vp5%=zRV-isK^
zO`=-7-NnJo*QQOmny)M_nJH-1hR=NJC<+?I`Akd_jZC*5K;OwffI3&IRz(NO%s4TY
zWX0AQ>lK&ccfa7sOTb;}-5xK&RonFS#^;EouD2ZcmO(l;hsrAlaGuys8gb{5sGLK(
z(?iQalq-D}1P6lMEf4m~hxk?!CuDQsnZ3+ouUJhC960GNQ5B%Jjm8w>IZY0?vl=?-
zdLw%oi<>-|yU2J4+1yiA7O%i6e8m=#AGwvGNx5^V<|l4%fhVW_!Vr78dICI*I&0mH
z=f@b~Hg5d5f;d~fU^s%BG<co`t@(>6SrW<{y@cKD^6hP(2B|0Z+G8zEG8QYS9r~Nl
z_zlZiE4NBZTcnK&s7L||4PK1O`@|!N++l(=Y_CjD4UR08&_z^?$lI(Ym%_|)GEndW
zEVJGZ{Nhg3T+GVui^cM0?0jsXx-V<KYxiKLWw1uH7HY3b@OAbEJ0b|3D5{2lN&zoL
z{6L45@a9n71?e8|2t&@vYOJz2kjKiS3HxWe+Nh?g?#md-)dEhfC?V_+Yp#SX=uB`L
zV2um$uY`(<b|B7GSc#4x36dsk^7Ntzj%WwNaHPykt@i%TFaAqO;9-bjBw7BUp^PQA
z97Kxh11yFL-Tp)Yze;yv5P#Zk=(cSOF^T)SN?Jl>5*Z;5&(I?hr~jZW;?z$gn5M%X
z#)<@Qy}m|7)+>1`X#!s$_8N>9WrlCQ4Xy+!GZ4lO&F)>6rIFOd?3Rx$^kS6o>F0`w
z!D{iZAc_X)@73NR-?k1CDKC?zEgUp)6pI8I>nhRE%L>7US#UA&kit>k=@M<R;Mi}K
zlxl%MN#$rGUEFG2j*1%?#x2|;X}&EHpCt+TakYMKUT#ek^DhRCE)>5{7%9j8a!?IZ
zahPfkm~sRh-vf(+>;5Dxb&4n+?|^qC(%A$p=KcZ(hSD%UC~w$?F#;v<A=_njeq_YL
zYh418<q|AABBr9WZ*24s45u-efbb$iG5u%|1gMV<%_AK#%;N}ABb()@W^Gwikcpl^
z?5Z)?sK(7Ukmqm->ojA<f(#$e?N?+^nv9P*My;8oB_KaU2Z@2Psta*Y2kr#QLoCRM
z{%N|#F^J|WBZW~a36odaPqp|;WRmML<N;8K?vg~v&mPltP7A0arx?C62muMHz-hn+
z&=rL;y4*69jAqu>>DC;^QHHC@$|zL$;6di7s%TAl_|L;i&s`jGFRaC%3=e5~k*yBu
z0I%&E3$r+LLx1{$pxk918z4mRBMw2P{@f<%Pznv1S_?9r(KxkpJAoxJW-4uRatTRC
zD|1c~n{(xC$p}wp{RD6;x$`~Y^X_ExHa`<5J1acT&LRxb8&}6Sri{gUtB)?teqhHn
zRHUMK%&_8fL7BmZEQvVNK^CjBK2-<Eye%(@Em?vQy*^VwJR}eYaULTqKPa?u_ETwi
z1Q_A%3?x%OLG-aAq|i(gLK#%f+NDIV(=3<3`82NZT&Bk`3nC?p>@Gn$9E)XovqN>#
zS(L~QJgs=Z6TX<#iaO>&R!;&cPay|Hp>T8wgHV%P>N=68O9wDKT_Qb0!wDNnM@zJ&
zaIR$dvBNTI+tg79St~Ryz$$D0R5x~#O#Kv;!U{2j0Zk{2Qc|)?xya=V!jssvOqU|n
z=8SQAlZ^n++$03D`YvnqavzsbG1W!de8Pc>l8CMgQcF<^a!u1TRBQ~8B`ei3nF$d6
z6sbmJH2>6H*oi{rPNx!4nrKx-wa*7@HSn&+qT-BZ?&#j!FP>;BX7F=NjS*VUtx*H7
zOxx3n=EFCU!z^)-IkknN#POK4G(0CoRrORlRF&|UDKp#A1-!=Bd~HSrkVQaFL#u;j
zo;B5~?3@0Q42KaYY|giwKs~hd3TV{Aaw;#UOCJN0UU9Y8cGXzgPbU#(EQJtHaWr44
z6-V19UvG6i1#oWi?x_A+EI&>uQ}q**PA!j=26x^9A$Rhb(p0fLRyW_YM6)KT@G%4<
z4>7(l{h$sWwX6>T&+^D_Zf2D{f)YpCs)l~H=n%9AX3$$!(G4pSm3$6DMdvp*j__oW
z+vsyEM)hh=@z@X*$jt3Xk}2?dQ7N929<3!-Ih10>bUEu(X$Do0^zU9jR!RG|OfQhS
zmUd_}C?{>M`1Fz^U@_&ubr09D2BQ&dUIYr6U?qTP76<L5UN#*8vuN}yOmoL347UQA
z&YEOys>)GF-P7C7H3dmPp{#2M?XD?O(~Uk$?j$W_@uvmDHakmcV`p_S_{nK?6gJ)s
zWTntNKnQT$ss3rm>1brp2t|k|Ct#^0(MZkmtMZjYu0dLxG;Q@YZIxx}8b#j_)<Plg
zs4`G+rxBux>_*?!F?COVCDLG`Eq0#{9ko!MAZ&HTAypqTx++2>g*WYHiRVHzXmdC8
zpsnoc^l9C38;z3QEbe&luEn%bfiEU(KWm2YvIpy70RMH%(jz&ERZwqEjt0=D?5k%-
zcV8QKXR!<lV-;Y%^jb3(f_YE`%x9m7b`1u%cntQ>1}iC}uycQSf+;eBb$H3%aWQ_w
z-~7QXQ^sUS>d;&_3Ysj2B{+%pi)DKk_O9@CQl=P9O9Tn{LIYThq?d;wE`jYbbA&T{
zI8=$x{uhV+R6x}hNU{QkM>sk;u}CX-Z{zk$g=QEdwmCSfdoP1m?a>Qs(rx6hix1>n
zL*UNvPq}ih8eTVAOpZp+aoqflQXpxL|7|5Hd9&Qd40Yk^n6ex%CF61nq?A%ht*K-Y
z_+A2#j@_52oK+s3D5}0Lm6Isi>@<lpF!TBm&vNR8K9EyWXW%+bwBpv4ZR#}|M;{j>
z_Fiv*p^NL-D3C5yAAPSWA~~BCvVK@cacG!_O(uiAuBIS4XFp076^JMmPk{TUBq#QX
zA4h9wYCty3&RB@s4%lk@itZ#XzCanH&~I_D^(`3{$>v#~(Mtp>ke_+!gxaA(Hw<_F
z-uU?z_V}pLcXM{yl7poN<^qw3BO_QqT4<xo4KkrLML~(3VYmph!>mS&j#%=G3=6ti
ztY9=yJvQ1AJC=Gc?P~c*#(wJ>ndiG=!!K8=_@Zy*dTb)yIQo?DmsU`3-fC9^tD*Z<
z%3>g@x_3n@Pfd-OKvJ@huk4O_jK5%Nt_}HE8WLzPYk67_Lnons1Z(wV496C?1Qd#J
zKE`6e)1L*#VYQHU4*FI1`d(~R-u#i3HDG3)cus{3sMFK4@sX=6jF0`Ie}R`k*0+?u
z85QXnek!`?icX|^_73TkmuFjOADBapY^IvIw*N$mrx1IKHNR%%9O;9LFCzZ=Tq7Dt
zxP+=ur&XBq{#m9Y`IR9zMIi_jpX@Nvn6w5v(caf-j99y=yOntM*@(H1;2F0~a)|*V
z_Zlxqn>g(TIw7tq?UH7yXA5N4Muqmtp|P2dqgT5~rdv%ov&G{^y{fy*8>@<@rv-C{
zd`YjcQix;veNTXD*I0qSi=TbEpu#9Mvl>43a)U!F<J#ADudEBn`V-n^mu#9GF&dBF
z(xgq}#_KL(Xeo`)IhoNL>?R7Tf83!{w!6DXQ4JfiD01<vR`=ApPSfT$#u~F8DKv-p
zK2#4ZhZPV}mdG)wV3JM$NTz!VW<q+hhLW$ZP<J%?VixTefk?N=(f+opANq5~jw_x}
zndQ2PeHLvG+oFa~yk9$Wow=;}T<nO>%6A+o;Sj@c3rDU)Y-Ie;2Jdq2Nb5jwqIl{1
zs@C5EH0<n~#R#3!d3?pqk#(YsJtL>D2-tF!*S`r@4xX|dU?am9y?o@GG$@)UwdU^x
z6`S@jAl`uz`dTgbF}xNAuSu1Oc^j{IXT9ZgeWhK;Ml{PGSADAr$g>G(ClYcR3U#?l
zF3bD6LsEnDxq)Zg#zCE#ovzpU_E>E+Cmq&|NGO9TO~}dp&GskGs;2ZBeb|Saw}ysm
z$D54<g1#V`lrehvw7Av764qr{jc9ojm6wL#C5&sfZe!u>{%+>UFPYDv(a06O;X5#T
zvaky7z0Q;S<BhL=7dsPg8*`*hYv{Fsf?HsiUGeY@&kJ?nFvfT}N{gIwltL$n_v6@z
zep8coEqr}|n=;=)uZ3wF$wV3X>e;<h{cQ$MDH*bbLKv&qy}g0<Q7)_L-&=v@@5#>>
z)8WZ*Y}lLqE1F783*^a`*r{@#HLu<KGGor>xw7hCy(58)zK6Wr@ZD8u$Hx(j;Ssu{
z)5ln!S%Oe#b55<+ul>~NXGH#?#j|ABOcj}65@*1j;*~0O&E2AJJ@rN2P*wiuW*h`r
z-r6S}>OSh^`CQj0!|u5~2M?o%<$&P;){?HeUp(vn#|$V{6b|>-44_^5&AlasJbtBC
zFY*UkQz5?8MZd8*$du}=on=3sL&)|WSBSd~K>Jt0_S6g(*E)yr`$gXATYni#$km?W
zoufSMNeao!=Y;^K^<_HJ2mlynp0;!ga5^RA5Fk7xe&<mZ<CP?0oSNFY?<*o0bpQ_w
z>$nq6^ktMHu@=6}(Zittg)%1+I;13@j$8GU5mrZ9siB(?d&%1m&B4)j%_6sy%Ko@=
zv3WeN-}C$aKVYEXAYq~5A!4E;VMvbSQ5e_8#0{0fT3aQ=<fc>P*hH3Q&sWcuiRVd5
zl15usnvul->{#P~N|I^@tp-GzCQR20NL&5|)X^7?%4)`N9NlNA539-&DA#m^69`19
zls6Kbarbr}E!FIEI2*d{^|;XaaUI^G{XKrZ{yu-d|3AQh0;NIH(L$a9A-Yb5@{pz5
zLM7cEQhGJ<L5mP;Hb66ICu1vRSh#UHg=`%QI&Z}7`B;tIpAIr5j7k?W%%oO|O3`u2
zlBGSM4eyCkC+`+Id}vw>Z0htW)TmOYQmtzBsvcIdw!*{;5Z5xVE-}>f)8R%!lQLvZ
z8Cf<UMo0XTb!~)$7>EsMF9qm}2^`Tv5!GzmOVTUi#EKU)ZtVCm<j9gkr8P0w>M$_|
zgJr&8?Hb!=MJ`=Uc}eKx)T&prZvO51HSE~3XBTR9v~(qxbrhU)6~eHNjY~eFp8GZ(
z?c~arGjHzvIrQk#6+@Gt0oLI>+13%knQ=P!@Z!glFK_-l`t&V3k{)X1+j|*c+pDi{
z|33cw`uFqi4`nY?49(C-D+dJO(16^?<sX9$I`|-j5lT3rJ~**(n;h?Wv64gcQTQQ<
zA&NL6i6uUFlWuuo5k@a0F~A~#j%=_-Eohl|BaS)hxFe4}BGMBsI{DJoT9jmjlaEO%
zxg?WKItd|rxV#fuNzFuK8huY{xh0ofdimvJ-bF)TkqoW)9hhmVxh9)!y7|YEd->7C
zDKBEQ+nagnxhJ1}^2nk|{%&oy8BNGox5{yTD!M46jXEkGdv`@K4=2i`RG<!zYPu<>
zoq9T1bv;pY!b?H05#xfNs=6wxt-6{IJva2G3t)Cd`YNuu>bfhh3*c!<Edo{$B`3Wa
zdn~fax(Q@%cj*SwLCFY-mXOL?do8xv?l>qkn+QtJr7ISvExF~Idv17O*>qc4L8cIA
zqUg#yFTM39XBrCR^t4Md&=zYizyS+9aAVNew#$H^l@M1m3Rp-m#1Tt8F<jRjxXnyf
zrp4^I6np$J$RVc`g})v_<N}5vtGqJH6Wf7`fW6#;1rjg<)-ujH>n!kh29vM@rvL6d
zG|@$4YZ_bNSe%gliq#qYG}KY=dQdo02H0WHmr1=f*Inmn$DtE}TbPtyn|(IgV2Wx<
z8W;B>ZpUfMJvZGA66^CE3W^Cr%60qwH{kq*fdMf%0a4(cSq8p1<Bj7-twVPKQ?qxD
zTYfp_kODYgkTOwg+s&DaK04_I4^y@sd7Y&3;HA6%I_y(De9Oo>iR9B5n+qK~@4fr3
z$mV2qaCqTNz5Vj<$t%CSATrvV`^8pXia7JtTYtSmBeN(Hpt-|n81~_dUp?YXHGARD
zBLyAz`0cx&Hqx4O#H=-FgkwVV@9V$+;x<m7I%OCz9M4^ce+E3@-15?wraj|G1k@S=
zBPhWMQn3Dl7Q7$^GpNB0a<GFQ{2&NJD8dnvu!JT&AqrEd!WFWxg)V#{3_l3L7}BtY
zY~n~oc4xyK^3V&^`V5XPWdZ8-u!u&i1+(0OBWf{GaYuZj4e!JOC*EjpWrHFX2Zkbx
z-3Ne4QeF45C`Nk4sEPL($&wJ49odXZhhuzWeQd-!_RZ!}eIwEQnsXE2&=HP)yjT4A
z*2mYN=!?X0BW$L3wLdcQjAaZRbZ)|=ra@9RXQE;wGkG53@C`f$Lu85Y!lFC6CW)Fn
zWfv_}AX38SOonVCD<NYrFb)!xwydKSYZ<0}ebGCybPQfTdCOsT@ezj8rD8q@hznFw
zJ^nG8O=sjt%xT&OOQ!jyWXcz}rtt-tL<y$q0#KResm_~FNump=xg>vOtqy~7XD}Qg
zPIGciM)b5wwXk^%>7fOP0@<Uxlrpmv=(9B31CTmRq@vEiXJ)$FT#B6Mky$=+jqs!0
zCC6DxHENV7Xet9T(byD>SY|bxt5!lKggcBaurDC#R(yPL9B(`;qo+e!P5rXKt!)vM
z*=*uHQz0vHZl<OgwWkB)1rRB!CVonF95d$!RNaYEeKzB!RDWpENj|g@;9H$KmdZJJ
z<{?gh(b=zNm`vipikDlU8LXr^27k`QG6iG|M^f}RX2R=qV;$2(xA)S{f$Jp|{wdy!
zf-0WQ`N|e>u-LwM01vJ>ghqo<>vb$US%SP^fr`b|Gg%X)ets6Epm?fa21C-3hNPeY
zVImQuX3V>dAf8D*sc6ROjt0!fV04Y#GcM#>NMUM<PxZ_vT(Qq*U?_UF66bIsB2Mj$
zA~;(;ms{KlOlRz)TFkV}-gttNmYl{3(Iw|zek+v=e6OP{W3O$q0hDkJmR8L(iv=*D
zhIV{6mDWVqMUave)Cy|^DQhMbeoIGZjp-W}s)l-x6&J`+RxI#3MByY#)M_x04lW%T
zL;A~Gn~JG^XCj6_f@!#^@DfwkmDmo#5(q(FkrDc}1V!*SSGCq6!ns5KPwIF9VlT8U
zj64ppfD>?F)cP0{tf*x-`M_Y5Ay`!l4P#<pzz8pv#SAE>vPKnHlS4KbPT*UFi{0y#
zkPKO1H7!O1MQVsDx8xsl*xoA1<2>oHLLO~C2AnA)DPT=xh*B1Zt;iWwFucehJ8jh`
zX?m4dm6^J&Gf8M}2G%PiS~NqHaXh%<4nL!T&Sf>GPxTQOEFD?GFP$ZMu`Ff7oTZ_K
zAf+32n=wnLnl=<wi4Q?7X!m4jvlSRl-%L&H8Ly+s@whR@a7yJ(5eE~k?yhc}U0d#1
zhXK0GMe6=sU;=4mE4Ra;V16U3&l*^!>9iJmSzTl5=4F|SJhc8PwsBl@XuGWR_T-sQ
zriZs6`Y#?v^eimWgG!gdVM6h;p&K^q#1ctz@D#D0*fBd6L$qV7+}>A^mk2iqDsl`5
z1c1&v<2tDPYY)ZWT^;=5;0}7(Rl*oP2pqZjUSYY?iImnf?TJnk>E>lfwPYJe?)xH<
z++4h$B(i!Mc0Z_6=#%)Gjp<s5A~`;TaI1E|F6!Zxi6kHS(TeNpu*!LgSisRx#l!A(
z!l*7Of>6bDi@tz)9Qd`^(0OcpIrm325GdEK!MF_n4O}m?YUozSN7{xAG1d3cT<s8r
z;ojYgqnu`RS&KOf*eq2blOm3d6ioXt7+kb`;74kGkN(n3c)jyCRk8MXU-lsEGMqPm
zO2K$m%mX%vOv8SpP{L0(D~^aH-QLnDE5Z5oBfpSgbyO3Zx+!06Xoqq*4(%7!y)_@#
z%0=0X_|ClNY<eRc?_HT+I)Ht3_~1*cw`(%)B{@{*4xPa)(O>y|kzF}d%*<)Wq*R@(
z<&Z?g0}falqUBop8Cx6#ooNLNe$C$m_FCc`#1wgs$<$Z0gdcNwmtja=K13Se9bF`_
z8G_gYaQq5}RTyu{3>fVm%1s{ZnSkUym<X!JQvA;jcv|z}+_*W|$>~9J$sp~`*@iq;
zRmcpGmDdpQoYBqIhk0A)5g9!}88&Rl{sG@U{&}ETokeh*fp-)aUhs$8SV}CMpgZ+Z
z@kEt1EDUJC-ETa>gk4+&B8OQ}38}eX+6e;Tpj5BL1m&q2h*;A*VG4RBo*H=q%|YBZ
zKw-m8BAVr3!l+&krpDD>1YQ^yhU{Sx&fOA*VXo!a45-(Tv6ZUX*TMDSO0kajg+<m#
z%azRt_eIh`T|t;Ff-_Vgf%w%K0+@kpjHh`U8CsRFor)B)gXRs3JD5r(<c9f#mLH6Q
zs7zyeA;M>r0w$?pnt`CY$%2c#Ul$(Q5h7t&E!A!K(|4ueD{h%mq+>O`+W>--llf5f
zZH%0u*(OF@H|!J`dV)T&7Z=cp{MnTLNDz(`j-r;CoL}kGKepmEd;$gr*SyWd5HcEx
z#glN%ARmGk%KS&9p_mj9j&%%T0f~Xn=$`n2;6<u~MaHDB1>yWiU0A#npyj}Z(W8O2
zV)YeAB}G-gh~hI!paB-({^?x~e8`1lLTe4+DCV2eMcXF|q#!*88mL!6NnVD%ft2YW
z<(OnAJe++&q|M}_SWu$--C<Bv!$RB%{R!hcF%enR<qC2G*`y8(##9+y5lJwlPre6F
zfS5fl!e_L{U^W%E<OV683^!Pp`ym8dW<}^Ep1SB;1ppo<PNmFE+<c{=%+X{u-AVZz
z<U9Bz^A$lAl1W3%T<P7{^br0?vWa8@-Xb-w;N!6$B2p!J(TNzMOuq#Nt!x}=YGxD4
zl~fv4QQbjfIcC)m5Fmbzi-pQ?JXB7g+BR)gU%DZ8F$Q0~nT!O&9fbtu1zc-l100H*
zHVmB)eO=$d#c+D(I*o}^vI|_HgP$#?KU#sMOaoDA7C-n{W!l`y^yF@CV9lLl0BvVj
zo)~*T7rPB%q;+O(sp0`9Sxf|@{NNiv<z@Q(qWSUNq!5cgAgG57glEiC&mc)Is2YtB
z<pWj5>^-K#Vc2oj);jisdD`8PB||L9-DUNrlI)Enlv#nkCM8%VvxQ}b^1)@;o=}w6
zh&riK`eyK{UQn#vSpIny`(y|A0Ha5#R?P9k^Q^?Q*p!!cR>hoHcZg<fn46va2z;^A
z&J`M+8YR<tPg6z!S&m$mI^FXrUs0S>lJ03A@@E=pjF2jXp3(~ARY+O%&9&9tlEzGx
zF5GT?p&8_rCi)*LF4|mx&6PfBbn1c$GT}g$R9jgfM6@6zM#_B7Nw7>qcjg?bKBbMy
zLFWY1KbT{lcG=9#if%gTQKH!{=;_|Em^o~zXS!Z~GK#K7fKk@UQT#+9QkRZOCG-%P
zFS2C18R(FfsuD7qt?p*IHc%7D#41@HrNqF`#2~{BPw5>=TZW*Q6$TKH#<Zf{VdzGM
zKqkBfWoA4p{@QJ$sW$0#vBa#p$CVzc3hwHS2I{bQB0#uS?u9}U8eyjPNhji*W>DdP
zO(0QCBs@SYo(k%Zxh6SH(K>!5%W6lc%-3*1R+YIMk=~t8<t#zG&4xl5==fi=*wwuq
z!kE3xpQ^z!%oLiDR?-UM!i1iRt;Y$HtFfkQDSlm|3?(A|qwV#|LV27<%+pUg7?yT|
zB|fI6HRQ1EK@MgbO+Bp(Mk~eI*|BaYNCAdtO@vFq>3^`T8u*^W>CTLO8w~7czDShc
zLP0lX3g2#+vj|iaY~(T-$^!9hDf$G+si?_PM^!N_puMG-9?cxNXPq^Z;OYyJ2C3i9
zA6Y{F9ObgBC?RSK(xAu9qc<syGX@2UB_m;}PpP$M@C_!4f`q*-ZiXIWWQ~~mIFt>>
zgjY_UUxC4vEyI^a+egXcdOcRI9Vzpr-=>ly?KDr0VpuJ~tjj#ze@LtsE+GV=E{`=B
z({gK*QV3B-7|Mby93p{baS{g-4*LlxeDo`;xn1FAFNf-8Jo!Y8;un`n&glAW>hj{1
z1S_y+ZHhHu?{@5r;hNP#uk)#$!W}Pb>I}PfRFbmh=mz9vT`Ov(Fd1}X%+^48@?@RD
zC6z(0^U{OkEr@3*2wvUljt*+&c9sD1WaHWe<Z%WwW^1r@kH?W7Je`@M{@qEjCmjCf
zRRW%$xTxncbztW{#kkytmsQg9PNn>mamw15;bo)QBxBy8t)p&7Xom0j$}GEvu*S}&
zxH{`drRz<&>-wsnAlHW65(K8%WL@sD_ijwBaWL&54f_u2LA4k18bLpb?{p?#e$|^D
zn}ZbhAh0Dy<W8YUrlDQ^s%3&Jj!`UWLNa7pPLxDlDtwq*VV12Sa<CP~DdsZ$g0PBy
zllLT6wZJLq<xXdAht64C6IpUV)j)Cq8<l8nu@q!-P3Lz`VDAnEE5a%f&M+y+SQx9V
z>~@)BNkjP>t?JFxRvtmaGVUS!o7fUqlZk5VAl9S8K?)9KDs)8JnwKFkjs74pkoW2o
z*>nc0K`t)FXxt95FB_r&ha@__^Ri_s8}_9{Ivzsl8u`B9-Fk~e^I106h&DbJJ-*{5
z=k1Wx?cy06Y>x9eRq7Tlr8Lk$N{^|5h|dQ43rGGiHMFms?pqkHGROQI)f%j-c_Nj;
zG#(-)9=FK(VlAL$XM`GCsNxy(;@K!!2N|>reW+4yZY307t7!BnH0zC`eG^3^^+*5H
z-kNglA{V#_*F1sgzivYKu`*t(T5)UyEGG{>Bk5D|m|27K9&eh4wyFVAhRo75-YSik
z2J_AZZ#jg@PSEWnLPA6bN(Zv_+Uz9g(W^7sr$4)%p#++^){gnA{@qT<?O(6iP0L|A
zJN0F4lNX`Te<7X>!l|?X^%?XVYVgEnFSc%1EMrS<B0#5y$(n^qwcS~XI|c$4xb$dc
zR~+W%3Yx1tk(Z5@@YTr_&OQqUzvgxXS5nVf@%if4F*WUG9a~rKoON*zd5&M8D-lfM
zO(!f-;&E6;-Wd0>!P<5vZmUCQHhWe!DMWTV7$G)h+dH=t3<73G?JIUV+H|dOgPLT1
zx}7mXsa9ul%fjR5g|wx)^fb2y=4#t(7xy+$D!9(-1Hj%H&h`pbm0_i)Z)d0*w9P{+
zL4d+vIJi_@d+96<G&ce72IDvPiZ7zk_+?X{#!f-colKYh`I2y`$Ql$GnphKu??(E~
z_2I4^U&>mz)x#QpT3)7fYn3oa5_cFjH<Th<ry9q2YXCby#J}NXwla>Nty64HN?~L-
znc9<;_cd0zJ_jYT5_RZKIW4!FHyd`M-@|By^GGjeg*%$pnJDYrcmN$ob^jHO<|7N|
z)?aR66*KrUJFuR=_m&wSk0vfF6)4Is1rz$5db(+!kK764VsH=l3^chKlj7}MdZ{Pu
zEx7nTttRHisgnIB5ZP`!S1t!<!Xh$frFUDwGAcHIR1qZ6@QF>DpYdfUo(n$NtNtEK
zJ8ARk+fSf2gYIh3eRB~v>aG7%heVfs%P}u@b-B-R(P8-h72FZv+0JtV`3Yjv>cpH-
zo`qL|nugU3c*QOUW;%g6vu^cpj5VeZUt)mGdXMAzdgZqm(>i?T_<#-jyt5eo?lZ|f
z;6E$G;sLnu_UES^nmylffR$_|#^9Ab8b61qVP#*01BM=As}{rx?${2j)r<`zaIn61
z{*w4g<7oAf)4&sgS~WZJ)$cv>q?3Q`$+J;q5&b-j@_SZ2)bZAj>|9}(J%&Xp)%SQj
zH=aY8a<<jq2FqoM`n*AK<RX5Hvv4^6!3$IpPvGCv2Q$}6(z+P{FnhQ9YL6-9e!VAU
zI`__R8+ux!r*#edu@$mJjvCy3cl<BU67|ImUOxWwE_zj917;^vup<xJLfJG}Nbe$s
zVb{|WR~|#kkhR0a#GMtg?zs^pDUFjyd7bN<vPyn6DcRAAKFmyF{mh!!AsiEobD8c}
zWw)N#dziI#x<`C?v}$9?5bWX7l#rjDj@Qh-LKf%n0sdaTbnvH8!h5&cTNZqBf(1oS
zD*qReEkGVA0n8Aw<#tZt4K<etL8Z!ogdo65tOYcwr@}h3e2{eZxKyU855H^x5&Ss8
zU-5Sk27ST?(daZHqR^;OR~->I(h&tU0IHD89_AMi7Fm}WEa!k7-;VCQ>7v-|q|n~K
z!utz}a1$iq3N%z)WNdVNgp8D&q^z{O#Qx0O+sLqSN?fRGtH_v$c;m77qAXP009`e}
z*i_m?1?{7{m{Lk@8qlZ$q59gwI#wG)eliVIYK_5V6O@+C(SyV`tfh&K6gAaMDM_f>
z5Jyi}UuSQ3e}|8k=gZTm_?WAP>u3$4fwnWN3Ak{w!n^?pj1C?*zVbnUg@&N1R8)>7
z;x|Q&91-T0k-KLRS-E4f5*6u)E1@5K0~JkNfp43@dSvdrl7>Np!7ePcDcC8(+q7|c
z77ZCPPw7&oO`Sf48da(-lV?^I1q8E!!wFiAIvBc;5m&JL{`C<v&a26NE{vcVrY49t
zk{^@kDPcuu4<O6r)Z#Mo1r%=9{;oB{`SMRW7gtT#Y!r6tKgLX2PR5*B^JdPSJ%2VV
z!eS?+m(>oYmacFL$)VMnzJXE<3%^+E29^PhFl}D7rSOy+${cAAU$wC8HYz#9oO9Mb
z4EiE^jMm~ZkWT6v^mgvuy?+NE9<;W_IygMx5KK*mGwgNbL24MrD|^mz;>7!kZRzw8
z{5F1KBOq?OjiVl72+*cA_!1BSd;UAeC@MtqXo@Rf6Hk(aRPrQ(>#$(2h!C-WFRctu
zL@`AbS7fn87hgnz8xaSxa4>!_vMq|B2t!68gao4StriU035N)qfrF@-_z7r*T$E(P
z85pOevPvtj#4<}Qz0<<}$hqL~t)x6G>xiK9a_rDHFp|iPp&--9QLioMq_a*t@5D1t
zJ@q8>LYO{M<`g#+h(fqS417R6$m9bvH{be^0>eEgrL<B@FU2%dO&^O?II_YV$-#pb
zZM3>8{tD&HBQC<h934QwjjT;)rL|UDZ^bp&$+|#+q-rLNRZKC?Xd{_%jx$K40)taC
zlwhhtR99)IrM6mYuch^;>`a7+O*mQA%Q5Y`GM0ua;L~W;0lh_b7eZadHePw>rMF&t
z9YG3>Wz7MJ$ug{Q439J>e8DdX>bge=iO?&USaXHhN*Er4{op~J2-%i7jMJO$UXMQp
zIb@MF)9J$mZ9D#NwQEd8GM^7<+qYdhPOeR0cx{#qt(QUdl;4+~7-}b7l(XeXllm<;
zO=PgcZ)B&RhT4@OOcrrrP;0&#RJg7ynVd?e*5Ep;0bO&$L{mdMAgdTt$)=jSzW7Z!
zPu+;^x7Y%%P;y3+``bt<{+Te~B;}IrAmz3vYQ-1N(8Ce!%KBU|KH-fSnfJhsB_1q#
z<*&%E7CZ5l0GjW^(E0vobe32?^YN)=NqlfE@<q$MzGR}uxf%P0T=KjF?D^5phbIs{
zf7VRb=eI<at1;c4n}FqCF3E4u$$1BnJjS=@{;08s2Y<n2ll%wzHq?psCbW!6-nZW$
zjd5I_>i)y~d~W5}{;d12Nnfplj?GyUzSp}jIpb}91047ul(lyi&m-*XO@n%3tix#z
zN&7m(%R1p68dbys{o|BA_(KSEB~V8{>zIvJcCigIEp*rkTMS84pAj}jfb@e;+(rn)
z`Am&JIUHgAgxEb>DN2Dytc?+Mloy|6ha_9;6<!P`18)g0FhqEq!nW0qFU^dAf9VAB
zm_fI5{pxsvkX{YS0|=kEj18?SR}R~=GnA20SZ_*9oS2|M>>+WCeT*RAdO-#Z7D{$&
zTS8K>s4v0IA&st}$jgp~uoWmue8Y+y9w}7Fs{vAi39N-DALzx|LF9e@f|i2FI6?_-
z{_HD6M3E*1$4NESFk|)`gi;7+N)m`LY3Qktg|Ik;n!yEwU9w8}{FXmELgAGOGo*at
zlghgw<X``q3n(t;8fTvBNbU0@+3Iqza0+H({}B=xYzIe_g^FR#j1`0K@{vwh#(+DZ
zOaOEDh`Io5P=$B~xDaSLTJj>5<w(g%?8y~nnFpS5GUe<XMz>H3sFC|qhRg66EY3+x
zT(DF}%*wQ{Q@v!DP|60!^c6fa*in)+x#c{ZST4C3RE%}}U`SbV(lb&93b1nLKuNWW
zb!pH;Ogy3|<DkHsmeZ+E)f-2FIUr?yt`&jf1T@<=R1X-42>Z;NHbpto!zr=;oq?<n
zEeFRhX@1dL4xJe@yA{V@bdGZU+S~0i394*@6cflSU>iyB$d0723_?<5XslO_F(T&$
z812eU`ZJ*+K>~96vYcLJl@h`l!hGb@oM4ggpaTk&ul78IS<xwznLbLCnSAZi1_Hq_
z1rMsJ`&Jld(Ah{dM+JF38n_09M1WQCB7{5X^xna`$*JwLP4Y=W6GY75_|*?Wt>r7P
z+q}GDB$wj&=p8h{TcRB;xTs3XMViVBw+L1@Yp~^hN~B$C)Dx==3BhxeS6Zsx$PP3^
zNmNNRrntPzGRFE@xKg&ja#Gg{Ad$^1of_LDHgKb1q9J&DiZ4|iu8;oM*zomg^j;MD
zr(&&>Na$K%1{&71FF<)Azn(b2lXc9N4v_{3t;tVcan81e1!-k~^*>dViL3OTL=Ww=
zS-9o{Ln#w)>zs#D=KRPJu?X*B{vb3dd685qSqx(>(#w)nt)ti#1q0ugGly|xz@y=m
zamxt4q4=x7V{&s%xv@zK7d5aGhB82rc4C_~N3PjW?QuO(yLBYD5m`3cU+HR`$!0li
zKlF3l7)MJ}T~53Rav7@HVixL^#&&>U^f)^ETqo(TWz>seOc637Bs)@bJFpzNkk{uV
z+SbK46U-G31ZM)pnP)tr?b2XE5>L?$IH2v3OGyOS;j|dl$^IfTF-{_g&8COQxIBuI
zZR*&g^iqBXp<ZtZ`zvm-8h|S<cZoicTSwEXHVr679D(Adn6Mx$%;q1ynkSCWQc#B!
z+@JI2*^BtrT0^Fe-gSdvX+K2gOn5o>3>*?nruzDmcgr|Y6PD~dlPj9kM)M!{O`(1R
z2nccE$S26yC_Tcq=5tPrlO0#@AJzNNYg};)j(h-DLsGeT`{yOO>7}3}v|&GTw~w?8
z?rl6)4+G04&-VmMaygyb8&|dNgf_NkP(!R#kI6eJa=u4Kou88)VzHt()JTUph`lA;
z7hHwC&Jl0T;hJEceTSfXpNA(udGVQ#f#o%IHIAO!{v4nCNYrp@oeqe>GhEz0>QARM
zU}+<B^<p>mcU&guy>+tAwK+W~Uw6S;w0xHCI=5@?!rYYi#aBg>sC!yNpJ|r_?o7f+
zrIR|~qhJ}6OC>gdJm;fNR{pj7-PlY(Z*-uD@V%8GXH`+~ZC7_2?Twr|e<obAvC6BC
zA{!`}^I&1*6w{kNE&uKR9<&8vKz($4td4lIyv~iib67N8Iy~EHp?V@W)p(DpIE66V
zF|243V89{&F_RFpl)9n5CQCKGXb9~4l?*}zb73POi#`Ylk)O-I(@4Eh5D_1`C6zI{
zWHBJv*o{_muAzghvw5s$aF85GK2ul)2eX3y0mD6bk)yrKJ~9|Q$6E%vup#L%09eru
z%_0?{0l7x1kqpcm4%|CDTEGpwkQ+EV6DS4_IiEo)!Kg5%&MOPh!@C>F7l1pK*jtDW
ziNh7CtVyAq%!0uK=|39;6B8T|jG~F0LOXSeq&hG?-J-Is5Gy6RiX@l`2gH{hvAeYE
z!&?Y9fy;rlkPOOtEohPznL{3+q9QZto#gVj{g40@_zjke81-AF?K=S)W38;|6)pUr
z;_J86>VOkuz(YK`#~_YMq(e6<mh|zuhby-;TE^ul7<T)IFcP5^qMl`vq&sOSKkTLK
z`=C`Y9vqAq<vIcsJOo+eKi%n^-zxsZ^&7@V_{48xLjcmTCv$>%1VSH_J4NWUc67%(
zP`*qYwuF)!Y;%}E$i942FH%G!`4|S18zWJ`pk@jbmkKdL>IG;KExw322s94s6UNI!
zjaTD?zKS;sbU1U-52@+JtYAby49U1_wU^96iW4|-1j(~li3Y;6Y}}GTQW@bhzTKmd
zl>niHkc?Z5p^2$GcM+m$Iyc6M$wRQR9rVSFtixwJM^&6Hs?fM@SiLBe8s*!+o7yF^
zfVV`fFv+>7HcP^{0>gJCAKIvjhxCGqni0nvr|ml!NNKDwD;Qm~N*ZYc<|;Z&q>O+N
zAxB%P%UCz6dJIO`D*sxHH2&%~x4;|~lFZpbF4F_6RGAap0L>F{N?d?BU(yFzDMN9*
zfU(Q4&m5_1Bag*28ATaM6&ybMBgqh07@k`xfy=qXJg+AcB7Y3T56ZOn`meH#q>K=*
zw9CtOkrRSZE?m$GQrH5qoQ+V(sG%u9XYw&WK@>DpMBNm_=M%rKd`A9Ztm}-2jid^J
zynzTr$rBK(o&dAZ;te3{s`~oCW0blCq=b!2Lp<yfl-$2*ipD3*isr;VGZ`!jY!lLi
z$wT4K_<2AwW6fwBOvRK${-F!f)3^fVB}b?!>3fXSoQQy7Ixp*jw1Sv2XupFp&z)jL
z?GzgBd=Gy(P|Djy{=fqfYGRF?APW+#Gxb<ZFUW!%JWhPHxXakkxGYXrxX_Rj#ysS_
z!?XlW_)XXxET3!#G{C!moSeX@lTA8+E;A1p05VS-llu&i92>)CvPq)5hO|UPkJOz(
z%+JUK#H*4NH;p%hxXvi8P_W`mH|#_Y>IR8WwW~51V=KoiBnG+UPHBh*yPVMG5+grR
z$lr+%sSJ_{jLQu(Jup?hpxnI86VxglofeJ2hZ#z6TTj%miVchw0rY|}+dMY155*MD
zce6W$3@yE6PAX9^u#m&i>?&v)1{K8-nsQNspbLq_O~E|W{=~PHIulOaiee!_b-dH`
zi9UwB%|(^|h(K63FV#wD)Kewx2k9wCpQw(x5w~E%BDz^keE2HTQ4EKARv<b6a&kHz
z&Ba@6LDX4>H3^$EbdYK^Ieje5mN-^CtIuhm$?|!$SbZ$^(7mF7*!xQfE-}F^5TR-<
z!RL}kEUkwm(TzOaHA?xZ%9%kn?0};jI;}{sEJ!Cy-M*?~6Z(0g9iW=_=)S9H%Cwlx
zXxPPb6xn9&Q~Z<K$~;vZ%e~k@%RPuZu0eu_;1HyRS#*0MUxCOVt-ob~CM*3k-87uL
z)GitMjUBz&1B0mb`VXpf+De)Z*ciA*L{78#HbJe*H}KdRZ5W$`PivgRL4`mPDp5r(
z4mSRJh}#R)uJFv2jEOs4G5~dvWg<*;iz_&=8k)Nu$<5Y8oX?hIT(_N7(8Z;4b=?t7
zLo=F6ko~_>oibrdGBVVhDy2Y^BU{iyxe>S;6{uLJ93#d<#D0m3u*y@Km9}VN!p(7#
ztouT7eODzxM;+Y+64h4MQ%nWD-Pq00-^yC;*hzxu)wR>y7!c7lDi+L*5=PV}m<U4h
z0!nHrNRf=iqx?XPd(i8=CF}DFXEZ$31>RtNT9>d=7~GIFXww!f0~A!wx?<WaEt9F$
zsB;y8Wc*Mvv)xE)-qvjko|y*Hu^9;%m~REx2AWO=0Sfu(jd_E+o)k)|B$PDjDgKBH
z7(??W-{oJSFb&I7*G5pn=MuUSOxg|wU<5(Ur|>PzJ3jA9NkX~UbM)R^36e&s-=`xI
zu0f=1<Okj|+zVcv5V{Gjxfs|3kXRt#dgQ6zg3!sO4o{ID%6Sb1PC+nnw4I4x$0Og?
z6wb;BmS-(KluQp5d{LwThvS)43E`UsHZqQMlH8NiMeVi(4F`#&Uo8XTaKMQZ`(tKg
zVht>c4VBN`EKy5iWmUXc5kyW75lTXV+#<~4d8wT2VckeV;0!jlK4uL^)I_2ThdO&0
zvRvQ0?4ns^P$2Ty`o$5iL4{lmOaa|w?d{;&^+@aFMf$?Q?h~ftdD*iO{^woAw~PW9
z8O~P`TNF;{UMbLFj3U0M%ZOfiH5_b>R2GXXuI52NE=RFWR`X0R1(09KXUGamvDidZ
zbKpZ0=ug}SdNwZW(p;MH74-!nQsIhv%;f*MC;XC6nR8s^B#w|C<(O<f5?s+0HO}$j
z<4PV1aWsP^{$3sQ({3E%ltfPblHOxcUMDVHo2~&}Y{S{e89i{t1#A}X?d2#bho44}
zq|E82h2_|=$9$|SLp|t^<>2o;Ua3@E?L29$o<u^O-Ozi9DE&881Sck?=trZ%$GcjJ
z2w<qIvzGWoGh(rOtk6tm2%W7!o<m3i#mB;4(0VP@BBN@Tjl@U(${*F4#$cYuAZ$y>
zc;F>^>ZAHH1&NS0S}glhiM%!&$sS)j-A6P|M>?h?jZN*rJzWM?wb7GFyj?*JW^I-1
z#L6w!eWJl`OxCxC3g>J>{qu!qX=+pEM)N{ZLxJtx;=xgr73lHbR)aJm9q8XRw=!ld
z)P7uSwd(R>DC`ahS1jWK1cr?QVc#1+zFSl8#9a@bD7>av64Ga)Qe`OFXvJDZ;0tS?
z4N0FfAASy9+dl7-B&K|JKK<&)Ag-O`bp?t6ZYn7x`{+G0W@<ioO^em8WmCrJ&g8qU
zQ`7G5R}n+-b>b$rHEzR^5>H*f-Qc}Y+cb?5VJ;s>IY|B)pAT%F9-b`_SZP4);_5)o
z=0lMg-zB6@{6X?<>ErIU>S#c!u5S`f=b>cTqSj+Wlu=1xO;dRe{`4Alv!0Ud)#;cj
zLyd4P31!S)qOKisHQL34J8pCC%C0NuJmy$6b!#_|^T-uB&1}RyV^0QO;2UP)tq8(B
zlG?yd&nKU9x*l<!2rD2t;eyy3XWKJUh?v8%<lYtyePa|1-sAfYTV~Z-_T@31q(Lg)
z!1@+&LGNDZYHi`Y<P*-lwb&(o(@2e==`**ML93!20c$YPyIY-e1~KE|8f`94Q4Tdx
z^dP=s&)dJ1<k|LspwaV(xldImYv`&`Xb8e{=Kh~7*bO{~E*EAkq5>*3JeW?CQikOw
z(?HAr6>t(w<)w@+jQjEmd@dkP=+@MBSC?N=7u=(PXbYYhCv&%Ftkr4exVYu@hfmRz
zQ?zAumV;mHLN{z0m-48TnM`!@i&u7l94cGi&`<VO_uY1OW#82xclwf|x$dAYq={G~
zZmoF+{F)8GYH;IQMu0LNdyZ_=1?6~laS;#hnzX<W_X*hD_$29+F^Q4_{`bSQF*I@>
z%^Thjhxn}@RB*1D<;K-8*rwY1Trk^_Kba_$H+4XEblzpXQ5^74UuJGJPq%Zom;>mp
zj@=ufi-Wag6RIjHObebhp|me4A6a+`{%znvh`D?!<;>NXrk7HvUW^rub>+T2+P<>v
zd|$%Vsr3;;oZ|Y?KN08Q9g}zQ`<RI6hA*}6AWkg|Ncn3#(BY*2cSg5(4c6xhyg?%&
z({~@^vdyo;b7vpHvV@j+BNU*0f^PLGdMUl-A$8Z}?tJQZ*~4HRuzmhX+R5vgeg9_M
zxxlQ{X+6#*{qvW-4r`Be1$k(<J(6sfi=NvPZ+nzF4ng}>`WJHJtyxeXb;T!uO=yau
zZq1<(9en~+2xL;h1B~OgWMqbD(qWp<a?CWTb%$+-ahqKj6AJ=EeR{o2OTt4MfHG%P
zdX!qPSWI@6wH9%`;S`c|!psc*RElfvy5I1)d`_?1@A$la&+q&HfPZQ_Vqr*y4kcG$
zF^mfUO<@%%l1Yv^mtzKsZI_-(NT4y1Cm5s;6b)*phy$c-kEw(Vi-crLXIBYT13D2b
zA1Q9Cm{4UczPT~HT8+wY&#uE%bH>tL))3jD$EbAC95*ZAf#v4s=;`X~?CtLF@LN7A
zgu-E`B4({4&87W`QcelLcTEJjDQY$hJk+X}H4*_JrIC`thL8~fB9^F^j2Rpw7GK19
zk$}g913Xw*%yDoF1AC45xgpr5r5BoAGU+K&P{tXYU2M+r6|bn#qezn~UCOknQ!HON
z?#P&m15YX%1R|lC2_OEaL=q)P9UGFCi)DNUu4rg<&>Erg&K6uq4@VkE?;2Fx7}kZy
zojTi0TPG?m+MsyE!F|fOvE#>(BTJrqbka*-n8|7$JBXOS#ZBFQZCdY%vcFz7J)x06
zrUp<y+Uk%KVG@zEX;P`hXsifmb_<PC<*Vp7<>SbcD__pMx%21n_&#2{ve%v3dQU5S
z{W^AK6+etKWwz_GI2{zIW>l+*4<z*zN{s6cy}teX`19-E&tLK^n2oIwLTz5$5T9te
z`9;HFClCizbQp=(--HxaXyJtzW~kwYe`F;BTTZQU!zMRuW+EZ7C}bNy-i@aM2itHc
z<BT-cXyc7I=Kk20iZVrZq78B}feQ&F)?>s6yP)TkUdw=}<C9QEDdm(@R>@yq$L$b|
zBM%;f(I%pC=A=<N6=vm`Xr`&=nrybYlZ5V=2TTPfee>cY=eY%^n|$`^=bwNEDkz1s
z-~*R!R$1mkX@fTE=%bKED(R$TCQ}D_x7?x%W_wcV>8GHED(a{@BADr^LoI`ylBBlk
z>Z`EED(iil8tDxd*1$#tfxTQ7+^oO`E9|hu7VC$vbt!sK1s!ytgb4#C*`u-4R%`9G
z*uKh_cO7&Ygo>(?AuW;FmTT_0=%!m`Jp{?A*$?aG@(Xw5s%!7P_~xsxb7X}{BzP>=
zYGhXO{^sEAz6d9*@WKr5RODXM-iBKQCQW1=CJ;N=@Wvc>?D5B;a25qKkzl$gM<A!H
z^2#jV%TbFKFqr8X0@vH}%{b?*^Qd}pYA8y&sIs0|MD1+!(MTuVW<nbsdP}sMM1rEy
zR99{F)iP%0WHd;MOAkn$VlDRAWS9L8kZO5LQWBuh3z6Ay$1V5V@mPe>XxN-Ur)n5S
zO!wb_2QD}q!~sp)$l}@s_TY>+?l|MZoaWcNTFKSf<Ctfz`PHkOY-B<#`5U1JM2Efk
z>8PikZN`-J5?F1Vh=cK3U*o0v?YQTzaMNE0p(-!4xNExZ#20V8q`@z!_qU|f8T#A)
z$44*y^s-9VD-5F<ft$13-SsQ=;D;~1qoTEr0VA|)isXEFkMI8b@LNfpYx@vwyJwS>
z=wbZ)_wWCWAnDHcBsM!DROc=>`=0_A$iVzC?KOz$n*GYxzzSOMg2_pi?V4n_FDZ{D
zC3?y5Fi64@n$QmO>)ycrQ<l-_Z-gg|p$uop5bD&$7R+*6GTt*k7}D^EKs+Jna`VBO
z(JpxM38E60$i!hl<W4wojlTvFqb6GMia;EMxN!2KUEry9KE$FJ#~3~C<RfHrs)1C(
zNX9n05p`N5LdhE8yxFOcjc?4O9vL@8?<j-=n%b6C#<a&m8d7&R90w+%utENzB~Fls
zjHD!q2f8^Xp$QZtk(}^2$xeDwXCnIJ+E!DWlvIS1pG>7HKW07##D|3*j9ITjxXN1E
zGH#qXqSoX?oD$vgm%zN*z*Nzi&hT=L0}Q4zmx;6Ll%QmM(G7Y~$;@h6(^zX*O%Yd8
zKEGY_o8Vj+=v=o!O&-CR<qW4f*NLyrE$9fbdtr$V#?E@$Q&_W@T+K+~HhSLkp8)0A
zMo_UWdMH4Dz6_{B7h1h1(uWw?tC=?$O3{i&sx!p&z%dDyhLc$Iqac0M3u#8haD+0X
zC{1af)Zm3u=5RJDjj2qnBn)W+V=hmeLD6Q))1CqlmWAkE-!|e;pZ*&4sP@qyh%)*z
zY9jTiP?ZgAi1`|5+KyFG&8k-GvjgRglbkvv<W|Q@R>sW7GmmhWEy~K)wo1k=8ik!b
zoa)xP+Lbo!I*%;uR>iye^{?j;T@rcJ%k}~Gu!y}5z{)bz3;beJN2F_FCyUg=1}}xY
zfglLGO4-hO)(NNdl?(Qou~=d>ou5rDWdn#%v-kt7cJZ8HRZCmI_AF1X3sM+(DKPWZ
z_P2>;tZ78CD)mtixX4AUTJbUj?M+oTmrJg6Z9ByYHYlU6lk9Z2ThBhiD<m2fVEVXA
zUbgB9JR-E2Wwlq{_HGrk143WKTBnw^xc9zU<!x)oz}Z@v{?xbl4e(6$)F70J%cM;c
zu!3XS!>g{~mGi_6Bk8l?3WJnWyu+Ktu%pSoTKL23WG#AG$`FlEY*k_fv5Ko{peBLi
zNcHO7if3F;-exms8jK^2cWlqFX_v=94ziGkOynXP`N&94vXYm~<R&}$$xx26l&4JP
zDqH!=SkAJRx6I`(d-=;?4zrlYOy)A1`OIie^JLAW<~Cn2Fm8@>|042ZIosK4F=FqX
z_k6sUSR%!I4zzv-;$cAn>3p*lw4w)no+Mt>zG<E4q9>iy4%+ZhwOda@Db4BpTsF~w
zV%nuUO=?<^3pIlZ;E_tr>ZHOLRJ8+jtCu{GojwWv#&9Mdr)C{xbOIPh0_0haF;r(>
zi}661g;HGv+RF=d)Y$(7YOXo-Rag^vKd2QdwC#C70R8mWlo|({@sk3oBx~FEWba*c
zM6Y7YXv7sdQnk^|P8;ekN09uKycO9W_EDJL>0YCa&K;`L0-8Dg0=PoE2Wc7|T2vjJ
zc75#aZiQbFmNOc!s2=F-rb*i3>Xgs5H3YDV6C0x+>^I6m4$!ZSoY)nC^~)@TPL?Ya
z#*53)3k#l4M%#r^Hea~g44R>NQz}mf&yo(u9dv-6Qg%i6cDNb7pD^92=@eZF)M*Zq
zjpNqSW5N1I!K0C_Pbj)FhlQyZD|N9ibfo^;?stM8@dl!r{4q#(AnTIu_Hg1l=W>5J
zG*A$)=b-u{K%e+qMA&yb`DFqfodA4>1KqpduECmBd3F>Fu|mh=hRDoA;uXIa%iDPZ
zE5vZWN(+&~&v3*aclAN{a9*>2{(=8eP+CN5cs!l5@hxRLcxB7_)FZT)gg5u$`Nw;?
zA5`LVIBik+K<D8*6+5QCj(*$T_gXhKHRM!vH$NBg<8#FG)QdI0*G@}w$Q%8%Uo|{}
zBWuW{5Zq$-e$Sb{jIs;1{JWHT59Dv*k$p!4cLulzqZe2sVhS%K5s+s&T!Vk@P#y_L
z8{(#C`PXh%&<cdMc+XaH*`x%l2mX3bXM)FvSr@1>)pZ|=!FPBdV;!|ocVr&mffCSl
zAkdc%9JU<D2ZQnBO7LM3m3JZrCvp+8g5PE_p@4eeB@)AM5FTfKxCb^5M|{<hJ0j+S
z&+=gEP+z4tCue|!8Rl_nwS46OI~wR17g2gjXf?SpexcPJOBYrT7(#gH7Ov+i$7KP-
zr(2)5Tb5ONivW7?2RMthH_fp_4A_7L<S@>_W@sn~@&<(N&?69*K=9*AcldOU_Anr5
zLnatkqTy91lMrvHc;$mEi4l8&06|vhh=oX1dvS<ngM_n(aOh=;b=N)=NP82-e>^B-
z)6qhch&z(kLd|72%QY=a{wI7|qbF3@gsee3$A~7?r&-*Dh6-U~nss#^AbGY36$PVl
zXix?l<ywMsZ_u%H=Map%=mv=<jOf5VJ|Y#<qkmzTa<ElUdIDialwFFVQ>`T(9s!OF
z5le2eR|}9JK~Zb4lNL;n3RKYtO*1qEL=A~T9pi{JbO;3TST{3Q4okIzbucE^7=L{j
z8e-vcCdo%dSQfleLsmCZ964%NKxd$5bSwc4+&3izhmdF>fB(P@h(QtP!-V{(ky@~M
zy%-X~hD*4YK_c>!C#eqvQx&@h4pzC9M7Jc0^Lwh3jLEV-|ArM%X=@;)jt}_^*wcQ3
zVF?|nbLK}#sHhA6P+=J7h?cj<Ha5tXRr4Ro!EjwU6kq@g;ud4xlN%WMJ2u#uMOlG>
zw<J@kIZn7-+P89m6dLG-5-6#APtsaS$u=g5hR`={%kl&n;RntVfvD1f8#R|5BWlRO
zc7T}&GuSqtXe*e|5)hMt|7I42sesJ56jjhcn1fkAiGim^O+TTPy8@Y5325}FAt$8?
z-nSTpR~`;I7)*I7sCPKuB9us39{MAl%@lJWFr4gAl_A-Xd5B$9MM0L8mk)zLotH=z
zksh}he__a;f}lcI_&0?1N`EIFL&JEAl^)Ca4ZE@|{h3xjrJfVymcHRV-gy<^hno_#
z6NOeL=OzA|`C=*L*%UfSl;2>GH<bnd@gkh?N0M+%msSNdBU@|e9>>R-VktMuHxU{r
z6d#y*k%<OEN*T$=iF62{T!nU4kz2vX22d!TIZz;I^=FD@2VyXq<Vc1DqcV&4p7jWo
z+8326$2EwSg$C3<$+IVC6-N4XcaFeYaN|88w0<99Vi{?a4cUPb2^^1<VGakCo8k-<
zag0@@3<DZ2OE9DxN{%h@3?dg4!(?u=$&9I}H$7AbCn_<cL^`$L2y*oTHx`!{(+o88
zOnqQ)^%q$4GE0{lE0C9Pg9nk=^_1qQr!_$iI~busARiS;1%LUffdE&ba|r#%J<D<l
zuKua0cu9?U+8%W0c;cz0z)BV(N-f9-7A}&A;;|QCf+`XMdmK19(U*(Wh$+A5lVo_K
z75Eme*fQA}c}40H#Ze7s`H;-|5gZDP)me4twl!J7B0X@ZZrKgEDsfICa_0o5kB3?m
z@qF+%MOuO|0{U|aIDjd6KAyuji(0PNC6k|sn`0mZc6tY5U`BEBAv_7M{#RO$nqGF`
ze{ui?Vs&`0`mPSdalo3aW>KO5!Kg6-eHjb14oa;cfJXH<FU&Yi_9CxniWIv98pM@9
zuep@=>3eEPdx%p?Q#gHbNgZ)=m>!oi@p^w&I|{P!tZg~3gGaQ90I4}KJVHqx{z|GG
zydy8y_yu}NXHi&~fTpabv!c)nT9Nv-g0-6HqJ};@f1daoio^>V>Yyt7hw4Cw?qZQ$
z7bpIPvk0SUm={}6fi~dTuZ5}$xyGh0@ewK_tiXYyrSPa2sD=-kO#FDNZ+UR%q_2(o
zc%X5&>~Rc#H&3ivBVdrIM^TU`IZ{0MA)HI9Bhiz+*}S7Llh;GKfUqrfYc2YiNHSBc
zyjXUj%cA6%hN&5y%^Hq;N|&woyI^6oa9cXvyO%9BzVgVcY~!|<WE|E5e*ed?B86gy
z38&c_eJ_VcSI4fByO*P6OxF=!(hHu<i@@#Ve=8?BrU0E&dcG*JxYAnwwN^_GAbbb5
zxKtbrc3`WzPl{@j_+o5Jz@Wjm8jJ;_bCkQHiA^~K>&m{f(p-socc?gbs_U(b3PXjl
zhT?&@e8VexQFcJgp|;0^`IavRN`)`0PbvD1fIw2mIffwYzx#@vHasEwyOiR%e4R-R
zLTj@z*uZ)@5|uZ2#X(YFA#KBpZ2`P#w@0Ty2z6c*zcH9mCF^4c^$S(ILl11a1GNqY
zmbe948i}c{eXP1A?8hmb8Xkp0#)+$SY?1TC7H1qZgaaoq=t?Y_D=^xgs~WVeXTzL=
zP7o+iFNFwRoD<126uJ9OgNvo#ILkwdJ=Y_Kve>pqTf@98OZNU_yv72C_V~d!A&O_~
zmknVP(wnZ)%Er4pu&Ft;QHmiu+LDk}ySI819$c!x>a2zkg%awW=VLmEE5p4ys&kw}
zqKJx{?1N&fj@GMy1bD>(Ll}M*ep!6Z%mR2Ty9H_Vd_xNjRwZuLvKuCHC}SJDS6hfq
zM9t59ESG|-y1OAIC!u<40X?hEAb>!oJHPk~w07CTyK=vHl~ZmzvA%;bLj{0X(kRZj
zi$BK1FeL|xd@+b}(IY|6z9_PXkv~GkS_#}Mb6k(!h|I8}OCf6~799{Ue9~wMySY5G
zRjRg*ikroJb~{bDo?FhpgO^<#Mm9^r72TvoiwZ`|LH;}aQl#~tC{oXCn3U@V94UxG
zP}iE~%9<;*%^963fP2TEY_i9B$hsg9mIkZa`*l_wj@tZqS82)pY9^?3*-W9>`q7{n
zJkEnmqp2GN!|{>msno(;Ao3g3!%CgYm6*jztio4ceuCK~_N^qjv?j|PFkHM@9JSdS
zeS;-Hsm#AK!`ZO80Sl;ahK!FI9Wvp{ux8q^2AkE;kiOSk6cNF0QO(v9UEP+TXVhEN
zalFEoXTeS!!s9uJmcdb{mP>0=2pTuZnW><cf*FL35FBe0wX#Voi@L9gU3+b^)r{Mz
z3JD_#DdM=UP34;d8^#9hT=`1F8%$_pI6BnK{@>62yh)*UIU<9Gh2F-x&eok1I0lSF
zjd;l`wOks2i*lycn$Q>0BmE7Ct(~<zjYK`jEc>k~oa*DVV}oVF;T?LI@ATNCECkOd
zU%4H{ffB1_*)I|tG$}R-uD8Op%%<g=7ew5Z_FE%NO5#ldn>rcLeT(Ik9G$J#8&xgR
zGl3|yo#R?#U4xWfm55N?Nh3np#KTI@Y$}?nR;oCF!+i5|V1iyUI}agV;`z-QLZz_o
z$kQ<XFA(mrp}j~erPJa?blLNzCYd1o?b#;n&h2VeGR~r3?Q@Ks33#k3!A;h<f_Rw+
zk)G<jnEKX;O^w}M(&C4o%b2AK>*{s>DG{3*Z^~*jr%t8Qa@%sAq%e!xttu_sEf*;3
z)Nd+@hA}Vn^<P7!zuWQNl`h=1nq6s9piK=%DP%xJZ4iz*-m_@mX%60-J)S03j)K6d
zuRh~R7@^)&U*jI{9E+)aPTk~d<-ijMrTOLIeV<756(!uiRk<6<-WUk!TW;FjxLzPX
z0=mHC;r&?Yf_2^0j$q)5U@r-(ETHL6d*Cub-$kc<nF#3lL=?h^eZ+)O+9~gh{<Gg1
zSY_T1W-QeTI1G6n-^EQ%HVy-hHCrz4V@|`W1<lfkcboVJjluvEBX)z0;Jk%J50vU0
zcOqBqe7!#z&V|@iV(Dmv?9=|5#GCq{ex&<Y+p_~%>U)df3G@Prjrh$2mk|S;ruu12
zKv13f_&ImVM!89vFS=nJwO6*$$cRv~)c}cUXb`Ec?^~l|)vc@7*d@!#L3Vw3!^sF7
zg`x6p8R`~!%n<IC5NQr#jaf1>0D{&k4ZV_zhwgb=T+lVKxZI#vS}uWe>X{@<4uqmg
zgGcX^OHJ++k~Tq_f>lmpVS*<y;;umIf$W(T%Eub%Y(NT63<R>(X&$a3ZVLSEwOBFb
zYZA^=i)shG2o+5dw`}7z5a%eA*$?K+BcZInBi~f|;smfk0L9uL#=)dvbSjNh2m-6b
zkt`kL0ny<zT}cIkD*kaoSV=Ty-{NhN0djx|UNNI98ZngH;pYPhFALSw1fVIaxz`s0
z3V3x-@EQGTf&?F{6pJ=5hQd|K2yUCxlh37wB<@75Z-T~ff)DX7(LztbQF4-!vTW+A
zWUohSgbgO_uqtuTAn0q+CAGw=RIO9cXNT=+$f-_b)dm(d(v%kHudUKhrD3XvSi~!r
zf;YD3GDntEmd(dP$rs9WXh%`|!h%B^r5so90T$M1TNx)x_uZ0hZ1znn^X1udcRB~q
zi5b~UT$^NX5x)ouO-)+mYF@-j#w1p>NUU9+3cNxzk}xJjn++2G2#OO@-o=F-Qa13Y
z>Bo~Ywno}<{$g)K$z?4eFnnZ(NQV|GBe>!+&Y~EfLe50-_7tFmNH?5e;1w<3xoS|k
zo<hS>+&B$HPtf^Bw$G-FWl~_fsH5%Jw0lq%L&y_Gsssazq5bmG?=gsh2^T)#_5oi|
zBHS<wvlMTrVj6#Z@Zf=JWH8U#3|(djiJhX}KB>F4hN`<)s1)JLskv`lAVeLHPT`2w
zz8@nv0@X^(DOcdIcL4$@gAVbg&Yl`B+8HOgS%(KJU(SJVOdBvUZE+FZ`g4<p>wU_7
zHfi|0gPpfW%OwV@jqGnrt?m8Y!yC1oMAodasPQzRCN;<CD+G@j=p!zl?ONj`EM+{p
z2EDibWN=V0g8XWyKFR7kqCyNk#Lb_O&>@S9f0l|!sT4DEP`xv7V(W?+0BlD!O)T-u
zy@D3OOt9fh%Wn--4m9$}9+k8(G#W@dMwK~u0xXLd%Nno=a9T`@%3RU_4n;2!@GQvy
zJ+V=`oalM1$%{J3<vu2v!BLu^JZPjGE1Pmju5M}~>#FAF>FggIm(WldVDwbv5Pvk_
zF|jgr{6)#~D8MWTEFR4=oh3)?BPvftB`+u^yKE_tv{>uVN4C;XY^7H8c_l=Njx-cf
z61wzc%*z%%!3jr8`?8i~P^^{D_ZpNc4<^i+hQe^(iWN^HenoI0J(U9J8Z3fsbkP19
zCB+upY~b?;H@#N<0-;t$Z3?6${u0rWIN!Zj*+=7zaHk_zWEDzM1_XFC&En10QerVH
zPZA~;Ni~~YkwRnNAos|%q9HJDX0$l3wE?dAR4R?V{ysg-H&_$p3_zPccG8R+|E1wh
zaxNLy5q4f4#5llSoQ4!kUXDPgatUs4SY@lw6C|(jeY&tVN4U%0hT8J)<Cb00WoBR>
z60lSJD&SGSP@m(O!R3-B($F`*yszc1d#T!#jf1Ah=nv%{$Ht0I12;N}NyMWkTjaq6
zQ(5zV>yI2Kg81a^zWr<HqAnXl9aS_hh}?BIM=}wop&s42zH>SFXp}Qtoc`m-`Ou~1
z&R!pMWSLeLypr00^fHY*fME%1F$@Z0(fIOmyqKVpBYC+Jg;1H2X!w*OW0|Z#=$I92
zOfE1PPDAGD@D`p_ZKDbnq}9D`RqkQ+&!n65_z83M!2=<`M3AB%v*g%tEr(nV%Ss*p
zEHD&^0B|z0BU}K{Hx0WL2V~w$7Dlv2Jcpd<Clr!k$BeQ)9b{(`h>6ErGV_#&v@2u;
zY=!}mH8@Ji0d*9kiVM1y8!q*Ogq54udU*2?E65Lsqrx8zeKs?zG!K2O^B+v21U4Lo
z%|~JI03?v}Cn);pLTA`pgcQg*D$I%)n=%z~Q1~`}u_i@tn^Ax0{<O2Wh-4OevC)2T
zw<p9YPGIY)qe;LRMO$GCXS~^nd+g^kA!aIwi9BQ$d&nyos7!qiB;E&yr9+Sf>~no!
zA*aYEi9XHkKXMSu?y4s=KqLt<27q4g;D?tHTE|Ls>SQ;BmITwy!yVlE2@b57Lk>Xc
zS7W+Xjdod(7+%nlPb2~6BBGFC#3Gpka-Slp`JP*<aw@uF2cj~EB_q*`PgVH}GznR#
zXyRaeqNJU8#6YC=RB#KN3?b0|XSL(WA~y4UO+v0#2Jr0B1h8rw4^FqRJ%+LYO$#Ip
z;b*3WTn-xx&5tOmxw4y_Q7ZY9<XnDOQICp>IWjor)ULAr3fuvdQL|hIKXxTM(UEgQ
zb!p}!i36QgLanCM(~=fYD$Q0p(<w}tj5<x@jrnvdIG>DOJ)m;R895E5JQ0SsCc=!s
z^)yoUXpC8~ijj@tRHFIA6Hj0_5Ab{xt>M##7keQeJ|ZxAi}B9d;A9qIq%=sf5*|vz
zYA%*Ms-tu1T`f*RCH8sioY^Y^HJk=lS{<~0w%}4t)j<>FRU<fk1t)*H(o)yG)T@1q
zWn$GZ)yF-;ruyR1H-vObp*D)DnDpyd&DFimePoDf)$Qm~*_JOE&<6HUMN9X_Oh~B8
zR>#VWaVK)G*S>>W#agVmgbGh@@~X3-YSveLp%wmoCbUq8>22tQF`+&kg%$n@ZVUAg
zvl;z@v?M$T?(miuht_VlDR^&u^V{D5!VP9ajhqr)0!@DvOAh??ZzXPeU!-xisgo4u
ze|cn3<w<Qb<E31ROb8+sX*iP;ix?anz}$jt5p}a;B?EBs8JtehwnS7Was^8i$Et^o
znqBaYQKSU@Ef8EMX)sKSi33NLpv9}RAR>6oHnI|nC2UHb+tRfu`0zl3nQ<7-9>uqN
z9H*<m>LnGs+u5cvZ7Zh=vtI5(*M=E&LwtiyDNdqW_R$bDOA1f7n%rj~O3Sw$<KA~d
zd?k_TDl#wWV~w)_y+Pa+M$gfzuP)QDeg0S)87iu2<+vpjI=-eSC8pJHtmW9@>Jl`K
z5YC+HYnQ-9Ay#=DahMq+7?AKw$9@1YkEeM60e|FFo)GStEP^~lYyz}?RyNd9nF>6a
z>vg@xgYOnFY&a2X(`SQYe;_JMto%?MuPv)&3Us5|*27bZ+MpV~_GZj_#9AV4s2n*Q
z(yVZ4HUuWNu)v%r90QtBDZDK&@t8zSv^hzra`3W?ZSYIhcHy#BX+y7QlIbuU<3aSX
zx>m|+ia%T=CNkefKE9J<+i*BwVlwXvGr1=s)s${lDR<YMDF0-oZ4vEkxp@<s#s!3x
z`3~zEF3e$RN6@e<m{Xw@`>Zd`{+LCKRJN&``LNUsGM-OgIn)#Ja|LG{?6}#rsk$z)
zGIemU9T(Nn50a8#0mpkb+(mxKkkA;({IT!0hQlT~hks<?C$!$_(gXNu6Q*UWUxOoi
zA5*iyf)n!DgY<^jt}41HP<FoBP0B9}q2HAxW>U{*<OzI0V<TGD^Zk0*S)V&Aqy9U8
zIw{vU-ns%No11dAv2!ZljF|iiVwo1a*hoJ;#+rG^wrt4#wh5~9nlVyRV0^a7Aa{_#
z8lyeG*1}XizxM7mCSJM4yCy_YEmL*eYa$42y1%FBWwZ71M=OS3Nb*niCcO?9j}#{l
zc-XUCSM+b|X6}Xva8<Vc2e1ID_9V{rT<Jl~?1KpIhgM(|icE{}hC$Zh7q|k8I>F6^
z=HiOaA!5d1dhfKL?bgn%zj_TaNTz07u02ffR@zT2a8LejFp;jnEeZ**Y~#8HkWF5Y
zz-nlzxUMIx4iIp{GU)7}Qo?;4Fr@YX2oLV7+N%fWW-P4b5#Z*`OveA5j|_TE369Xa
z#%K(+iKntpb#4#%8bic-j22oz3@Rr6rb)B7$mT39J**E0`!KEiZ7EDF6sS&>^vim-
zU;_Qf2)Sch)`B!_syx<+4{s?;Ch?SB!`c?nZwN==><I5%==+u++`Ov-Icd*~P6Ssc
zBy6G@*u;1G;YI$mZ}>n##qy(!m@e$5$pme03W3EJ(+zw4P#Aa2!zxH{)@p2g#&#47
z0Gkm>nCcU2<Mf!~3T<o@p=}UmQH9(EH<AzA`a-FY5kuN7d-&iH5eXW);CqrI1X&;|
z#%<T2!))%xo$O16`irk-h!6*?9{KTb)~xJoa2N-2x4cUrxuFRZW2E4uybN$T^hW{z
zgR*cjf#UFT(Bc@~jg%as3j6L18OFsv;>QZ-m*6X;R!S`T10B?{JFcsOQmjZa>=V=F
z4n3#GMrkh+PX+cR^oWq;`07EN%NkW-s|eC4G0wGu0oeBK!~p1U*h)(-QKE20G48C1
zrlkgDC;rz0?fb@{BWG=xX3`n0E65bf2|o^bGzIXY&_tB#eN03Z1yH}VQOPzjro?h|
z$dUn-WqsHUw;t~(0~72tXtjtd3+NJLymBEy<tufs(Rk)xy6E9(j4APe1_!P$P~{Rf
z($Z>9iJlAKNHVIRrL>w)L%v4`EpQdD1{~Z{5zBF%MrJc!XXFACsVuNzc19wRarFe#
zH!GzW;m7RwuqmvpJN9uh1kW3_2JbeiuRf*-F0vOXh>FswUbxWALgWnfP1i68_Wq?N
zUMg;;LW2zCzpO&4w$d42GaD}FGWQWVS)^gSQ4e`3nh^6Cg7G)^a~RLT9wiQ|rVk$2
z{?C>0vo&gQNbJ%fBkuER$@|!CFTl_8cFtyQ0U)l55VMSa@a&y9!Utf|D&h!PQUb<`
zjK1)aFg)hcpwgNi(gTBLeh@T0{*FIu)HY*)KB<5x`)`K^NE1&73mS6^KLYFObCLp(
z(4aCWIn$w14rf~JCsDu~m^AO6q$~<cvc|#j(yW&V)GJOQPmFUnNY5>a^KmFm^cW~X
zxNo=WNN#rKO#_PfqNI4T)JE^LM(s2~|IZLM<~Y8o*2s;z+ykrP#@R5FPALdQy@bwY
zEsiF$U})q+nWM6%6eyrVyq2IH>#FV`t_w8n0I%vGX^uZ4?tj1}Gyd?<8i`N-;RP_J
zvHr$}YhZOy%1bZt6jzT@V|*ntt8gq1h#YfINyTtU>61+pM5LT_@%~_{uC9C@bfSpu
znYdCmEVN1X!x<dKW>_s#A<+7=vz?IcS#}^hOsK2E6qW=E?I@CXXjLT)2zC_C04HQ^
z$m%P#(Llv6%eXUF`&BSOkQ{Q8W}eb93oM?D2z_ow2R&vPdoa=BQ&`y(U$mh_>jqWk
zv0bOjO8rDGwyg6ytV;}s6h(D;+HxK%h>|XV``*so0`@=MYX2ZLHutTy5;7yx<!-of
z$rhqAd5Dk})?NKoXz`RSiE27ejkb_<J!6(#lP5%3G*W^~i_&yK-LL*c%)wN~jCYc1
z=OpfTzTxl)u0Wb943!7y=*(t2Pd%&E=FCBocC+OQX&3+F)&Q!A<nlnnC^D#KZHLxx
z_fumI1S}>3V~}$i`&N~v#O)SG9wM{kz`<0{M2DQEQsH0~R;g!5!&13HHr}yYT~jRN
zMbI#{V5euGu#D~K>Q=D@)i{)Q9w^u3m1kj)ZD3dbAObvhu^Ru22>#Z0fA;{RKuDPu
z9<J@kcm?RrhZqD=$|M)qba!(UP|?i8g*FtSDmOc)^fIi}AXQdd^`&#UD&KhM_Yik%
za?}+;D0F1h*OCHJqhw)xrO4`mM@zSkAW3Oo_DCa_W&{*?|Na+%53>s4h{%2vH|+yp
z&IO6~louPAGFt8ey9q`DqD)c{7wJMUW`k=V(aRvPW481hSxfjrgD#HaQ}fk$8PRXv
z6nZlXTkgz!56-0c@qkqm<pL5N16YT5xKk*pbmw#_t=2N(BvmU5P+PT!LXL(-1$|j%
zC*xpv>#|<2l|0YlY&oF@>8ayLcP73pdxe9vXfrS*WicIMckM%fD(+}=#)<fqf8974
zN0o=?n2r(cT!|?e?b9!@OV~!UCFBNHNfgKutUyn3Q3V7()`79ERJ<&>ELaPRxkF@E
z$6TeQi$C^yWwM5$mJm2Oqk8i(AT|{p0eyotxMGG`{=6#5>X?;V+0~Hj$%r_hYKZn`
zE>1W3jIr<@WmXw)Cm5*I_R5fRDM>p$@CY*X=ZHvr#dphQB2NadyF?k=9=Cz_Cx02t
zeL=adU@0<_7oK8iB(&L;$Js_P_>wMGn_M^RoM@F8;_Pg3F>mgSs$=e$h)7K6PS9}g
zLR6==hFZLH-?DS3u1d^4tP?rXW#7z`C73exQko%XjfL3cet3XP8McD<6%Lu4Hvuy`
z%*C3cX>oYV*evat7D><T#QBZkSl<@ci!_==!yzZQ@4W&h{LDfsJHqI6w&%VW?!YWd
zrLW6i=yIZ1*wj$#1j*nQBx3P4ek^*S8O(n>8mgn3{wNP;FhIh%8kcw(I;l(R)iOm~
zt}jBfhG5w^XaLibX2|%Ypk1Z{LTo7~=ja@LD!aJqnEkVv7wZ+V>7}J7A{<$wWtO64
zWHk)~G9(0*wd;MgHHM{{vB%jsvZEzeD*a-WU&qCqQxbAxcQ5mkrSp)11NASu%uG`a
z(6nOx9u-vu1($u}Qjf3cR`MRMEX(-epb0m!_t>67O{r&TvDGxNPr4dc*Pqufmx&T%
z8ymTkTkHfU6B&cbV2c!vi3An2I6)GkeKeI1G5^%qPZ|`ZTl-^E3fWTSW3^VX?qsXZ
z%X%<sFz}%~w}>u#J7Q;Wx8-U7Qf`^z)jZJt!$Q?nKi4p0B2y-5SGfz^z}3hMM$(#n
z5ETyQ>~JimK=-Y{>re+-bj^4f?d`{u*dW!!S|em!H#Tcag>xfSo?z|z<Yhxedbeeh
zyO+2%Jq-psRbsCjuveRJBIdV8nUs6?z<(UbU1!l2cwjZFg~^m8D64&lGNxWzWLGVP
zz{m*JIvU!?HU1>C&f+ELDUq>)%h0BhOq#{*qNmR3$ccw}Bbs;RJILGo$M-_b@v4hp
zqa?NZWn-(j{or^O(Dw|HhRktM4p(teE5?PnD|FI3I}HNM`-?^RnQ2KxCA@QUqhthD
z&kJpshK+rrZfSL`xuozS9M8VpoYekHeFPPy#+RwnQ|I}}N2m=JXREmz&Kh=twrZZ`
zZ+zMp(1Wenh-5pw(K)tb6`dVm;i`ip@!VUEe55f4w>U}rIA^xWiR9ITYmIQ+)U#dN
zq0C;CcnVuGYXrQLPtekNcEPRCCa0#-<xEo;3(qB^NvIguIS{;cox1Rt3XJ)-OMKPa
z*ur<V-_;!y4LJ4wQ=H|IwYFX17v7iXZ>wFgu2NkcgjzocoX7L_Xzs^y;zb+%j(pJT
zb5XY$jH)Agixk6w?>?8_2av>o_&p%_Iwh&vBM;Q6dv30s;d5T+=O@Z89^0gZ71++1
zn)rEC`ZSMlke|zF>m$t}ApV9(4J|Qi#SM~V3#HMQ*?88bCXz7V6T5Imk7n&~V;a@z
z0c<Jh=Q7{0s1f?&#C+%9-qdrfj$El>$;9O|8tMP<CC&PPSkp48IeShFzAHDV9NnIP
zov`Medd%TBsKcdITYrbVE<ro1kr%P!TqG+tRp27@jJ{{LrX!HXI^mx5OaEPVa^`Q!
zp(XvCOP4+~l#h1BnTqSPN4n1^KjE*8@xPZ#2it5jSZ9{mauG1ZTX#Suf9dmlqN{ty
zuTQ}@+lBp%S<Tw?tKa(5ZENJ$NQ*Sj&i(Ft^mwt|y=r|$p1;_~H?tMZr%|5ozNMIb
z$F;g#Aut(AeX-xL{`(UvFyOOIUz_?DF`oeDW9o9Nh!6k;!V0H1@BV|KIFhA#qN%#F
zt^2~U%t8i4UDz!JP$vHvmqkr8G_EK;PB56Da4OEk)RD6csyNJKYpGzqV88~9xJtd_
z^#Q%!UW!kjEl%AWHDrBNu?*Q6VIeW?;TiSOh(t*FB+fuaN={N%T3%viYHo5`-n;?u
zOh`CpG(AB4Q5kj$KCT`ztz6ysgyPh=;S7NG{>Y65^@8SPVYxZ!ibd4g7<|22#S)&V
zaz?i`&^buB`0(JiijR|*o1dentFNmknl{O4XSJ0^^px_%1D)rllIC_9hD%w62ZQK=
ziNop#D>0z{o)Juw;aEh0V-AF3rx8-AGgR;egfj@+#*!vaqD-lBCCipE^qHDR?_Iwf
zXyVu;m?K{W30!Vj4Em;)9Y;il&Ge;D=Bk8^jw}_*hH0H=Qmi5^wPq=c0P+-7MYU~O
zO`}-?`Xtpw)X<x1aMr8y%O%~qcJJcNt9LKo62C|;;@V-@6kUMNXc>C3jpB=}3R#^v
zlnBE;Ivf#Ba~UyJxmn=Ri8mK?5t_7cDW!ASUEwN+`@)Vbdp7Obwr}G$xb4$poezvX
zeq6^_Lf$%y-$9J?vohdUc`cTedph;%)~{pFu6;YEA*G8cNbL~Jy@O4mHIeG;v$1<<
zJ`4VoZ1FYs`u6YR&#!+!e|}*Q_7UHB1u<qGEe*8A-V;t0l+01;UG`jm6H-{Ag%@I&
z;eNa9@t#4%ARwV`JuHNv8G3|c2y44Q7Y0&IX&9r7GtyY2jW=%M21X(lIAAKlB(xwD
z#=JtH5L^9b7FHNQL`+dWU4f&NQ&L%_l~-mMq;tY885D0PZix+eC<as2m+_r>jG8)P
z*`}Ls!WpNWD%CI&iwr=xl|!FIF=QDm=Az~<&7BpJpXRlQ=$wl(+Nh(CLi)im7(w@l
zd@fd`nTuSWM^cnFtY=t{VDe(xr;(zXs;aB9ilZ<*F5pzAOu~W(sSY4&OQxT^Q~u_T
z2i@ALu)`8ttg+NJ;|z0*1m&3!efnuDYEBS?nxGDyA?Sg}a@(!9--3&RBciai)dW|N
z(i4f*_Tyz2e=(9Rw2GSe+^be~X=hBUnDR!r{{kGaz;KT1lar?v2S-23`k7{QN4|Kf
zy|8{5tu_p5v2CJGhDdE#1A`p0$Rk^4kHKC}3IctFp@-zfWzq^<zZO{$?1PhSIbW$n
z)xzK!qd<sOT&K`Sve8E)O>#};>KP7TMQ5Y3d1NS~ad^`bX=rqW#%eRArJ_6#h|pPc
zl&-Da%Nae&E(=YbYW*`;(sR>Y_l@=Vqgb6C%@o-pBos}aErhv~=UAY+{>(CuzvP)M
zaTMq5H71-Yi<!cp<fA0ic5~kO3$A@*Pr>Alk`_1uh17$=nF}Um!OUh>Cd(wyJJ<+$
zoQ3z`P|RASP{{x_-lYr)8SJcE1={koMFBt2mVL>A%z$s4tEA`GcaBf+c^Z!MOgAYA
z-}J9aRr=wujcboo%<B;X<<k9)hfx~8VpE8Q&!aQqzTy<jm>c&*39$>?02|T>Ewy5E
zeqoN|E)^e9C=h!Rtdi(p$Gx`rs7o_@%Dy`Dk+p%~Ail{-_nH>B9N9o?O8Ls2Vj#i~
z<RLWgXu}es#E34i?KhHo&H>j4KsYRkP0VS`RS0)MA|@<}$6HPQAH3p$*0m219Esk1
zbmE=}PB4quft|xJc0?`JiA8|wPz&AnA3!Vw3%tWq0UcPa>5YLc<RVW1FW5yRMPU)4
z=m*e3p~C;1uQT?0Uk+V{2&rl6i%wBcM0Tgh^)0b!UeJoQsx}-XTHs`vRGqrw=ns7m
z@>!9Xf^a}*Ig601gIZjrZPbS*0bz2CfP_gONQr__s*DMi0^xEZr-nqXPb6Seql(fP
zK{6)eYznER^&sNGLMXwEhdGrt-1A8PQA<xG<X$Aj^G1JF>TH`@SLCuOyffM4m-XWe
z&&EZOn(Q%z8F?ZWiGVoX>~B1&3?wW2$qox%6OQ^r1q%Kv0maBTuVOv}=ArOM3*9-g
zCzcD%E$gYr`hl{HxT;+wBkCo`#pj0%4Jb+fxE}E>)L$OjpF3c9h=<ZDndm`=WKw~*
z+HEwKGMk5d`XxPcDM59lGnDDd<rd;}b3UlUU_}%XOb98&q@%b1>z?V)l6aJ)kIYvz
zm4l0bhz5$J@n0R*a*uz2!(bbn;Rj)8F|M}dq2xQ!9VK$HrzHWGk|+W+?x_vMDUxvn
zL>E|-s#QDY^O}L^(yu0CB)NuF2QQ<hD0675z9n-vkfVlG12HB>Wc7`Pm85$5rvq4y
zl%#ISMK~3<vB4!PXUj~_GDNDdgI+Zgbv^7O-TwH|lwl;9b6^{I827QL>B5&`(<E(s
zW71wwsv@I$D@IEoM%?1isz-vD<dD0Ib!9+n>w;uFeu+Ta0_%6bGYoGB%Do|Ca46@3
z>v>_C#18Eir}mU0e^GHK^Tv!9&Y2f!m0}s_8nLvEL+@3Zdbv+2YDo5rT9eku-4>d5
zQ;*XORTq}qmuQke$WU%+A?l$0ek6L9mB#H{Lt%O{q%tCk)=k!GNpSX(zLNE7CRg(Z
zf}}2@#=*=EsOnHIl(!z$Yib}_%gC4|PmdvOEcJNXj5Co~!B0gkU)d{^lerOi_q|g$
zli|c8J*~Tec|u$92`WndcTcHJXAG<M{-ScqR;CXrFOdA^OI>xWwV52%&i;~-oD^cQ
z@&mBXGQ6jMe7FRs0}?|MJCLEVxg{1IWq>Dq)GD{vZ31QM+D^PPjoxoH0=6m;<*8o}
z42meVMGPL#^Q-eP`mi^MZm2=@Y3R~aE)Csti3_Yzs5~TJwg?McT>K$VbpW>$wL&ew
zNruIE`n~xqZ}>oZwyq%wVW_)jqu~k{#gvECC@tGY?U=}Ot83GB186Z*JGKzAB(~p6
z$sk92gpWQ5x3hqn0u?=&6A6@XL^-bat|p+-R!hgd?lrHn{M>6^QEXVV^pxcpjR`kk
zynO4L;$DV7j)Q1y)(-4?^XsJka2M~irQvD+LL+mZYDRU2-Fb27oLgQ^WxBq4#tHPw
z;ueo3v_b8~#g)+0ZlusBnn*Gai-;}zeM(H85W%adP0z$7+uqHSc!MvPsJiwn3>%!d
zYS|8<;te?*U~5r^o1G>T)0D$!5umSlK<lX);vO}Nqe7LcqF?`%W8{`GlN8n5@FXw5
zeUpikTgMuH@=NZ2igjDRM``sE(I)KnoR{*393e!|;4qFux>m@>GKwaL9*#X+%+&Ze
zO0<c<rGXo)sjWf0v+I7{>j;dFVhw<GDyW6zujCdr4Z{*ELQgn@6-oBeF37i4tiHRd
zhbFWP<cUCVe)tw<s;vH|g;(Ii^%spJ6x4Su1;&Q~?gSxxgq%Q?@JZ+Ab8Xtu8_n^c
zQwS9eKta^92%PM>!itT9i}ex{b(<L#kgSZ@@#(@9T~S!w&IbM!<=xO%)sfP<U4x;5
z3ON|?r4f})(g?EMf}q@;X%+uDR!RlcxDeFT(bI8p9J(l-_T7qoB?t$$#QiywTglte
zk=v+c#u1`QQt4X=oK=Y7kql9d>dC--eE`(aNf=$k&g~A+`4D?VPp?!BGLV7`jn%@v
znOGo{|5)Gtu~yRMjn4HS_3c!tV1-}-iUyS#_t~3LG1ii(AYwrr+WF1n)Y!}<;O8)*
z3Z7k-0hl$!6aHgJMg-zp0s!C!{DFI%83Rm}av+!Js10ODO(VA0hWW@O2F!Sc)aGOq
z2<=F;aaMnUiaN|+!GR)$WfQo$jgwVY4w9dV`~?%V9!0@J9@!tJunRNkQU&SZ?<iNG
zwMY<U9XOSmA6}COqDJM6Ns!nXF(FSKwwDaHmwO0d&CEd0mBo7T3rPLUm*gT9nG<I9
zP)wLb2l0#!R$M*woP^z@tT|nXoYmN&!%@wZ7-XWb0Mlx<lvo7Bhj1E4y_Iq-q7DLr
zD6&{HdE&^;05ewPFXrDc#$1mf$ELlS5>Xx!7Rqg%6gJ9|AvF}^Ro%nrh6rkznr+wc
zNf%eS{+zD4TgyFE+^kaqty;Szm}g0zJ~ra~F=7si-%}!hP=4e~yxA_EmgcpJL^K?V
z7>9NZ02W3Y<`IG5-5`;aLEykp_59UDdcX+{hP)XF6TSvB7y}~ho*)3uSq>RMKwPuv
z7(u+CjOpUm1l<BOof-U^U-H37Fy8RMhdTzz7o}RR=~^!85I#EH1?B@gElWN~B|Qip
zNPNR#vcV~6h$$ihM^T$w(w{p18ER(8@jOw3>`+CXS5z8^OL+sQYy%NaB?GpAm=IxJ
zegvce4p`C7?HmK#1QIwl(jOAWASRrhKv$)JTe4K(b(Y=?21O^blOFDmAl8fWm0sfh
z9b2ww7{Z83tSF}{eTk>Eh6#L!Z*T;Pm?IRD14%HYF6j_dCWlwLR5wyuLbeILWl%M#
z8NIOODlC~tMCC52Km?qDIckCJNJ>Fw7Rbo}2LY%R6qdNmrD5RKj+J3RwV|<z(Mf&Q
z_V5U*L82jv4^OFwcLIoCWn07a)lVJd*o;{37#h5coH7U{SYBdAN)&K@g}9U;UBVjt
zB<WgO!za{`MlKKw3@6dK4-H%zfj$v<Ri%cyN$=ERiir@HoS|#fnr<8%YL2E8(L@sL
z5VgS*Rb|c|nT#_sm&r)wjydSSX(Yjs#tU$XD`8WIKB&WqT_j1TV(w*A$Qb_Dd}Zx;
z4_}2}u>B8l(PVHn7kU~3m|)vvM&}ZlXBAZ{L{MSwp#+uEB5*D!EIw%mBEk?j%|Fsy
z+S%QGqA509>6NaUEcz-)sw73e*(8POPJX9;E$31oCz4KMlZNF|7$7AG#y6N(?G>Rs
znaO{?m^XY!p91TmxoCuP0Xek*mxS8%0bHS7W{S$>(mjIJiJ()(TGKSgr54DJ8dr~i
zr-LFGib5ZU{HuuVr-@wAKLLT-Az&47X|Ha?I-Oar#;MAz3=J$Su0V;;(CFPr((5H<
zw)mpsbly?8)dOhFBAVu_h6l7z(&31utN!XGd=ksLPyJ+<%celgw*G7+7?5PXXmv{5
zjttJCnjGJOQ>WIK!rfQ3)tkL^N~x(|Pom)R?TWYhMO4@VSx!TuY3o06kWB@_C}5S7
z%ARk=4~#h_NCra2Zk~GnrhdRyrpBTrh9y>BtH=^#gES;@rmXycCRyT+)*&O;hEf4i
z!H0e;9xzQdz@{$pXJWk||F~h%8VSunBtoPqWcn;qNErN`TssC)s>K-l%_Qaa>_Ba8
z@j>W^RO~ELEnQeoA~Hjh4Qz0xSre%36&~ToVHd|z+TykndsUkTMjOT0oTP?ah>3|Q
z>er7jN!~Ut-#+hbqMkJ!lzvK+sve)&FpEgiAADx*y<VTt{sEBaX$k3quD6Y+|2adT
z=qe<x=WyjAFobKwbR4L5ZhuM{>vqfrVXfG<r742xBou~&p2-=yu2eEh)xM?vMlZ8I
zZF;nAcAOHbsinulpY(`XYgkN9aAa^@7A9g*BhX<1&gF#$?z3XAp)#y|rW-C!=((Jc
z|0d`6qS20m9V*_iHys#tc5IeSMAC_&ugWU#v@5FB8&XcL7?9XAipUS!FPRl4;QYdr
z?%FxlrE(bXENli<=B%_*1w6#jnO1Lb>Xb8tD-8$h;m)Sfoe%5zE??-1%~bI4A|;-P
z6%Y3?V*qD>%<lGnEdJW<+5X8R5S36WX<7Oi2pI1Ew(bz00&*0YfL=-RtKJa?hXo8q
z=T2=)6bIKZM5(JnQHSIq<{Gi%hDjj)kU8NIkZh{yUd*51$@flcv=wXv0zyKjE)LGY
zpuj2`b6u?PAWXzYSM>)Nk_uZ|N*SqUGOnR7Ta7fzPe@o~P9n(63c;i~6-80Axa11T
z`oZ?-pUtkNBlj}&#`55W(*5x!z1*FM8tBkb-c(ehgu&?JLe9kEq1@n{rWl0QG}c_@
ztL?6pJu~rbCaD$5i#JoE0ZafSQ$xk&8%*dxC$26cf6f9*+p2mUQ#f&Zys@-8Un=a!
zGSRDxa>buIFZyQhN?UZ@;@V=JF&mb12U`9sq8420HR2+_EXkgp^j4I7CNi!hGdgEu
z3X#TKg{O1aYdLYU-p-J5T^lPSs;5%5h)pp}s)zj=VHMw%P>&@%t1%;+4ewR7H^}Lo
zZe%-rW*IZESksWsnRPk>%GKfrfLXAs_Qrx1&QEMs>xQgKP9&l=FzQYya?s{0AMz}u
zC6QWJ;o{Qmjv@mibn#gznzb8aE?BU=v{KtBq984=s*Nzz<#z<EXXDHwJrCJg+SE4I
zvl?Luc5O&^9ZpH86@zGt;dUg)v~@)Tl<)xo+mu7wu`ee{Glz9#zl6LhaeY|wLQhuE
z!k_3~E*ljFbD4lz5$?#+5Vi<+I{w;UZ_g#&%4Z|UEqk7DH6OQI8^mDm+hkG3a8T-?
z2!!K0Re>0{jt$=on<mvv^^k0EvI)^JC0p|;w@1Za8vpg*GOI#on!^FEhvqJ9@^VPp
zv@=fgBU2><?Ja|UjvsY#dFS?B`4430hBb=wWIFfN(2!{Cb_(frzIJKSG37KN=jMX=
z*KjL_7onxV=ZAM`&FXlNOU*4Eod5bbbkL3iDS2YOYeS9XV@-EhR*onWaD(_aDd8C8
zmZ>4FlrWw+)Bs?s;&{<50+1(TSs&7&k_EvLx0uh`hM%{P1GB1m!pF%4iSP7yQ&@}B
z1__bU$Gz2gk~id8w&iZL{vc)GyCi~1W29H|%>c8s9<%r9mSv8mkeml_Wlv~!|F#q_
z^^kusSJrd~%on7S$<M%y?AR$K?(3g@Cx<i4n3{!(um=v9xylU_mLD_R{xy;V&PmR$
za%$n=Ex22!@EY^^3PY2ab91|SFRo~JuYaXR8z%9f?vIqMvFEa1Pe*n}Ds3~Pqvq61
zt2dFnr~cXb{Rr1zJ!F*z@&ZSC@pv;bGkX-6LjU?HG)3rNK^wIlcGl|d7RyCnqH?>R
ziu6#roEN3FpV7ZHuNO!+)dXElONb?1lpfG%z1O>LqTYuOC!TLQpn|3hAG+n$)9q$@
zOPe<-E*e@=Mg*V!^H3Igh$r-Qz$3osVEDoLx7%NLw{BOeFbJb}$njl<rgWrto%N38
zyAU^2Fe$8`c$qs5fhNY4&a%%#^GeG2E%))x&LEovICy}``(mkfQ4Ygfd+0hmJvVVd
zARJ*<Jh~FItA!<F-wa-f`^ys?8>imtGLtIaG7M2xmf|JNH#EE>W24thPFt7o&F-KE
zJ6`y?hISc70Y&x3bgME$yZ?GP6C)1wc+?AticR}^8^MynmX(UP;Da{5hls~jFxiGS
zE}8tG4}GGw{@?nbq#{tvRJH9FyLO4BWw<mM$#<;@?9K+lfP>AgB>S}rr=`1KdrSFQ
zYU@YqcrgCbJgNHy<>1uDryj|9b)H8Zx!<-eTP9au$Gas)Z})YI7yjLgKPKKjcO^x*
zON)MP{8#G#tOk9#6M!^KUB&<iPFn&{cg$25GfM)wkEF~`+BWb*EVL1oz&+(?iXhF9
zc*y7#NrWN~Te9de3@iwbr!(<gLa<JdveP=byy32td{$<-5htc-nz72knO#}i<ZxFG
zj}Zjwl|6<#qLRPBL%@|gj72^}#1=@&B9ykUpR!5KP0lc*n9LI~yTQN3HwwRoy3mRT
zl^Cf=m$y2<N4CE{Fr^yNMkm}<Enz5L163tpH_7EdOI_u{*12Ib!O^&#l`2bZ!cQo#
zCjMDK$Tpo96RCqBqcbBmRUdD!ud{5?I_Ewan=4XX%%xz20*tc+^NLNX2PZ_b8=aOk
zEW!|-L?=sN3Bm(|;xmX2)pVT3#|;pSDOHlGvT+G5AmxOtl9}tpD?7zn@>rO`qMbu$
zUZGpq$XlhJH<Km+R`kz<rJQE4cy^A&LLVkGvbmR|rbcjjhJ>rOb&6SzTeU>dz|`%N
zFIhO`=!T=~*i|3^__7I;FQPtccpZugP-|W#QLR!@Olc3Yzb|g6k>KaYS274`AsY-L
zWT$u~0(_o@xZ(*@l((&9-P+7Oj~JkmFiOY`HKsg+eY{0e#Vc@-B0IW+tMDg7{>hWB
zF#Wpohv5=&@5Y>1m{8r4malo5Pal&@U4PTdZ97f~V_aqeR_6suI}L2dmEkEXtXLnG
zXTVm!fb;^*<XIxRBxF&fx)K6J4XuO_bT2^&MpLk_0`=Jp6h!Ef@Tvf(OKhb+eEF!O
z&pec&G45CqMXu*ua}gu)8kztJ|77yWFk{Lpf=0b~sw)fi;-hJxEnuREK*y}>4Zs4U
zfrG~cZ%T_LlJJ<y9k*Wm#=OI{iwvvwf+<j-INlTQi}<`7#~!gHl0pReo|sDqJ>as>
zl2P6f>&$!{91BSbJNU22lAgp0nYOlQv7<^{98n!AmZSx+uR^QvF)efc*~^4}{=sHK
z1ucbi6)FPdY6>zlRh1#wM&NP)DDlz=s)%Ssjni`8sf3-8#LT0*r~ZM3vu)(q^^s+S
z5fwsE7S+qjJ%VF$LH`Pg(xDG&XtRTVfIAT;ffnIHPa<@sq*#|8OKvRsB=fZm6_^k*
zH!9GK@yxl@oa{VSs;f-8he)MLG~0R_7&^-uJFPWT$N(xL=N?@Z+ss~F55Nd7RVGzF
zlC1|HXD1dp+HF*8vBcU~iEWiZP0o&vj=|t2#FB9U#nxbM(KXSGOw`DbmJz}!As28i
zEe$6m-T0A)E$p$^m>2EILArE=Ic6srn2jonx4er@y3pLx-NgRb!t5QgdwB0X`mD(J
z%GLOUO-7+_ZjP2gpD8XYQehQgDaAtebhpR$VlUe+w@~(Al^DOI9*J-JCvsoErBY&@
z4C-%W&ROLGxL9(<HE%Ze*{4lsJp_F#^cY0$ip#==COk-ZUFRqSD^<bJtP{Um$(NyH
zyi`-U0#B+9fSV9vjQw=oKs~wZs&#T>GK>)ChhRJEbXaF9K6;uaD|)cy&i!m%cp)8|
zDn=WvDsV@`v3A0U0ZduZ^cGy4O$_#LHu)*+Vv+#V{Fq0ig^ht*imMWk1lTzU+QVFW
zq0FbQwkAR8CuA*ZN=*W@y8$Lp6SF%YkXW)m*WqGV#{L-`K^P?tpM_~!eS;b0tV29T
z+;4;%`V?6rfiE;wj|ujJ!{5S^mM9nlPiZ;`u4ERkgWQ8UtKlC7YowE|9W6ZTOOnG3
zxCf&-Bzp`B1o{NnDVrhcd-*%d;ZCHY$&FBj)|mx!lo5+-Xa|H5<l_kMAtKv|D`gxr
zjM}sX3<tSSU&Wiq3uzEKMQ-3ZVMLs0niex?<>X-sQyI0MwHw-u(34ZLk_{P=x-N_{
z81*q<7u0YaBRVcijQK{dcDAc0dPQuX%A)ZWIi>=-a3Zo)%#R#lmKdgBdFR^Wq~xK>
zDq0SKT9l#He1|-wk)knNe4H{3WJQQ26E!I5{$n}&C&bO=f>S<x&4sKr44KV`A~pi&
zuNZmBVPfu`)-sNbQq;>FoxocSAtVhicu)tH@JR^T$K;6BLVd{69$BI$kXq?VT7HsV
z<B-XI_y;Fx!H}HHTnjp}CXjxC4^wSipaMH~qh+p5E@jh>#$4J(ZA?U!5~ag(en-(E
zQOQN+@Ka!}@~BtdaGV^|=~9#jO>;(dGt--<-$E8Et@-H`D7>5L1ZJ{hLMT9~b7m5-
z8cmyFtO?vOV&OEAtgOaVSX9d)vrLI0vXL>T0j;Q7;~~UG>eZj|;v25o5yazptp{a@
z-t?GSp2w2XhWLb?W+tnK0GbsP`Ef}80C_eEs48w3LBZ!ud(n|{cuSiQ91%mWWm8jV
z5)VUZrc`a)zw~@gmR&1tLg16Wo<=qWJoQXub62!f8p2sdi6c*aCYY2^<4_mDX>a);
zA%Ce5y0@~X3uPoA<8g*NV>(cbB-6c9z3~D}W$aFVAc!iohfdR52e?8JoBI+~xemGl
zvXnzAuaJgv)<x(FbXLSM>V#5&Vp+7x$X*n1Q-pc2N=udbStu}guiecnp{5~8x!zX9
zB->?rMwwQ*tTjB4d&+QHx6%+|!x7DTj-}XYAm<U7nh&JuBY#SYFl8^E5UpH#wfN%N
z71YR{&}#y>`!n~l1-&nM<CFg3RFQZgkuh>IZ(mo;;cAB2x2R3ldsET7-Do(he*D4u
zhJ_Jim=?^Ujoe4L5#t@H_`{r|*?+m0w8g?zp?E9thz+eJbY^U}Df<OQ`WrcCkq%cq
zW=6+6Y$UT1l7%wG^Mi`Uo&V^Vmoq$bP|7wx6DW-#&2e<PF19kUw(3DL;*?tWhh8ZY
zm25$}4BsGIKY&&gjfATohXfHB;a2L4IT`jLqSHx!rY}Wa?(m5Xswg5ORGFMmGZ}q7
z=z_qHF!F<9h!1`4{sGYzOkIZ5lCf+WY=**0fhC9L2w!1YcNcIpk|Cv8>xeb^Jfih6
zrhiIcuf`FlKrQPu*Z!5pqgX9f$NCz-Jgt=}M<g@=$AS^#Vqt2-Zfa4(rofYiLgjE3
zEzK6=OXtj2Vgty3th#Q(6kgMV7Zs^@ri3Xm_6&Zzf(***hR@M`bcT(KJmGy!zigy5
z!Sxn&l7vQtkkZ=-%|<iD;qN0TNf<9%Y}&Fpn<xkb@1V+7qiZI6=H@Wo+}HqgQ@Qzs
zA)6;sSA=HSLI*e;M_37>`nWF@HCK?N@@m8UwRy-Kn!8!#5)RA)UzfQwH%v#7<Xusg
z#Vu-22ri4*F@iAAC9IKt`ly1q%V9XB!0P$51Tn2C&n?BT$hV@CR<ftpuDs<J9#|R6
zSsT}Z*VT97{x6uUR+M!`>c@Y#H;hwJ^Il_UqUiJDCAzCuuafp~k-Ra+OT*F*%Xb+`
zle?l|Ufuv6ivBJqNs%y($48$38ue&r`Dx_3z>Z06QUCvQi!xd3J#A4G>6xrDdzkUd
zCgUj!e|k7s$t#YbJl+`=L|VHagAT4bow~xdM%%WMYdD-Um6}+c^f)TPs+xt-0TdLI
z<G~>qWRnbhE*xsP%?Kv76Q;$xqdYq+3=FphVjyOLvBHy}$6zq0f+!421yzY5`0%n3
zA(ptPK>(~m)O(wq@B<T^s2=%>p+T@1_`(I`J>S@!-rBMqv_GK&5i&tC3QRmq8iKPU
z9bg&$uDYAPCQ~)L1G;UYKT>PIfn&0`6TL*^lip|vs`ChT2r{&Bq?idKrlA;WqcW`N
zzOeg2HX1`oBtzLit|crJk$|fD<1`SQF}XsDuZl0+;{+)j7dW&+ShT{nP(423klH9g
zLPDgnn-escM26!E>uMR}aJ-kRG$G_RvAc@(c@%#sLD_S=eKNUflfDKTA5);aLc9po
zJFJVsm$_J_U%Dn=>O%ztz2CD#Pin22po@d~3dC!z3d_L4Ne)aXqNFe!n$Q_zGC(m4
zM3>7D-aCa+{29VBx>!6&gk+shh@H8Kz#e(X1_-0aN)`VDm0$3fhWfN<{GL!Kp!5D|
z!NsZt_gROnBS&g$w{`Td%%GggV6VBlL&h4uve^&BS}%GMBX=m78w(pLg2MgE2iZ#`
zN)W@$ur^omph_W1S5THy5Xavs4DBhRVq7acV!NZEnn*Ob*aOBpY@BgX!GsJ;v0OC)
zq(-hZ#<Lu=Ziz~DP%RF_4R|w2O6*0_!Z&$DE4_o1H2J{f+eC0P3O^IUAWX|0QNwX+
z!E@xtTDlr4RG|5CMSdxjLX<~+YeZ7~1qtIq@@q<a^u3?6y}@aU@H?@_*r^@+l9&oM
z$UBEg88DP`Is!5SEkqap8%x`~%}t;x2O!7kXozPM42rx8pIF5#m@)3sEB-mry(YUa
zKs?4`)T=ifPHALIQ@gZI`$bmhwi;8k$Wtzyq#f^h#c5<47Q7zoGapoR%J7f_;kvjs
z$Q!T2F~k%W>%7k5?7)6pKXg1wgUmLq`NvWsKmEi{0))<_>Z|^=he(Q^fy7M*eNbRT
zr+N`RSotX*JP-D?k>w)JfEyM28bN>9!}|=;d7G)N<Va8&3$EfAU}=`VTr!>N63sEm
z?_13RO;HnCljB)L0gVD_;e{7u$N?1310t8Qh(ZFzL&fvQGU8B+=r$V_zGzvTDFwGY
zg0Uo}p#6$7kc$Hi^QobuEw4yW2rW}H4Z>QCknH$2;M1D5GRq}p{x~{0z(EU1I<Pt-
zm5RX|(BMJK927I!sIQF-#K7>6%>uNDdr=k<O%hGJR|E)=BO>4NsIhs7Ody`goK9_H
z27?G8I~&ma1jXuXr|5#x2_e(VbW&HyOl5&m!_-p9sj9i$s2d$jma^2wGPg6`RbD-(
z9^j8Y#5()v8l<F1b|h7toV^D1rbdxNt$DYM0#Gn>!b)K&9&{Sv+cf78w7e74idiud
zqEfYh7q{WjQP9nMv_xOT%U}FY=~UIg<irn~yw^L?a#Yk;l~r--m@nl{zqBySq0m1S
ztRm9Kuaq4t=v9SX*wpKar+PZ`V5c~}q#7-qIz<R(tiOZ)fwzinQ&(U&9mLjISRQ_0
zt`c=HnH<lP{LTrw%M*GtcfpTZI@V%jD6iO5c@@=*yw*%|r;r=FqV!LnAPUc<&Ph~8
zTErjO=(ZvZ)sW58F8Ux{sz*&_SgXBSk>R;Q{G38tmL(O|Fcb{g(?s=yQC2iAqo6#A
zQMoa?P&jnLq_~CVR9eF{J+Unx?Q7Q_%sL|=x|k~u7ThIot*&cSA6JdjJnh(ez1N8W
z6HwLLp<`2U%SthsPnPRa)>Kl#)LE9n1k&@7zr|Y79o<8#L3*$kR_aqoM9D*CAH1Q{
zEFC_{V^piuzl+4j-a885Du(uSNJBlPGwQw0=+ypBLpzHSn{c?1t?fpEG%?LYi*+>7
z?|L0}wNjmvN)d(JOj*`-#aG{13V*u9&U?;^ai6)<&8j6`^<Cf7J1TGd9LxBHI!&M2
z+_wR(QPO)_v-RB(71xQZ1O~&{(jqQ0f~E|0S{tQNxZBMjXqDyd$v694@wkN+$%;#b
z8q9U8^o>G*BPDPtDl7$2O(iCwCEr%n-VhWqZon?xAYk@=VHhsc@@yrla4v(uR6lKy
zruYl1lODO`+$;T=g78j^`-{J8*77LDtO7`sm7z9tVIrB1H-QJ{{TfQG1|aB$a&w77
zvR27zI7C$0;A_-}a|R(3w={q@`>X~Xqy9m!Y)>`HTvf>>MN&Hd<K7s~V?74IMk&k6
zFkgX9-`F);#g*LzUN@8)vRb`KF=}0FG7+q^i`bG?5n`e(8{9RM;^V_H8s4kKO3VqZ
zViyHMAnsO_YSet~IW^;5@pD&&g238U&+8P<prudPD`8FGi=%>!_l4p;{$*eeW<U^9
zrE6p1d0ZwXOeTe0NU2TML)KJHJleH86L~BW$Sj-E-pzuvy8)RpTt~U7TpY&PH%;CC
z>&bj%+)#4eCU#Ue5l~8&<3j05CeB_g-W2KKP*hc>*~FI=-DhDAXn`JR_x0!9B-<cn
zBxy!07RW_l>0PQD<5V`vi}T`z{_~LV#o6@LP~ycYnNXhFjh#!4QfF!x4CToo6{w)Y
zATrvTcuwY*7UY`6V>hB_4bEVr&6VN>4D;0>cD#`mpy`1gYN9UcUoAZ^<cGTzLJ6VE
z{S6sWTZ2$r6!S3SV_Do%W>*cBQQk!5%Zny<cq-s5mRNP2!&$G^*<#f^EH|s5<}o^B
z(cCZtXqiSdXpCHi&PY>9Pr^7|(CwL`4s5|5Y;)qqBamC#qlqvCD2ei*r&!^wdgTpO
z<{xasiF8LYRAU*e)m^z#7$CR(sVrA(95eB|oRZjBLm>^N*{hsnuzRcJBk2&{T;=4j
z(Bea#6l%iWZQkx}Oqm=0sywWVMToNjXFIdEqAlPK%3<HLHxH3w&!pc+qb81?BKn$1
zIDJlLCcPRyPt~L|Xno7SwrMeA<k^;M^1aK9?y5->C%o$3AETKp({10bZ~MM))N(Ie
z&A1VD&V=@xXr0wkhDQ(f-o!B~T6XI0+SlBoQBF26Ac9$(ygfKmn=S^$`Y7ZFJ8T~w
zIXRm@fKJeR+f?Z?&6rNiCTT@q#%~sHaTm{&75XFj!7dK;?`j*is*LB(KDY(835gxv
zF&)ao-jFky@h{=1nTaxT=`VPAD+Vp_Dp^E3N+RT7X;uU!tAo~M5^C3`AJ>QlED}fh
z28+ggaWg-2H0S;!Ki-QvF0HfDg^JB_D0j!J&MJLGC!eNG<xO&o^EX-UFbq}+;1+bp
z_@**(hnC&mgk=tB81wYD=Mztf<ymPdMTCb<b4<^4O~0-1S@W9NyW!%Juq9<B8pob~
zs)xO9s?=!KSn?4YbX&#ZCp?WACXc3N4UxW;nK`iBbd;>+F`7=EeRJkbFLq-;b~RVT
zR(gOu-vQt_b!TUcZUiwFFkM;?Kp#Q8tUYHU1)Q~^CF04G-hC0vRF|WkO+XH02X%Cj
zcv!kdc6g6>d1si(z|`<rB}7a_eP6k{uEL~ccm1KFardGm@*a~0yzh3DPdHpOR)>wa
z<os}UUjFCw+lKF(n7aF#ca7h8j_>%P0!u@Ca+rpnkuryMQud0EF6%+M;i;TN9P*K@
zc0cbNf!t)WMqrQ6d7a;Rp68{MZ`>v-b9ISXe)DT9&~`*irw2`N>%*OGc=kKjUC1!<
z9yY4gVD!A~d9B}iuJ3vM*42rrlkgk^%8(F9{6w|zQOK04L>Fjl=XYd!_pYCNy03dp
zFQhC+I(wOhR5xh2n-LX_oe`sUfVX?YKYYYbe6jpKq~{}ql`kebSW&i`2`%T4udKpX
ze9hl{&hLCR&y~g>z0{3-Z`5L%ti?#s#)0QE`Sg6(e|^}G{q}XD|EtM+d2iOy1Jobp
z{xBZ=^_G3$4}RevevvV=)0<jvtY~&!I&fUQKuh?Mfy>M%e(JA&>$iIiKeYZk!33|6
z({Jzz-ihgN<yyUd^FM#|ul~?CCs@E9C=X43IcM>B^ypXB^uK@n&wtHlaJFCjZ_Hc*
z(1bR??W~5JwAzca-n{z{hT=$;=82~2%C_zc$MQ_q_KoNI&i6hofE<FBNC~m1C;-9W
z;|GmOr_`$Tip^@b+^+Wv4qqEiVo_vNlqm-110ase=k&V$j?e4&{JtOc#vo%fq2|``
zm#DbN*y#8O87VpW2l3=$Sf~_8+3EQS8Y((UT56he$OKnJm|;e-y2`e6h;(}Xi<_&v
z%iHVw8)NA(c(KF@jGU~z%-rn!jOFGgK?v9Cp~gln5y%An4IVB&PF{|i>QIe+AzPT8
zlxi+NPhW3;kH3SiYSFHdplOw{CDah4%ZD(b!i5YQg4?%k)(BMw{6#dz<eI~c96Nga
z2y)IoRo)_Y2;lAAHGyr&gnS7zrp%c%R|soz0Fj7{2Tb<-nF)fenna5lJ&IIeI-Ne(
zozav8sKH@Lt6IH^HEXVJ90UYFfU=3fuLYkHTtJed*0pTgx_w(`UjncJP?C8d?e3eQ
zP-9Vr3plXg!Gs5)8<|l^;+vM5EN+$HQsK#zD_gECY-!pzIj3^tws`(8P9=^nn?8*?
zHPSNOQnrj$mbBQ=6v<2#q&m0m-MkaB=3Jqqth1S58AL3kxANu8n<sOe7wV9H7d2#L
z{mQxa?cBS2s&$a`(+-Z0c|VUnz4|(t53w8nx#?VzPS)GMk3T<@yta#2)VKgZ?ue#e
zfd(Fkpb6z=R!mdHR8&o9d?iR>g%%zd$Y@eIXckk{0C!=CB97RdQ0YW~qAS%6p&?p{
z0Z3wuGR{~Sc*!Yvks+zTNMnya{%F;8(rmyZQ1L+*9*{~d$z)ASwHN{+@1V6~lU81d
zr9%`!sp3!4rJ*B;S&m6&nc~<cAPUvAQO1yFz6ocXzUal$2>ub=C=h6#$;oG*eu83R
zT16@m6+9E<>7q-2F3M=5ezZ3s2(tKtXqzQDifN{regWK|7!;=xo6~GcYN@71v86?<
z&^6a_UiL+cqNmPEYppN1r0Q|M2`Wr%esNQtt-=mVEC@rk#9wR2(P_(_Y}{CEw9*!9
z<4BPaVFs^wNr|kg(|!xCrVE;Aj70H~1X_kEZ5D33?q=H9U2GESUrDVhE7`mH?%QW$
z0bWWZz@6<Huc!PTjIfXWxf&c~&3?G-V>~5Ham7n++eR_|lvYTkn;C3z$RZo)-T_}h
z1~66GAQ73rBfku@g(ptT3RyYfRuO$I{}pr3KHnE!{+b;dp_Y-zdHZwHN;5YV61W9-
zshi#UMIX{jUyU_tnO(<D8q+-`FSJ>YO}1qV?ipOy|IBQ4*>1nR)=exDI+WA2AlsRk
zaPQ4GR(hrQ55qgR{9E6KACA<Ct@<}mq+agWHsX>`-VouAO9zieQ(HoL=bmr0t-xnY
zNNG1he~x<U^JKVoV}N(8tm?AQKF*1cd-YXoCX&WezO?@iJTkRhi{{a{EuOB}!7tDJ
zDUj>F*~hQ&g<bR3Ur)-`(2o{<Mkgm%GWOz+KS|i3TO^b;JJTjQ`R>2p2gk163>Cq2
z+Ez6D`tP5|8Z09UwVc@xP5djM0ohZZ-C+*?Ex-yCR}Kil2zo(cU&8>-s^+@<NpOQ4
zj6%ugvNniKYA@~Upb1Y{gHbIofS(c0ZDfVQ7|IX^Jd4UTaKf_JXa;06?4b`^x3LCw
zrh+%y)(?+}L^RZAI_;3sx}@^JBua6L>?j%{SQZhSfr&9Cq@ovnD3n9lOJf-W)*7hv
zv@fdhhwgbt6F-zAv0x;PYpkOTmo+a9m5Xj_co7fn2uS#;1x$du6xaUeyFe;Zg2R|n
z6%Um~(=Bq6j1+>`9_c0g?S+z@G~ko80U1ahY9Jcyq$$al7$Pq4b&+(_DPJi*JpBYO
z6ge4nTy#cQ>auxZ?1|}$cf(EYa+v<Xb0G9I1Aw{+2!DShrZeHzv<0!~m&DUvGoOjg
zu_0$0M|+Z9vI$Plsjnp$(d7Elm&<Uf6LANT<FlHkCl#)9o|AJ~p8BXb8_{#0h;tJF
zi>MP4UXz~$6&dGZ^G??#YoG;fXu{H05Yp-DG4OP#MXx3+A~dm0n=9o-KMJ${NCltB
z%8OV)iqe=>bb*#kmCjNMQ;`jCWn!dR0}mS0oFWW6d|`rJa5{jWa!jX0)mJT8LCej_
zv#3l37ky?~8_8%da!sx3tX>qLV?hfeXtSzUhczEMim{BgAmCTeYAbmKApo0brvbuJ
zL$u0OQw)lfx-JOAx$4zXPyP+&CD579y$beE{>oLS<TBXA5_V#a!&$>vqu9vG39_Hc
zMjDwV+02&7tYtCCJKg9}&5Bk@FXZei()Txpj&`*eLhVr@dD^IUk+rlPQEBA`i&~zK
zs<rKHf+ChAZtAc~zAY|^F#9T4aPyPKZLWoeHyp0H!wk?-t#hy29CQJ+tJfMBZ?Owr
z@ANgd*)b<S!i(PgK*xen6OCBY3*Yk`3u+1_P<-!;9(bl{VzON#e*fzo^?gl1)qF32
z56rZuj#41CL9m0l!=JL^aEA}BaBu9wQEgevx)$zmRm#&eA<+zSr}MCh0b{A8vR7C0
z;qZxH{E@@7$-6cy{^D$02ICxC<u~h1R9eQv7##~aaT6_G_ijYp{tkJ`HL;Nq69wFM
zsCBkXt};VrGt*4E7f(^NvX?nxJF3v~V@!$gcfX8gbEKj!GvgL8fkLh{%b6iMgOqg?
z)lnDEdC$Oj-eWR==iwTd&x9^V)o2kP7AYWiE&Eq53k_*`Xa=^Eg5C70OXWywx*6B8
z*KDSn97EoWOPenBGcpX2(;jt+-O{tEUmc3niqtcA64LQtjcaG@N>sT87)R5U>tHXV
zT6K#nwmy_;VJo{7$4ip2r5o5~OZyhJ5ipifB;p@Wd)wzY<ay5qYE7P*+vIixl3Zg_
z*+h)g<!-nBBn|_tnr;Hoado%7%{^v0id2N9z1+S3oe0LvYr8}9OOFALa794ZB(HUc
z2p^sBi0`4{0Nr=}{wDE^_itwjRcl1?c^8d~JT4fYj??7UlRla;*&}ax6(YRc*qMaE
z%5%BRv9PtU<~6ww_w3Doo&`VKu3kr)<G6v2bRhI@s(_x~^md-~sOx~mc?xX<3G70D
zOMUAz@MyGWag#LEoa<zdfh&Q{fi@$X<z;XC39Ol&z*Q}%R(HGIZPK1`gBYuK@4MM^
za)MU5+V6xfyx|Xz_{1xI@r-Z0;~x+C$V-0ml&`$yFOT`mYku>b@4V+f5BkuHe)Oa-
gz3CWFkNVWBe)X(xz3X2O``F8V_O!3P0Sf>CJIdc9i2wiq

literal 0
HcmV?d00001

diff --git a/usr/local/www/graph.php b/usr/local/www/graph.php
index 666f198..6a227fa 100755
--- a/usr/local/www/graph.php
+++ b/usr/local/www/graph.php
@@ -55,11 +55,7 @@ $ifnum = get_real_interface($ifnum);
 $ifname=@$_GET["ifname"]?$_GET["ifname"]:"Interface $ifnum";  //Interface name that will be showed on top right of graph
 
 /********* Other conf *******/
-if (isset($config["widgets"]["trafficgraphs"]["scale_type"]))
-	$scale_type = $config["widgets"]["trafficgraphs"]["scale_type"];
-else
-	$scale_type = "up";
-
+$scale_type="up";               //Autoscale default setup : "up" = only increase scale; "follow" = increase and decrease scale according to current graphed datas
 $nb_plot=120;                   //NB plot in graph
 if ($_GET["timeint"])
 	$time_interval = $_GET["timeint"];		//Refresh time Interval
@@ -101,7 +97,7 @@ if(file_exists("/usr/local/www/themes/{$g['theme']}/graph.php")) {
 } 
 
 /********* Graph DATA **************/
-print('<?xml version="1.0" ?>' . "\n");?>
+print('<?xml version="1.0" encoding="iso-8859-1"?>' . "\n");?>
 <svg width="100%" height="100%" viewBox="0 0 <?=$width?> <?=$height?>" preserveAspectRatio="none" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" onload="init(evt)">
   <g id="graph">
     <rect id="bg" x1="0" y1="0" width="100%" height="100%" fill="white"/>
@@ -120,8 +116,7 @@ print('<?xml version="1.0" ?>' . "\n");?>
     <text id="ifname" x="<?=$width?>" y="8" <?=$attribs['graphname']?> text-anchor="end"><?=htmlspecialchars($ifname)?></text>
     <text id="switch_unit" x="<?=$width*0.55?>" y="5" <?=$attribs['switch_unit']?>><?=gettext("Switch to bytes/s"); ?></text>
     <text id="switch_scale" x="<?=$width*0.55?>" y="11" <?=$attribs['switch_scale']?>><?=gettext("AutoScale"); ?> (<?=$scale_type?>)</text>
-    <text id="date" x="<?=$width*0.33?>" y="5" <?=$attribs['legend']?>> </text>
-    <text id="time" x="<?=$width*0.33?>" y="11" <?=$attribs['legend']?>> </text>
+    <text id="datetime" x="<?=$width*0.33?>" y="5" <?=$attribs['legend']?>> </text>
     <text id="graphlast" x="<?=$width*0.55?>" y="17" <?=$attribs['legend']?>><?=gettext("Graph shows last"); ?> <?=$time_interval*$nb_plot?> <?=gettext("seconds"); ?></text>
     <polygon id="axis_arrow_x" <?=$attribs['axis']?> points="<?=($width) . "," . ($height)?> <?=($width-2) . "," . ($height-2)?> <?=($width-2) . "," . $height?>"/>
     <text id="error" x="<?=$width*0.5?>" y="<?=$height*0.5?>"  visibility="hidden" <?=$attribs['error']?> text-anchor="middle"><?=$error_text?></text>
@@ -214,10 +209,9 @@ function fetch_data() {
 function plot_data(obj) {
   // Show datetimelegend
   var now = new Date();
-  var time = LZ(now.getHours()) + ":" + LZ(now.getMinutes()) + ":" + LZ(now.getSeconds());
-  SVGDoc.getElementById('time').firstChild.data = time;
-  var date = (now.getMonth()+1) + "/" + now.getDate() + "/" + now.getFullYear();
-  SVGDoc.getElementById('date').firstChild.data = date;
+  var datetime = (now.getMonth()+1) + "/" + now.getDate() + "/" + now.getFullYear() + ' ' + 
+    LZ(now.getHours()) + ":" + LZ(now.getMinutes()) + ":" + LZ(now.getSeconds());
+  SVGDoc.getElementById('datetime').firstChild.data = datetime;
 
   if (!obj.success)
     return handle_error();  // getURL failed to get data
diff --git a/usr/local/www/graph_cpu.php b/usr/local/www/graph_cpu.php
index 12641d2..9c6dbd7 100644
--- a/usr/local/www/graph_cpu.php
+++ b/usr/local/www/graph_cpu.php
@@ -67,7 +67,7 @@ $height=100;  // SVG internal height : do not modify
 $width=200;   // SVG internal width  : do not modify
 
 /********* Graph DATA **************/
-print('<?xml version="1.0" ?>' . "\n");?>
+print('<?xml version="1.0" encoding="iso-8859-1"?>' . "\n");?>
 <svg width="100%" height="100%" viewBox="0 0 <?=$width?> <?=$height?>" preserveAspectRatio="none" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" onload="init(evt);">
   <g id="graph">
     <rect id="bg" x1="0" y1="0" width="100%" height="100%" fill="white"/>
diff --git a/usr/local/www/guiconfig.inc b/usr/local/www/guiconfig.inc
index 6d8d082..fb50c82 100755
--- a/usr/local/www/guiconfig.inc
+++ b/usr/local/www/guiconfig.inc
@@ -240,13 +240,13 @@ function do_input_validation($postdata, $reqdfields, $reqdfieldsn, &$input_error
 	/* check for bad control characters */
 	foreach ($postdata as $pn => $pd) {
 		if (is_string($pd) && preg_match("/[\\x00-\\x08\\x0b\\x0c\\x0e-\\x1f]/", $pd)) {
-			$input_errors[] = "The field '" . $pn . "' contains invalid characters.";
+			$input_errors[] = "Nội dung '" . $pn . "' chứa các kí tự không hợp lệ.";
 		}
 	}
 
 	for ($i = 0; $i < count($reqdfields); $i++) {
 		if ($_POST[$reqdfields[$i]] == "" && $_REQUEST[$reqdfields[$i]] == "") {
-			$input_errors[] = "The field '" . $reqdfieldsn[$i] . "' is required.";
+			$input_errors[] = "Bắt buộc phải khai báo thông tin '" . $reqdfieldsn[$i] . "'.";
 		}
 	}
 }
@@ -262,7 +262,7 @@ function print_input_errors($input_errors) {
 			<img src="/themes/{$g['theme']}/images/icons/icon_error.gif" alt="errors" />
 		</td>
 		<td class="inputerrorsright errmsg">
-			<p>The following input errors were detected:</p>
+			<p>Việc nhập liệu có một số lỗi như sau:</p>
 				<ul>
 EOF;
 		foreach ($input_errors as $ierr) {
@@ -287,6 +287,17 @@ function verify_gzip_file($fname) {
 		return 1;
 }
 
+/*!
+ * @param[in]  $msg	Chuỗi thông báo sẽ hiên thị. Nếu chuỗi có chứa từ 
+ *                      "apply","save","create" mặc định sẽ hiển thị nút chấp thuận.
+ *			Trong trường hợp, sử dụng ngôn ngữ tiếng Việt, chú ý
+ *                      phải dịch thông nhất các từ khóa trên, và các câu cảnh 
+ *                      báo trong tham số này. Nếu không, nút "Apply Changes"       
+ *                      sẽ không hiện ra. 
+ *                      Nói cách khác là, trong file ngôn ngữ po, từ apply, save,
+ *                      create dịch như thế nào, thì tham số này phải chứa các
+ *                      chính xác từ đó
+ */
 function print_info_box_np($msg, $name="apply",$value="", $showapply=false) {
 	global $g, $nifty_redbox, $nifty_blackbox, $nifty_background;
 
@@ -321,7 +332,7 @@ function print_info_box_np($msg, $name="apply",$value="", $showapply=false) {
 	}
 
 	if(!$savebutton) {
-		$savebutton = "<td class=\"infoboxsave\"><input value=\"Close\" type=\"button\" onclick=\"jQuery('#redboxtable').hide();\" /></td>";
+		$savebutton = "<td class=\"infoboxsave\"><input value=\"Đóng\" type=\"button\" onclick=\"jQuery('#redboxtable').hide();\" /></td>";
 	}
 
 	echo <<<EOFnp
@@ -386,7 +397,7 @@ function print_info_box_np_undo($msg, $name="apply",$value="Apply changes", $und
 
 
 	if(!$savebutton) {
-		$savebutton = "<td class=\"infoboxsave\"><input value=\"Close\" type=\"button\" onclick=\"jQuery('#redboxtable').hide();\" /></td>";
+		$savebutton = "<td class=\"infoboxsave\"><input value=\"Đóng\" type=\"button\" onclick=\"jQuery('#redboxtable').hide();\" /></td>";
 	}
 
 	echo <<<EOFnp
@@ -432,12 +443,12 @@ function get_std_save_message($ok) {
 	global $d_sysrebootreqd_path;
 	$filter_related = false;
 	$filter_pages = array("nat", "filter");
-	$to_return = "The changes have been applied successfully.";
+	$to_return = "Các thay đổi đã được cập nhật thành công.";
 	foreach($filter_pages as $fp)
 		if(stristr($_SERVER['SCRIPT_FILENAME'], $fp))
 			$filter_related = true;
 	if($filter_related)
-		$to_return .= "<br/>You can also <a href=\"status_filter_reload.php\">monitor</a> the filter reload progress.";
+		$to_return .= "<br/>Bấm vào đây để  <a href=\"status_filter_reload.php\">xem chi tiết</a> quá trình nạp lại bộ lọc.";
 	return $to_return;
 }
 
@@ -543,37 +554,19 @@ function update_changedesc($update) {
 	$changecount++;
 }
 
-function clear_log_file($logfile = "/var/log/system.log", $restart_syslogd = true) {
+function clear_log_file($logfile = "/var/log/system.log") {
 	global $config, $g;
-	if ($restart_syslogd)
-		exec("/usr/bin/killall syslogd");
+	exec("/usr/bin/killall syslogd");
 	if(isset($config['system']['disablesyslogclog'])) {
 		unlink($logfile);
 		touch($logfile);
 	} else {
-		$log_size = isset($config['syslog']['logfilesize']) ? $config['syslog']['logfilesize'] : "511488";
 		if(isset($config['system']['usefifolog']))
-			exec("/usr/sbin/fifolog_create -s {$log_size} {$logfile}");
+			exec("/usr/sbin/fifolog_create -s 511488 {$logfile}");
 		else
-			exec("/usr/sbin/clog -i -s {$log_size} {$logfile}");
+			exec("/usr/sbin/clog -i -s 511488 {$logfile}");
 	}
-	if ($restart_syslogd)
-		system_syslogd_start();
-}
-
-function clear_all_log_files() {
-	global $g;
-	exec("/usr/bin/killall syslogd");
-
-	$log_files = array("system", "filter", "dhcpd", "vpn", "pptps", "poes", "l2tps", "openvpn", "portalauth", "ipsec", "ppp", "relayd", "wireless", "lighttpd", "ntpd", "gateways", "resolver", "routing");
-	foreach ($log_files as $lfile) {
-		clear_log_file("{$g['varlog_path']}/{$lfile}.log", false);
-	}
-
 	system_syslogd_start();
-	killbyname("dhcpd");
-	services_dhcpd_configure();
-	return;
 }
 
 function dump_clog($logfile, $tail, $withorig = true, $grepfor = "", $grepinvert = "") {
@@ -929,6 +922,7 @@ function echo_array($array,$return_me=false){
  *   null
  ******/
 function display_top_tabs(& $tab_array, $no_drop_down = false) {
+	global $HTTP_SERVER_VARS;
 	global $config;
 	global $g;
 	global $tab_array_indent;
@@ -1047,16 +1041,9 @@ function alias_info_popup($alias_id){
 		$alias_name=$config['aliases']['alias'][$alias_id];
 		$alias_objects_with_details = "<table width=\"100%\" border=\"0\" cellpadding=\"2\" cellspacing=\"0\" summary=\"alias info popup\">";
 		if ($alias_name['url']) {
-			// TODO: Change it when pf supports tables with ports
-			if ($alias_name['type'] == "urltable") {
-				exec("/sbin/pfctl -t {$alias_name['name']} -T show | wc -l", $total_entries);
-				$counter=preg_replace("/\D/","",$total_entries[0]);
-				exec("/sbin/pfctl -t {$alias_name['name']} -T show | head -10002", $alias_addresses);
-			} else {
-				$urlfn = alias_expand_urltable($alias_name['name']);
-				$alias_addresses = explode("\n", file_get_contents($urlfn));
-				$counter = count($alias_addresses);
-			}
+			exec("/sbin/pfctl -t {$alias_name['name']} -T show | wc -l", $total_entries);
+			$counter=preg_replace("/\D/","",$total_entries[0]);
+			exec("/sbin/pfctl -t {$alias_name['name']} -T show | head -10002", $alias_addresses);
 			$alias_objects_with_details .= "<tr><td colspan=\"3\" $close_title class=\"vncell\">{$alias_name['url']}</td></tr>";
 			$x=0;
 			foreach ($alias_addresses as $alias_ports_address ) {
diff --git a/usr/local/www/guiconfig.inc.orig b/usr/local/www/guiconfig.inc.orig
new file mode 100755
index 0000000..b45f827
--- /dev/null
+++ b/usr/local/www/guiconfig.inc.orig
@@ -0,0 +1,1145 @@
+<?php
+/*
+	guiconfig.inc
+	by Scott Ullrich, Copyright 2004, All rights reserved.
+	originally based on of m0n0wall (http://m0n0.ch/wall)
+
+	Copyright (C) 2003-2004 Manuel Kasper <mk@neon1.net>.
+	All rights reserved.
+
+	Redistribution and use in source and binary forms, with or without
+	modification, are permitted provided that the following conditions are met:
+
+	1. Redistributions of source code must retain the above copyright notice,
+	   this list of conditions and the following disclaimer.
+
+	2. Redistributions in binary form must reproduce the above copyright
+	   notice, this list of conditions and the following disclaimer in the
+	   documentation and/or other materials provided with the distribution.
+
+	THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES,
+	INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY
+	AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
+	AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY,
+	OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
+	SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
+	INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
+	CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
+	ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
+	POSSIBILITY OF SUCH DAMAGE.
+*/
+/*
+	pfSense_MODULE:	base
+*/
+
+/* Include authentication routines */
+/* THIS MUST BE ABOVE ALL OTHER CODE */
+if(!$nocsrf) {
+	function csrf_startup() {
+		csrf_conf('rewrite-js', '/csrf/csrf-magic.js');
+		$timeout_minutes = isset($config['system']['webgui']['session_timeout']) ?  $config['system']['webgui']['session_timeout'] : 240;
+		csrf_conf('expires', $timeout_minutes * 60);
+	}
+	require_once("csrf/csrf-magic.php");
+}
+
+/* make sure nothing is cached */
+if (!$omit_nocacheheaders) {
+	header("Expires: 0");
+	header("Last-Modified: " . gmdate("D, d M Y H:i:s") . " GMT");
+	header("Cache-Control: no-store, no-cache, must-revalidate");
+	header("Cache-Control: post-check=0, pre-check=0", false);
+	header("Pragma: no-cache");
+}
+
+Header("X-Frame-Options: SAMEORIGIN");
+require_once("authgui.inc");
+
+/* parse the configuration and include all configuration functions */
+require_once("functions.inc");
+
+/* Pull in all the gui related display classes) */
+foreach (scandir("/usr/local/www/classes/") as $file) {
+	if (substr($file, -4) == ".inc") {
+		require_once("classes/{$file}");
+	}
+}
+
+$g['theme'] = get_current_theme();
+
+/* Set the default interface language */
+if($config['system']['language'] <> "") {
+	$g['language'] = $config['system']['language'];
+} elseif ($g['language'] == "") {
+	$g['language'] = 'en_US';
+}
+
+set_language($g['language']);
+
+/* used by progress bar */
+$lastseen = "-1";
+
+$navlevelsep = ": ";	/* navigation level separator string */
+$mandfldhtml = "";		/* display this before mandatory input fields */
+$mandfldhtmlspc = "";	/* same as above, but with spacing */
+
+/* Some ajax scripts still need access to GUI */
+if(!$ignorefirmwarelock) {
+	if (is_subsystem_dirty('firmwarelock')) {
+		if (!$d_isfwfile) {
+			header("Location: system_firmware.php");
+			exit;
+		} else {
+			return;
+		}
+	}
+}
+
+$firewall_rules_dscp_types = array("af11",
+				"af12",
+				"af13",
+				"af21",
+				"af22",
+				"af23",
+				"af31",
+				"af32",
+				"af33",
+				"af41",
+				"af42",
+				"af43",
+				"EF",
+				"cs1",
+				"cs2",
+				"cs3",
+				"cs4",
+				"cs5",
+				"cs6",
+				"cs7",
+				"0x01 (reliability, ToS 0x04)",
+				"0x02 (throughput, ToS 0x08)",
+				"0x04 (lowdelay, ToS 0x10)");
+
+$auth_server_types = array(
+	'ldap' => "LDAP",
+	'radius' => "Radius");
+
+$ldap_urltypes = array(
+	'TCP - Standard' => 389,
+	'SSL - Encrypted' => 636);
+
+$ldap_scopes = array(
+	'one' => "One Level",
+	'subtree' => "Entire Subtree");
+
+$ldap_protvers = array(
+	2,
+	3);
+
+$ldap_templates = array(
+
+	'open' => array(
+				'desc' => "OpenLDAP",
+				'attr_user' => "cn",
+				'attr_group' => "cn",
+				'attr_member' => "member"),
+
+	'msad' => array(
+				'desc' => "Microsoft AD",
+				'attr_user' => "samAccountName",
+				'attr_group' => "cn",
+				'attr_member' => "memberOf"),
+
+	'edir' => array(
+				'desc' => "Novell eDirectory",
+				'attr_user' => "cn",
+				'attr_group' => "cn",
+				'attr_member' => "uniqueMember"));
+
+$radius_srvcs = array(
+	'both' => "Authentication and Accounting",
+	'auth' => "Authentication",
+	'acct' => "Accounting");
+
+$netbios_nodetypes = array(
+	'0' => "none",
+	'1' => "b-node",
+	'2' => "p-node",
+	'4' => "m-node",
+	'5' => "h-node");
+
+/* some well knows ports */
+$wkports = array(
+	5999 => "CVSup",
+	53 => "DNS",
+	21 => "FTP",
+	3000 => "HBCI",
+	80 => "HTTP",
+	443 => "HTTPS",
+	5190 => "ICQ",
+	113 => "IDENT/AUTH",
+	143 => "IMAP",
+	993 => "IMAP/S",
+	4500 => "IPsec NAT-T",
+	500 => "ISAKMP",
+	1701 => "L2TP",
+	389 => "LDAP",
+	1755 => "MMS/TCP",
+	7000 => "MMS/UDP",
+	445 => "MS DS",
+	3389 => "MS RDP",
+	1512 => "MS WINS",
+	1863 => "MSN",
+	119 => "NNTP",
+	123 => "NTP",
+	138 => "NetBIOS-DGM",
+	137 => "NetBIOS-NS",
+	139 => "NetBIOS-SSN",
+	1194 => "OpenVPN",
+	110 => "POP3",
+	995 => "POP3/S",
+	1723 => "PPTP",
+	1812 => "RADIUS",
+	1813 => "RADIUS accounting",
+	5004 => "RTP",
+	5060 => "SIP",
+	25 => "SMTP",
+	465 => "SMTP/S",
+	161 => "SNMP",
+	162 => "SNMP-Trap",
+	22 => "SSH",
+	3478 => "STUN",
+	587 => "SUBMISSION",
+	3544 => "Teredo",
+	23 => "Telnet",
+	69 => "TFTP",
+	5900 => "VNC");
+
+/* TCP flags */
+$tcpflags = array("fin", "syn", "rst", "psh", "ack", "urg", "ece", "cwr");
+
+$specialnets = array("pptp" => "PPTP clients", "pppoe" => "PPPoE clients", "l2tp" => "L2TP clients");
+
+$spiflist = get_configured_interface_with_descr(false, true);
+foreach ($spiflist as $ifgui => $ifdesc) {
+	$specialnets[$ifgui] = $ifdesc . " net";
+	$specialnets[$ifgui . 'ip'] = $ifdesc . " address";
+}
+
+$medias = array("auto" => "tự động", "100full" => "100BASE-TX song công",
+	"100half" => "100BASE-TX bán song công", "10full" => "10BASE-T song công",
+	"10half" => "10BASE-T bán song công");
+
+$wlan_modes = array("bss" => "Infrastructure (BSS)", "adhoc" => "Ad-hoc (IBSS)",
+	"hostap" => "Access Point");
+
+/* platforms that support firmware updating */
+$fwupplatforms = array('pfSense', 'net45xx', 'net48xx', 'generic-pc', 'embedded', 'wrap', 'nanobsd');
+
+function do_input_validation($postdata, $reqdfields, $reqdfieldsn, &$input_errors) {
+
+	/* check for bad control characters */
+	foreach ($postdata as $pn => $pd) {
+		if (is_string($pd) && preg_match("/[\\x00-\\x08\\x0b\\x0c\\x0e-\\x1f]/", $pd)) {
+			$input_errors[] = "Nội dung '" . $pn . "' chứa các kí tự không hợp lệ.";
+		}
+	}
+
+	for ($i = 0; $i < count($reqdfields); $i++) {
+		if ($_POST[$reqdfields[$i]] == "" && $_REQUEST[$reqdfields[$i]] == "") {
+			$input_errors[] = "Bắt buộc phải khai báo thông tin '" . $reqdfieldsn[$i] . "'.";
+		}
+	}
+}
+
+function print_input_errors($input_errors) {
+	global $g;
+
+	print <<<EOF
+	<div id="inputerrorsdiv">
+	<table border="0" cellspacing="0" cellpadding="4" width="100%" summary="input errors">
+	<tr>
+		<td class="inputerrorsleft">
+			<img src="/themes/{$g['theme']}/images/icons/icon_error.gif" alt="errors" />
+		</td>
+		<td class="inputerrorsright errmsg">
+			<p>Việc nhập liệu có một số lỗi như sau:</p>
+				<ul>
+EOF;
+		foreach ($input_errors as $ierr) {
+			echo "<li>" . htmlspecialchars($ierr) . "</li>";
+		}
+
+	print <<<EOF2
+				</ul>
+		</td></tr>
+	</table>
+	</div>
+	&nbsp;<br />
+EOF2;
+
+}
+
+function verify_gzip_file($fname) {
+	$returnvar = mwexec("/usr/bin/gzip -t " . escapeshellarg($fname));
+	if ($returnvar != 0)
+		return 0;
+	else
+		return 1;
+}
+
+/*!
+ * @param[in]  $msg	Chuỗi thông báo sẽ hiên thị. Nếu chuỗi có chứa từ 
+ *                      "apply","save","create" mặc định sẽ hiển thị nút chấp thuận.
+ *			Trong trường hợp, sử dụng ngôn ngữ tiếng Việt, chú ý
+ *                      phải dịch thông nhất các từ khóa trên, và các câu cảnh 
+ *                      báo trong tham số này. Nếu không, nút "Apply Changes"       
+ *                      sẽ không hiện ra. 
+ */
+function print_info_box_np($msg, $name="apply",$value="", $showapply=false) {
+	global $g, $nifty_redbox, $nifty_blackbox, $nifty_background;
+
+	if(empty($value)) {
+		$value = gettext("Apply changes");
+	}
+
+	// Set the Nifty background color if one is not set already (defaults to white)
+	if($nifty_background == "")
+		$nifty_background = "#FFF";
+
+	if(stristr($msg, gettext("apply")) != false || stristr($msg, gettext("save")) != false || stristr($msg, gettext("create")) != false || $showapply) {
+		$savebutton = "<td class=\"infoboxsave\">";
+		$savebutton .= "<input name=\"{$name}\" type=\"submit\" class=\"formbtn\" id=\"${name}\" value=\"{$value}\" />";
+		if($_POST['if'])
+			$savebutton .= "<input type=\"hidden\" name=\"if\" value=\"" . htmlspecialchars($_POST['if']) . "\" />";
+		$savebutton.="</td>";
+	}
+	$nifty_redbox = "#990000";
+	$nifty_blackbox = "#000000";
+
+	$themename = $g['theme'];
+
+	if(file_exists("/usr/local/www/themes/{$themename}/tabcontrols.php")) {
+		$toeval = file_get_contents("/usr/local/www/themes/{$themename}/tabcontrols.php");
+		eval($toeval);
+	}
+
+	if(file_exists("/usr/local/www/themes/{$themename}/infobox.php")) {
+		$toeval = file_get_contents("/usr/local/www/themes/{$themename}/infobox.php");
+		eval($toeval);
+	}
+
+	if(!$savebutton) {
+		$savebutton = "<td class=\"infoboxsave\"><input value=\"Đóng\" type=\"button\" onclick=\"jQuery('#redboxtable').hide();\" /></td>";
+	}
+
+	echo <<<EOFnp
+	<table class="infobox" id="redboxtable" summary="red box table">
+		<tr>
+			<td>
+				<div class="infoboxnp" id="redbox">
+					<table class="infoboxnptable2" summary="message">
+						<tr>
+							<td class="infoboxnptd">
+								&nbsp;&nbsp;&nbsp;<img class="infoboxnpimg" src="/themes/{$g['theme']}/images/icons/icon_exclam.gif" alt="exclamation" />
+							</td>
+							<td class="infoboxnptd2">
+								<b>{$msg}</b>
+							</td>
+							{$savebutton}
+						</tr>
+					</table>
+				</div>
+				<div>
+					<p>&nbsp;</p>
+				</div>
+			</td>
+		</tr>
+	</table>
+	<script type="text/javascript">
+	//<![CDATA[
+		NiftyCheck();
+		Rounded("div#redbox","all","{$nifty_background}","{$nifty_redbox}","smooth");
+		Rounded("td#blackbox","all","{$nifty_background}","{$nifty_blackbox}","smooth");
+	//]]>
+	</script>
+EOFnp;
+
+}
+
+function print_info_box_np_undo($msg, $name="apply",$value="Apply changes", $undo) {
+	global $g;
+
+	if(stristr($msg, "apply") != false || stristr($msg, "save") != false || stristr($msg, "create") != false) {
+		$savebutton = "<td class=\"infoboxsave nowrap\">";
+		$savebutton .= "<input type=\"button\" value=\"Undo\" onclick=\"document.location='{$undo}'\" />";
+		$savebutton .= "<input name=\"{$name}\" type=\"submit\" class=\"formbtn\" id=\"${name}\" value=\"{$value}\" />";
+		$savebutton .= "</td>";
+		if($_POST['if'])
+			$savebutton .= "<input type=\"hidden\" name=\"if\" value=\"" . htmlspecialchars($_POST['if']) . "\" />";
+	}
+	$nifty_redbox = "#990000";
+	$nifty_blackbox = "#000000";
+
+	$themename = $g['theme'];
+
+	if(file_exists("/usr/local/www/themes/{$themename}/tabcontrols.php")) {
+		$toeval = file_get_contents("/usr/local/www/themes/{$themename}/tabcontrols.php");
+		eval($toeval);
+	}
+
+	if(file_exists("/usr/local/www/themes/{$themename}/infobox.php")) {
+		$toeval = file_get_contents("/usr/local/www/themes/{$themename}/infobox.php");
+		eval($toeval);
+	}
+
+
+	if(!$savebutton) {
+		$savebutton = "<td class=\"infoboxsave\"><input value=\"Đóng\" type=\"button\" onclick=\"jQuery('#redboxtable').hide();\" /></td>";
+	}
+
+	echo <<<EOFnp
+	<table class="infobox" id="redboxtable" summary="red box table">
+		<tr>
+			<td>
+				<div class="infoboxnp" id="redbox">
+					<table class="infoboxnptable2" summary="message">
+						<tr>
+							<td class="infoboxnptd">
+								&nbsp;&nbsp;&nbsp;<img class="infoboxnpimg" src="/themes/{$g['theme']}/images/icons/icon_exclam.gif" alt="exclamation" />
+							</td>
+							<td class="infoboxnptd2">
+								<b>{$msg}</b>
+							</td>
+							{$savebutton}
+							{$undobutton}
+						</tr>
+					</table>
+				</div>
+				<div>
+					<p>&nbsp;</p>
+				</div>
+			</td>
+		</tr>
+	</table>
+	<script type="text/javascript">
+	//<![CDATA[
+		NiftyCheck();
+		Rounded("div#redbox","all","#FFF","{$nifty_redbox}","smooth");
+		Rounded("td#blackbox","all","#FFF","{$nifty_blackbox}","smooth");
+	//]]>
+	</script>
+EOFnp;
+
+}
+
+function print_info_box($msg) {
+	print_info_box_np($msg);
+}
+
+function get_std_save_message($ok) {
+	global $d_sysrebootreqd_path;
+	$filter_related = false;
+	$filter_pages = array("nat", "filter");
+	$to_return = "Các thay đổi đã được cập nhật thành công.";
+	foreach($filter_pages as $fp)
+		if(stristr($_SERVER['SCRIPT_FILENAME'], $fp))
+			$filter_related = true;
+	if($filter_related)
+		$to_return .= "<br/>Bấm vào đây để  <a href=\"status_filter_reload.php\">xem chi tiết</a> quá trình nạp lại bộ lọc.";
+	return $to_return;
+}
+
+function pprint_address($adr) {
+	global $specialnets;
+
+	if (isset($adr['any'])) {
+		$padr = "*";
+	} else if ($adr['network']) {
+		$padr = $specialnets[$adr['network']];
+	} else {
+		$padr = $adr['address'];
+	}
+
+	if (isset($adr['not']))
+		$padr = "! " . $padr;
+
+	return $padr;
+}
+
+function pprint_port($port) {
+	global $wkports;
+
+	$pport = "";
+
+	if (!$port)
+		return "*";
+	else {
+		$srcport = explode("-", $port);
+		if ((!$srcport[1]) || ($srcport[0] == $srcport[1])) {
+			$pport = $srcport[0];
+			if ($wkports[$srcport[0]]) {
+				$pport .= " (" . $wkports[$srcport[0]] . ")";
+			}
+		} else
+			$pport .= $srcport[0] . " - " . $srcport[1];
+	}
+
+	return $pport;
+}
+
+function firewall_check_for_advanced_options(&$item) {
+	$item_set = "";
+	if($item['max'])
+		$item_set .= "max {$item['max']} ";
+	if($item['max-src-nodes'])
+		$item_set .= "max-src-nodes {$item['max-src-nodes']} ";
+	if($item['max-src-conn'])
+		$item_set .= "max-src-conn {$item['max-src-conn']} ";
+	if($item['max-src-states'])
+		$item_set .= "max-src-states {$item['max-src-states']} ";
+	if($item['statetype'] != "keep state" && $item['statetype'] != "")
+		$item_set .= "statetype {$item['statetype']} ";
+	if($item['statetimeout'])
+		$item_set .= "statetimeout {$item['statetimeout']} ";
+	if($item['nosync'])
+		$item_set .= "nosync ";
+	if($item['max-src-conn-rate'])
+		$item_set .= "max-src-conn-rate {$item['max-src-conn-rate']} ";
+	if($item['max-src-conn-rates'])
+		$item_set .= "max-src-conn-rates {$item['max-src-conn-rates']} ";
+	if($item['gateway'])
+		$item_set .= "gateway {$item['gateway']} ";
+	if($item['dnpipe'])
+		$item_set .= "limiter {$item['dnpipe']} ";
+	if($item['pdnpipe'])
+		$item_set .= "limiter {$item['pdnpipe']} ";
+	if($item['l7container'])
+		$item_set .= "layer7 {$item['l7container']} ";
+	if($item['tag'])
+		$item_set .= "tag {$item['tag']} ";
+	if($item['tagged'])
+		$item_set .= "tagged {$item['tagged']} ";
+	if(isset($item['allowopts']))
+		$item_set .= "allowopts ";
+	if(isset($item['disablereplyto']))
+		$item_set .= "disable reply-to ";
+	if($item['tcpflags_any'] || $item['tcpflags1'] || $item['tcpflags2'])
+		$item_set .= "tcpflags set";
+
+	return $item_set;
+}
+
+function gentitle($title) {
+	global $navlevelsep;
+	if(!is_array($title))
+		return $title;
+	else
+		return join($navlevelsep, $title);
+}
+
+function genhtmltitle($title) {
+	global $config;
+	return gentitle($title);
+}
+
+/* update the changedesc and changecount(er) variables */
+function update_changedesc($update) {
+	global $changedesc;
+	global $changecount;
+
+	$changedesc .= " {$update}";
+	$changecount++;
+}
+
+function clear_log_file($logfile = "/var/log/system.log") {
+	global $config, $g;
+	exec("/usr/bin/killall syslogd");
+	if(isset($config['system']['disablesyslogclog'])) {
+		unlink($logfile);
+		touch($logfile);
+	} else {
+		if(isset($config['system']['usefifolog']))
+			exec("/usr/sbin/fifolog_create -s 511488 {$logfile}");
+		else
+			exec("/usr/sbin/clog -i -s 511488 {$logfile}");
+	}
+	system_syslogd_start();
+}
+
+function dump_clog($logfile, $tail, $withorig = true, $grepfor = "", $grepinvert = "") {
+	global $g, $config;
+	$sor = isset($config['syslog']['reverse']) ? "-r" : "";
+	$logarr = "";
+	$grepline = "  ";
+	if(is_array($grepfor))
+		foreach($grepfor as $agrep)
+			$grepline .= " | grep \"$agrep\"";
+	if(is_array($grepinvert))
+		foreach($grepinvert as $agrep)
+			$grepline .= " | grep -v \"$agrep\"";
+	if(file_exists($logfile) && filesize($logfile) == 0) {
+		$logarr = array("Log file started.");
+	} else {
+		if($config['system']['disablesyslogclog']) {
+			exec("cat {$logfile}{$grepline} | /usr/bin/tail {$sor} -n {$tail}", $logarr);
+		} else {
+			if(isset($config['system']['usefifolog']))
+				exec("/usr/sbin/fifolog_reader {$logfile}{$grepline} | /usr/bin/tail {$sor} -n {$tail}", $logarr);
+			else
+				exec("/usr/sbin/clog {$logfile}{$grepline}| grep -v \"CLOG\" | grep -v \"\033\" | /usr/bin/tail {$sor} -n {$tail}", $logarr);
+		}
+	}
+	foreach ($logarr as $logent) {
+			$logent = preg_split("/\s+/", $logent, 6);
+			echo "<tr valign=\"top\">\n";
+			if ($withorig) {
+					if(isset($config['system']['usefifolog'])) {
+						$entry_date_time = htmlspecialchars(date("F j, Y, g:i a","" . $logent[1] . ""));
+						$entry_text = htmlspecialchars($logent[5]);
+					} else {
+						$entry_date_time = htmlspecialchars(join(" ", array_slice($logent, 0, 3)));
+						$entry_text = ($logent[3] ==  $config['system']['hostname']) ? "" : $logent[3] . " ";
+						$entry_text .= htmlspecialchars($logent[4] . " " . $logent[5]);
+					}
+					echo "<td class=\"listlr nowrap\">{$entry_date_time}</td>\n";
+					echo "<td class=\"listr\">{$entry_text}</td>\n";
+
+			} else {
+					echo "<td class=\"listlr\" colspan=\"2\">" . htmlspecialchars($logent[5]) . "</td>\n";
+			}
+			echo "</tr>\n";
+	}
+}
+
+function return_clog($logfile, $tail, $withorig = true, $grepfor = "", $grepinvert = "", $grepreverse = false) {
+	global $g, $config;
+	$sor = (isset($config['syslog']['reverse']) || $grepreverse) ? "-r" : "";
+	$logarr = "";
+	$grepline = "  ";
+	if(is_array($grepfor))
+		foreach($grepfor as $agrep)
+			$grepline .= " | grep \"$agrep\"";
+	if(is_array($grepinvert))
+		foreach($grepinvert as $agrep)
+			$grepline .= " | grep -v \"$agrep\"";
+	if($config['system']['disablesyslogclog']) {
+		exec("cat {$logfile}{$grepline} | /usr/bin/tail {$sor} -n {$tail}", $logarr);
+	} else {
+		if(isset($config['system']['usefifolog'])) {
+			exec("/usr/sbin/fifolog_reader {$logfile}{$grepline} | /usr/bin/tail {$sor} -n {$tail}", $logarr);
+		} else {
+			exec("/usr/sbin/clog {$logfile}{$grepline}| grep -v \"CLOG\" | grep -v \"\033\" | /usr/bin/tail {$sor} -n {$tail}", $logarr);
+		}
+	}
+	return($logarr);
+}
+
+/* Check if variable has changed, update and log if it has
+ * returns true if var changed
+ * varname = variable name in plain text
+ * orig = original value
+ * new = new value
+ */
+function update_if_changed($varname, & $orig, $new) {
+	if (is_array($orig) && is_array($new)) {
+		$a_diff = array_diff($orig, $new);
+		foreach ($a_diff as $diff) {
+			update_changedesc("removed {$varname}: \"{$diff}\"");
+		}
+		$a_diff = array_diff($new, $orig);
+		foreach ($a_diff as $diff) {
+			update_changedesc("added {$varname}: \"{$diff}\"");
+		}
+		$orig = $new;
+		return true;
+
+	} else {
+		if ($orig != $new) {
+			update_changedesc("{$varname}: \"{$orig}\" -> \"{$new}\"");
+			$orig = $new;
+			return true;
+		}
+	}
+	return false;
+}
+
+function address_to_pconfig($adr, &$padr, &$pmask, &$pnot, &$pbeginport, &$pendport) {
+	if (isset($adr['any']))
+		$padr = "any";
+	else if ($adr['network'])
+		$padr = $adr['network'];
+	else if ($adr['address']) {
+		list($padr, $pmask) = explode("/", $adr['address']);
+		if (!$pmask) {
+			if (is_ipaddrv6($padr))
+				$pmask = 128;
+			else
+				$pmask = 32;
+		}
+	}
+
+	if (isset($adr['not']))
+		$pnot = 1;
+	else
+		$pnot = 0;
+
+	if ($adr['port']) {
+		list($pbeginport, $pendport) = explode("-", $adr['port']);
+		if (!$pendport)
+			$pendport = $pbeginport;
+	} else if (!is_alias($pbeginport) && !is_alias($pendport)) {
+		$pbeginport = "any";
+		$pendport = "any";
+	}
+}
+
+function pconfig_to_address(&$adr, $padr, $pmask, $pnot=false, $pbeginport=0, $pendport=0) {
+	$adr = array();
+
+	if ($padr == "any")
+		$adr['any'] = true;
+	else if (is_specialnet($padr))
+		$adr['network'] = $padr;
+	else {
+		$adr['address'] = $padr;
+		if (is_ipaddrv6($padr)) {
+			if ($pmask != 128)
+				$adr['address'] .= "/" . $pmask;
+		} else {
+			if ($pmask != 32)
+				$adr['address'] .= "/" . $pmask;
+		}
+	}
+
+	if ($pnot)
+		$adr['not'] = true;
+	else
+		unset($adr['not']);
+
+	if (($pbeginport != 0) && ($pbeginport != "any")) {
+		if ($pbeginport != $pendport)
+			$adr['port'] = $pbeginport . "-" . $pendport;
+		else
+			$adr['port'] = $pbeginport;
+	}
+
+	if(is_alias($pbeginport)) {
+		$adr['port'] = $pbeginport;
+	}
+}
+
+function is_specialnet($net) {
+	global $specialsrcdst;
+
+	if(!$net)
+		return false;
+	if (in_array($net, $specialsrcdst))
+		return true;
+	else
+		return false;
+}
+
+//function to create widget tabs when called
+function display_widget_tabs(& $tab_array) {
+	echo "<div id=\"tabs\">";
+	$tabscounter = 0;
+	foreach ($tab_array as $ta) {
+	$dashpos = strpos($ta[2],'-');
+	$tabname = $ta[2] . "-tab";
+	$tabclass = substr($ta[2],0,$dashpos);
+	$tabclass = $tabclass . "-class";
+		if ($ta[1] == true) {
+			$tabActive = "table-cell";
+			$tabNonActive = "none";
+		}
+		else {
+			$tabActive = "none";
+			$tabNonActive = "table-cell";
+		}
+		echo "<div id=\"{$ta[2]}-active\" class=\"{$tabclass}-tabactive\" style=\"display:{$tabActive}; background-color:#EEEEEE; color:black;\">";
+		echo "<b>&nbsp;&nbsp;&nbsp;{$ta[0]}";
+		echo "&nbsp;&nbsp;&nbsp;</b>";
+		echo "</div>";
+
+		echo "<div id=\"{$ta[2]}-deactive\" class=\"{$tabclass}-tabdeactive\" style=\"display:{$tabNonActive}; background-color:#777777; color:white; cursor: pointer;\" onclick=\"return changeTabDIV('{$ta[2]}')\">";
+		echo "<b>&nbsp;&nbsp;&nbsp;{$ta[0]}";
+		echo "&nbsp;&nbsp;&nbsp;</b>";
+		echo "</div>";
+	}
+
+	echo "<script type=\"text/javascript\">";
+	echo "\n//<![CDATA[\n";
+	echo "NiftyCheck();\n";
+	echo "Rounded(\"div.{$tabclass}-tabactive\",\"top\",\"#CCCCCC\",\"#EEEEEE\",\"smooth\");\n";
+	echo "Rounded(\"div.{$tabclass}-tabdeactive\",\"top\",\"#CCCCCC\",\"#777777\",\"smooth\");\n";
+	echo "//]]>\n";
+	echo "</script>";
+	echo "</div>";
+}
+
+
+// Return inline javascript file or CSS to minimizie
+// request count going back to server.
+function outputJavaScriptFileInline($javascript) {
+	if(file_exists($javascript)) {
+		echo "\n<script type=\"text/javascript\">\n";
+		include($javascript);
+		echo "\n</script>\n";
+	} else {
+		echo "\n\n<!-- Could not location file:  {$javascript} -->\n\n";
+	}
+}
+
+
+
+function outputCSSPrintFileInline($css) {
+	if(file_exists($css)) {
+		echo "\n<style media=\"print\" type=\"text/css\">\n";
+		include($css);
+		echo "\n</style>\n";
+	} else {
+		echo "\n\n<!-- Could not location file:  {$css} -->\n\n";
+	}
+}
+
+
+function outputCSSFileInline($css) {
+	if(file_exists($css)) {
+		echo "\n<style type=\"text/css\">\n";
+		include($css);
+		echo "\n</style>\n";
+	} else {
+		echo "\n\n<!-- Could not location file:  {$css} -->\n\n";
+	}
+}
+
+$rfc2616 = array(
+	100 => "100 Continue",
+	101 => "101 Switching Protocols",
+	200 => "200 OK",
+	201 => "201 Created",
+	202 => "202 Accepted",
+	203 => "203 Non-Authoritative Information",
+	204 => "204 No Content",
+	205 => "205 Reset Content",
+	206 => "206 Partial Content",
+	300 => "300 Multiple Choices",
+	301 => "301 Moved Permanently",
+	302 => "302 Found",
+	303 => "303 See Other",
+	304 => "304 Not Modified",
+	305 => "305 Use Proxy",
+	306 => "306 (Unused)",
+	307 => "307 Temporary Redirect",
+	400 => "400 Bad Request",
+	401 => "401 Unauthorized",
+	402 => "402 Payment Required",
+	403 => "403 Forbidden",
+	404 => "404 Not Found",
+	405 => "405 Method Not Allowed",
+	406 => "406 Not Acceptable",
+	407 => "407 Proxy Authentication Required",
+	408 => "408 Request Timeout",
+	409 => "409 Conflict",
+	410 => "410 Gone",
+	411 => "411 Length Required",
+	412 => "412 Precondition Failed",
+	413 => "413 Request Entity Too Large",
+	414 => "414 Request-URI Too Long",
+	415 => "415 Unsupported Media Type",
+	416 => "416 Requested Range Not Satisfiable",
+	417 => "417 Expectation Failed",
+	500 => "500 Internal Server Error",
+	501 => "501 Not Implemented",
+	502 => "502 Bad Gateway",
+	503 => "503 Service Unavailable",
+	504 => "504 Gateway Timeout",
+	505 => "505 HTTP Version Not Supported"
+);
+
+function is_rfc2616_code($code) {
+	global $rfc2616;
+	if (isset($rfc2616[$code]))
+		return true;
+	else
+		return false;
+}
+
+function print_rfc2616_select($tag, $current){
+	global $rfc2616;
+
+	/* Default to 200 OK if not set */
+	if ($current == "")
+		$current = 200;
+
+	echo "<select id=\"{$tag}\" name=\"{$tag}\">\n";
+	foreach($rfc2616 as $code => $message) {
+		if ($code == $current) {
+			$sel = " selected=\"selected\"";
+		} else {
+			$sel = "";
+		}
+		echo "<option value=\"{$code}\"{$sel}>{$message}</option>\n";
+	}
+}
+
+// Useful debugging function, much cleaner than print_r
+function echo_array($array,$return_me=false){
+	if(is_array($array) == false){
+		$return = "The provided variable is not an array.";
+	}else{
+		foreach($array as $name=>$value){
+			if(is_array($value)){
+				$return .= "";
+				$return .= "['<b>$name</b>'] {<div style=\"margin-left:10px;\">\n";
+				$return .= echo_array($value,true);
+				$return .= "</div>}";
+				$return .= "\n\n";
+			}else{
+				if(is_string($value)){
+					$value = "\"$value\"";
+				}
+				$return .= "['<b>$name</b>'] = $value\n\n";
+			}
+		}
+	}
+	if($return_me == true){
+		return $return;
+	}else{
+		echo "<pre>".$return."</pre>";
+	}
+}
+
+/****f* pfsense-utils/display_top_tabs
+ * NAME
+ *   display_top_tabs - display tabs with rounded edges
+ * INPUTS
+ *   $text      - array of tabs
+ * RESULT
+ *   null
+ ******/
+function display_top_tabs(& $tab_array, $no_drop_down = false) {
+	global $HTTP_SERVER_VARS;
+	global $config;
+	global $g;
+	global $tab_array_indent;
+	global $tab_array_space;
+	global $tab_array_char_limit;
+
+	/*  does the user have access to this tab?
+	 *  master user has access to everything.
+	 *  if the user does not have access, simply
+	 *  unset the tab item.
+	 */
+
+	/* empty string code */
+	if ($tab_array_indent == '') {
+		$tab_array_indent = 0;
+	}
+
+	if ($tab_array_space == '') {
+		$tab_array_space = 1;
+	}
+
+	if ($tab_array_char_limit == '') {
+		$tab_array_char_limit = 92;
+	}
+
+	foreach ($tab_array as $tab_id => $ta){
+		if(!isAllowedPage($ta[2]))
+			unset ($tab_array[$tab_id]);
+	}
+
+	$tab_active_bg   = "#EEEEEE";
+	$tab_inactive_bg = "#777777";
+	$nifty_tabs_corners = "#FFF";
+	$font_color = "white";
+
+	/* if tabcontrols.php exist for a theme, allow it to be overriden */
+	$themename = $config['theme'];
+	$filename = "/usr/local/www/themes/{$themename}/tabcontrols.php";
+	if(file_exists($filename)) {
+		$eval_code = file_get_contents($filename);
+		eval($eval_code);
+	}
+
+	$tabcharcount = 0;
+	foreach ($tab_array as $ta)
+		$tabcharcount = $tabcharcount + strlen($ta[0]);
+
+	if($no_drop_down == true) {
+		$tabcharcount = 0;
+		unset($tab_array_char_limit);
+	}
+
+	// If the character count of the tab names is > 670
+	// then show a select item dropdown menubox.
+	if($tabcharcount > $tab_array_char_limit) {
+		echo "Currently viewing: ";
+		echo "<select name=\"TabSelect\" onchange=\"tabs_will_go(this)\">\n";
+		foreach ($tab_array as $ta) {
+			if($ta[1]=="true")
+				$selected = " selected=\"selected\"";
+			else
+				$selected = "";
+			// Onclick in option will not work in some browser
+			// echo "<option onclick=\"document.location='{$ta[2]}';\"{$selected}>{$ta['0']}</option>\n";
+			echo "<option value=\"{$ta[2]}\"{$selected}>{$ta['0']}</option>\n";
+		}
+		echo "</select>\n<p>&nbsp;</p>";
+		echo "<script type=\"text/javascript\">";
+		echo "\n//<![CDATA[\n";
+		echo " function tabs_will_go(obj){ document.location = obj.value; }\n";
+		echo "//]]>\n";
+		echo "</script>";
+	}  else {
+		echo "<div class=\"newtabmenu\" style=\"margin:{$tab_array_space}px {$tab_array_indent}px; width:775px;\">\n";
+		echo "<!-- Tabbed bar code-->\n";
+		echo "<ul class=\"newtabmenu\">\n";
+		$tabscounter = 0;
+		foreach ($tab_array as $ta) {
+			if ($ta[1] == true) {
+				echo "  <li class=\"newtabmenu_active\"><a href=\"{$ta[2]}\"><span>{$ta[0]}</span></a></li>\n";
+			} else {
+				echo "  <li><a href=\"{$ta[2]}\"><span>{$ta[0]}</span></a></li>\n";
+			}
+			$tabscounter++;
+		}
+		echo "</ul>\n</div>\n";
+	}
+}
+
+function add_package_tabs($tabgroup, & $tab_array) {
+	global $config, $g;
+
+	if(!is_array($config['installedpackages']))
+		return;
+	if(!is_array($config['installedpackages']['tab']))
+		return;
+
+	foreach($config['installedpackages']['tab'] as $tab) {
+		if ($tab['group'] !== $group)
+			continue;
+		$tab_entry = array();
+		if($tab['name']) {
+			$tab_entry[] = $tab['name'];
+			$tab_entry[] = false;
+			$tab_entry[] = $tab['url'];
+			$tab_array[] = $tab_entry;
+		}
+	}
+}
+
+function alias_info_popup($alias_id){
+	global $config;
+	$maxlength = 60;
+	$close_title="title='".gettext('move mouse out this alias to hide')."'";
+	if (is_array($config['aliases']['alias'][$alias_id])){
+		$alias_name=$config['aliases']['alias'][$alias_id];
+		$alias_objects_with_details = "<table width=\"100%\" border=\"0\" cellpadding=\"2\" cellspacing=\"0\" summary=\"alias info popup\">";
+		if ($alias_name['url']) {
+			exec("/sbin/pfctl -t {$alias_name['name']} -T show | wc -l", $total_entries);
+			$counter=preg_replace("/\D/","",$total_entries[0]);
+			exec("/sbin/pfctl -t {$alias_name['name']} -T show | head -10002", $alias_addresses);
+			$alias_objects_with_details .= "<tr><td colspan=\"3\" $close_title class=\"vncell\">{$alias_name['url']}</td></tr>";
+			$x=0;
+			foreach ($alias_addresses as $alias_ports_address ) {
+				switch ($x) {
+				case 0:
+					$x++;
+					$alias_objects_with_details .= "<tr><td $close_title class=\"vncell\" width=\"33%\" style=\"background: #FFFFFF;color: #000000;\">{$alias_ports_address}</td>";
+					break;
+				case 1:
+					$x++;
+					$alias_objects_with_details .= "<td $close_title class=\"vncell\" width=\"33%\" style=\"background: #FFFFFF;color: #000000;\">{$alias_ports_address}</td>";
+					break;
+				default:
+					$x=0;
+					$alias_objects_with_details .= "<td  $close_title class=\"vncell\" width=\"33%\" style=\"background: #FFFFFF;color: #000000;\">{$alias_ports_address}</td><tr>";
+					break;
+				}
+			}
+			for ($y = $x; $y <= $x; $y++) {
+				$alias_objects_with_details .= "<td $close_title class=\"vncell\" width=\"33%\">&nbsp;</td>";
+			}
+			if ($x > 0) {
+				$alias_objects_with_details .= "</tr>";
+			}
+			if ($counter > 10002) {
+				$alias_objects_with_details .= "<tr><td colspan=\"3\"> listing only first 10k items</td><tr>";
+			}
+		}
+		else{
+			$alias_addresses = explode (" ", $alias_name['address']);
+			$alias_details = explode ("||", $alias_name['detail']);
+			$counter = 0;
+			foreach ($alias_addresses as $alias_ports_address) {
+				$alias_objects_with_details .= "<tr><td $close_title width=\"5%\" class=\"vncell\" style=\"background: #FFFFFF;color: #000000;\">{$alias_addresses[$counter]}</td>";
+				$alias_detail_default = strpos ($alias_details[$counter],"Entry added");
+				if ($alias_details[$counter] != "" && $alias_detail_default === False)
+					$alias_objects_with_details .="<td $close_title width=\"95%\" class=\"vncell\" style=\"background: #FFFFFF;color: #000000;\">{$alias_details[$counter]}</td>";
+				else
+					$alias_objects_with_details .="<td $close_title width=\"95%\" class=\"vncell\" style=\"background: #FFFFFF;color: #000000;\">&nbsp;</td>";
+				$alias_objects_with_details .= "</tr>";
+				$counter++;
+			}
+		}
+		$alias_objects_with_details .= "</table>";
+	}
+	$alias_descr_substr = $alias_name['descr'];
+	if ($strlength >= $maxlength)
+		$alias_descr_substr = substr($alias_descr_substr, 0, $maxlength) . "...";
+	$item_text = ($counter > 1 ? "items" : "item");
+	$alias_caption = "{$alias_descr_substr} - {$counter} {$item_text}<a href=\"/firewall_aliases_edit.php?id={$alias_id}\" title=\"".gettext('edit this alias')."\">&nbsp;&nbsp;edit </a>";
+	$strlength = strlen ($alias_caption);
+	print "<h1>{$alias_caption}</h1>" . $alias_objects_with_details;
+}
+
+function rule_popup($src,$srcport,$dst,$dstport){
+	global $config,$g;
+	$aliases_array = array();
+	if ($config['aliases']['alias'] <> "" and is_array($config['aliases']['alias'])) {
+		$descriptions = array ();
+		foreach ($config['aliases']['alias'] as $alias_id=>$alias_name){
+			$loading_image="<a><img src=\'/themes/{$g['theme']}/images/misc/loader.gif\' alt=\'loader\' /> " .gettext("loading...")."</a>";
+			switch ($alias_name['type']){
+			case "port":
+				$width="250";
+				break;
+			case "urltable":
+				$width="500";
+				break;
+			default:
+				$width="350";
+				break;
+			}
+			$span_begin = "<span style=\"cursor: help;\" onmouseover=\"var response_html=domTT_activate(this, event, 'id','ttalias_{$alias_id}','content','{$loading_image}', 'trail', true, 'delay', 300, 'fade', 'both', 'fadeMax', 93, 'styleClass', 'niceTitle','type','velcro','width',{$width});alias_popup('{$alias_id}','{$g['theme']}','".gettext('loading...')."');\" onmouseout=\"this.style.color = ''; domTT_mouseout(this, event);\"><u>";
+			$span_end = "</u></span>";
+			if ($alias_name['name'] == $src) {
+				$descriptions['src'] = $span_begin;
+				$descriptions['src_end'] = $span_end;
+			}
+			if ($alias_name['name'] == $srcport) {
+				$descriptions['srcport'] = $span_begin;
+				$descriptions['srcport_end'] = $span_end;
+			}
+			if ($alias_name['name'] == $dst ) {
+				$descriptions['dst'] = $span_begin;
+				$descriptions['dst_end'] = $span_end;
+			}
+			if ($alias_name['name'] == $dstport) {
+				$descriptions['dstport'] = $span_begin;
+				$descriptions['dstport_end'] = $span_end;
+			}
+		}
+		return $descriptions;
+	}
+}
+
+$timezone = $config['system']['timezone'];
+if (!$timezone)
+	$timezone = "Etc/UTC";
+
+date_default_timezone_set($timezone);
+
+?>
diff --git a/usr/local/www/headjs.php b/usr/local/www/headjs.php
index 0ee1cb4..bfea6e9 100644
--- a/usr/local/www/headjs.php
+++ b/usr/local/www/headjs.php
@@ -37,7 +37,7 @@
 require_once("guiconfig.inc");
 
 function getHeadJS() {
-  global $g, $use_loader_tab_gif;
+  global $_SERVER, $HTTP_SERVER_VARS, $g, $use_loader_tab_gif;
 
   if(!$use_loader_tab_gif)
     $loader_gif = "/themes/{$g['theme']}/images/misc/loader.gif";
diff --git a/usr/local/www/help.php b/usr/local/www/help.php
index 7c5b9db..4f79fea 100644
--- a/usr/local/www/help.php
+++ b/usr/local/www/help.php
@@ -11,301 +11,301 @@ require_once("guiconfig.inc");
 /* Links to categories could probably be more specific. */
 $helppages = array(
 	/* These pages are confirmed to work and have usable content */
-	'index.php' => 'https://doc.pfsense.org/index.php/Dashboard',
+	'index.php' => 'http://doc.pfsense.org/index.php/Dashboard',
 	'license.php' => 'http://www.pfsense.org/index.php@option=com_content&task=view&id=42&Itemid=62.html',
-	'miniupnpd.xml' => 'https://doc.pfsense.org/index.php/What_is_UPNP%3F',
-	'status_upnp.php' => 'https://doc.pfsense.org/index.php/What_is_UPNP%3F',
-	'firewall_virtual_ip.php' => 'https://doc.pfsense.org/index.php/What_are_Virtual_IP_Addresses%3F',
-	'firewall_virtual_ip_edit.php' => 'https://doc.pfsense.org/index.php/What_are_Virtual_IP_Addresses%3F',
-	'firewall_aliases.php' => 'https://doc.pfsense.org/index.php/Aliases',
-	'firewall_aliases_edit.php' => 'https://doc.pfsense.org/index.php/Aliases',
-	'firewall_aliases_import.php' => 'https://doc.pfsense.org/index.php/Aliases',
-	'firewall_nat_out.php' => 'https://doc.pfsense.org/index.php/Outbound_NAT',
-	'firewall_nat_out_edit.php' => 'https://doc.pfsense.org/index.php/Outbound_NAT',
-	'firewall_rules.php' => 'https://doc.pfsense.org/index.php/Firewall_Rule_Basics',
-	'firewall_rules_edit.php' => 'https://doc.pfsense.org/index.php/Firewall_Rule_Basics',
-	'firewall_schedule.php' => 'https://doc.pfsense.org/index.php/Firewall_Rule_Schedules',
-	'firewall_schedule_edit.php' => 'https://doc.pfsense.org/index.php/Firewall_Rule_Schedules',
-	'interfaces_vlan.php' => 'https://doc.pfsense.org/index.php/VLAN_Trunking',
-	'interfaces_vlan_edit.php' => 'https://doc.pfsense.org/index.php/VLAN_Trunking',
-	'diag_routes.php' => 'https://doc.pfsense.org/index.php/Viewing_Routes',
-	'diag_packet_capture.php' => 'https://doc.pfsense.org/index.php/Sniffers,_Packet_Capture',
-	'diag_system_pftop.php' => 'https://doc.pfsense.org/index.php/How_can_I_monitor_bandwidth_usage%3F#pftop',
-	'status_rrd_graph.php' => "https://doc.pfsense.org/index.php/RRD_Graphs",
-	'status_rrd_graph_img.php' => "https://doc.pfsense.org/index.php/RRD_Graphs",
-	'status_rrd_graph_settings.php' => "https://doc.pfsense.org/index.php/RRD_Graphs",
-	'firewall_nat.php' => 'https://doc.pfsense.org/index.php/How_can_I_forward_ports_with_pfSense%3F',
-	'firewall_nat_edit.php' => 'https://doc.pfsense.org/index.php/How_can_I_forward_ports_with_pfSense%3F',
-	'diag_arp.php' => 'https://doc.pfsense.org/index.php/ARP_Table',
-	'diag_backup.php' => 'https://doc.pfsense.org/index.php/Configuration_Backup_and_Restore',
-	'diag_confbak.php' => 'https://doc.pfsense.org/index.php/Configuration_History',
-	'diag_defaults.php' => 'https://doc.pfsense.org/index.php/Factory_Defaults',
-	'firewall_shaper.php' => 'https://doc.pfsense.org/index.php/Traffic_Shaping_Guide',
-	'firewall_shaper_layer7.php' => 'https://doc.pfsense.org/index.php/Traffic_Shaping_Guide',
-	'firewall_shaper_queues.php' => 'https://doc.pfsense.org/index.php/Traffic_Shaping_Guide',
-	'firewall_shaper_vinterface.php' => 'https://doc.pfsense.org/index.php/Traffic_Shaping_Guide',
-	'firewall_shaper_wizards.php' => 'https://doc.pfsense.org/index.php/Traffic_Shaping_Guide',
-	'status_queues.php' => 'https://doc.pfsense.org/index.php/Traffic_Shaping_Guide',
-	'status_dhcp_leases.php' => 'https://doc.pfsense.org/index.php/DHCP_Leases',
-	'diag_dns.php' => 'https://doc.pfsense.org/index.php/DNS_Lookup',
-	'diag_dump_states.php' => 'https://doc.pfsense.org/index.php/Show_States',
-	'diag_resetstate.php' => 'https://doc.pfsense.org/index.php/Reset_States',
-	'diag_logs.php' => 'https://doc.pfsense.org/index.php/System_Logs',
-	'diag_logs_auth.php' => 'https://doc.pfsense.org/index.php/Captive_Portal_Authentication_Logs',
-	'diag_logs_dhcp.php' => 'https://doc.pfsense.org/index.php/DHCP_Logs',
-	'diag_logs_filter.php' => 'https://doc.pfsense.org/index.php/Firewall_Logs',
-	'diag_logs_filter_dynamic.php' => 'https://doc.pfsense.org/index.php/Firewall_Logs',
-	'diag_logs_filter_summary.php' => 'https://doc.pfsense.org/index.php/Firewall_Logs',
-	'diag_logs_ntpd.php' => 'https://doc.pfsense.org/index.php/NTP_Logs',
-	'diag_logs_ppp.php' => 'https://doc.pfsense.org/index.php/PPP_Logs',
-	'diag_logs_relayd.php' => 'https://doc.pfsense.org/index.php/Load_Balancer_Logs',
-	'diag_logs_settings.php' => 'https://doc.pfsense.org/index.php/Log_Settings',
-	'diag_logs_vpn.php' => 'https://doc.pfsense.org/index.php/PPTP_VPN_Logs',
-	'diag_logs_ipsec.php' => 'https://doc.pfsense.org/index.php/IPsec_Logs',
-	'diag_logs_openvpn.php' => 'https://doc.pfsense.org/index.php/OpenVPN_Logs',
-	'diag_nanobsd.php' => 'https://doc.pfsense.org/index.php/NanoBSD_Diagnostics',
-	'diag_patterns.php' => 'https://doc.pfsense.org/index.php/Layer7_Pattern_Diagnostics',
-	'diag_ping.php' => 'https://doc.pfsense.org/index.php/Ping_Host',
-	'diag_pkglogs.php' => 'https://doc.pfsense.org/index.php/Package_Logs',
-	'diag_tables.php' => 'https://doc.pfsense.org/index.php/Tables',
-	'diag_system_activity.php' => 'https://doc.pfsense.org/index.php/System_Activity',
-	'diag_traceroute.php' => 'https://doc.pfsense.org/index.php/Traceroute',
-	'easyrule.php' => 'https://doc.pfsense.org/index.php/Easy_Rule',
-	'edit.php' => 'https://doc.pfsense.org/index.php/Edit_File',
-	'exec.php' => 'https://doc.pfsense.org/index.php/Execute_Command',
-	'firewall_nat_1to1.php' => 'https://doc.pfsense.org/index.php/1:1_NAT',
-	'firewall_nat_1to1_edit.php' => 'https://doc.pfsense.org/index.php/1:1_NAT',
-	'halt.php' => 'https://doc.pfsense.org/index.php/Halt_System',
-	'reboot.php' => 'https://doc.pfsense.org/index.php/Reboot_System',
-	'status_filter_reload.php' => 'https://doc.pfsense.org/index.php/Filter_Reload_Status',
-	'status_gateway_groups.php' => 'https://doc.pfsense.org/index.php/Gateway_Status',
-	'status_gateways.php' => 'https://doc.pfsense.org/index.php/Gateway_Status',
-	'status_graph.php' => 'https://doc.pfsense.org/index.php/Traffic_Graph',
-	'status_graph_cpu.php' => 'https://doc.pfsense.org/index.php/CPU_Load',
-	'status_interfaces.php' => 'https://doc.pfsense.org/index.php/Interface_Status',
-	'status_services.php' => 'https://doc.pfsense.org/index.php/Services_Status',
-	'status_wireless.php' => 'https://doc.pfsense.org/index.php/Wireless_Status',
-	'pkg_mgr.php' => 'https://doc.pfsense.org/index.php/Package_Manager',
-	'pkg_mgr_install.php' => 'https://doc.pfsense.org/index.php/Package_Manager',
-	'pkg_mgr_installed.php' => 'https://doc.pfsense.org/index.php/Package_Manager',
-	'pkg_mgr_settings.php' => 'https://doc.pfsense.org/index.php/Package_Manager_Settings',
-	'interfaces.php' => 'https://doc.pfsense.org/index.php/Interface_Settings',
-	'interfaces_assign.php' => 'https://doc.pfsense.org/index.php/Assign_Interfaces',
-	'interfaces_bridge.php' => 'https://doc.pfsense.org/index.php/Interface_Bridges',
-	'interfaces_bridge_edit.php' => 'https://doc.pfsense.org/index.php/Interface_Bridges',
-	'interfaces_gif.php' => 'https://doc.pfsense.org/index.php/GIF_Interfaces',
-	'interfaces_gif_edit.php' => 'https://doc.pfsense.org/index.php/GIF_Interfaces',
-	'interfaces_gre.php' => 'https://doc.pfsense.org/index.php/GRE_Interfaces',
-	'interfaces_gre_edit.php' => 'https://doc.pfsense.org/index.php/GRE_Interfaces',
-	'interfaces_groups.php' => 'https://doc.pfsense.org/index.php/Interface_Groups',
-	'interfaces_groups_edit.php' => 'https://doc.pfsense.org/index.php/Interface_Groups',
-	'interfaces_lagg.php' => 'https://doc.pfsense.org/index.php/LAGG_Interfaces',
-	'interfaces_lagg_edit.php' => 'https://doc.pfsense.org/index.php/LAGG_Interfaces',
-	'interfaces_ppps.php' => 'https://doc.pfsense.org/index.php/PPP_Interfaces',
-	'interfaces_ppps_edit.php' => 'https://doc.pfsense.org/index.php/PPP_Interfaces',
-	'interfaces_qinq.php' => 'https://doc.pfsense.org/index.php/QinQ_Interfaces',
-	'interfaces_qinq_edit.php' => 'https://doc.pfsense.org/index.php/QinQ_Interfaces',
-	'services_dyndns.php' => 'https://doc.pfsense.org/index.php/Dynamic_DNS',
-	'services_dyndns_edit.php' => 'https://doc.pfsense.org/index.php/Dynamic_DNS',
-	'services_rfc2136.php' => 'https://doc.pfsense.org/index.php/Dynamic_DNS',
-	'services_rfc2136_edit.php' => 'https://doc.pfsense.org/index.php/Dynamic_DNS',
-	'services_dhcp.php' => 'https://doc.pfsense.org/index.php/DHCP_Server',
-	'services_dhcp_edit.php' => 'https://doc.pfsense.org/index.php/DHCP_Server',
-	'services_dhcp_relay.php' => 'https://doc.pfsense.org/index.php/DHCP_Relay',
-	'services_dnsmasq.php' => 'https://doc.pfsense.org/index.php/DNS_Forwarder',
-	'services_dnsmasq_domainoverride_edit.php' => 'https://doc.pfsense.org/index.php/DNS_Forwarder',
-	'services_dnsmasq_edit.php' => 'https://doc.pfsense.org/index.php/DNS_Forwarder',
-	'services_igmpproxy.php' => 'https://doc.pfsense.org/index.php/IGMP_Proxy',
-	'services_igmpproxy_edit.php' => 'https://doc.pfsense.org/index.php/IGMP_Proxy',
-	'services_snmp.php' => 'https://doc.pfsense.org/index.php/SNMP_Daemon',
-	'services_wol.php' => 'https://doc.pfsense.org/index.php/Wake_on_LAN',
-	'services_wol_edit.php' => 'https://doc.pfsense.org/index.php/Wake_on_LAN',
-	'system.php' => 'https://doc.pfsense.org/index.php/General_Setup_(2.0)',
-	'system_advanced_admin.php' => 'https://doc.pfsense.org/index.php/Advanced_Setup_(2.0)',
-	'system_advanced_firewall.php' => 'https://doc.pfsense.org/index.php/Advanced_Setup_(2.0)#Firewall.2FNAT',
-	'system_advanced_misc.php' => 'https://doc.pfsense.org/index.php/Advanced_Setup_(2.0)#Miscellaneous',
-	'system_advanced_network.php' => 'https://doc.pfsense.org/index.php/Advanced_Setup_(2.0)#Firewall.2FNAT',
-	'system_advanced_notifications.php' => 'https://doc.pfsense.org/index.php/Advanced_Setup_(2.0)#Notifications',
-	'system_advanced_sysctl.php' => 'https://doc.pfsense.org/index.php/Advanced_Setup_(2.0)#System_Tunables',
-	'system_firmware.php' => 'https://doc.pfsense.org/index.php/Firmware_Updates',
-	'system_firmware_auto.php' => 'https://doc.pfsense.org/index.php/Firmware_Updates',
-	'system_firmware_check.php' => 'https://doc.pfsense.org/index.php/Firmware_Updates',
-	'system_firmware_settings.php' => 'https://doc.pfsense.org/index.php/Firmware_Updates',
-	'system_gateway_groups.php' => 'https://doc.pfsense.org/index.php/Gateway_Settings',
-	'system_gateway_groups_edit.php' => 'https://doc.pfsense.org/index.php/Gateway_Settings',
-	'system_gateways.php' => 'https://doc.pfsense.org/index.php/Gateway_Settings',
-	'system_gateways_edit.php' => 'https://doc.pfsense.org/index.php/Gateway_Settings',
-	'system_routes.php' => 'https://doc.pfsense.org/index.php/Static_Routes',
-	'system_routes_edit.php' => 'https://doc.pfsense.org/index.php/Static_Routes',
-	'system_authservers.php' => 'https://doc.pfsense.org/index.php/User_Authentication_Servers',
-	'system_groupmanager.php' => 'https://doc.pfsense.org/index.php/Group_Manager',
-	'system_groupmanager_addprivs.php' => 'https://doc.pfsense.org/index.php/Group_Manager',
-	'system_usermanager.php' => 'https://doc.pfsense.org/index.php/User_Manager',
-	'system_usermanager_addprivs.php' => 'https://doc.pfsense.org/index.php/User_Manager',
-	'system_usermanager_settings.php' => 'https://doc.pfsense.org/index.php/User_Manager',
-	'system_usermanager_settings_ldapacpicker.php' => 'https://doc.pfsense.org/index.php/User_Manager',
-	'system_usermanager_settings_test.php' => 'https://doc.pfsense.org/index.php/User_Manager',
-	'system_usermanager_passwordmg.php' => 'https://doc.pfsense.org/index.php/User_Manager',
-	'system_camanager.php' => 'https://doc.pfsense.org/index.php/Certificate_Management',
-	'system_certmanager.php' => 'https://doc.pfsense.org/index.php/Certificate_Management',
-	'vpn_l2tp.php' => 'https://doc.pfsense.org/index.php/L2TP_VPN_Settings',
-	'vpn_l2tp_users.php' => 'https://doc.pfsense.org/index.php/L2TP_VPN_Settings',
-	'vpn_l2tp_users_edit.php' => 'https://doc.pfsense.org/index.php/L2TP_VPN_Settings',
-	'vpn_pppoe.php' => 'https://doc.pfsense.org/index.php/PPPoE_Server_Settings',
-	'vpn_pppoe_edit.php' => 'https://doc.pfsense.org/index.php/PPPoE_Server_Settings',
-	'vpn_pptp.php' => 'https://doc.pfsense.org/index.php/PPTP_VPN_Settings',
-	'vpn_pptp_users.php' => 'https://doc.pfsense.org/index.php/PPTP_VPN_Settings',
-	'vpn_pptp_users_edit.php' => 'https://doc.pfsense.org/index.php/PPTP_VPN_Settings',
-	'diag_ipsec.php' => 'https://doc.pfsense.org/index.php/IPsec_Status',
-	'diag_ipsec_sad.php' => 'https://doc.pfsense.org/index.php/IPsec_Status',
-	'diag_ipsec_spd.php' => 'https://doc.pfsense.org/index.php/IPsec_Status',
-	'vpn_ipsec.php' => 'https://doc.pfsense.org/index.php/IPsec_Tunnels',
-	'vpn_ipsec_mobile.php' => 'https://doc.pfsense.org/index.php/IPsec_Mobile_Clients',
-	'vpn_ipsec_phase1.php' => 'https://doc.pfsense.org/index.php/IPsec_Tunnels',
-	'vpn_ipsec_phase2.php' => 'https://doc.pfsense.org/index.php/IPsec_Tunnels',
-	'vpn_ipsec_keys.php' => 'https://doc.pfsense.org/index.php/IPsec_Tunnels',
-	'vpn_ipsec_keys_edit.php' => 'https://doc.pfsense.org/index.php/IPsec_Tunnels',
-	'services_captiveportal.php' => 'https://doc.pfsense.org/index.php/Captive_Portal',
-	'services_captiveportal_filemanager.php' => 'https://doc.pfsense.org/index.php/Captive_Portal',
-	'services_captiveportal_ip.php' => 'https://doc.pfsense.org/index.php/Captive_Portal',
-	'services_captiveportal_ip_edit.php' => 'https://doc.pfsense.org/index.php/Captive_Portal',
-	'services_captiveportal_mac.php' => 'https://doc.pfsense.org/index.php/Captive_Portal',
-	'services_captiveportal_mac_edit.php' => 'https://doc.pfsense.org/index.php/Captive_Portal',
-	'services_captiveportal_hostname.php' => 'https://doc.pfsense.org/index.php/Captive_Portal',
-	'services_captiveportal_hostname_edit.php' => 'https://doc.pfsense.org/index.php/Captive_Portal',
-	'status_captiveportal.php' => 'https://doc.pfsense.org/index.php/Captive_Portal_Status',
-	'status_captiveportal_test.php' => 'https://doc.pfsense.org/index.php/Captive_Portal_Status',
-	'services_captiveportal_vouchers.php' => 'https://doc.pfsense.org/index.php/Captive_Portal_Vouchers',
-	'services_captiveportal_vouchers_edit.php' => 'https://doc.pfsense.org/index.php/Captive_Portal_Vouchers',
-	'status_captiveportal_voucher_rolls.php' => 'https://doc.pfsense.org/index.php/Captive_Portal_Vouchers',
-	'status_captiveportal_vouchers.php' => 'https://doc.pfsense.org/index.php/Captive_Portal_Vouchers',
-	'status_openvpn.php' => 'https://doc.pfsense.org/index.php/OpenVPN_Status',
-	'vpn_openvpn_client.php' => 'https://doc.pfsense.org/index.php/OpenVPN_Settings',
-	'vpn_openvpn_csc.php' => 'https://doc.pfsense.org/index.php/OpenVPN_Settings',
-	'vpn_openvpn_server.php' => 'https://doc.pfsense.org/index.php/OpenVPN_Settings',
-	'openvpn-client-export.xml' => 'https://doc.pfsense.org/index.php/OpenVPN_Client_Exporter', /* Package */
-	'vpn_openvpn_export.php' => 'https://doc.pfsense.org/index.php/OpenVPN_Client_Exporter', /* Package */
-	'diag_authentication.php' => 'https://doc.pfsense.org/index.php/User_Authentication_Servers',
-	'diag_limiter_info.php' => 'https://doc.pfsense.org/index.php/Traffic_Shaping_Guide#Display_Pipes',
-	'diag_pf_info.php' => 'https://doc.pfsense.org/index.php/Packet_Filter_Information',
-	'diag_smart.php' => 'https://doc.pfsense.org/index.php/SMART_Status',
-	'diag_states_summary.php' => 'https://doc.pfsense.org/index.php/States_Summary',
-	'interfaces_wireless.php' => 'https://doc.pfsense.org/index.php/Wireless_Interfaces',
-	'interfaces_wireless_edit.php' => 'https://doc.pfsense.org/index.php/Wireless_Interfaces',
-	'system_crlmanager.php' => 'https://doc.pfsense.org/index.php/Certificate_Management',
-	'crash_reporter.php' => 'https://doc.pfsense.org/index.php/Unexpected_Reboot_Troubleshooting',
-	'diag_dump_states_sources.php' => "https://doc.pfsense.org/index.php/Show_Source_Tracking",
-	'diag_logs_gateways.php' => "https://doc.pfsense.org/index.php/Gateway_Logs",
-	'diag_logs_resolver.php' => "https://doc.pfsense.org/index.php/Resolver_Logs",
-	'diag_logs_routing.php' => "https://doc.pfsense.org/index.php/Routing_Logs",
-	'diag_logs_wireless.php' => "https://doc.pfsense.org/index.php/Wireless_Logs",
-	'diag_ndp.php' => "https://doc.pfsense.org/index.php/NDP_Table",
-	'diag_sockets.php' => "https://doc.pfsense.org/index.php/Diag_Sockets",
-	'diag_testport.php' => "https://doc.pfsense.org/index.php/Test_Port",
-	'firewall_nat_npt.php' => "https://doc.pfsense.org/index.php/NPt",
-	'firewall_nat_npt_edit.php' => "https://doc.pfsense.org/index.php/NPt",
-	'load_balancer_setting.php' => "https://doc.pfsense.org/index.php/Category:Load_balancing",
-	'services_captiveportal_zones.php' => "https://doc.pfsense.org/index.php/Captive_Portal",
-	'services_captiveportal_zones_edit.php' => "https://doc.pfsense.org/index.php/Captive_Portal",
-	'status_captiveportal_expire.php' => "https://doc.pfsense.org/index.php/Captive_Portal",
-	'services_ntpd.php' => "https://doc.pfsense.org/index.php/NTP_Server",
-	'status_ntpd.php' => "https://doc.pfsense.org/index.php/NTP_Server",
-	'system_firmware_restorefullbackup.php' => "https://doc.pfsense.org/index.php/Full_Backup",
+	'miniupnpd.xml' => 'http://doc.pfsense.org/index.php/What_is_UPNP%3F',
+	'status_upnp.php' => 'http://doc.pfsense.org/index.php/What_is_UPNP%3F',
+	'firewall_virtual_ip.php' => 'http://doc.pfsense.org/index.php/What_are_Virtual_IP_Addresses%3F',
+	'firewall_virtual_ip_edit.php' => 'http://doc.pfsense.org/index.php/What_are_Virtual_IP_Addresses%3F',
+	'firewall_aliases.php' => 'http://doc.pfsense.org/index.php/Aliases',
+	'firewall_aliases_edit.php' => 'http://doc.pfsense.org/index.php/Aliases',
+	'firewall_aliases_import.php' => 'http://doc.pfsense.org/index.php/Aliases',
+	'firewall_nat_out.php' => 'http://doc.pfsense.org/index.php/Outbound_NAT',
+	'firewall_nat_out_edit.php' => 'http://doc.pfsense.org/index.php/Outbound_NAT',
+	'firewall_rules.php' => 'http://doc.pfsense.org/index.php/Firewall_Rule_Basics',
+	'firewall_rules_edit.php' => 'http://doc.pfsense.org/index.php/Firewall_Rule_Basics',
+	'firewall_schedule.php' => 'http://doc.pfsense.org/index.php/Firewall_Rule_Schedules',
+	'firewall_schedule_edit.php' => 'http://doc.pfsense.org/index.php/Firewall_Rule_Schedules',
+	'interfaces_vlan.php' => 'http://doc.pfsense.org/index.php/VLAN_Trunking',
+	'interfaces_vlan_edit.php' => 'http://doc.pfsense.org/index.php/VLAN_Trunking',
+	'diag_routes.php' => 'http://doc.pfsense.org/index.php/Viewing_Routes',
+	'diag_packet_capture.php' => 'http://doc.pfsense.org/index.php/Sniffers,_Packet_Capture',
+	'diag_system_pftop.php' => 'http://doc.pfsense.org/index.php/How_can_I_monitor_bandwidth_usage%3F#pftop',
+	'status_rrd_graph.php' => "http://doc.pfsense.org/index.php/RRD_Graphs",
+	'status_rrd_graph_img.php' => "http://doc.pfsense.org/index.php/RRD_Graphs",
+	'status_rrd_graph_settings.php' => "http://doc.pfsense.org/index.php/RRD_Graphs",
+	'firewall_nat.php' => 'http://doc.pfsense.org/index.php/How_can_I_forward_ports_with_pfSense%3F',
+	'firewall_nat_edit.php' => 'http://doc.pfsense.org/index.php/How_can_I_forward_ports_with_pfSense%3F',
+	'diag_arp.php' => 'http://doc.pfsense.org/index.php/ARP_Table',
+	'diag_backup.php' => 'http://doc.pfsense.org/index.php/Configuration_Backup_and_Restore',
+	'diag_confbak.php' => 'http://doc.pfsense.org/index.php/Configuration_History',
+	'diag_defaults.php' => 'http://doc.pfsense.org/index.php/Factory_Defaults',
+	'firewall_shaper.php' => 'http://doc.pfsense.org/index.php/Traffic_Shaping_Guide',
+	'firewall_shaper_layer7.php' => 'http://doc.pfsense.org/index.php/Traffic_Shaping_Guide',
+	'firewall_shaper_queues.php' => 'http://doc.pfsense.org/index.php/Traffic_Shaping_Guide',
+	'firewall_shaper_vinterface.php' => 'http://doc.pfsense.org/index.php/Traffic_Shaping_Guide',
+	'firewall_shaper_wizards.php' => 'http://doc.pfsense.org/index.php/Traffic_Shaping_Guide',
+	'status_queues.php' => 'http://doc.pfsense.org/index.php/Traffic_Shaping_Guide',
+	'status_dhcp_leases.php' => 'http://doc.pfsense.org/index.php/DHCP_Leases',
+	'diag_dns.php' => 'http://doc.pfsense.org/index.php/DNS_Lookup',
+	'diag_dump_states.php' => 'http://doc.pfsense.org/index.php/Show_States',
+	'diag_resetstate.php' => 'http://doc.pfsense.org/index.php/Reset_States',
+	'diag_logs.php' => 'http://doc.pfsense.org/index.php/System_Logs',
+	'diag_logs_auth.php' => 'http://doc.pfsense.org/index.php/Captive_Portal_Authentication_Logs',
+	'diag_logs_dhcp.php' => 'http://doc.pfsense.org/index.php/DHCP_Logs',
+	'diag_logs_filter.php' => 'http://doc.pfsense.org/index.php/Firewall_Logs',
+	'diag_logs_filter_dynamic.php' => 'http://doc.pfsense.org/index.php/Firewall_Logs',
+	'diag_logs_filter_summary.php' => 'http://doc.pfsense.org/index.php/Firewall_Logs',
+	'diag_logs_ntpd.php' => 'http://doc.pfsense.org/index.php/NTP_Logs',
+	'diag_logs_ppp.php' => 'http://doc.pfsense.org/index.php/PPP_Logs',
+	'diag_logs_relayd.php' => 'http://doc.pfsense.org/index.php/Load_Balancer_Logs',
+	'diag_logs_settings.php' => 'http://doc.pfsense.org/index.php/Log_Settings',
+	'diag_logs_vpn.php' => 'http://doc.pfsense.org/index.php/PPTP_VPN_Logs',
+	'diag_logs_ipsec.php' => 'http://doc.pfsense.org/index.php/IPsec_Logs',
+	'diag_logs_openvpn.php' => 'http://doc.pfsense.org/index.php/OpenVPN_Logs',
+	'diag_nanobsd.php' => 'http://doc.pfsense.org/index.php/NanoBSD_Diagnostics',
+	'diag_patterns.php' => 'http://doc.pfsense.org/index.php/Layer7_Pattern_Diagnostics',
+	'diag_ping.php' => 'http://doc.pfsense.org/index.php/Ping_Host',
+	'diag_pkglogs.php' => 'http://doc.pfsense.org/index.php/Package_Logs',
+	'diag_tables.php' => 'http://doc.pfsense.org/index.php/Tables',
+	'diag_system_activity.php' => 'http://doc.pfsense.org/index.php/System_Activity',
+	'diag_traceroute.php' => 'http://doc.pfsense.org/index.php/Traceroute',
+	'easyrule.php' => 'http://doc.pfsense.org/index.php/Easy_Rule',
+	'edit.php' => 'http://doc.pfsense.org/index.php/Edit_File',
+	'exec.php' => 'http://doc.pfsense.org/index.php/Execute_Command',
+	'firewall_nat_1to1.php' => 'http://doc.pfsense.org/index.php/1:1_NAT',
+	'firewall_nat_1to1_edit.php' => 'http://doc.pfsense.org/index.php/1:1_NAT',
+	'halt.php' => 'http://doc.pfsense.org/index.php/Halt_System',
+	'reboot.php' => 'http://doc.pfsense.org/index.php/Reboot_System',
+	'status_filter_reload.php' => 'http://doc.pfsense.org/index.php/Filter_Reload_Status',
+	'status_gateway_groups.php' => 'http://doc.pfsense.org/index.php/Gateway_Status',
+	'status_gateways.php' => 'http://doc.pfsense.org/index.php/Gateway_Status',
+	'status_graph.php' => 'http://doc.pfsense.org/index.php/Traffic_Graph',
+	'status_graph_cpu.php' => 'http://doc.pfsense.org/index.php/CPU_Load',
+	'status_interfaces.php' => 'http://doc.pfsense.org/index.php/Interface_Status',
+	'status_services.php' => 'http://doc.pfsense.org/index.php/Services_Status',
+	'status_wireless.php' => 'http://doc.pfsense.org/index.php/Wireless_Status',
+	'pkg_mgr.php' => 'http://doc.pfsense.org/index.php/Package_Manager',
+	'pkg_mgr_install.php' => 'http://doc.pfsense.org/index.php/Package_Manager',
+	'pkg_mgr_installed.php' => 'http://doc.pfsense.org/index.php/Package_Manager',
+	'pkg_mgr_settings.php' => 'http://doc.pfsense.org/index.php/Package_Manager_Settings',
+	'interfaces.php' => 'http://doc.pfsense.org/index.php/Interface_Settings',
+	'interfaces_assign.php' => 'http://doc.pfsense.org/index.php/Assign_Interfaces',
+	'interfaces_bridge.php' => 'http://doc.pfsense.org/index.php/Interface_Bridges',
+	'interfaces_bridge_edit.php' => 'http://doc.pfsense.org/index.php/Interface_Bridges',
+	'interfaces_gif.php' => 'http://doc.pfsense.org/index.php/GIF_Interfaces',
+	'interfaces_gif_edit.php' => 'http://doc.pfsense.org/index.php/GIF_Interfaces',
+	'interfaces_gre.php' => 'http://doc.pfsense.org/index.php/GRE_Interfaces',
+	'interfaces_gre_edit.php' => 'http://doc.pfsense.org/index.php/GRE_Interfaces',
+	'interfaces_groups.php' => 'http://doc.pfsense.org/index.php/Interface_Groups',
+	'interfaces_groups_edit.php' => 'http://doc.pfsense.org/index.php/Interface_Groups',
+	'interfaces_lagg.php' => 'http://doc.pfsense.org/index.php/LAGG_Interfaces',
+	'interfaces_lagg_edit.php' => 'http://doc.pfsense.org/index.php/LAGG_Interfaces',
+	'interfaces_ppps.php' => 'http://doc.pfsense.org/index.php/PPP_Interfaces',
+	'interfaces_ppps_edit.php' => 'http://doc.pfsense.org/index.php/PPP_Interfaces',
+	'interfaces_qinq.php' => 'http://doc.pfsense.org/index.php/QinQ_Interfaces',
+	'interfaces_qinq_edit.php' => 'http://doc.pfsense.org/index.php/QinQ_Interfaces',
+	'services_dyndns.php' => 'http://doc.pfsense.org/index.php/Dynamic_DNS',
+	'services_dyndns_edit.php' => 'http://doc.pfsense.org/index.php/Dynamic_DNS',
+	'services_rfc2136.php' => 'http://doc.pfsense.org/index.php/Dynamic_DNS',
+	'services_rfc2136_edit.php' => 'http://doc.pfsense.org/index.php/Dynamic_DNS',
+	'services_dhcp.php' => 'http://doc.pfsense.org/index.php/DHCP_Server',
+	'services_dhcp_edit.php' => 'http://doc.pfsense.org/index.php/DHCP_Server',
+	'services_dhcp_relay.php' => 'http://doc.pfsense.org/index.php/DHCP_Relay',
+	'services_dnsmasq.php' => 'http://doc.pfsense.org/index.php/DNS_Forwarder',
+	'services_dnsmasq_domainoverride_edit.php' => 'http://doc.pfsense.org/index.php/DNS_Forwarder',
+	'services_dnsmasq_edit.php' => 'http://doc.pfsense.org/index.php/DNS_Forwarder',
+	'services_igmpproxy.php' => 'http://doc.pfsense.org/index.php/IGMP_Proxy',
+	'services_igmpproxy_edit.php' => 'http://doc.pfsense.org/index.php/IGMP_Proxy',
+	'services_snmp.php' => 'http://doc.pfsense.org/index.php/SNMP_Daemon',
+	'services_wol.php' => 'http://doc.pfsense.org/index.php/Wake_on_LAN',
+	'services_wol_edit.php' => 'http://doc.pfsense.org/index.php/Wake_on_LAN',
+	'system.php' => 'http://doc.pfsense.org/index.php/General_Setup_(2.0)',
+	'system_advanced_admin.php' => 'http://doc.pfsense.org/index.php/Advanced_Setup_(2.0)',
+	'system_advanced_firewall.php' => 'http://doc.pfsense.org/index.php/Advanced_Setup_(2.0)#Firewall.2FNAT',
+	'system_advanced_misc.php' => 'http://doc.pfsense.org/index.php/Advanced_Setup_(2.0)#Miscellaneous',
+	'system_advanced_network.php' => 'http://doc.pfsense.org/index.php/Advanced_Setup_(2.0)#Firewall.2FNAT',
+	'system_advanced_notifications.php' => 'http://doc.pfsense.org/index.php/Advanced_Setup_(2.0)#Notifications',
+	'system_advanced_sysctl.php' => 'http://doc.pfsense.org/index.php/Advanced_Setup_(2.0)#System_Tunables',
+	'system_firmware.php' => 'http://doc.pfsense.org/index.php/Firmware_Updates',
+	'system_firmware_auto.php' => 'http://doc.pfsense.org/index.php/Firmware_Updates',
+	'system_firmware_check.php' => 'http://doc.pfsense.org/index.php/Firmware_Updates',
+	'system_firmware_settings.php' => 'http://doc.pfsense.org/index.php/Firmware_Updates',
+	'system_gateway_groups.php' => 'http://doc.pfsense.org/index.php/Gateway_Settings',
+	'system_gateway_groups_edit.php' => 'http://doc.pfsense.org/index.php/Gateway_Settings',
+	'system_gateways.php' => 'http://doc.pfsense.org/index.php/Gateway_Settings',
+	'system_gateways_edit.php' => 'http://doc.pfsense.org/index.php/Gateway_Settings',
+	'system_routes.php' => 'http://doc.pfsense.org/index.php/Static_Routes',
+	'system_routes_edit.php' => 'http://doc.pfsense.org/index.php/Static_Routes',
+	'system_authservers.php' => 'http://doc.pfsense.org/index.php/User_Authentication_Servers',
+	'system_groupmanager.php' => 'http://doc.pfsense.org/index.php/Group_Manager',
+	'system_groupmanager_addprivs.php' => 'http://doc.pfsense.org/index.php/Group_Manager',
+	'system_usermanager.php' => 'http://doc.pfsense.org/index.php/User_Manager',
+	'system_usermanager_addprivs.php' => 'http://doc.pfsense.org/index.php/User_Manager',
+	'system_usermanager_settings.php' => 'http://doc.pfsense.org/index.php/User_Manager',
+	'system_usermanager_settings_ldapacpicker.php' => 'http://doc.pfsense.org/index.php/User_Manager',
+	'system_usermanager_settings_test.php' => 'http://doc.pfsense.org/index.php/User_Manager',
+	'system_usermanager_passwordmg.php' => 'http://doc.pfsense.org/index.php/User_Manager',
+	'system_camanager.php' => 'http://doc.pfsense.org/index.php/Certificate_Management',
+	'system_certmanager.php' => 'http://doc.pfsense.org/index.php/Certificate_Management',
+	'vpn_l2tp.php' => 'http://doc.pfsense.org/index.php/L2TP_VPN_Settings',
+	'vpn_l2tp_users.php' => 'http://doc.pfsense.org/index.php/L2TP_VPN_Settings',
+	'vpn_l2tp_users_edit.php' => 'http://doc.pfsense.org/index.php/L2TP_VPN_Settings',
+	'vpn_pppoe.php' => 'http://doc.pfsense.org/index.php/PPPoE_Server_Settings',
+	'vpn_pppoe_edit.php' => 'http://doc.pfsense.org/index.php/PPPoE_Server_Settings',
+	'vpn_pptp.php' => 'http://doc.pfsense.org/index.php/PPTP_VPN_Settings',
+	'vpn_pptp_users.php' => 'http://doc.pfsense.org/index.php/PPTP_VPN_Settings',
+	'vpn_pptp_users_edit.php' => 'http://doc.pfsense.org/index.php/PPTP_VPN_Settings',
+	'diag_ipsec.php' => 'http://doc.pfsense.org/index.php/IPsec_Status',
+	'diag_ipsec_sad.php' => 'http://doc.pfsense.org/index.php/IPsec_Status',
+	'diag_ipsec_spd.php' => 'http://doc.pfsense.org/index.php/IPsec_Status',
+	'vpn_ipsec.php' => 'http://doc.pfsense.org/index.php/IPsec_Tunnels',
+	'vpn_ipsec_mobile.php' => 'http://doc.pfsense.org/index.php/IPsec_Mobile_Clients',
+	'vpn_ipsec_phase1.php' => 'http://doc.pfsense.org/index.php/IPsec_Tunnels',
+	'vpn_ipsec_phase2.php' => 'http://doc.pfsense.org/index.php/IPsec_Tunnels',
+	'vpn_ipsec_keys.php' => 'http://doc.pfsense.org/index.php/IPsec_Tunnels',
+	'vpn_ipsec_keys_edit.php' => 'http://doc.pfsense.org/index.php/IPsec_Tunnels',
+	'services_captiveportal.php' => 'http://doc.pfsense.org/index.php/Captive_Portal',
+	'services_captiveportal_filemanager.php' => 'http://doc.pfsense.org/index.php/Captive_Portal',
+	'services_captiveportal_ip.php' => 'http://doc.pfsense.org/index.php/Captive_Portal',
+	'services_captiveportal_ip_edit.php' => 'http://doc.pfsense.org/index.php/Captive_Portal',
+	'services_captiveportal_mac.php' => 'http://doc.pfsense.org/index.php/Captive_Portal',
+	'services_captiveportal_mac_edit.php' => 'http://doc.pfsense.org/index.php/Captive_Portal',
+	'services_captiveportal_hostname.php' => 'http://doc.pfsense.org/index.php/Captive_Portal',
+	'services_captiveportal_hostname_edit.php' => 'http://doc.pfsense.org/index.php/Captive_Portal',
+	'status_captiveportal.php' => 'http://doc.pfsense.org/index.php/Captive_Portal_Status',
+	'status_captiveportal_test.php' => 'http://doc.pfsense.org/index.php/Captive_Portal_Status',
+	'services_captiveportal_vouchers.php' => 'http://doc.pfsense.org/index.php/Captive_Portal_Vouchers',
+	'services_captiveportal_vouchers_edit.php' => 'http://doc.pfsense.org/index.php/Captive_Portal_Vouchers',
+	'status_captiveportal_voucher_rolls.php' => 'http://doc.pfsense.org/index.php/Captive_Portal_Vouchers',
+	'status_captiveportal_vouchers.php' => 'http://doc.pfsense.org/index.php/Captive_Portal_Vouchers',
+	'status_openvpn.php' => 'http://doc.pfsense.org/index.php/OpenVPN_Status',
+	'vpn_openvpn_client.php' => 'http://doc.pfsense.org/index.php/OpenVPN_Settings',
+	'vpn_openvpn_csc.php' => 'http://doc.pfsense.org/index.php/OpenVPN_Settings',
+	'vpn_openvpn_server.php' => 'http://doc.pfsense.org/index.php/OpenVPN_Settings',
+	'openvpn-client-export.xml' => 'http://doc.pfsense.org/index.php/OpenVPN_Client_Exporter', /* Package */
+	'vpn_openvpn_export.php' => 'http://doc.pfsense.org/index.php/OpenVPN_Client_Exporter', /* Package */
+	'diag_authentication.php' => 'http://doc.pfsense.org/index.php/User_Authentication_Servers',
+	'diag_limiter_info.php' => 'http://doc.pfsense.org/index.php/Traffic_Shaping_Guide#Display_Pipes',
+	'diag_pf_info.php' => 'http://doc.pfsense.org/index.php/Packet_Filter_Information',
+	'diag_smart.php' => 'http://doc.pfsense.org/index.php/SMART_Status',
+	'diag_states_summary.php' => 'http://doc.pfsense.org/index.php/States_Summary',
+	'interfaces_wireless.php' => 'http://doc.pfsense.org/index.php/Wireless_Interfaces',
+	'interfaces_wireless_edit.php' => 'http://doc.pfsense.org/index.php/Wireless_Interfaces',
+	'system_crlmanager.php' => 'http://doc.pfsense.org/index.php/Certificate_Management',
+	'crash_reporter.php' => 'http://doc.pfsense.org/index.php/Unexpected_Reboot_Troubleshooting',
+	'diag_dump_states_sources.php' => "http://doc.pfsense.org/index.php/Show_Source_Tracking",
+	'diag_logs_gateways.php' => "http://doc.pfsense.org/index.php/Gateway_Logs",
+	'diag_logs_resolver.php' => "http://doc.pfsense.org/index.php/Resolver_Logs",
+	'diag_logs_routing.php' => "http://doc.pfsense.org/index.php/Routing_Logs",
+	'diag_logs_wireless.php' => "http://doc.pfsense.org/index.php/Wireless_Logs",
+	'diag_ndp.php' => "http://doc.pfsense.org/index.php/NDP_Table",
+	'diag_sockets.php' => "http://doc.pfsense.org/index.php/Diag_Sockets",
+	'diag_testport.php' => "http://doc.pfsense.org/index.php/Test_Port",
+	'firewall_nat_npt.php' => "http://doc.pfsense.org/index.php/NPt",
+	'firewall_nat_npt_edit.php' => "http://doc.pfsense.org/index.php/NPt",
+	'load_balancer_setting.php' => "http://doc.pfsense.org/index.php/Category:Load_balancing",
+	'services_captiveportal_zones.php' => "http://doc.pfsense.org/index.php/Captive_Portal",
+	'services_captiveportal_zones_edit.php' => "http://doc.pfsense.org/index.php/Captive_Portal",
+	'status_captiveportal_expire.php' => "http://doc.pfsense.org/index.php/Captive_Portal",
+	'services_ntpd.php' => "http://doc.pfsense.org/index.php/NTP_Server",
+	'status_ntpd.php' => "http://doc.pfsense.org/index.php/NTP_Server",
+	'system_firmware_restorefullbackup.php' => "http://doc.pfsense.org/index.php/Full_Backup",
 
 	/* New Files for 2.1 that still need better pages/links. */
-	'services_dhcpv6.php' => "https://doc.pfsense.org/index.php/Category:IPv6",
-	'services_dhcpv6_edit.php' => "https://doc.pfsense.org/index.php/Category:IPv6",
-	'services_dhcpv6_relay.php' => "https://doc.pfsense.org/index.php/Category:IPv6",
-	'status_dhcpv6_leases.php' => "https://doc.pfsense.org/index.php/Category:IPv6",
-	'services_router_advertisements.php' => "https://doc.pfsense.org/index.php/Category:IPv6",
+	'services_dhcpv6.php' => "http://doc.pfsense.org/index.php/Category:IPv6",
+	'services_dhcpv6_edit.php' => "http://doc.pfsense.org/index.php/Category:IPv6",
+	'services_dhcpv6_relay.php' => "http://doc.pfsense.org/index.php/Category:IPv6",
+	'status_dhcpv6_leases.php' => "http://doc.pfsense.org/index.php/Category:IPv6",
+	'services_router_advertisements.php' => "http://doc.pfsense.org/index.php/Category:IPv6",
 
 	/* Below here are pages that may need some cleanup or have not been fully looked at yet */
 
-	'carp_status.php' => 'https://doc.pfsense.org/index.php/Category:CARP',
-	'system_hasync.php' => 'https://doc.pfsense.org/index.php/Category:CARP', /* FIXME? */
+	'carp_status.php' => 'http://doc.pfsense.org/index.php/Category:CARP',
+	'system_hasync.php' => 'http://doc.pfsense.org/index.php/Category:CARP', /* FIXME? */
 
-	'load_balancer_monitor.php' => 'https://doc.pfsense.org/index.php/Category:Load_balancing',
-	'load_balancer_monitor_edit.php' => 'https://doc.pfsense.org/index.php/Category:Load_balancing',
-	'load_balancer_pool.php' => 'https://doc.pfsense.org/index.php/Category:Load_balancing',
-	'load_balancer_pool_edit.php' => 'https://doc.pfsense.org/index.php/Category:Load_balancing',
-	'load_balancer_relay_action.php' => 'https://doc.pfsense.org/index.php/Category:Load_balancing',
-	'load_balancer_relay_action_edit.php' => 'https://doc.pfsense.org/index.php/Category:Load_balancing',
-	'load_balancer_relay_protocol.php' => 'https://doc.pfsense.org/index.php/Category:Load_balancing',
-	'load_balancer_relay_protocol_edit.php' => 'https://doc.pfsense.org/index.php/Category:Load_balancing',
-	'load_balancer_virtual_server.php' => 'https://doc.pfsense.org/index.php/Category:Load_balancing',
-	'load_balancer_virtual_server_edit.php' => 'https://doc.pfsense.org/index.php/Category:Load_balancing',
-	'status_lb_pool.php' => 'https://doc.pfsense.org/index.php/Category:Load_balancing',
-	'status_lb_vs.php' => 'https://doc.pfsense.org/index.php/Category:Load_balancing',
+	'load_balancer_monitor.php' => 'http://doc.pfsense.org/index.php/Category:Load_balancing',
+	'load_balancer_monitor_edit.php' => 'http://doc.pfsense.org/index.php/Category:Load_balancing',
+	'load_balancer_pool.php' => 'http://doc.pfsense.org/index.php/Category:Load_balancing',
+	'load_balancer_pool_edit.php' => 'http://doc.pfsense.org/index.php/Category:Load_balancing',
+	'load_balancer_relay_action.php' => 'http://doc.pfsense.org/index.php/Category:Load_balancing',
+	'load_balancer_relay_action_edit.php' => 'http://doc.pfsense.org/index.php/Category:Load_balancing',
+	'load_balancer_relay_protocol.php' => 'http://doc.pfsense.org/index.php/Category:Load_balancing',
+	'load_balancer_relay_protocol_edit.php' => 'http://doc.pfsense.org/index.php/Category:Load_balancing',
+	'load_balancer_virtual_server.php' => 'http://doc.pfsense.org/index.php/Category:Load_balancing',
+	'load_balancer_virtual_server_edit.php' => 'http://doc.pfsense.org/index.php/Category:Load_balancing',
+	'status_lb_pool.php' => 'http://doc.pfsense.org/index.php/Category:Load_balancing',
+	'status_lb_vs.php' => 'http://doc.pfsense.org/index.php/Category:Load_balancing',
 
 
 	/* From here down are packages. Not checking these as strictly, 
 	any information is better than nothing. */
-	'olsrd.xml' => 'https://doc.pfsense.org/index.php/OLSR_Daemon',
-	'routed.xml' => 'https://doc.pfsense.org/index.php/Routing_Information_Protocol_(RIP)', # RIP
-	'autoconfigbackup.xml' => 'https://doc.pfsense.org/index.php/AutoConfigBackup',
-	'phpservice.xml' => 'https://doc.pfsense.org/index.php/PHPService',
-	'anyterm.xml' => 'https://doc.pfsense.org/index.php/AnyTerm_package',
-	'avahi.xml' => 'https://doc.pfsense.org/index.php/Avahi_package',
-	'squid.xml' => 'https://doc.pfsense.org/index.php/Category:Squid',
-	'squid_auth.xml' => 'https://doc.pfsense.org/index.php/Category:Squid',
-	'squid_cache.xml' => 'https://doc.pfsense.org/index.php/Category:Squid',
-	'squid_extauth.xml' => 'https://doc.pfsense.org/index.php/Category:Squid',
-	'squid_nac.xml' => 'https://doc.pfsense.org/index.php/Category:Squid',
-	'squid_ng.xml' => 'https://doc.pfsense.org/index.php/Category:Squid',
-	'squid_traffic.xml' => 'https://doc.pfsense.org/index.php/Category:Squid',
-	'squid_upstream.xml' => 'https://doc.pfsense.org/index.php/Category:Squid',
-	'squid_users.xml' => 'https://doc.pfsense.org/index.php/Category:Squid',
-	'squidGuard.xml' => 'https://doc.pfsense.org/index.php/SquidGuard_package',
-	'squidguard.xml' => 'https://doc.pfsense.org/index.php/SquidGuard_package',
-	'squidguard_acl.xml' => 'https://doc.pfsense.org/index.php/SquidGuard_package',
-	'squidguard_default.xml' => 'https://doc.pfsense.org/index.php/SquidGuard_package',
-	'squidguard_dest.xml' => 'https://doc.pfsense.org/index.php/SquidGuard_package',
-	'squidguard_log.xml' => 'https://doc.pfsense.org/index.php/SquidGuard_package',
-	'squidguard_rewr.xml' => 'https://doc.pfsense.org/index.php/SquidGuard_package',
-	'squidguard_time.xml' => 'https://doc.pfsense.org/index.php/SquidGuard_package',
-	'bandwidthd.xml' => "https://doc.pfsense.org/index.php/How_can_I_monitor_bandwidth_usage%3F",
-	'pfflowd.xml' => "https://doc.pfsense.org/index.php/How_can_I_monitor_bandwidth_usage%3F",
-	'darkstat.xml' => "https://doc.pfsense.org/index.php/How_can_I_monitor_bandwidth_usage%3F",
-	'rate.xml' => "https://doc.pfsense.org/index.php/How_can_I_monitor_bandwidth_usage%3F",
-	'ntop.xml' => "https://doc.pfsense.org/index.php/How_can_I_monitor_bandwidth_usage%3F",
-	'vnstat.xml' => "https://doc.pfsense.org/index.php/How_can_I_monitor_bandwidth_usage%3F",
-	'widentd.xml' => 'https://doc.pfsense.org/index.php/Widentd_package',
-	'tinydns.xml' => 'https://doc.pfsense.org/index.php/Tinydns_package',
-	'tinydns_domains.xml' => 'https://doc.pfsense.org/index.php/Tinydns_package',
-	'tinydns_sync.xml' => 'https://doc.pfsense.org/index.php/Tinydns_package',
-	'blinkled.xml' => 'https://doc.pfsense.org/index.php/BlinkLED_Package',
-	'freeswitch.xml' => 'https://doc.pfsense.org/index.php/FreeSWITCH',
-	'freeswitch_modules.xml' => 'https://doc.pfsense.org/index.php/FreeSWITCH',
-	'dialplan.default.xml' => 'https://doc.pfsense.org/index.php/FreeSWITCH',
-	'dialplan.public.xml' => 'https://doc.pfsense.org/index.php/FreeSWITCH',
-	'havp.xml' => 'https://doc.pfsense.org/index.php/HAVP_Package_for_HTTP_Anti-Virus_Scanning',
-	'havp_avset.xml' => 'https://doc.pfsense.org/index.php/HAVP_Package_for_HTTP_Anti-Virus_Scanning',
-	'havp_blacklist.xml' => 'https://doc.pfsense.org/index.php/HAVP_Package_for_HTTP_Anti-Virus_Scanning',
-	'havp_fscan.xml' => 'https://doc.pfsense.org/index.php/HAVP_Package_for_HTTP_Anti-Virus_Scanning',
-	'havp_trans_exclude.xml' => 'https://doc.pfsense.org/index.php/HAVP_Package_for_HTTP_Anti-Virus_Scanning',
-	'havp_whitelist.xml' => 'https://doc.pfsense.org/index.php/HAVP_Package_for_HTTP_Anti-Virus_Scanning',
-	'snort.xml' => 'https://doc.pfsense.org/index.php/Setup_Snort_Package',
-	'snort_advanced.xml' => 'https://doc.pfsense.org/index.php/Setup_Snort_Package',
-	'snort_define_servers.xml' => 'https://doc.pfsense.org/index.php/Setup_Snort_Package',
-	'snort_threshold.xml' => 'https://doc.pfsense.org/index.php/Setup_Snort_Package',
-	'snort_whitelist.xml' => 'https://doc.pfsense.org/index.php/Setup_Snort_Package',
-	'stunnel.xml' => 'https://doc.pfsense.org/index.php/Stunnel_package',
-	'stunnel_certs.xml' => 'https://doc.pfsense.org/index.php/Stunnel_package',
-	'openbgpd.xml' => 'https://doc.pfsense.org/index.php/OpenBGPD_package',
-	'openbgpd_groups.xml' => 'https://doc.pfsense.org/index.php/OpenBGPD_package',
-	'openbgpd_neighbors.xml' => 'https://doc.pfsense.org/index.php/OpenBGPD_package',
-	'iperf.xml' => 'https://doc.pfsense.org/index.php/Iperf_package',
-	'iperfserver.xml' => 'https://doc.pfsense.org/index.php/Iperf_package',
-	'jail_template.xml' => 'https://doc.pfsense.org/index.php/PfJailctl_package',
-	'jailctl.xml' => 'https://doc.pfsense.org/index.php/PfJailctl_package',
-	'jailctl.xml' => 'https://doc.pfsense.org/index.php/PfJailctl_package',
-	'jailctl_defaults.xml' => 'https://doc.pfsense.org/index.php/PfJailctl_package',
-	'jailctl_settings.xml' => 'https://doc.pfsense.org/index.php/PfJailctl_package',
-	'siproxd.xml' => 'https://doc.pfsense.org/index.php/Siproxd_package',
-	'siproxdusers.xml' => 'https://doc.pfsense.org/index.php/Siproxd_package',
-	'open-vm-tools.xml' => 'https://doc.pfsense.org/index.php/Open_VM_Tools_package',
-	'arping.xml' => 'https://doc.pfsense.org/index.php/Arping_package',
-	'unbound.xml' => 'https://doc.pfsense.org/index.php/Unbound_package',
+	'olsrd.xml' => 'http://doc.pfsense.org/index.php/OLSR_Daemon',
+	'routed.xml' => 'http://doc.pfsense.org/index.php/Routing_Information_Protocol_(RIP)', # RIP
+	'autoconfigbackup.xml' => 'http://doc.pfsense.org/index.php/AutoConfigBackup',
+	'phpservice.xml' => 'http://doc.pfsense.org/index.php/PHPService',
+	'anyterm.xml' => 'http://doc.pfsense.org/index.php/AnyTerm_package',
+	'avahi.xml' => 'http://doc.pfsense.org/index.php/Avahi_package',
+	'squid.xml' => 'http://doc.pfsense.org/index.php/Category:Squid',
+	'squid_auth.xml' => 'http://doc.pfsense.org/index.php/Category:Squid',
+	'squid_cache.xml' => 'http://doc.pfsense.org/index.php/Category:Squid',
+	'squid_extauth.xml' => 'http://doc.pfsense.org/index.php/Category:Squid',
+	'squid_nac.xml' => 'http://doc.pfsense.org/index.php/Category:Squid',
+	'squid_ng.xml' => 'http://doc.pfsense.org/index.php/Category:Squid',
+	'squid_traffic.xml' => 'http://doc.pfsense.org/index.php/Category:Squid',
+	'squid_upstream.xml' => 'http://doc.pfsense.org/index.php/Category:Squid',
+	'squid_users.xml' => 'http://doc.pfsense.org/index.php/Category:Squid',
+	'squidGuard.xml' => 'http://doc.pfsense.org/index.php/SquidGuard_package',
+	'squidguard.xml' => 'http://doc.pfsense.org/index.php/SquidGuard_package',
+	'squidguard_acl.xml' => 'http://doc.pfsense.org/index.php/SquidGuard_package',
+	'squidguard_default.xml' => 'http://doc.pfsense.org/index.php/SquidGuard_package',
+	'squidguard_dest.xml' => 'http://doc.pfsense.org/index.php/SquidGuard_package',
+	'squidguard_log.xml' => 'http://doc.pfsense.org/index.php/SquidGuard_package',
+	'squidguard_rewr.xml' => 'http://doc.pfsense.org/index.php/SquidGuard_package',
+	'squidguard_time.xml' => 'http://doc.pfsense.org/index.php/SquidGuard_package',
+	'bandwidthd.xml' => "http://doc.pfsense.org/index.php/How_can_I_monitor_bandwidth_usage%3F",
+	'pfflowd.xml' => "http://doc.pfsense.org/index.php/How_can_I_monitor_bandwidth_usage%3F",
+	'darkstat.xml' => "http://doc.pfsense.org/index.php/How_can_I_monitor_bandwidth_usage%3F",
+	'rate.xml' => "http://doc.pfsense.org/index.php/How_can_I_monitor_bandwidth_usage%3F",
+	'ntop.xml' => "http://doc.pfsense.org/index.php/How_can_I_monitor_bandwidth_usage%3F",
+	'vnstat.xml' => "http://doc.pfsense.org/index.php/How_can_I_monitor_bandwidth_usage%3F",
+	'widentd.xml' => 'http://doc.pfsense.org/index.php/Widentd_package',
+	'tinydns.xml' => 'http://doc.pfsense.org/index.php/Tinydns_package',
+	'tinydns_domains.xml' => 'http://doc.pfsense.org/index.php/Tinydns_package',
+	'tinydns_sync.xml' => 'http://doc.pfsense.org/index.php/Tinydns_package',
+	'blinkled.xml' => 'http://doc.pfsense.org/index.php/BlinkLED_Package',
+	'freeswitch.xml' => 'http://doc.pfsense.org/index.php/FreeSWITCH',
+	'freeswitch_modules.xml' => 'http://doc.pfsense.org/index.php/FreeSWITCH',
+	'dialplan.default.xml' => 'http://doc.pfsense.org/index.php/FreeSWITCH',
+	'dialplan.public.xml' => 'http://doc.pfsense.org/index.php/FreeSWITCH',
+	'havp.xml' => 'http://doc.pfsense.org/index.php/HAVP_Package_for_HTTP_Anti-Virus_Scanning',
+	'havp_avset.xml' => 'http://doc.pfsense.org/index.php/HAVP_Package_for_HTTP_Anti-Virus_Scanning',
+	'havp_blacklist.xml' => 'http://doc.pfsense.org/index.php/HAVP_Package_for_HTTP_Anti-Virus_Scanning',
+	'havp_fscan.xml' => 'http://doc.pfsense.org/index.php/HAVP_Package_for_HTTP_Anti-Virus_Scanning',
+	'havp_trans_exclude.xml' => 'http://doc.pfsense.org/index.php/HAVP_Package_for_HTTP_Anti-Virus_Scanning',
+	'havp_whitelist.xml' => 'http://doc.pfsense.org/index.php/HAVP_Package_for_HTTP_Anti-Virus_Scanning',
+	'snort.xml' => 'http://doc.pfsense.org/index.php/Setup_Snort_Package',
+	'snort_advanced.xml' => 'http://doc.pfsense.org/index.php/Setup_Snort_Package',
+	'snort_define_servers.xml' => 'http://doc.pfsense.org/index.php/Setup_Snort_Package',
+	'snort_threshold.xml' => 'http://doc.pfsense.org/index.php/Setup_Snort_Package',
+	'snort_whitelist.xml' => 'http://doc.pfsense.org/index.php/Setup_Snort_Package',
+	'stunnel.xml' => 'http://doc.pfsense.org/index.php/Stunnel_package',
+	'stunnel_certs.xml' => 'http://doc.pfsense.org/index.php/Stunnel_package',
+	'openbgpd.xml' => 'http://doc.pfsense.org/index.php/OpenBGPD_package',
+	'openbgpd_groups.xml' => 'http://doc.pfsense.org/index.php/OpenBGPD_package',
+	'openbgpd_neighbors.xml' => 'http://doc.pfsense.org/index.php/OpenBGPD_package',
+	'iperf.xml' => 'http://doc.pfsense.org/index.php/Iperf_package',
+	'iperfserver.xml' => 'http://doc.pfsense.org/index.php/Iperf_package',
+	'jail_template.xml' => 'http://doc.pfsense.org/index.php/PfJailctl_package',
+	'jailctl.xml' => 'http://doc.pfsense.org/index.php/PfJailctl_package',
+	'jailctl.xml' => 'http://doc.pfsense.org/index.php/PfJailctl_package',
+	'jailctl_defaults.xml' => 'http://doc.pfsense.org/index.php/PfJailctl_package',
+	'jailctl_settings.xml' => 'http://doc.pfsense.org/index.php/PfJailctl_package',
+	'siproxd.xml' => 'http://doc.pfsense.org/index.php/Siproxd_package',
+	'siproxdusers.xml' => 'http://doc.pfsense.org/index.php/Siproxd_package',
+	'open-vm-tools.xml' => 'http://doc.pfsense.org/index.php/Open_VM_Tools_package',
+	'arping.xml' => 'http://doc.pfsense.org/index.php/Arping_package',
+	'unbound.xml' => 'http://doc.pfsense.org/index.php/Unbound_package',
 
 );
 
@@ -425,7 +425,7 @@ if (array_key_exists($pagename, $helppages)) {
 	 stating that a given page does not have help yet. */
 
 if (empty($helppage)) {
-	$helppage = "https://doc.pfsense.org/index.php/No_Help_Found";
+	$helppage = "http://doc.pfsense.org/index.php/No_Help_Found";
 
 }
 
diff --git a/usr/local/www/includes/functions.inc.php b/usr/local/www/includes/functions.inc.php
index 7ad0ed9..33cb585 100644
--- a/usr/local/www/includes/functions.inc.php
+++ b/usr/local/www/includes/functions.inc.php
@@ -8,7 +8,6 @@ if(Connection_Aborted()) {
 }
 
 require_once("config.inc");
-require_once("pfsense-utils.inc");
 
 function get_stats() {
 	$stats['cpu'] = cpu_usage();
@@ -72,14 +71,21 @@ function get_gatewaystats() {
 			$bgcolor = "#ADD8E6";  // lightblue
 		}
 		$data .= ($online == "Pending") ? "{$online},{$online}," : "{$gws['delay']},{$gws['loss']},";
-		$data .= "<table><tr><td bgcolor=\"$bgcolor\">&nbsp;$online&nbsp;</td></td></tr></table>";
+		$data .= "<table border=\"0\" cellpadding=\"0\" cellspacing=\"2\" summary=\"status\"><tr><td bgcolor=\"$bgcolor\">&nbsp;$online&nbsp;</td></tr></table>";
 	}
 	return $data;
 }
 
 function get_uptime() {
-	$uptime = get_uptime_sec();
+	$boottime = "";
+	$matches = "";
+	exec("/sbin/sysctl -n kern.boottime", $boottime);
+	preg_match("/sec = (\d+)/", $boottime[0], $matches);
+	$boottime = $matches[1];
+	$uptime = time() - $boottime;
 
+	if(intval($boottime) == 0)
+		return;
 	if(intval($uptime) == 0)
 		return;
 
@@ -145,13 +151,8 @@ function get_pfstate($percent=false) {
 	if (preg_match("/([0-9]+)/", $curentries, $matches)) {
 		$curentries = $matches[1];
 	}
-	if (!is_numeric($curentries))
-		$curentries = 0;
 	if ($percent)
-		if (intval($maxstates) > 0)
-			return round(($curentries / $maxstates) * 100, 0);
-		else
-			return "NA";
+		return round(($curentries / $maxstates) * 100, 0);
 	else
 		return $curentries . "/" . $maxstates;
 }
@@ -171,10 +172,7 @@ function get_mbuf($percent=false) {
 	$mbufs_output=trim(`/usr/bin/netstat -mb | /usr/bin/grep "mbuf clusters in use" | /usr/bin/awk '{ print $1 }'`);
 	list( $mbufs_current, $mbufs_cache, $mbufs_total, $mbufs_max ) = explode( "/", $mbufs_output);
 	if ($percent)
-		if ($mbufs_max > 0)
-			return round(($mbufs_total / $mbufs_max) * 100, 0);
-		else
-			return "NA";
+		return round(($mbufs_total / $mbufs_max) * 100, 0);
 	else
 		return "{$mbufs_total}/{$mbufs_max}";
 }
@@ -219,10 +217,7 @@ function mem_usage() {
 	$totalMem = $memory[0];
 	$availMem = $memory[1] + $memory[2] + $memory[3];
 	$usedMem = $totalMem - $availMem;
-	if ($totalMem > 0)
-		$memUsage = round(($usedMem * 100) / $totalMem, 0);
-	else
-		$memUsage = "NA";
+	$memUsage = round(($usedMem * 100) / $totalMem, 0);
 
 	return $memUsage;
 }
diff --git a/usr/local/www/interfaces.php b/usr/local/www/interfaces.php
index bfea79d..22fc811 100755
--- a/usr/local/www/interfaces.php
+++ b/usr/local/www/interfaces.php
@@ -4,7 +4,7 @@
 	interfaces.php
 	Copyright (C) 2004-2008 Scott Ullrich
 	Copyright (C) 2006 Daniel S. Haischt.
-	Copyright (C) 2008-2010 Ermal Luçi
+	Copyright (C) 2008-2010 Ermal Lu�i
 	All rights reserved.
 
 	originally part of m0n0wall (http://m0n0.ch/wall)
@@ -176,60 +176,6 @@ $pconfig['dhcphostname'] = $wancfg['dhcphostname'];
 $pconfig['alias-address'] = $wancfg['alias-address'];
 $pconfig['alias-subnet'] = $wancfg['alias-subnet'];
 $pconfig['dhcprejectfrom'] = $wancfg['dhcprejectfrom'];
-
-$pconfig['adv_dhcp_pt_timeout'] = $wancfg['adv_dhcp_pt_timeout'];
-$pconfig['adv_dhcp_pt_retry'] = $wancfg['adv_dhcp_pt_retry'];
-$pconfig['adv_dhcp_pt_select_timeout'] = $wancfg['adv_dhcp_pt_select_timeout'];
-$pconfig['adv_dhcp_pt_reboot'] = $wancfg['adv_dhcp_pt_reboot'];
-$pconfig['adv_dhcp_pt_backoff_cutoff'] = $wancfg['adv_dhcp_pt_backoff_cutoff'];
-$pconfig['adv_dhcp_pt_initial_interval'] = $wancfg['adv_dhcp_pt_initial_interval'];
-
-$pconfig['adv_dhcp_pt_values'] = $wancfg['adv_dhcp_pt_values'];
-
-$pconfig['adv_dhcp_send_options'] = $wancfg['adv_dhcp_send_options'];
-$pconfig['adv_dhcp_request_options'] = $wancfg['adv_dhcp_request_options'];
-$pconfig['adv_dhcp_required_options'] = $wancfg['adv_dhcp_required_options'];
-$pconfig['adv_dhcp_option_modifiers'] = $wancfg['adv_dhcp_option_modifiers'];
-
-$pconfig['adv_dhcp_config_advanced'] = $wancfg['adv_dhcp_config_advanced'];
-$pconfig['adv_dhcp_config_file_override'] = $wancfg['adv_dhcp_config_file_override'];
-$pconfig['adv_dhcp_config_file_override_path'] = $wancfg['adv_dhcp_config_file_override_path'];
-
-$pconfig['adv_dhcp6_interface_statement_send_options'] = $wancfg['adv_dhcp6_interface_statement_send_options'];
-$pconfig['adv_dhcp6_interface_statement_request_options'] = $wancfg['adv_dhcp6_interface_statement_request_options'];
-$pconfig['adv_dhcp6_interface_statement_information_only_enable'] = $wancfg['adv_dhcp6_interface_statement_information_only_enable'];
-$pconfig['adv_dhcp6_interface_statement_script'] = $wancfg['adv_dhcp6_interface_statement_script'];
-
-$pconfig['adv_dhcp6_id_assoc_statement_address_enable'] = $wancfg['adv_dhcp6_id_assoc_statement_address_enable'];
-$pconfig['adv_dhcp6_id_assoc_statement_address'] = $wancfg['adv_dhcp6_id_assoc_statement_address'];
-$pconfig['adv_dhcp6_id_assoc_statement_address_id'] = $wancfg['adv_dhcp6_id_assoc_statement_address_id'];
-$pconfig['adv_dhcp6_id_assoc_statement_address_pltime'] = $wancfg['adv_dhcp6_id_assoc_statement_address_pltime'];
-$pconfig['adv_dhcp6_id_assoc_statement_address_vltime'] = $wancfg['adv_dhcp6_id_assoc_statement_address_vltime'];
-
-$pconfig['adv_dhcp6_id_assoc_statement_prefix_enable'] = $wancfg['adv_dhcp6_id_assoc_statement_prefix_enable'];
-$pconfig['adv_dhcp6_id_assoc_statement_prefix'] = $wancfg['adv_dhcp6_id_assoc_statement_prefix'];
-$pconfig['adv_dhcp6_id_assoc_statement_prefix_id'] = $wancfg['adv_dhcp6_id_assoc_statement_prefix_id'];
-$pconfig['adv_dhcp6_id_assoc_statement_prefix_pltime'] = $wancfg['adv_dhcp6_id_assoc_statement_prefix_pltime'];
-$pconfig['adv_dhcp6_id_assoc_statement_prefix_vltime'] = $wancfg['adv_dhcp6_id_assoc_statement_prefix_vltime'];
-
-$pconfig['adv_dhcp6_prefix_interface_statement_sla_id'] = $wancfg['adv_dhcp6_prefix_interface_statement_sla_id'];
-$pconfig['adv_dhcp6_prefix_interface_statement_sla_len'] = $wancfg['adv_dhcp6_prefix_interface_statement_sla_len'];
-
-$pconfig['adv_dhcp6_authentication_statement_authname'] = $wancfg['adv_dhcp6_authentication_statement_authname'];
-$pconfig['adv_dhcp6_authentication_statement_protocol'] = $wancfg['adv_dhcp6_authentication_statement_protocol'];
-$pconfig['adv_dhcp6_authentication_statement_algorithm'] = $wancfg['adv_dhcp6_authentication_statement_algorithm'];
-$pconfig['adv_dhcp6_authentication_statement_rdm'] = $wancfg['adv_dhcp6_authentication_statement_rdm'];
-
-$pconfig['adv_dhcp6_key_info_statement_keyname'] = $wancfg['adv_dhcp6_key_info_statement_keyname'];
-$pconfig['adv_dhcp6_key_info_statement_realm'] = $wancfg['adv_dhcp6_key_info_statement_realm'];
-$pconfig['adv_dhcp6_key_info_statement_keyid'] = $wancfg['adv_dhcp6_key_info_statement_keyid'];
-$pconfig['adv_dhcp6_key_info_statement_secret'] = $wancfg['adv_dhcp6_key_info_statement_secret'];
-$pconfig['adv_dhcp6_key_info_statement_expire'] = $wancfg['adv_dhcp6_key_info_statement_expire'];
-
-$pconfig['adv_dhcp6_config_advanced'] = $wancfg['adv_dhcp6_config_advanced'];
-$pconfig['adv_dhcp6_config_file_override'] = $wancfg['adv_dhcp6_config_file_override'];
-$pconfig['adv_dhcp6_config_file_override_path'] = $wancfg['adv_dhcp6_config_file_override_path'];
-
 $pconfig['dhcp_plus'] = isset($wancfg['dhcp_plus']);
 $pconfig['descr'] = remove_bad_chars($wancfg['descr']);
 $pconfig['enable'] = isset($wancfg['enable']);
@@ -498,7 +444,7 @@ if ($_POST['apply']) {
 		case "staticv4":
 			$reqdfields = explode(" ", "ipaddr subnet gateway");
 			$reqdfieldsn = array(gettext("IPv4 address"),gettext("Subnet bit count"),gettext("Gateway"));
-			do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+			do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 			break;
 		case "none":
 			if(is_array($config['virtualip']['vip'])) {
@@ -514,7 +460,7 @@ if ($_POST['apply']) {
 		case "ppp":
 			$reqdfields = explode(" ", "port phone");
 			$reqdfieldsn = array(gettext("Modem Port"),gettext("Phone Number"));
-			do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+			do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 			break;
 		case "pppoe":
 			if ($_POST['pppoe_dialondemand']) {
@@ -524,7 +470,7 @@ if ($_POST['apply']) {
 				$reqdfields = explode(" ", "pppoe_username pppoe_password");
 				$reqdfieldsn = array(gettext("PPPoE username"),gettext("PPPoE password"));
 			}
-			do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+			do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 			break;
 		case "pptp":
 			if ($_POST['pptp_dialondemand']) {
@@ -534,7 +480,7 @@ if ($_POST['apply']) {
 				$reqdfields = explode(" ", "pptp_username pptp_password pptp_local pptp_subnet pptp_remote");
 				$reqdfieldsn = array(gettext("PPTP username"),gettext("PPTP password"),gettext("PPTP local IP address"),gettext("PPTP subnet"),gettext("PPTP remote IP address"));
 			}
-			do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+			do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 			break;
 		case "l2tp":
 			if ($_POST['pptp_dialondemand']) {
@@ -544,14 +490,14 @@ if ($_POST['apply']) {
 				$reqdfields = explode(" ", "pptp_username pptp_password pptp_remote");
 				$reqdfieldsn = array(gettext("L2TP username"),gettext("L2TP password"),gettext("L2TP remote IP address"));
 			}
-			do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+			do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 			break;
 	}
 	switch(strtolower($_POST['type6'])) {
 		case "staticv6":
 			$reqdfields = explode(" ", "ipaddrv6 subnetv6 gatewayv6");
 			$reqdfieldsn = array(gettext("IPv6 address"),gettext("Subnet bit count"),gettext("Gateway"));
-			do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+			do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 			break;
 		case "none":
 			if(is_array($config['virtualip']['vip'])) {
@@ -613,14 +559,6 @@ if ($_POST['apply']) {
 			if (is_ipaddr_configured($_POST['ipaddr'], $if, true))
 				$input_errors[] = gettext("This IPv4 address is being used by another interface or VIP.");
 
-			/* Do not accept network or broadcast address, except if subnet is 31 or 32 */
-			if ($_POST['subnet'] < 31) {
-				if ($_POST['ipaddr'] == gen_subnet($_POST['ipaddr'], $_POST['subnet']))
-					$input_errors[] = gettext("This IPv4 address is the network address and cannot be used");
-				else if ($_POST['ipaddr'] == gen_subnet_max($_POST['ipaddr'], $_POST['subnet']))
-					$input_errors[] = gettext("This IPv4 address is the broadcast address and cannot be used");
-			}
-
 			foreach ($staticroutes as $route_subnet) {
 				list($network, $subnet) = explode("/", $route_subnet);
 				if ($_POST['subnet'] == $subnet && $network == gen_subnet($_POST['ipaddr'], $_POST['subnet'])) {
@@ -698,15 +636,17 @@ if ($_POST['apply']) {
 		$input_errors[] = gettext("A valid MAC address must be specified.");
 	if ($_POST['mtu']) {
 		if ($_POST['mtu'] < 576 || $_POST['mtu'] > 9000)
-			$input_errors[] = gettext("The MTU must be greater than 576 bytes and less than 9000.");
+			$input_errors[] = gettext("The MTU must be greater than 576 bytes.");
 
 		if (stristr($wancfg['if'], "_vlan")) {
 			$realhwif_array = get_parent_interface($wancfg['if']);
 			// Need code to handle MLPPP if we ever use $realhwif for MLPPP handling
 			$parent_realhwif = $realhwif_array[0];
 			$parent_if = convert_real_interface_to_friendly_interface_name($parent_realhwif);
-			if (!empty($parent_if) && !empty($config['interfaces'][$parent_if]['mtu'])) {
-				if ($_POST['mtu'] > intval($config['interfaces'][$parent_if]['mtu']))
+			if (!empty($parent_if) && isset($config['interfaces'][$parent_if]['mtu'])) {
+				$parent_mtu = $config['interfaces'][$parent_if]['mtu'];
+
+				if ($_POST['mtu'] > $parent_mtu)
 					$input_errors[] = gettext("MTU of a vlan should not be bigger than parent interface.");
 			}
 		} else {
@@ -736,7 +676,7 @@ if ($_POST['apply']) {
 			$reqdfields[] = "ssid";
 			$reqdfieldsn[] = gettext("SSID");
 		}
-		do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+		do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 		check_wireless_mode();
 		/* loop through keys and enforce size */
 		for ($i = 1; $i <= 4; $i++) {
@@ -817,60 +757,6 @@ if ($_POST['apply']) {
 		unset($wancfg['prefix-6rd']);
 		unset($wancfg['prefix-6rd-v4plen']);
 		unset($wancfg['gateway-6rd']);
-
-		unset($wancfg['adv_dhcp_pt_timeout']);
-		unset($wancfg['adv_dhcp_pt_retry']);
-		unset($wancfg['adv_dhcp_pt_select_timeout']);
-		unset($wancfg['adv_dhcp_pt_reboot']);
-		unset($wancfg['adv_dhcp_pt_backoff_cutoff']);
-		unset($wancfg['adv_dhcp_pt_initial_interval']);
-
-		unset($wancfg['adv_dhcp_pt_values']);
-
-		unset($wancfg['adv_dhcp_send_options']);
-		unset($wancfg['adv_dhcp_request_options']);
-		unset($wancfg['adv_dhcp_required_options']);
-		unset($wancfg['adv_dhcp_option_modifiers']);
-
-		unset($wancfg['adv_dhcp_config_advanced']);
-		unset($wancfg['adv_dhcp_config_file_override']);
-		unset($wancfg['adv_dhcp_config_file_override_path']);
-
-		unset($wancfg['adv_dhcp6_interface_statement_send_options']);
-		unset($wancfg['adv_dhcp6_interface_statement_request_options']);
-		unset($wancfg['adv_dhcp6_interface_statement_information_only_enable']);
-		unset($wancfg['adv_dhcp6_interface_statement_script']);
-
-		unset($wancfg['adv_dhcp6_id_assoc_statement_address_enable']);
-		unset($wancfg['adv_dhcp6_id_assoc_statement_address']);
-		unset($wancfg['adv_dhcp6_id_assoc_statement_address_id']);
-		unset($wancfg['adv_dhcp6_id_assoc_statement_address_pltime']);
-		unset($wancfg['adv_dhcp6_id_assoc_statement_address_vltime']);
-
-		unset($wancfg['adv_dhcp6_id_assoc_statement_prefix_enable']);
-		unset($wancfg['adv_dhcp6_id_assoc_statement_prefix']);
-		unset($wancfg['adv_dhcp6_id_assoc_statement_prefix_id']);
-		unset($wancfg['adv_dhcp6_id_assoc_statement_prefix_pltime']);
-		unset($wancfg['adv_dhcp6_id_assoc_statement_prefix_vltime']);
-
-		unset($wancfg['adv_dhcp6_prefix_interface_statement_sla_id']);
-		unset($wancfg['adv_dhcp6_prefix_interface_statement_sla_len']);
-
-		unset($wancfg['adv_dhcp6_authentication_statement_authname']);
-		unset($wancfg['adv_dhcp6_authentication_statement_protocol']);
-		unset($wancfg['adv_dhcp6_authentication_statement_algorithm']);
-		unset($wancfg['adv_dhcp6_authentication_statement_rdm']);
-
-		unset($wancfg['adv_dhcp6_key_info_statement_keyname']);
-		unset($wancfg['adv_dhcp6_key_info_statement_realm']);
-		unset($wancfg['adv_dhcp6_key_info_statement_keyid']);
-		unset($wancfg['adv_dhcp6_key_info_statement_secret']);
-		unset($wancfg['adv_dhcp6_key_info_statement_expire']);
-
-		unset($wancfg['adv_dhcp6_config_advanced']);
-		unset($wancfg['adv_dhcp6_config_file_override']);
-		unset($wancfg['adv_dhcp6_config_file_override_path']);
-
 		unset($wancfg['pppoe_password']);
 		unset($wancfg['pptp_username']);
 		unset($wancfg['pptp_password']);
@@ -908,25 +794,6 @@ if ($_POST['apply']) {
 				$wancfg['alias-address'] = $_POST['alias-address'];
 				$wancfg['alias-subnet'] = $_POST['alias-subnet'];
 				$wancfg['dhcprejectfrom'] = $_POST['dhcprejectfrom'];
-
-				$wancfg['adv_dhcp_pt_timeout'] = $_POST['adv_dhcp_pt_timeout'];
-				$wancfg['adv_dhcp_pt_retry'] = $_POST['adv_dhcp_pt_retry'];
-				$wancfg['adv_dhcp_pt_select_timeout'] = $_POST['adv_dhcp_pt_select_timeout'];
-				$wancfg['adv_dhcp_pt_reboot'] = $_POST['adv_dhcp_pt_reboot'];
-				$wancfg['adv_dhcp_pt_backoff_cutoff'] = $_POST['adv_dhcp_pt_backoff_cutoff'];
-				$wancfg['adv_dhcp_pt_initial_interval'] = $_POST['adv_dhcp_pt_initial_interval'];
-
-				$wancfg['adv_dhcp_pt_values'] = $_POST['adv_dhcp_pt_values'];
-
-				$wancfg['adv_dhcp_send_options'] = $_POST['adv_dhcp_send_options'];
-				$wancfg['adv_dhcp_request_options'] = $_POST['adv_dhcp_request_options'];
-				$wancfg['adv_dhcp_required_options'] = $_POST['adv_dhcp_required_options'];
-				$wancfg['adv_dhcp_option_modifiers'] = $_POST['adv_dhcp_option_modifiers'];
-
-				$wancfg['adv_dhcp_config_advanced'] = $_POST['adv_dhcp_config_advanced'];
-				$wancfg['adv_dhcp_config_file_override'] = $_POST['adv_dhcp_config_file_override'];
-				$wancfg['adv_dhcp_config_file_override_path'] = $_POST['adv_dhcp_config_file_override_path'];
-
 				$wancfg['dhcp_plus'] = $_POST['dhcp_plus'] == "yes" ? true : false;
 				if($gateway_item) {
 					$a_gateways[] = $gateway_item;
@@ -1027,42 +894,6 @@ if ($_POST['apply']) {
 					$wancfg['dhcp6prefixonly'] = true;
 				if($_POST['dhcp6usev4iface'] == "yes")
 					$wancfg['dhcp6usev4iface'] = true;
-
-				$wancfg['adv_dhcp6_interface_statement_send_options'] = $_POST['adv_dhcp6_interface_statement_send_options'];
-				$wancfg['adv_dhcp6_interface_statement_request_options'] = $_POST['adv_dhcp6_interface_statement_request_options'];
-				$wancfg['adv_dhcp6_interface_statement_information_only_enable'] = $_POST['adv_dhcp6_interface_statement_information_only_enable'];
-				$wancfg['adv_dhcp6_interface_statement_script'] = $_POST['adv_dhcp6_interface_statement_script'];
-
-				$wancfg['adv_dhcp6_id_assoc_statement_address_enable'] = $_POST['adv_dhcp6_id_assoc_statement_address_enable'];
-				$wancfg['adv_dhcp6_id_assoc_statement_address'] = $_POST['adv_dhcp6_id_assoc_statement_address'];
-				$wancfg['adv_dhcp6_id_assoc_statement_address_id'] = $_POST['adv_dhcp6_id_assoc_statement_address_id'];
-				$wancfg['adv_dhcp6_id_assoc_statement_address_pltime'] = $_POST['adv_dhcp6_id_assoc_statement_address_pltime'];
-				$wancfg['adv_dhcp6_id_assoc_statement_address_vltime'] = $_POST['adv_dhcp6_id_assoc_statement_address_vltime'];
-
-				$wancfg['adv_dhcp6_id_assoc_statement_prefix_enable'] = $_POST['adv_dhcp6_id_assoc_statement_prefix_enable'];
-				$wancfg['adv_dhcp6_id_assoc_statement_prefix'] = $_POST['adv_dhcp6_id_assoc_statement_prefix'];
-				$wancfg['adv_dhcp6_id_assoc_statement_prefix_id'] = $_POST['adv_dhcp6_id_assoc_statement_prefix_id'];
-				$wancfg['adv_dhcp6_id_assoc_statement_prefix_pltime'] = $_POST['adv_dhcp6_id_assoc_statement_prefix_pltime'];
-				$wancfg['adv_dhcp6_id_assoc_statement_prefix_vltime'] = $_POST['adv_dhcp6_id_assoc_statement_prefix_vltime'];
-
-				$wancfg['adv_dhcp6_prefix_interface_statement_sla_id'] = $_POST['adv_dhcp6_prefix_interface_statement_sla_id'];
-				$wancfg['adv_dhcp6_prefix_interface_statement_sla_len'] = $_POST['adv_dhcp6_prefix_interface_statement_sla_len'];
-
-				$wancfg['adv_dhcp6_authentication_statement_authname'] = $_POST['adv_dhcp6_authentication_statement_authname'];
-				$wancfg['adv_dhcp6_authentication_statement_protocol'] = $_POST['adv_dhcp6_authentication_statement_protocol'];
-				$wancfg['adv_dhcp6_authentication_statement_algorithm'] = $_POST['adv_dhcp6_authentication_statement_algorithm'];
-				$wancfg['adv_dhcp6_authentication_statement_rdm'] = $_POST['adv_dhcp6_authentication_statement_rdm'];
-
-				$wancfg['adv_dhcp6_key_info_statement_keyname'] = $_POST['adv_dhcp6_key_info_statement_keyname'];
-				$wancfg['adv_dhcp6_key_info_statement_realm'] = $_POST['adv_dhcp6_key_info_statement_realm'];
-				$wancfg['adv_dhcp6_key_info_statement_keyid'] = $_POST['adv_dhcp6_key_info_statement_keyid'];
-				$wancfg['adv_dhcp6_key_info_statement_secret'] = $_POST['adv_dhcp6_key_info_statement_secret'];
-				$wancfg['adv_dhcp6_key_info_statement_expire'] = $_POST['adv_dhcp6_key_info_statement_expire'];
-
-				$wancfg['adv_dhcp6_config_advanced'] = $_POST['adv_dhcp6_config_advanced'];
-				$wancfg['adv_dhcp6_config_file_override'] = $_POST['adv_dhcp6_config_file_override'];
-				$wancfg['adv_dhcp6_config_file_override_path'] = $_POST['adv_dhcp6_config_file_override_path'];
-
 				if($gateway_item) {
 					$a_gateways[] = $gateway_item;
 				}
@@ -1897,12 +1728,7 @@ $types6 = array("none" => gettext("None"), "staticv6" => gettext("Static IPv6"),
 							<td colspan="2" style="padding: 0px;">
 								<table width="100%" border="0" cellpadding="6" cellspacing="0" summary="dhcp">
 									<tr>
-										<td colspan="2" valign="top" class="listtopic"><?=gettext("DHCP client configuration &nbsp &nbsp " .
-										' <input name="adv_dhcp_config_advanced" type="checkbox" id="adv_dhcp_config_advanced" value="" onClick="show_adv_dhcp_config(this)";> ' .
-										" Advanced &nbsp &nbsp " .
-										' <input name="adv_dhcp_config_file_override" type="checkbox" id="adv_dhcp_config_file_override" value="" onClick="show_adv_dhcp_config(this)";> ' .
-										" Config File Override &nbsp &nbsp "); ?>
-										</td>
+										<td colspan="2" valign="top" class="listtopic"><?=gettext("DHCP client configuration"); ?></td>
 									</tr>
 									<!-- Uncomment to expose DHCP+ in GUI
 									<tr>
@@ -1915,7 +1741,7 @@ $types6 = array("none" => gettext("None"), "staticv6" => gettext("Static IPv6"),
 										</td>
 									</tr>
 									-->
-									<tr style='display:none' name="show_basic_dhcphostname" id="show_basic_dhcphostname">
+									<tr>
 										<td width="22%" valign="top" class="vncell"><?=gettext("Hostname"); ?></td>
 										<td width="78%" class="vtable">
 											<input name="dhcphostname" type="text" class="formfld unknown" id="dhcphostname" size="40" value="<?=htmlspecialchars($pconfig['dhcphostname']);?>" />
@@ -1925,7 +1751,7 @@ $types6 = array("none" => gettext("None"), "staticv6" => gettext("Static IPv6"),
 											"this (for client identification)."); ?>
 										</td>
 									</tr>
-									<tr style='display:none' name="show_basic_dhcpalias-address" id="show_basic_dhcpalias-address">
+									<tr>
 										<td width="22%" valign="top" class="vncell"><?=gettext("Alias IPv4 address"); ?></td>
 										<td width="78%" class="vtable">
 											<input name="alias-address" type="text" class="formfld unknown" id="alias-address" size="20" value="<?=htmlspecialchars($pconfig['alias-address']);?>" />
@@ -1944,7 +1770,7 @@ $types6 = array("none" => gettext("None"), "staticv6" => gettext("Static IPv6"),
 											"DHCP client."); ?>
 										</td>
 									</tr>
-									<tr style='display:none' name="show_basic_dhcprejectlease" id="show_basic_dhcprejectlease">
+									<tr>
 										<td width="22%" valign="top" class="vncell"><?=gettext("Reject Leases From"); ?></td>
 										<td width="78%" class="vtable">
 											<input name="dhcprejectfrom" type="text" class="formfld unknown" id="dhcprejectfrom" size="20" value="<?=htmlspecialchars($pconfig['dhcprejectfrom']);?>" />
@@ -1953,150 +1779,9 @@ $types6 = array("none" => gettext("None"), "staticv6" => gettext("Static IPv6"),
 											<?=gettext("This is useful for rejecting leases from cable modems that offer private IPs when they lose upstream sync."); ?>
 										</td>
 									</tr>
-
-									<tr style='display:none' name="show_adv_dhcp_protocol_timing" id="show_adv_dhcp_protocol_timing">
-										<td width="22%" valign="top" class="vncell"><?=gettext("<a target=FreeBSD DHCP href=http://www.freebsd.org/cgi/man.cgi?query=dhclient.conf&sektion=5#PROTOCOL_TIMING>Protocol Timing</a>"); ?></td>
-										<td width="48%" class="vtable">
-											Timeout: <input name="adv_dhcp_pt_timeout" type="text" class="formfld unknown" id="adv_dhcp_pt_timeout" size="2" value="<?=htmlspecialchars($pconfig['adv_dhcp_pt_timeout']);?>" onChange="customdhcpptcheckradiobuton(document.iform.adv_dhcp_pt_values, '');">
-											Retry:   <input name="adv_dhcp_pt_retry"   type="text" class="formfld unknown" id="adv_dhcp_pt_retry"   size="2" value="<?=htmlspecialchars($pconfig['adv_dhcp_pt_retry']);?>"   onChange="customdhcpptcheckradiobuton(document.iform.adv_dhcp_pt_values, '');">
-											Select Timeout: <input name="adv_dhcp_pt_select_timeout" type="text" class="formfld unknown" id="adv_dhcp_pt_select_timeout" size="2" value="<?=htmlspecialchars($pconfig['adv_dhcp_pt_select_timeout']);?>" onChange="customdhcpptcheckradiobuton(document.iform.adv_dhcp_pt_values, '');">
-
-											&nbsp &nbsp &nbsp &nbsp 
-											Presets: &nbsp
-											<input name="adv_dhcp_pt_values" type="radio" value="DHCP"	unchecked	enabled id="customdhcpptdhcpdefaults"	onClick="customdhcpptsetvalues(this, iform);">FreeBSD Default &nbsp 
-											<input name="adv_dhcp_pt_values" type="radio" value="Clear"	unchecked	enabled id="customdhcpptclear"		onClick="customdhcpptsetvalues(this, iform);">Clear
-
-											<br>
-											Reboot: <input name="adv_dhcp_pt_reboot" type="text" class="formfld unknown" id="adv_dhcp_pt_reboot" size="2" value="<?=htmlspecialchars($pconfig['adv_dhcp_pt_reboot']);?>" onChange="customdhcpptcheckradiobuton(document.iform.adv_dhcp_pt_values, '');">
-											Backoff Cutoff:   <input name="adv_dhcp_pt_backoff_cutoff"   type="text" class="formfld unknown" id="adv_dhcp_pt_backoff_cutoff"   size="2" value="<?=htmlspecialchars($pconfig['adv_dhcp_pt_backoff_cutoff']);?>"   onChange="customdhcpptcheckradiobuton(document.iform.adv_dhcp_pt_values, '');">
-											Initial Interval: <input name="adv_dhcp_pt_initial_interval" type="text" class="formfld unknown" id="adv_dhcp_pt_initial_interval" size="2" value="<?=htmlspecialchars($pconfig['adv_dhcp_pt_initial_interval']);?>" onChange="customdhcpptcheckradiobuton(document.iform.adv_dhcp_pt_values, '');">
-
-											&nbsp &nbsp &nbsp &nbsp &nbsp 
-											<input name="adv_dhcp_pt_values" type="radio" value="pfSense"	unchecked	enabled id="customdhcpptpfsensedefaults"	onClick="customdhcpptsetvalues(this, iform);">pfSense Default &nbsp 
-											<input name="adv_dhcp_pt_values" type="radio" value="SavedCfg" checked	enabled id="customdhcpptsavedcfg"		onClick="customdhcpptsetvalues(this, iform);">Saved Cfg 
-
-											<br>
-											<?=gettext("The values in these fields are DHCP protocol timings used when requesting a lease. <br> " ); ?>
-
-											<script type="text/javascript">
-												function customdhcpptcheckradiobuton(T, BUTTON) {
-													for (var i = 0; i < T.length; i++) {
-														T[i].checked = false;
-														if (T[i].value == BUTTON) T[i].checked = true;
-													}
-													T.value = BUTTON;
-												}
-
-												function customdhcpptsetvalues(T, FORM) {
-													// timeout, retry, select-timeout, reboot, backoff-cutoff, initial-interval
-													if (T.value == "DHCP")		customdhcpptsetvaluesnow(T, FORM, "60", "300", "0", "10", "120", "10");
-													if (T.value == "pfSense")	customdhcpptsetvaluesnow(T, FORM, "60", "15", "0", "", "", "1");
-													if (T.value == "SavedCfg")	customdhcpptsetvaluesnow(T, FORM, "<?=htmlspecialchars($pconfig['adv_dhcp_pt_timeout']);?>", "<?=htmlspecialchars($pconfig['adv_dhcp_pt_retry']);?>", "<?=htmlspecialchars($pconfig['adv_dhcp_pt_select_timeout']);?>", "<?=htmlspecialchars($pconfig['adv_dhcp_pt_reboot']);?>", "<?=htmlspecialchars($pconfig['adv_dhcp_pt_backoff_cutoff']);?>", "<?=htmlspecialchars($pconfig['adv_dhcp_pt_initial_interval']);?>");
-													if (T.value == "Clear")		customdhcpptsetvaluesnow(T, FORM, "", "", "", "", "", "");
-												}
-
-												function customdhcpptsetvaluesnow(T, FORM, timeout, retry, selecttimeout, reboot, backoffcutoff, initialinterval) {
-													FORM.adv_dhcp_pt_timeout.value = timeout;
-													FORM.adv_dhcp_pt_retry.value = retry;
-													FORM.adv_dhcp_pt_select_timeout.value = selecttimeout;
-													FORM.adv_dhcp_pt_reboot.value = reboot;
-													FORM.adv_dhcp_pt_backoff_cutoff.value = backoffcutoff;
-													FORM.adv_dhcp_pt_initial_interval.value = initialinterval;
-
-													FORM.adv_dhcp_pt_values.value = T.value;
-												}
-
-												<!-- Set the adv_dhcp_pt_values radio button from saved config -->
-												var RADIOBUTTON_VALUE = "<?=htmlspecialchars($pconfig['adv_dhcp_pt_values']);?>";
-												if (RADIOBUTTON_VALUE == "") RADIOBUTTON_VALUE = "SavedCfg";
-												customdhcpptcheckradiobuton(document.iform.adv_dhcp_pt_values, RADIOBUTTON_VALUE);
-											</script>
-										</td>
-									</tr>
-
-									<tr style='display:none' name="show_adv_dhcp_lease_requirements_and_requests" id="show_adv_dhcp_lease_requirements_and_requests">
-										<td width="22%" valign="top" class="vncell"><?=gettext("<a target=FreeBSD DHCP href=http://www.freebsd.org/cgi/man.cgi?query=dhclient.conf&sektion=5#LEASE_REQUIREMENTS_AND_REQUESTS>Lease Requirements and Requests</a>"); ?></td>
-										<td width="78%" class="vtable">
-											<?=gettext("<a target=FreeBSD DHCP href=http://www.freebsd.org/cgi/man.cgi?query=dhclient.conf&sektion=5#LEASE_REQUIREMENTS_AND_REQUESTS>Send</a> <a target=FreeBSD DHCP href=http://www.freebsd.org/cgi/man.cgi?query=dhcp-options&sektion=5>Options</a>"); ?><br>
-											<input name="adv_dhcp_send_options" type="text" class="formfld unknown" id="adv_dhcp_send_options" size="86" value="<?=htmlspecialchars($pconfig['adv_dhcp_send_options']);?>">
-											<br>
-											<?=gettext("The values in this field are DHCP options to be sent when requesting a DHCP lease.  [option declaration [, ...]] <br>" .
-											"Value Substitutions: {interface}, {hostname}, {mac_addr_asciiCD}, {mac_addr_hexCD} <br>" .
-											"Where C is U(pper) or L(ower) Case, and D is \" :-.\" Delimiter (space, colon, hyphen, or period) (omitted for none). <br>" .
-											"Some ISPs may require certain options be or not be sent. "); ?>
-											<hr>
-											<?=gettext("<a target=FreeBSD DHCP href=http://www.freebsd.org/cgi/man.cgi?query=dhclient.conf&sektion=5#LEASE_REQUIREMENTS_AND_REQUESTS>Request</a> <a target=FreeBSD DHCP href=http://www.freebsd.org/cgi/man.cgi?query=dhcp-options&sektion=5>Options</a>"); ?><br>
-											<input name="adv_dhcp_request_options" type="text" class="formfld unknown" id="adv_dhcp_request_options" size="86" value="<?=htmlspecialchars($pconfig['adv_dhcp_request_options']);?>">
-											<br>
-											<?=gettext("The values in this field are DHCP option 55 to be sent when requesting a DHCP lease.  [option [, ...]] <br>" .
-											"Some ISPs may require certain options be or not be requested. "); ?>
-											<hr>
-											<?=gettext("<a target=FreeBSD DHCP href=http://www.freebsd.org/cgi/man.cgi?query=dhclient.conf&sektion=5#LEASE_REQUIREMENTS_AND_REQUESTS>Require</a> <a target=FreeBSD DHCP href=http://www.freebsd.org/cgi/man.cgi?query=dhcp-options&sektion=5>Options</a>"); ?><br>
-											<input name="adv_dhcp_required_options" type="text" class="formfld unknown" id="adv_dhcp_required_options" size="86" value="<?=htmlspecialchars($pconfig['adv_dhcp_required_options']);?>">
-											<br>
-											<?=gettext("The values in this field are DHCP options required by the client when requesting a DHCP lease.  [option [, ...]] "); ?>
-										</td>
-									</tr>
-
-									<tr style='display:none' name="show_adv_dhcp_option_modifiers" id="show_adv_dhcp_option_modifiers">
-										<td width="22%" valign="top" class="vncell"><?=gettext("<a target=FreeBSD DHCP href=http://www.freebsd.org/cgi/man.cgi?query=dhcp-options&sektion=5>Option</a> <a target=FreeBSD DHCP href=http://www.freebsd.org/cgi/man.cgi?query=dhclient.conf&sektion=5#OPTION_MODIFIERS>Modifiers</a>"); ?></td>
-										<td width="78%" class="vtable">
-											<input name="adv_dhcp_option_modifiers" type="text" class="formfld unknown" id="adv_dhcp_option_modifiers" size="86" value="<?=htmlspecialchars($pconfig['adv_dhcp_option_modifiers']);?>">
-											<br>
-											<?=gettext("The values in this field are DHCP option modifiers applied to obtained DHCP lease.  [modifier option declaration [, ...]] <br> " .
-											"modifiers: (default, supersede, prepend, append)"); ?>
-										</td>
-									</tr>
-
-									<tr style='display:none' name="show_adv_dhcp_config_file_override" id="show_adv_dhcp_config_file_override">
-										<td width="22%" valign="top" class="vncell"><?=gettext("<a target=FreeBSD DHCP href=http://www.freebsd.org/cgi/man.cgi?query=dhclient.conf&sektion=5>Configuration File</a> Override"); ?></td>
-										<td width="78%" class="vtable">
- 											<input name="adv_dhcp_config_file_override_path"   type="text" class="formfld unknown" id="adv_dhcp_config_file_override_path"  size="86" value="<?=htmlspecialchars($pconfig['adv_dhcp_config_file_override_path']);?>">
-											<br>
-											<?=gettext("The value in this field is the full absolute path to a DHCP client configuration file.  [/[dirname/[.../]]filename[.ext]] <br> " .
-											"Value Substitutions in Config File: {interface}, {hostname}, {mac_addr_asciiCD}, {mac_addr_hexCD} <br>" .
-											"Where C is U(pper) or L(ower) Case, and D is \" :-.\" Delimiter (space, colon, hyphen, or period) (omitted for none). <br>" .
-											"Some ISPs may require certain options be or not be sent. "); ?>
-										</td>
+									<tr>
+										<td colspan="2" valign="top" height="16"></td>
 									</tr>
-
- 									<tr>
- 										<td colspan="2" valign="top" height="16"></td>
- 									</tr>
-
-									<script type="text/javascript">
-										function show_adv_dhcp_config(T) {
-
-											if (T.checked) T.value = "Selected";
-											else T.value = "";
-
-											     if (document.iform.adv_dhcp_config_file_override.checked)	show_hide_adv_dhcp('none', 'none', '');
-											else if (document.iform.adv_dhcp_config_advanced.checked)	show_hide_adv_dhcp('', '', 'none');
-											else 									show_hide_adv_dhcp('', 'none', 'none');
-										}
-
-										function show_hide_adv_dhcp(basic, advanced, override) {
-
-											document.getElementById("show_basic_dhcphostname").style.display = basic;
-											document.getElementById("show_basic_dhcpalias-address").style.display = basic;
-											document.getElementById("show_basic_dhcprejectlease").style.display = basic;
-
-											document.getElementById("show_adv_dhcp_protocol_timing").style.display = advanced;
-											document.getElementById("show_adv_dhcp_lease_requirements_and_requests").style.display = advanced;
-											document.getElementById("show_adv_dhcp_option_modifiers").style.display = advanced;
-
-											document.getElementById("show_adv_dhcp_config_file_override").style.display = override;
-										}
-
-										<!-- Set the adv_dhcp_config_advanced checkbox from saved config -->
-										if ("<?=htmlspecialchars($pconfig['adv_dhcp_config_advanced']);?>" == "Selected") document.iform.adv_dhcp_config_advanced.checked = true;
-										show_adv_dhcp_config(document.iform.adv_dhcp_config_advanced);
-
-										<!-- Set the adv_dhcp_config_file_override checkbox from saved config -->
-										if ("<?=htmlspecialchars($pconfig['adv_dhcp_config_file_override']);?>" == "Selected") document.iform.adv_dhcp_config_file_override.checked = true;
-										show_adv_dhcp_config(document.iform.adv_dhcp_config_file_override);
-									</script>
-
 								</table>
 							</td>
 						</tr>
@@ -2104,15 +1789,10 @@ $types6 = array("none" => gettext("None"), "staticv6" => gettext("Static IPv6"),
 							<td colspan="2" style="padding: 0px;">
 								<table width="100%" border="0" cellpadding="6" cellspacing="0" summary="dhcp6">
 									<tr>
-										<td colspan="2" valign="top" class="listtopic"><?=gettext("DHCP6 client configuration &nbsp &nbsp " .
-										' <input name="adv_dhcp6_config_advanced" type="checkbox" id="adv_dhcp6_config_advanced" value="" onClick="show_adv_dhcp6_config(this)";> ' .
-										" Advanced &nbsp &nbsp " .
-										' <input name="adv_dhcp6_config_file_override" type="checkbox" id="adv_dhcp6_config_file_override" value="" onClick="show_adv_dhcp6_config(this)";> ' .
-										" Config File Override &nbsp &nbsp "); ?>
-										</td>
+										<td colspan="2" valign="top" class="listtopic"><?=gettext("DHCP6 client configuration"); ?></td>
 									</tr>
 									<!--- Leave commented out for now
-									<tr style='display:none' name="basicdhcp6_show_dhcp6_duid" id="basicdhcp6_show_dhcp6_duid">
+									<tr>
 										<td width="22%" valign="top" class="vncell"><?=gettext("DHCPv6 Unique Identifier (DUID)"); ?></td>
 										<td width="78%" class="vtable">
 											<input name="dhcp6-duid" type="text" class="formfld unknown" id="dhcp6-duid" size="40" value="<?=htmlspecialchars($pconfig['dhcp6-duid']);?>" />
@@ -2128,21 +1808,21 @@ $types6 = array("none" => gettext("None"), "staticv6" => gettext("Static IPv6"),
 										</td>
 									</tr>
 									-->
-									<tr style='display:none' name="basicdhcp6_use_pppoeinterface" id="basicdhcp6_use_pppoeinterface">
+									<tr>
 										<td width="22%" valign="top" class="vncell"><?=gettext("Use IPv4 connectivity as parent interface"); ?></td>
 										<td width="78%" class="vtable">
 											<input name="dhcp6usev4iface" type="checkbox" id="dhcp6usev4iface" value="yes" <?php if ($pconfig['dhcp6usev4iface'] == true) echo "checked=\"checked\""; ?> />
 											<?=gettext("Request a IPv6 prefix/information through the IPv4 connectivity link"); ?>
 										</td>
 									</tr>
-									<tr style='display:none' name="basicdhcp6_show_dhcp6_prefix_only" id="basicdhcp6_show_dhcp6_prefix_only">
+									<tr>
 										<td width="22%" valign="top" class="vncell"><?=gettext("Request only a IPv6 prefix"); ?></td>
 										<td width="78%" class="vtable">
 											<input name="dhcp6prefixonly" type="checkbox" id="dhcp6prefixonly" value="yes" <?php if ($pconfig['dhcp6prefixonly'] == true) echo "checked=\"checked\""; ?> />
 											<?=gettext("Only request a IPv6 prefix, do not request a IPv6 address"); ?>
 										</td>
 									</tr>
-									<tr style='display:none' name="basicdhcp6_show_dhcp6_prefix_delegation_size" id="basicdhcp6_show_dhcp6_prefix_delegation_size">
+									<tr>
 										<td width="22%" valign="top" class="vncell"><?=gettext("DHCPv6 Prefix Delegation size"); ?></td>
 										<td width="78%" class="vtable">
 											<select name="dhcp6-ia-pd-len" class="formselect" id="dhcp6-ia-pd-len">
@@ -2159,213 +1839,16 @@ $types6 = array("none" => gettext("None"), "staticv6" => gettext("Static IPv6"),
 											<?=gettext("The value in this field is the delegated prefix length provided by the DHCPv6 server. Normally specified by the ISP."); ?>
 										</td>
 									</tr>
-									<tr style='display:none' name="basicdhcp6_show_dhcp6_prefix_send_hint" id="basicdhcp6_show_dhcp6_prefix_send_hint">
+									<tr>
 										<td width="22%" valign="top" class="vncell"><?=gettext("Send IPv6 prefix hint"); ?></td>
 										<td width="78%" class="vtable">
 											<input name="dhcp6-ia-pd-send-hint" type="checkbox" id="dhcp6-ia-pd-send-hint" value="yes" <?php if ($pconfig['dhcp6-ia-pd-send-hint'] == true) echo "checked=\"checked\""; ?> />
 											<?=gettext("Send an IPv6 prefix hint to indicate the desired prefix size for delegation"); ?>
 										</td>
 									</tr>
-
-									<tr style='display:none' name="show_adv_dhcp6_interface_statement" id="show_adv_dhcp6_interface_statement">
-										<td width="22%" valign="top" class="vncell">
-											<?=gettext("<a target=FreeBSD DHCP href=http://www.freebsd.org/cgi/man.cgi?query=dhcp6c.conf&sektion=5&apropos=0&manpath=FreeBSD+Ports#Interface_statement>Interface Statement</a>"); ?>
-											<br><br>
-											<input name="adv_dhcp6_interface_statement_information_only_enable" type="checkbox" id="adv_dhcp6_interface_statement_information_only_enable" value="" onClick="show_adv_dhcp6_config(this)";>
-											<?=gettext("Information Only"); ?>
-										</td>
-										<td width="78%" class="vtable">
-											<?=gettext("Send Options"); ?><br>
-											<input name="adv_dhcp6_interface_statement_send_options" type="text" class="formfld unknown" id="adv_dhcp6_interface_statement_send_options" size="86" value="<?=htmlspecialchars($pconfig['adv_dhcp6_interface_statement_send_options']);?>">
-											<br>
-											<?=gettext("The values in this field are DHCP send options to be sent when requesting a DHCP lease.  [option declaration [, ...]] <br>" .
-											"Value Substitutions: {interface}, {hostname}, {mac_addr_asciiCD}, {mac_addr_hexCD} <br>" .
-											"Where C is U(pper) or L(ower) Case, and D is \" :-.\" Delimiter (space, colon, hyphen, or period) (omitted for none). <br>" .
-											"Some DHCP services may require certain options be or not be sent. "); ?>
-											<br>
-											<br>
-											<?=gettext("Request Options"); ?><br>
-											<input name="adv_dhcp6_interface_statement_request_options" type="text" class="formfld unknown" id="adv_dhcp6_interface_statement_request_options" size="86" value="<?=htmlspecialchars($pconfig['adv_dhcp6_interface_statement_request_options']);?>">
-											<br>
-											<?=gettext("The values in this field are DHCP request options to be sent when requesting a DHCP lease.  [option [, ...]] <br>" .
-											"Some DHCP services may require certain options be or not be requested. "); ?>
-											<br>
-											<br>
-											<?=gettext("Script"); ?><br>
-											<input name="adv_dhcp6_interface_statement_script" type="text" class="formfld unknown" id="adv_dhcp6_interface_statement_script" size="86" value="<?=htmlspecialchars($pconfig['adv_dhcp6_interface_statement_script']);?>">
-											<br>
-											<?=gettext("The value in this field is the absolute path to a script invoked on certain conditions including when a reply message is received. <br>" .
-											"[/[dirname/[.../]]filename[.ext]] "); ?>
-										</td>
-									</tr>
-
-									<tr style='display:none' name="show_adv_dhcp6_id_assoc_statement" id="show_adv_dhcp6_id_assoc_statement">
-										<td width="22%" valign="top" class="vncell">
-											<?=gettext("<a target=FreeBSD DHCP href=http://www.freebsd.org/cgi/man.cgi?query=dhcp6c.conf&sektion=5&apropos=0&manpath=FreeBSD+Ports#Identity_association_statement>Identity Association Statement</a>"); ?>
-										</td>
-										<td width="78%" class="vtable">
-
-											<input name="adv_dhcp6_id_assoc_statement_address_enable" type="checkbox" id="adv_dhcp6_id_assoc_statement_address_enable" value="" onClick="show_adv_dhcp6_config(this)";>
-											<?=gettext("Non-Temporary Address Allocation"); ?>
-											<div style='display:none'  name="show_adv_dhcp6_id_assoc_statement_address" id="show_adv_dhcp6_id_assoc_statement_address">
-											<?=gettext("id-assoc na"); ?>
-											<?=gettext("<i>ID</i>"); ?>
-											<input name="adv_dhcp6_id_assoc_statement_address_id" type="text" class="formfld unknown" id="adv_dhcp6_id_assoc_statement_address_id" size="3" value="<?=htmlspecialchars($pconfig['adv_dhcp6_id_assoc_statement_address_id']);?>">
-											<br>
-											<?=gettext("Address"); ?>
-											<?=gettext("<i>ipv6-address</i>"); ?>
-											<input name="adv_dhcp6_id_assoc_statement_address" type="text" class="formfld unknown" id="adv_dhcp6_id_assoc_statement_address" size="34" value="<?=htmlspecialchars($pconfig['adv_dhcp6_id_assoc_statement_address']);?>">
-											<?=gettext("<i>pltime</i>"); ?>
-											<input name="adv_dhcp6_id_assoc_statement_address_pltime" type="text" class="formfld unknown" id="adv_dhcp6_id_assoc_statement_address_pltime" size="3" value="<?=htmlspecialchars($pconfig['adv_dhcp6_id_assoc_statement_address_pltime']);?>">
-											<?=gettext("<i>vltime</i>"); ?>
-											<input name="adv_dhcp6_id_assoc_statement_address_vltime" type="text" class="formfld unknown" id="adv_dhcp6_id_assoc_statement_address_vltime" size="3" value="<?=htmlspecialchars($pconfig['adv_dhcp6_id_assoc_statement_address_vltime']);?>">
-											</div>
-											<hr>
-
-											<input name="adv_dhcp6_id_assoc_statement_prefix_enable" type="checkbox" id="adv_dhcp6_id_assoc_statement_prefix_enable" value="" onClick="show_adv_dhcp6_config(this)";>
-											<?=gettext("Prefix Delegation"); ?>
-											<div style='display:none'  name="show_adv_dhcp6_id_assoc_statement_prefix" id="show_adv_dhcp6_id_assoc_statement_prefix">
-											<?=gettext("id-assoc pd"); ?>
-											<?=gettext("<i>ID</i>"); ?>
-											<input name="adv_dhcp6_id_assoc_statement_prefix_id" type="text" class="formfld unknown" id="adv_dhcp6_id_assoc_statement_prefix_id" size="3" value="<?=htmlspecialchars($pconfig['adv_dhcp6_id_assoc_statement_prefix_id']);?>">
-											<br>
-											<?=gettext("Prefix"); ?>
-											<?=gettext("<i>ipv6-prefix</i>"); ?>
-											<input name="adv_dhcp6_id_assoc_statement_prefix" type="text" class="formfld unknown" id="adv_dhcp6_id_assoc_statement_prefix" size="37" value="<?=htmlspecialchars($pconfig['adv_dhcp6_id_assoc_statement_prefix']);?>">
-											<?=gettext("<i>pltime</i>"); ?>
-											<input name="adv_dhcp6_id_assoc_statement_prefix_pltime" type="text" class="formfld unknown" id="adv_dhcp6_id_assoc_statement_prefix_pltime" size="3" value="<?=htmlspecialchars($pconfig['adv_dhcp6_id_assoc_statement_prefix_pltime']);?>">
-											<?=gettext("<i>vltime</i>"); ?>
-											<input name="adv_dhcp6_id_assoc_statement_prefix_vltime" type="text" class="formfld unknown" id="adv_dhcp6_id_assoc_statement_prefix_vltime" size="3" value="<?=htmlspecialchars($pconfig['adv_dhcp6_id_assoc_statement_prefix_vltime']);?>">
-											</div>
-										</td>
-									</tr>
-
-									<tr style='display:none' name="show_adv_dhcp6_prefix_interface_statement" id="show_adv_dhcp6_prefix_interface_statement">
-										<td width="22%" valign="top" class="vncell">
-											<?=gettext("<a target=FreeBSD DHCP href=http://www.freebsd.org/cgi/man.cgi?query=dhcp6c.conf&sektion=5&apropos=0&manpath=FreeBSD+Ports#Prefix_interface_statement>Prefix Interface Statement</a>"); ?>
-										</td>
-										<td width="78%" class="vtable">
-											<?=gettext("Prefix Interface "); ?>
-											<?=gettext("<i>sla-id</i>"); ?>
-											<input name="adv_dhcp6_prefix_interface_statement_sla_id" type="text" class="formfld unknown" id="adv_dhcp6_prefix_interface_statement_sla_id" size="3" value="<?=htmlspecialchars($pconfig['adv_dhcp6_prefix_interface_statement_sla_id']);?>">
-											<?=gettext("<i>sla-len</i>"); ?>
-											<input name="adv_dhcp6_prefix_interface_statement_sla_len" type="text" class="formfld unknown" id="adv_dhcp6_prefix_interface_statement_sla_len" size="3" value="<?=htmlspecialchars($pconfig['adv_dhcp6_prefix_interface_statement_sla_len']);?>">
-										</td>
-									</tr>
-
-									<tr style='display:none' name="show_adv_dhcp6_authentication_statement" id="show_adv_dhcp6_authentication_statement">
-										<td width="22%" valign="top" class="vncell">
-											<?=gettext("<a target=FreeBSD DHCP href=http://www.freebsd.org/cgi/man.cgi?query=dhcp6c.conf&sektion=5&apropos=0&manpath=FreeBSD+Ports#Authentication_statement>Authentication Statement</a>"); ?>
-										</td>
-										<td width="78%" class="vtable">
-											<?=gettext("<i>authname</i>"); ?>
-											<input name="adv_dhcp6_authentication_statement_authname" type="text" class="formfld unknown" id="adv_dhcp6_authentication_statement_authname" size="10" value="<?=htmlspecialchars($pconfig['adv_dhcp6_authentication_statement_authname']);?>">
-											<?=gettext("<i>protocol</i>"); ?>
-											<input name="adv_dhcp6_authentication_statement_protocol" type="text" class="formfld unknown" id="adv_dhcp6_authentication_statement_protocol" size="6" value="<?=htmlspecialchars($pconfig['adv_dhcp6_authentication_statement_protocol']);?>">
-											<?=gettext("<i>algorithm</i>"); ?>
-											<input name="adv_dhcp6_authentication_statement_algorithm" type="text" class="formfld unknown" id="adv_dhcp6_authentication_statement_algorithm" size="8" value="<?=htmlspecialchars($pconfig['adv_dhcp6_authentication_statement_algorithm']);?>">
-											<?=gettext("<i>rdm</i>"); ?>
-											<input name="adv_dhcp6_authentication_statement_rdm" type="text" class="formfld unknown" id="adv_dhcp6_authentication_statement_rdm" size="9" value="<?=htmlspecialchars($pconfig['adv_dhcp6_authentication_statement_rdm']);?>">
-										</td>
-									</tr>
-
-									<tr style='display:none' name="show_adv_dhcp6_key_info_statement" id="show_adv_dhcp6_key_info_statement">
-										<td width="22%" valign="top" class="vncell">
-											<?=gettext("<a target=FreeBSD DHCP href=http://www.freebsd.org/cgi/man.cgi?query=dhcp6c.conf&sektion=5&apropos=0&manpath=FreeBSD+Ports#Keyinfo_statement>Keyinfo Statement</a>"); ?>
-										</td>
-										<td width="78%" class="vtable">
-											<?=gettext("<i>keyname</i>"); ?>
-											<input name="adv_dhcp6_key_info_statement_keyname" type="text" class="formfld unknown" id="adv_dhcp6_key_info_statement_keyname" size="27" value="<?=htmlspecialchars($pconfig['adv_dhcp6_key_info_statement_keyname']);?>">
-											<?=gettext("<i>realm</i>"); ?>
-											<input name="adv_dhcp6_key_info_statement_realm" type="text" class="formfld unknown" id="adv_dhcp6_key_info_statement_realm" size="37" value="<?=htmlspecialchars($pconfig['adv_dhcp6_key_info_statement_realm']);?>">
-											<br>
-											<?=gettext("<i>keyid</i>"); ?>
-											<input name="adv_dhcp6_key_info_statement_keyid" type="text" class="formfld unknown" id="adv_dhcp6_key_info_statement_keyid" size="2" value="<?=htmlspecialchars($pconfig['adv_dhcp6_key_info_statement_keyid']);?>">
-											<?=gettext("<i>secret</i>"); ?>
-											<input name="adv_dhcp6_key_info_statement_secret" type="text" class="formfld unknown" id="adv_dhcp6_key_info_statement_secret" size="36" value="<?=htmlspecialchars($pconfig['adv_dhcp6_key_info_statement_secret']);?>">
-											<?=gettext("<i>expire</i>"); ?>
-											<input name="adv_dhcp6_key_info_statement_expire" type="text" class="formfld unknown" id="adv_dhcp6_key_info_statement_expire" size="15" value="<?=htmlspecialchars($pconfig['adv_dhcp6_key_info_statement_expire']);?>">
-										</td>
-									</tr>
-
-									<tr style='display:none' name="show_adv_dhcp6_config_file_override" id="show_adv_dhcp6_config_file_override">
-										<td width="22%" valign="top" class="vncell">
-											<?=gettext("<a target=FreeBSD DHCP href=http://www.freebsd.org/cgi/man.cgi?query=dhcp6c.conf&sektion=5&apropos=0&manpath=FreeBSD+Ports>Configuration File</a> Override"); ?>
-										</td>
-										<td width="78%" class="vtable">
- 											<input name="adv_dhcp6_config_file_override_path"   type="text" class="formfld unknown" id="adv_dhcp6_config_file_override_path"  size="86" value="<?=htmlspecialchars($pconfig['adv_dhcp6_config_file_override_path']);?>">
-											<br>
-											<?=gettext("The value in this field is the full absolute path to a DHCP client configuration file.  [/[dirname/[.../]]filename[.ext]] <br> " .
-											"Value Substitutions in Config File: {interface}, {hostname}, {mac_addr_asciiCD}, {mac_addr_hexCD} <br>" .
-											"Where C is U(pper) or L(ower) Case, and D is \" :-.\" Delimiter (space, colon, hyphen, or period) (omitted for none). <br>" .
-											"Some ISPs may require certain options be or not be sent. "); ?>
-										</td>
+									<tr>
+										<td colspan="2" valign="top" height="16"></td>
 									</tr>
-
- 									<tr>
- 										<td colspan="2" valign="top" height="16"></td>
- 									</tr>
-
-									<script type="text/javascript">
-										function show_adv_dhcp6_config(T) {
-
-											if (T.checked) T.value = "Selected";
-											else T.value = "";
-
-											     if (document.iform.adv_dhcp6_config_file_override.checked)	show_hide_adv_dhcp6('none', 'none', ''    );
-											else if (document.iform.adv_dhcp6_config_advanced.checked)		show_hide_adv_dhcp6('none', '',     'none');
-											else 															show_hide_adv_dhcp6('',     'none', 'none');
-										}
-
-										function show_hide_adv_dhcp6(basic, advanced, override) {
-
-											document.getElementById("basicdhcp6_use_pppoeinterface").style.display = basic;
-											document.getElementById("basicdhcp6_show_dhcp6_prefix_delegation_size").style.display = basic;
-											document.getElementById("basicdhcp6_show_dhcp6_prefix_send_hint").style.display = basic;
-											document.getElementById("basicdhcp6_show_dhcp6_prefix_only").style.display = basic;
-
-											document.getElementById("show_adv_dhcp6_interface_statement").style.display = advanced;
-											document.getElementById("show_adv_dhcp6_id_assoc_statement").style.display = advanced;
-
-											document.getElementById("show_adv_dhcp6_id_assoc_statement_address").style.display = 'none';
-											if (document.iform.adv_dhcp6_id_assoc_statement_address_enable.checked)  {
-												document.getElementById("show_adv_dhcp6_id_assoc_statement_address").style.display = advanced;
-											}
-
-											document.getElementById("show_adv_dhcp6_id_assoc_statement_prefix").style.display = 'none';
-											document.getElementById("show_adv_dhcp6_prefix_interface_statement").style.display = 'none';
-											if (document.iform.adv_dhcp6_id_assoc_statement_prefix_enable.checked)  {
-												document.getElementById("show_adv_dhcp6_id_assoc_statement_prefix").style.display = advanced;
-												document.getElementById("show_adv_dhcp6_prefix_interface_statement").style.display = advanced;
-											}
-
-											document.getElementById("show_adv_dhcp6_authentication_statement").style.display = advanced;
-											document.getElementById("show_adv_dhcp6_key_info_statement").style.display = advanced;
-
-											document.getElementById("show_adv_dhcp6_config_file_override").style.display = override;
-										}
-
-										<!-- Set the adv_dhcp6_config_advanced checkbox from saved config -->
-										if ("<?=htmlspecialchars($pconfig['adv_dhcp6_config_advanced']);?>" == "Selected") document.iform.adv_dhcp6_config_advanced.checked = true;
-										show_adv_dhcp6_config(document.iform.adv_dhcp6_config_advanced);
-
-										<!-- Set the adv_dhcp6_config_file_override checkbox from saved config -->
-										if ("<?=htmlspecialchars($pconfig['adv_dhcp6_config_file_override']);?>" == "Selected") document.iform.adv_dhcp6_config_file_override.checked = true;
-										show_adv_dhcp6_config(document.iform.adv_dhcp6_config_file_override);
-
-										<!-- Set the adv_dhcp6_interface_statement_information_only_enable checkbox from saved config -->
-										if ("<?=htmlspecialchars($pconfig['adv_dhcp6_interface_statement_information_only_enable']);?>" == "Selected") document.iform.adv_dhcp6_interface_statement_information_only_enable.checked = true;
-										show_adv_dhcp6_config(document.iform.adv_dhcp6_interface_statement_information_only_enable);
-
-										<!-- Set the adv_dhcp6_id_assoc_statement_address_enable checkbox from saved config -->
-										if ("<?=htmlspecialchars($pconfig['adv_dhcp6_id_assoc_statement_address_enable']);?>" == "Selected") document.iform.adv_dhcp6_id_assoc_statement_address_enable.checked = true;
-										show_adv_dhcp6_config(document.iform.adv_dhcp6_id_assoc_statement_address_enable);
-
-										<!-- Set the adv_dhcp6_id_assoc_statement_prefix_enable checkbox from saved config -->
-										if ("<?=htmlspecialchars($pconfig['adv_dhcp6_id_assoc_statement_prefix_enable']);?>" == "Selected") document.iform.adv_dhcp6_id_assoc_statement_prefix_enable.checked = true;
-										show_adv_dhcp6_config(document.iform.adv_dhcp6_id_assoc_statement_prefix_enable);
-									</script>
-
 								</table>
 							</td>
 						</tr>
@@ -3329,11 +2812,9 @@ $types6 = array("none" => gettext("None"), "staticv6" => gettext("Static IPv6"),
 			var descr = jQuery('#gatewaydescr').val();
 			gatewayip = jQuery('#gatewayip').val();
 
-			var defaultgw = '';
-			if (jQuery('#defaultgw').is(':checked'))
-				defaultgw = '&defaultgw=on';
+			var defaultgw = jQuery('#defaultgw').val();
 			var url = "system_gateways_edit.php";
-			var pars = 'isAjax=true&ipprotocol=inet' + defaultgw + '&interface=' + escape(iface) + '&name=' + escape(name) + '&descr=' + escape(descr) + '&gateway=' + escape(gatewayip);
+			var pars = 'isAjax=true&ipprotocol=inet&defaultgw=' + escape(defaultgw) + '&interface=' + escape(iface) + '&name=' + escape(name) + '&descr=' + escape(descr) + '&gateway=' + escape(gatewayip);
 			jQuery.ajax(
 				url,
 				{
@@ -3350,11 +2831,9 @@ $types6 = array("none" => gettext("None"), "staticv6" => gettext("Static IPv6"),
 			name = jQuery('#namev6').val();
 			var descr = jQuery('#gatewaydescrv6').val();
 			gatewayip = jQuery('#gatewayipv6').val();
-			var defaultgw = '';
-			if (jQuery('#defaultgwv6').is(':checked'))
-				defaultgw = '&defaultgw=on';
+			var defaultgw = jQuery('#defaultgwv6').val();
 			var url_v6 = "system_gateways_edit.php";
-			var pars_v6 = 'isAjax=true&ipprotocol=inet6' + defaultgw + '&interface=' + escape(iface) + '&name=' + escape(name) + '&descr=' + escape(descr) + '&gateway=' + escape(gatewayip);
+			var pars_v6 = 'isAjax=true&ipprotocol=inet6&defaultgw=' + escape(defaultgw) + '&interface=' + escape(iface) + '&name=' + escape(name) + '&descr=' + escape(descr) + '&gateway=' + escape(gatewayip);
 			jQuery.ajax(
 				url_v6,
 				{
diff --git a/usr/local/www/interfaces_bridge_edit.php b/usr/local/www/interfaces_bridge_edit.php
index 36a9b1a..1565abc 100644
--- a/usr/local/www/interfaces_bridge_edit.php
+++ b/usr/local/www/interfaces_bridge_edit.php
@@ -118,7 +118,7 @@ if ($_POST) {
 	$reqdfields = explode(" ", "members");
 	$reqdfieldsn = array(gettext("Member Interfaces"));
 
-	do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+	do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 
 	if ($_POST['maxage'] && !is_numeric($_POST['maxage']))
 		$input_errors[] = gettext("Maxage needs to be an integer between 6 and 40.");
diff --git a/usr/local/www/interfaces_gif_edit.php b/usr/local/www/interfaces_gif_edit.php
index 5d091ca..b5eb89c 100644
--- a/usr/local/www/interfaces_gif_edit.php
+++ b/usr/local/www/interfaces_gif_edit.php
@@ -74,7 +74,7 @@ if ($_POST) {
 	$reqdfields = explode(" ", "if tunnel-remote-addr tunnel-remote-net tunnel-local-addr");
 	$reqdfieldsn = array(gettext("Parent interface,Local address, Remote tunnel address, Remote tunnel network, Local tunnel address"));
 
-	do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+	do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 
 	if ((!is_ipaddr($_POST['tunnel-local-addr'])) || (!is_ipaddr($_POST['tunnel-remote-addr'])) ||
 			(!is_ipaddr($_POST['remote-addr']))) {
diff --git a/usr/local/www/interfaces_gre_edit.php b/usr/local/www/interfaces_gre_edit.php
index bd3e420..4551aa0 100644
--- a/usr/local/www/interfaces_gre_edit.php
+++ b/usr/local/www/interfaces_gre_edit.php
@@ -73,7 +73,7 @@ if ($_POST) {
 	$reqdfields = explode(" ", "if tunnel-remote-addr tunnel-remote-net tunnel-local-addr");
 	$reqdfieldsn = array(gettext("Parent interface"),gettext("Local address"),gettext("Remote tunnel address"),gettext("Remote tunnel network"), gettext("Local tunnel address"));
 
-	do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+	do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 
 	if ((!is_ipaddr($_POST['tunnel-local-addr'])) || (!is_ipaddr($_POST['tunnel-remote-addr'])) ||
 			(!is_ipaddr($_POST['remote-addr']))) {
@@ -131,7 +131,6 @@ include("head.inc");
 ?>
 
 <body link="#0000CC" vlink="#0000CC" alink="#0000CC">
-<script type="text/javascript" src="/javascript/jquery.ipv4v6ify.js"></script>
 <?php include("fbegin.inc"); ?>
 <?php if ($input_errors) print_input_errors($input_errors); ?>
             <form action="interfaces_gre_edit.php" method="post" name="iform" id="iform">
@@ -176,8 +175,8 @@ include("head.inc");
 				<tr>
                   <td valign="top" class="vncellreq"><?=gettext("GRE tunnel remote address ");?></td>
                   <td class="vtable">
-                    <input name="tunnel-remote-addr" type="text" class="formfld unknown ipv4v6" id="tunnel-remote-addr" size="16" value="<?=htmlspecialchars($pconfig['tunnel-remote-addr']);?>" />
-                    <select name="tunnel-remote-net" class="formselect ipv4v6" id="tunnel-remote-net">
+                    <input name="tunnel-remote-addr" type="text" class="formfld unknown" id="tunnel-remote-addr" size="16" value="<?=htmlspecialchars($pconfig['tunnel-remote-addr']);?>" />
+                    <select name="tunnel-remote-net" class="formselect" id="tunnel-remote-net">
                                         <?php
                                         for ($i = 128; $i > 0; $i--) {
 						echo "<option value=\"{$i}\"";
diff --git a/usr/local/www/interfaces_groups_edit.php b/usr/local/www/interfaces_groups_edit.php
index 09053c7..1356760 100755
--- a/usr/local/www/interfaces_groups_edit.php
+++ b/usr/local/www/interfaces_groups_edit.php
@@ -31,9 +31,9 @@
 */
 
 ##|+PRIV
-##|*IDENT=page-interfaces-groups-edit
+##|*IDENT=page-interfacess-groups
 ##|*NAME=Interfaces: Groups: Edit page
-##|*DESCR=Allow access to the 'Interfaces: Groups: Edit' page.
+##|*DESCR=Edit Interface groups
 ##|*MATCH=interfaces_groups_edit.php*
 ##|-PRIV
 
diff --git a/usr/local/www/interfaces_lagg.php b/usr/local/www/interfaces_lagg.php
index 91515fe..4e58254 100644
--- a/usr/local/www/interfaces_lagg.php
+++ b/usr/local/www/interfaces_lagg.php
@@ -33,9 +33,9 @@
 */
 
 ##|+PRIV
-##|*IDENT=page-interfaces-lagg
+##|*IDENT=page-interfacess-lagg
 ##|*NAME=Interfaces: LAGG: page
-##|*DESCR=Allow access to the 'Interfaces: LAGG' page.
+##|*DESCR=Edit Interface LAGG
 ##|*MATCH=interfaces_lagg.php*
 ##|-PRIV
 
diff --git a/usr/local/www/interfaces_lagg_edit.php b/usr/local/www/interfaces_lagg_edit.php
index a830172..1a1d468 100644
--- a/usr/local/www/interfaces_lagg_edit.php
+++ b/usr/local/www/interfaces_lagg_edit.php
@@ -32,9 +32,9 @@
 */
 
 ##|+PRIV
-##|*IDENT=page-interfaces-lagg-edit
+##|*IDENT=page-interfacess-lagg
 ##|*NAME=Interfaces: LAGG: Edit page
-##|*DESCR=Allow access to the 'Interfaces: LAGG: Edit' page.
+##|*DESCR=Edit Interface LAGG
 ##|*MATCH=interfaces_lagg_edit.php*
 ##|-PRIV
 
@@ -87,7 +87,7 @@ if ($_POST) {
 	$reqdfields = explode(" ", "members proto");
 	$reqdfieldsn = array(gettext("Member interfaces"), gettext("Lagg protocol"));
 
-	do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+	do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 
 	if (is_array($_POST['members'])) {
 		foreach ($_POST['members'] as $member) {
diff --git a/usr/local/www/interfaces_ppps_edit.php b/usr/local/www/interfaces_ppps_edit.php
index 353b4b5..034c42d 100644
--- a/usr/local/www/interfaces_ppps_edit.php
+++ b/usr/local/www/interfaces_ppps_edit.php
@@ -186,7 +186,7 @@ if ($_POST) {
 		case "ppp":
 			$reqdfields = explode(" ", "interfaces phone");
 			$reqdfieldsn = array(gettext("Link Interface(s)"),gettext("Phone Number"));
-			do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+			do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 			break;
 		case "pppoe":
 			if ($_POST['ondemand']) {
@@ -196,7 +196,7 @@ if ($_POST) {
 				$reqdfields = explode(" ", "interfaces username password");
 				$reqdfieldsn = array(gettext("Link Interface(s)"),gettext("Username"),gettext("Password"));
 			}
-			do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+			do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 			break;
 		case "l2tp":
 		case "pptp":
@@ -207,7 +207,7 @@ if ($_POST) {
 				$reqdfields = explode(" ", "interfaces username password localip subnet gateway");
 				$reqdfieldsn = array(gettext("Link Interface(s)"),gettext("Username"),gettext("Password"),gettext("Local IP address"),gettext("Subnet"),gettext("Remote IP address"));
 			}
-			do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+			do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 			break;
 		default:
 			$input_errors[] = gettext("Please choose a Link Type.");
@@ -434,7 +434,8 @@ $types = array("select" => gettext("Select"), "ppp" => "PPP", "pppoe" => "PPPoE"
 				$selected_ports = explode(',',$pconfig['interfaces']);
 				if (!is_dir("/var/spool/lock"))
 					mwexec("/bin/mkdir -p /var/spool/lock");
-				$serialports = pfSense_get_modem_devices();
+				// $serialports = pfSense_get_modem_devices();
+				$serialports = glob("/dev/cua?[0-9]{,.[0-9]}", GLOB_BRACE);
 				$serport_count = 0;
 				foreach ($serialports as $port) {
 					$serport_count++;
diff --git a/usr/local/www/interfaces_qinq_edit.php b/usr/local/www/interfaces_qinq_edit.php
index 242b26d..beff4b1 100755
--- a/usr/local/www/interfaces_qinq_edit.php
+++ b/usr/local/www/interfaces_qinq_edit.php
@@ -30,9 +30,9 @@
 */
 
 ##|+PRIV
-##|*IDENT=page-interfaces-qinq-edit
+##|*IDENT=page-interfacess-qinq
 ##|*NAME=Interfaces: QinQ: Edit page
-##|*DESCR=Allow access to 'Interfaces: QinQ: Edit' page
+##|*DESCR=Edit Interface qinq
 ##|*MATCH=interfaces_qinq_edit.php*
 ##|-PRIV
 
diff --git a/usr/local/www/interfaces_vlan.php b/usr/local/www/interfaces_vlan.php
index 7639c0f..f4836f2 100755
--- a/usr/local/www/interfaces_vlan.php
+++ b/usr/local/www/interfaces_vlan.php
@@ -67,9 +67,10 @@ if ($_GET['act'] == "del") {
 	/* check if still in use */
 	else if (vlan_inuse($_GET['id'])) {
 		$input_errors[] = gettext("This VLAN cannot be deleted because it is still being used as an interface.");
+	} elseif (!does_interface_exist($a_vlans[$_GET['id']]['vlanif'])) {
+		$input_errors[] = gettext("Invalid VLAN interface.");
 	} else {
-		if (does_interface_exist($a_vlans[$_GET['id']]['vlanif']))
-			pfSense_interface_destroy($a_vlans[$_GET['id']]['vlanif']);
+		mwexec("/sbin/ifconfig " . $a_vlans[$_GET['id']]['vlanif'] . " destroy");
 		unset($a_vlans[$_GET['id']]);
 
 		write_config();
diff --git a/usr/local/www/interfaces_vlan_edit.php b/usr/local/www/interfaces_vlan_edit.php
index acd78e2..524f9f3 100755
--- a/usr/local/www/interfaces_vlan_edit.php
+++ b/usr/local/www/interfaces_vlan_edit.php
@@ -74,7 +74,7 @@ if ($_POST) {
 	$reqdfields = explode(" ", "if tag");
 	$reqdfieldsn = array(gettext("Parent interface"),gettext("VLAN tag"));
 
-	do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+	do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 
 	if ($_POST['tag'] && (!is_numericint($_POST['tag']) || ($_POST['tag'] < '1') || ($_POST['tag'] > '4094'))) {
 		$input_errors[] = gettext("The VLAN tag must be an integer between 1 and 4094.");
@@ -83,12 +83,6 @@ if ($_POST) {
 	if (!does_interface_exist($_POST['if']))
 		$input_errors[] = gettext("Interface supplied as parent is invalid");
 
-	if (isset($id)) {
-		if ($_POST['tag'] && $_POST['tag'] != $a_vlans[$id]['tag']) {
-			if (!empty($a_vlans[$id]['vlanif']) && convert_real_interface_to_friendly_interface_name($a_vlans[$id]['vlanif']) != NULL)
-				$input_errors[] = gettext("Interface is assigned and you cannot change the VLAN tag while assigned.");
-		}
-	}
 	foreach ($a_vlans as $vlan) {
 		if (isset($id) && ($a_vlans[$id]) && ($a_vlans[$id] === $vlan))
 			continue;
diff --git a/usr/local/www/interfaces_wireless_edit.php b/usr/local/www/interfaces_wireless_edit.php
index b34f266..778ee2e 100644
--- a/usr/local/www/interfaces_wireless_edit.php
+++ b/usr/local/www/interfaces_wireless_edit.php
@@ -85,7 +85,7 @@ if ($_POST) {
 	$reqdfields = explode(" ", "if mode");
 	$reqdfieldsn = array(gettext("Parent interface"),gettext("Mode"));
 
-	do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+	do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 
 	if (!$input_errors) {
 		$clone = array();
diff --git a/usr/local/www/javascript/datetimepicker.js b/usr/local/www/javascript/datetimepicker.js
new file mode 100755
index 0000000..a8a3615
--- /dev/null
+++ b/usr/local/www/javascript/datetimepicker.js
@@ -0,0 +1,486 @@
+//Javascript name: My Date Time Picker
+//Date created: 16-Nov-2003 23:19
+//Scripter: TengYong Ng
+//Website: http://www.rainforestnet.com
+//Copyright (c) 2003 TengYong Ng
+//FileName: DateTimePicker.js
+//Version: 0.8
+//Contact: contact@rainforestnet.com
+// Note: Permission given to use this script in ANY kind of applications if
+//       header lines are left unchanged.
+
+//Global variables
+var winCal;
+var dtToday=new Date();
+var Cal;
+var docCal;
+var MonthName=["January", "February", "March", "April", "May", "June","July", 
+	"August", "September", "October", "November", "December"];
+var WeekDayName=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];	
+var exDateTime;//Existing Date and Time
+
+//Configurable parameters
+var cnTop="200";//top coordinate of calendar window.
+var cnLeft="500";//left coordinate of calendar window
+var WindowTitle ="DateTime Picker";//Date Time Picker title.
+var WeekChar=2;//number of character for week day. if 2 then Mo,Tu,We. if 3 then Mon,Tue,Wed.
+var CellWidth=20;//Width of day cell.
+var DateSeparator="/";//Date Separator, you can change it to "/" if you want.
+var TimeMode=24;//default TimeMode value. 12 or 24
+
+var ShowLongMonth=true;//Show long month name in Calendar header. example: "January".
+var ShowMonthYear=true;//Show Month and Year in Calendar header.
+var MonthYearColor="#435370";//Font Color of Month and Year in Calendar header.
+var WeekHeadColor="#777777";//Background Color in Week header.
+var SundayColor="#D9DEE8";//Background color of Sunday.
+var SaturdayColor="#D9DEE8";//Background color of Saturday.
+var WeekDayColor="white";//Background color of weekdays.
+var FontColor="black";//color of font in Calendar day cell.
+var TodayColor="#FFFF33";//Background color of today.
+var SelDateColor="red";//Backgrond color of selected date in textbox.
+var YrSelColor="black";//color of font of Year selector.
+var ThemeBg="";//Background image of Calendar window.
+//end Configurable parameters
+//end Global variable
+
+function NewCal(pCtrl,pFormat,pShowTime,pTimeMode)
+{
+	Cal=new Calendar(dtToday);
+	if ((pShowTime!=null) && (pShowTime))
+	{
+		Cal.ShowTime=true;
+		if ((pTimeMode!=null) &&((pTimeMode=='12')||(pTimeMode=='24')))
+		{
+			TimeMode=pTimeMode;
+		}		
+	}	
+	if (pCtrl!=null)
+		Cal.Ctrl=pCtrl;
+	if (pFormat!=null)
+		Cal.Format=pFormat.toUpperCase();
+	
+	exDateTime=document.getElementById(pCtrl).value;
+	if (exDateTime!="")//Parse Date String
+	{
+		var Sp1;//Index of Date Separator 1
+		var Sp2;//Index of Date Separator 2 
+		var tSp1;//Index of Time Separator 1
+		var tSp2;//Index of Time Separator 2
+		var strMonth;
+		var strDate;
+		var strYear;
+		var intMonth;
+		var YearPattern;
+		var strHour;
+		var strMinute;
+		var strSecond;
+		//parse month
+		Sp1=exDateTime.indexOf(DateSeparator,0);
+		Sp2=exDateTime.indexOf(DateSeparator,(parseInt(Sp1)+1));
+		
+		if ((Cal.Format.toUpperCase()=="DDMMYYYY") || (Cal.Format.toUpperCase()=="DDMMMYYYY"))
+		{
+			strMonth=exDateTime.substring(Sp1+1,Sp2);
+			strDate=exDateTime.substring(0,Sp1);
+		}
+		else if ((Cal.Format.toUpperCase()=="MMDDYYYY") || (Cal.Format.toUpperCase()=="MMMDDYYYY"))
+		{
+			strMonth=exDateTime.substring(0,Sp1);
+			strDate=exDateTime.substring(Sp1+1,Sp2);
+		}
+		if (isNaN(strMonth))
+			intMonth=Cal.GetMonthIndex(strMonth);
+		else
+			intMonth=parseInt(strMonth,10)-1;	
+		if ((parseInt(intMonth,10)>=0) && (parseInt(intMonth,10)<12))
+			Cal.Month=intMonth;
+		//end parse month
+		//parse Date
+		if ((parseInt(strDate,10)<=Cal.GetMonDays()) && (parseInt(strDate,10)>=1))
+			Cal.Date=strDate;
+		//end parse Date
+		//parse year
+		strYear=exDateTime.substring(Sp2+1,Sp2+5);
+		YearPattern=/^\d{4}$/;
+		if (YearPattern.test(strYear))
+			Cal.Year=parseInt(strYear,10);
+		//end parse year
+		//parse time
+		if (Cal.ShowTime==true)
+		{
+			tSp1=exDateTime.indexOf(":",0);
+			tSp2=exDateTime.indexOf(":",(parseInt(tSp1)+1));
+			strHour=exDateTime.substring(tSp1,(tSp1)-2);
+			Cal.SetHour(strHour);
+			strMinute=exDateTime.substring(tSp1+1,tSp2);
+			Cal.SetMinute(strMinute);
+			strSecond=exDateTime.substring(tSp2+1,tSp2+3);
+			Cal.SetSecond(strSecond);
+		}	
+	}
+	winCal=window.open("","DateTimePicker","toolbar=0,status=0,menubar=0,fullscreen=no,width=195,height=200,resizable=0,top="+cnTop+",left="+cnLeft);
+	docCal=winCal.document;
+	RenderCal();
+}
+
+function RenderCal()
+{
+	var vCalHeader;
+	var vCalData;
+	var vCalTime;
+	var i;
+	var j;
+	var SelectStr;
+	var vDayCount=0;
+	var vFirstDay;
+
+	docCal.open();
+	docCal.writeln("<html><head><title>"+WindowTitle+"</title>");
+	docCal.writeln("<script>var winMain=window.opener;</script>");
+	docCal.writeln("<style>");
+	docCal.writeln("body,td,th,input,select {font-family: Tahoma, Verdana, Arial, Helvetica, sans-serif;font-size: 11px;}");
+	docCal.writeln("a {text-decoration: none;}");
+	docCal.writeln("</style>");
+	docCal.writeln("</head><body background='"+ThemeBg+"' link="+FontColor+" vlink="+FontColor+"><form name='Calendar'>");
+
+	vCalHeader="<table border=1 cellpadding=1 cellspacing=1 align=\"center\" valign=\"top\" bgcolor='#EEEEEE' style=\"border-color:#999999; border-style:solid; border-collapse:collapse\">\n";
+	//Month Selector
+	vCalHeader+="<tr>\n<td colspan='7'><table border=0 width='100%' cellpadding=0 cellspacing=0><tr><td align='left'>\n";
+	vCalHeader+="<select name=\"MonthSelector\" onChange=\"javascript:winMain.Cal.SwitchMth(this.selectedIndex);winMain.RenderCal();\">\n";
+	for (i=0;i<12;i++)
+	{
+		if (i==Cal.Month)
+			SelectStr="Selected";
+		else
+			SelectStr="";	
+		vCalHeader+="<option "+SelectStr+" value >"+MonthName[i]+"\n";
+	}
+	vCalHeader+="</select></td>";
+	//Year selector
+	vCalHeader+="\n<td align='right'><a href=\"javascript:winMain.Cal.DecYear();winMain.RenderCal()\"><b><font color=\""+YrSelColor+"\"><</font></b></a><font face=\"Verdana\" color=\""+YrSelColor+"\" size=2><b> "+Cal.Year+" </b></font><a href=\"javascript:winMain.Cal.IncYear();winMain.RenderCal()\"><b><font color=\""+YrSelColor+"\">></font></b></a></td></tr></table></td>\n";	
+	vCalHeader+="</tr>";
+	//Calendar header shows Month and Year
+	if (ShowMonthYear)
+		vCalHeader+="<tr><td colspan='7'><font face='Verdana' size='2' align='center' color='"+MonthYearColor+"'><b>"+Cal.GetMonthName(ShowLongMonth)+" "+Cal.Year+"</b></font></td></tr>\n";
+	//Week day header
+	vCalHeader+="<tr bgcolor="+WeekHeadColor+">";
+	for (i=0;i<7;i++)
+	{
+		vCalHeader+="<td align='center'><font face='Verdana' size='2'>"+WeekDayName[i].substr(0,WeekChar)+"</font></td>";
+	}
+	vCalHeader+="</tr>";	
+	docCal.write(vCalHeader);
+	
+	//Calendar detail
+	CalDate=new Date(Cal.Year,Cal.Month);
+	CalDate.setDate(1);
+	vFirstDay=CalDate.getDay();
+	vCalData="<tr>";
+	for (i=0;i<vFirstDay;i++)
+	{
+		vCalData=vCalData+GenCell();
+		vDayCount=vDayCount+1;
+	}
+	for (j=1;j<=Cal.GetMonDays();j++)
+	{
+		var strCell;
+		vDayCount=vDayCount+1;
+		if ((j==dtToday.getDate())&&(Cal.Month==dtToday.getMonth())&&(Cal.Year==dtToday.getFullYear()))
+			strCell=GenCell(j,true,TodayColor);//Highlight today's date
+		else
+		{
+			if (j==Cal.Date)
+			{
+				strCell=GenCell(j,true,SelDateColor);
+			}
+			else
+			{	 
+				if (vDayCount%7==0)
+					strCell=GenCell(j,false,SaturdayColor);
+				else if ((vDayCount+6)%7==0)
+					strCell=GenCell(j,false,SundayColor);
+				else
+					strCell=GenCell(j,null,WeekDayColor);
+			}		
+		}						
+		vCalData=vCalData+strCell;
+
+		if((vDayCount%7==0)&&(j<Cal.GetMonDays()))
+		{
+			vCalData=vCalData+"</tr>\n<tr>";
+		}
+	}
+	docCal.writeln(vCalData);	
+	//Time picker
+	if (Cal.ShowTime)
+	{
+		var showHour;
+		showHour=Cal.getShowHour();		
+		vCalTime="<tr>\n<td colspan='7' align='center'>";
+		vCalTime+="<input type='text' name='hour' maxlength=2 size=1 style=\"WIDTH: 22px\" value="+showHour+" onchange=\"javascript:winMain.Cal.SetHour(this.value)\">";
+		vCalTime+=" : ";
+		vCalTime+="<input type='text' name='minute' maxlength=2 size=1 style=\"WIDTH: 22px\" value="+Cal.Minutes+" onchange=\"javascript:winMain.Cal.SetMinute(this.value)\">";
+		vCalTime+=" : ";
+		vCalTime+="<input type='text' name='second' maxlength=2 size=1 style=\"WIDTH: 22px\" value="+Cal.Seconds+" onchange=\"javascript:winMain.Cal.SetSecond(this.value)\">";
+		if (TimeMode==12)
+		{
+			var SelectAm =(parseInt(Cal.Hours,10)<12)? "Selected":"";
+			var SelectPm =(parseInt(Cal.Hours,10)>=12)? "Selected":"";
+
+			vCalTime+="<select name=\"ampm\" onchange=\"javascript:winMain.Cal.SetAmPm(this.options[this.selectedIndex].value);\">";
+			vCalTime+="<option "+SelectAm+" value=\"AM\">AM</option>";
+			vCalTime+="<option "+SelectPm+" value=\"PM\">PM<option>";
+			vCalTime+="</select>";
+		}	
+		vCalTime+="\n</td>\n</tr>";
+		docCal.write(vCalTime);
+	}	
+	//end time picker
+	docCal.writeln("\n</table>");
+	docCal.writeln("</form></body></html>");
+	docCal.close();
+}
+
+function GenCell(pValue,pHighLight,pColor)//Generate table cell with value
+{
+	var PValue;
+	var PCellStr;
+	var vColor;
+	var vHLstr1;//HighLight string
+	var vHlstr2;
+	var vTimeStr;
+	
+	if (pValue==null)
+		PValue="";
+	else
+		PValue=pValue;
+	
+	if (pColor!=null)
+		vColor="bgcolor=\""+pColor+"\"";
+	else
+		vColor="";	
+	if ((pHighLight!=null)&&(pHighLight))
+		{vHLstr1="color='red'><b>";vHLstr2="</b>";}
+	else
+		{vHLstr1=">";vHLstr2="";}	
+	
+	if (Cal.ShowTime)
+	{
+		vTimeStr="winMain.document.getElementById('"+Cal.Ctrl+"').value+=' '+"+"winMain.Cal.getShowHour()"+"+':'+"+"winMain.Cal.Minutes"+"+':'+"+"winMain.Cal.Seconds";
+		if (TimeMode==12)
+			vTimeStr+="+' '+winMain.Cal.AMorPM";
+	}	
+	else
+		vTimeStr="";		
+	PCellStr="<td "+vColor+" width="+CellWidth+" align='center'><font face='verdana' size='2'"+vHLstr1+"<a href=\"javascript:winMain.document.getElementById('"+Cal.Ctrl+"').value='"+Cal.FormatDate(PValue)+"';"+vTimeStr+";window.close();\">"+PValue+"</a>"+vHLstr2+"</font></td>";
+	return PCellStr;
+}
+
+function Calendar(pDate,pCtrl)
+{
+	//Properties
+	this.Date=pDate.getDate();//selected date
+	this.Month=pDate.getMonth();//selected month number
+	this.Year=pDate.getFullYear();//selected year in 4 digits
+	this.Hours=pDate.getHours();	
+	
+	if (pDate.getMinutes()<10)
+		this.Minutes="0"+pDate.getMinutes();
+	else
+		this.Minutes=pDate.getMinutes();
+	
+	if (pDate.getSeconds()<10)
+		this.Seconds="0"+pDate.getSeconds();
+	else		
+		this.Seconds=pDate.getSeconds();
+		
+	this.MyWindow=winCal;
+	this.Ctrl=pCtrl;
+	this.Format="ddMMyyyy";
+	this.Separator=DateSeparator;
+	this.ShowTime=false;
+	if (pDate.getHours()<12)
+		this.AMorPM="AM";
+	else
+		this.AMorPM="PM";	
+}
+
+function GetMonthIndex(shortMonthName)
+{
+	for (i=0;i<12;i++)
+	{
+		if (MonthName[i].substring(0,3).toUpperCase()==shortMonthName.toUpperCase())
+		{	return i;}
+	}
+}
+Calendar.prototype.GetMonthIndex=GetMonthIndex;
+
+function IncYear()
+{	Cal.Year++;}
+Calendar.prototype.IncYear=IncYear;
+
+function DecYear()
+{	Cal.Year--;}
+Calendar.prototype.DecYear=DecYear;
+	
+function SwitchMth(intMth)
+{	Cal.Month=intMth;}
+Calendar.prototype.SwitchMth=SwitchMth;
+
+function SetHour(intHour)
+{	
+	var MaxHour;
+	var MinHour;
+  switch (TimeMode) {
+    case 24: {	MaxHour=23;MinHour=0; break; }
+    case 12: {	MaxHour=12;MinHour=1; break; }
+    default: { alert("TimeMode can only be 12 or 24"); break;}
+  }
+	var HourExp=new RegExp("^\\d\\d$");
+	if (HourExp.test(intHour) && (parseInt(intHour,10)<=MaxHour) && (parseInt(intHour,10)>=MinHour))
+	{	
+		if ((TimeMode==12) && (Cal.AMorPM=="PM"))
+		{
+			if (parseInt(intHour,10)==12)
+				Cal.Hours=12;
+			else	
+				Cal.Hours=parseInt(intHour,10)+12;
+		}	
+		else if ((TimeMode==12) && (Cal.AMorPM=="AM"))
+		{
+			if (intHour==12)
+				intHour-=12;
+			Cal.Hours=parseInt(intHour,10);
+		}
+		else if (TimeMode==24)
+			Cal.Hours=parseInt(intHour,10);	
+	}
+}
+Calendar.prototype.SetHour=SetHour;
+
+function SetMinute(intMin)
+{
+	var MinExp=new RegExp("^\\d\\d$");
+	if (MinExp.test(intMin) && (intMin<60))
+		Cal.Minutes=intMin;
+}
+Calendar.prototype.SetMinute=SetMinute;
+
+function SetSecond(intSec)
+{	
+	var SecExp=new RegExp("^\\d\\d$");
+	if (SecExp.test(intSec) && (intSec<60))
+		Cal.Seconds=intSec;
+}
+Calendar.prototype.SetSecond=SetSecond;
+
+function SetAmPm(pvalue)
+{
+	this.AMorPM=pvalue;
+	if (pvalue=="PM")
+	{
+		this.Hours=(parseInt(this.Hours,10))+12;
+		if (this.Hours==24)
+			this.Hours=12;
+	}	
+	else if (pvalue=="AM")
+		this.Hours-=12;	
+}
+Calendar.prototype.SetAmPm=SetAmPm;
+
+function getShowHour()
+{
+	var finalHour;
+    if (TimeMode==12)
+    {
+    	if (parseInt(this.Hours,10)==0)
+		{
+			this.AMorPM="AM";
+			finalHour=parseInt(this.Hours,10)+12;	
+		}
+		else if (parseInt(this.Hours,10)==12)
+		{
+			this.AMorPM="PM";
+			finalHour=12;
+		}		
+		else if (this.Hours>12)
+		{
+			this.AMorPM="PM";
+			if ((this.Hours-12)<10)
+				finalHour="0"+((parseInt(this.Hours,10))-12);
+			else
+				finalHour=parseInt(this.Hours,10)-12;	
+		}
+		else
+		{
+			this.AMorPM="AM";
+			if (this.Hours<10)
+				finalHour="0"+parseInt(this.Hours,10);
+			else
+				finalHour=this.Hours;	
+		}
+	}
+	else if (TimeMode==24)
+	{
+		if (this.Hours<10)
+			finalHour="0"+parseInt(this.Hours,10);
+		else	
+			finalHour=this.Hours;
+	}	
+	return finalHour;	
+}				
+Calendar.prototype.getShowHour=getShowHour;		
+
+function GetMonthName(IsLong)
+{
+	var Month=MonthName[this.Month];
+	if (IsLong)
+		return Month;
+	else
+		return Month.substr(0,3);
+}
+Calendar.prototype.GetMonthName=GetMonthName;
+
+function GetMonDays()//Get number of days in a month
+{
+	var DaysInMonth=[31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
+	if (this.IsLeapYear())
+	{
+		DaysInMonth[1]=29;
+	}	
+	return DaysInMonth[this.Month];	
+}
+Calendar.prototype.GetMonDays=GetMonDays;
+
+function IsLeapYear()
+{
+	if ((this.Year%4)==0)
+	{
+		if ((this.Year%100==0) && (this.Year%400)!=0)
+		{
+			return false;
+		}
+		else
+		{
+			return true;
+		}
+	}
+	else
+	{
+		return false;
+	}
+}
+Calendar.prototype.IsLeapYear=IsLeapYear;
+
+function FormatDate(pDate)
+{
+	if (this.Format.toUpperCase()=="DDMMYYYY")
+		return (pDate+DateSeparator+(this.Month+1)+DateSeparator+this.Year);
+	else if (this.Format.toUpperCase()=="DDMMMYYYY")
+		return (pDate+DateSeparator+this.GetMonthName(false)+DateSeparator+this.Year);
+	else if (this.Format.toUpperCase()=="MMDDYYYY")
+		return ((this.Month+1)+DateSeparator+pDate+DateSeparator+this.Year);
+	else if (this.Format.toUpperCase()=="MMMDDYYYY")
+		return (this.GetMonthName(false)+DateSeparator+pDate+DateSeparator+this.Year);			
+}
+Calendar.prototype.FormatDate=FormatDate;	
\ No newline at end of file
diff --git a/usr/local/www/javascript/index/ajax.js b/usr/local/www/javascript/index/ajax.js
index 2fc6ab6..fa33914 100644
--- a/usr/local/www/javascript/index/ajax.js
+++ b/usr/local/www/javascript/index/ajax.js
@@ -51,8 +51,10 @@ function stats(x) {
 function updateMemory(x) {
 	if(jQuery('#memusagemeter'))
 		jQuery("#memusagemeter").html(x + '%');
-	if(jQuery('#memUsagePB'))
-		jQuery('#memUsagePB').progressbar( { value: parseInt(x) } );
+	if(jQuery('#memwidtha'))
+		jQuery("#memwidtha").css('width',x + 'px');
+	if(jQuery('#memwidthb'))
+		jQuery("#memwidthb").css('width', (100 - x) + 'px');
 }
 
 function updateMbuf(x) {
@@ -63,15 +65,19 @@ function updateMbuf(x) {
 function updateMbufMeter(x) {
 	if(jQuery('#mbufusagemeter'))
 		jQuery("#mbufusagemeter").html(x + '%');
-	if(jQuery('#mbufPB'))
-		jQuery('#mbufPB').progressbar( { value: parseInt(x) } );
+	if(jQuery('#mbufwidtha'))
+		jQuery("#mbufwidtha").css('width',x + 'px');
+	if(jQuery('#mbufwidthb'))
+		jQuery("#mbufwidthb").css('width', (100 - x) + 'px');
 }
 
 function updateCPU(x) {
 	if(jQuery('#cpumeter'))
 		jQuery("#cpumeter").html(x + '%');
-	if(jQuery('#cpuPB'))
-		jQuery('#cpuPB').progressbar( { value: parseInt(x) } );
+	if(jQuery('#cpuwidtha'))
+		jQuery("#cpuwidtha").css('width',x + 'px');
+	if(jQuery('#cpuwidthb'))
+		jQuery("#cpuwidthb").css('width',(100 - x) + 'px');
 	/* Load CPU Graph widget if enabled */
 	if(widgetActive('cpu_graphs')) {
 		GraphValue(graph[0], x);
@@ -81,8 +87,10 @@ function updateCPU(x) {
 function updateTemp(x) {
 	if(jQuery("#tempmeter"))
 		jQuery("#tempmeter").html(x + '\u00B0' + 'C');
-        if(jQuery('#tempPB'))
-		jQuery("#tempPB").progressbar( { value: parseInt(x) } );
+        if(jQuery('#tempwidtha'))
+		jQuery("#tempwidtha").css('width',x + 'px');
+        if(jQuery('#tempwidthb'))
+		jQuery("#tempwidthb").css('width',(100 - x) + 'px');
 }
 
 function updateDateTime(x) {
@@ -103,8 +111,10 @@ function updateState(x) {
 function updateStateMeter(x) {
 	if(jQuery('#pfstateusagemeter'))
 		jQuery("#pfstateusagemeter").html(x + '%');
-	if(jQuery('#statePB'))
-		jQuery('#statePB').progressbar( { value: parseInt(x) } );
+	if(jQuery('#pfstatewidtha'))
+		jQuery("#pfstatewidtha").css('width',x + 'px');
+	if(jQuery('#pfstatewidthb'))
+		jQuery("#pfstatewidthb").css('width',(100 - x) + 'px');
 }
 
 function updateGatewayStats(x){
@@ -173,7 +183,7 @@ function updateInterfaces(x){
 
 function widgetActive(x) {
 	var widget = jQuery('#' + x + '-container');
-	if ((widget != null) && (widget.css('display') != null) && (widget.css('display') != "none"))
+	if ((widget != null) && (widget.css('display') != "none"))
 		return true;
 	else
 		return false;
@@ -182,5 +192,4 @@ function widgetActive(x) {
 /* start updater */
 jQuery(document).ready(function(){
 	setTimer();
-});
-
+});
\ No newline at end of file
diff --git a/usr/local/www/javascript/jquery/jquery-ui.custom.css b/usr/local/www/javascript/jquery/jquery-ui.custom.css
index 7dca82a..6f4a5ac 100755
--- a/usr/local/www/javascript/jquery/jquery-ui.custom.css
+++ b/usr/local/www/javascript/jquery/jquery-ui.custom.css
@@ -58,7 +58,7 @@
 .ui-widget input, .ui-widget select, .ui-widget textarea, .ui-widget button { font-family: Trebuchet MS, Helvetica, Arial, sans-serif; font-size: 1em; }
 .ui-widget-content { border: 1px solid #aaaaaa; background: #c9c9c9 url(images/ui-bg_inset-soft_50_c9c9c9_1x100.png) 50% bottom repeat-x; color: #333333; }
 .ui-widget-content a { color: #333333; }
-.ui-widget-header { border: 1px solid #bbbbbb; color: #444444; font-weight: bold; }
+.ui-widget-header { border: 1px solid #bbbbbb; background: #dddddd url(images/ui-bg_glass_35_dddddd_1x400.png) 50% 50% repeat-x; color: #444444; font-weight: bold; }
 .ui-widget-header a { color: #444444; }
 
 /* Interaction states
@@ -561,5 +561,5 @@ button.ui-button::-moz-focus-inner { border: 0; padding: 0; } /* reset extra pad
  *
  * http://docs.jquery.com/UI/Progressbar#theming
  */
-.ui-progressbar { height:1em; text-align: left; overflow: hidden; }
-.ui-progressbar .ui-progressbar-value {margin: -1px; height:100%; background-color:#990000; }
+.ui-progressbar { height:2em; text-align: left; overflow: hidden; }
+.ui-progressbar .ui-progressbar-value {margin: -1px; height:100%; }
\ No newline at end of file
diff --git a/usr/local/www/javascript/row_helper.js b/usr/local/www/javascript/row_helper.js
index b5424fe..8c9ff4f 100755
--- a/usr/local/www/javascript/row_helper.js
+++ b/usr/local/www/javascript/row_helper.js
@@ -39,21 +39,21 @@ var addRowTo = (function() {
 			for (cidr = 128; cidr>= 1; cidr--) {
 				str=str + "<option value=\"" + cidr + "\" >" + cidr + "</option>";
 			}
-			td.innerHTML="<INPUT type='hidden' value='" + totalrows +"' name='" + rowname[i] + "_row-" + totalrows + "'></input><select size='1' name='" + rowname[i] + totalrows + "' id='" + rowname[i] + totalrows + "'>" + str + "</select> ";
+			td.innerHTML="<INPUT type='hidden' value='" + totalrows +"' name='" + rowname[i] + "_row-" + totalrows + "'></input><select size='1' name='" + rowname[i] + totalrows + "'>" + str + "</select> ";
 		} else if(rowtype[i] == 'select,ipv4v6') {
                         var cidr;
 			var str;
 			for (cidr = 128; cidr>= 1; cidr--) {
 				str=str + "<option value=\"" + cidr + "\" >" + cidr + "</option>";
 			}
-			td.innerHTML="<INPUT type='hidden' value='" + totalrows +"' name='" + rowname[i] + "_row-" + totalrows + "'></input><select class='ipv4v6' size='1' name='" + rowname[i] + totalrows + "' id='" + rowname[i] + totalrows + "'>" + str + "</select> ";
+			td.innerHTML="<INPUT type='hidden' value='" + totalrows +"' name='" + rowname[i] + "_row-" + totalrows + "'></input><select class='ipv4v6' size='1' name='" + rowname[i] + totalrows + "'>" + str + "</select> ";
 		} else if(rowtype[i] == 'select_source') {
                         var cidr;
 			var str;
 			for (cidr = 128; cidr>= 1; cidr--) {
 				str=str + "<option value=\"" + cidr + "\" >" + cidr + "</option>";
 			}
-			td.innerHTML="<INPUT type='hidden' value='" + totalrows +"' name='" + rowname[i] + "_row-" + totalrows + "'></input><select size='1' name='" + rowname[i] + totalrows + "' id='" + rowname[i] + totalrows + "'>" + str + "</select> ";
+			td.innerHTML="<INPUT type='hidden' value='" + totalrows +"' name='" + rowname[i] + "_row-" + totalrows + "'></input><select size='1' name='" + rowname[i] + totalrows + "'>" + str + "</select> ";
 		} else {
 			td.innerHTML="<INPUT type='hidden' value='" + totalrows +"' name='" + rowname[i] + "_row-" + totalrows + "'></input><input type='checkbox' name='" + rowname[i] + totalrows + "'></input> ";
 		}
diff --git a/usr/local/www/license.php b/usr/local/www/license.php
index e2ffb98..82a93a5 100755
--- a/usr/local/www/license.php
+++ b/usr/local/www/license.php
@@ -47,7 +47,7 @@ include("head.inc");
             <p><strong><?=$g['product_name'];?> <?=gettext("is Copyright");?> &copy; <?=$g['product_copyright_years'];?> <?=gettext("by");?> <?=$g['product_copyright'];?><br>
               <?=gettext("All rights reserved");?>.</strong></p>
 
-            <p><strong><?=gettext("m0n0wall is Copyright ");?>&copy; <?=gettext("2002-2014 by Manuel Kasper");?>
+            <p><strong><?=gettext("m0n0wall is Copyright ");?>&copy; <?=gettext("2002-2007 by Manuel Kasper");?>
               (<a href="mailto:mk@neon1.net">mk@neon1.net</a>).<br>
               <?=gettext("All rights reserved");?>.</strong></p>
             <p> <?=gettext("Redistribution and use in source and binary forms, with or without");?><br>
@@ -81,15 +81,84 @@ include("head.inc");
               "OF THE");?><br>
               <?=gettext("POSSIBILITY OF SUCH DAMAGE");?></strong>.</p>
             <hr size="1">
+            <p><?=gettext("The following persons have contributed code to m0n0wall");?>:</p>
+            <p>Bob Zoller (<a href="mailto:bob@kludgebox.com">bob@kludgebox.com</a>)<br>
+              &nbsp;&nbsp;&nbsp;&nbsp;<em><font color="#666666"><?=gettext("Diagnostics: Ping ".
+              "function; WLAN channel auto-select; DNS forwarder");?></font></em><br>
+              <br>
+              Michael Mee (<a href="mailto:mikemee2002@pobox.com">mikemee2002@pobox.com</a>)<br>
+              &nbsp;&nbsp;&nbsp;&nbsp;<em><font color="#666666"><?=gettext("Timezone and NTP ".
+              "client support");?></font></em><br>
+              <br>
+              Magne Andreassen (<a href="mailto:magne.andreassen@bluezone.no">magne.andreassen@bluezone.no</a>)<br>
+              &nbsp;&nbsp;&nbsp;&nbsp;<em><font color="#666666"><?=gettext("Remote syslog'ing; ".
+              "some code bits for DHCP server on optional interfaces");?></font></em><br>
+              <br>
+              Rob Whyte (<a href="mailto:rob@g-labs.com">rob@g-labs.com</a>)<br>
+              &nbsp;&nbsp;&nbsp;&nbsp;<em><font color="#666666"><?=gettext("Idea/code bits ".
+              "for encrypted webConfigurator passwords; minimalized SNMP agent");?></font></em><br>
+              <br>
+              Petr Verner (<a href="mailto:verner@ipps.cz">verner@ipps.cz</a>)<br>
+              &nbsp;&nbsp;&nbsp;&nbsp;<em><font color="#666666"><?=gettext("Advanced outbound ".
+              "NAT: destination selection");?></font></em><br>
+              <br>
+              Bruce A. Mah (<a href="mailto:bmah@acm.org">bmah@acm.org</a>)<br>
+              &nbsp;&nbsp;&nbsp;&nbsp;<em><font color="#666666"><?=gettext("Filtering bridge ".
+              "patches ");?></font></em><br>
+              <br>
+              Jim McBeath (<a href="mailto:monowall@j.jimmc.org">monowall@j.jimmc.org</a>)<br>
+              &nbsp;&nbsp;&nbsp;&nbsp;<em><font color="#666666"><?=gettext("Filter rule patches ".
+              "(ordering, block/pass, disabled); better status page;");?><br>
+              &nbsp;&nbsp;&nbsp;&nbsp;<?=gettext("webConfigurator assign network ports page ");?></font></em><br>
+              <br>
+              Chris Olive (<a href="mailto:chris@technologEase.com">chris@technologEase.com</a>)<br>
+              &nbsp;&nbsp;&nbsp;&nbsp;<em><font color="#666666"><?=gettext("enhanced ");?>&quot;<?=gettext("execute ".
+              "command");?>&quot;<?=gettext(" page");?></font></em><br>
+              <br>
+              Pauline Middelink (<a href="mailto:middelink@polyware.nl">middelink@polyware.nl</a>)<br>
+              &nbsp;&nbsp;&nbsp;&nbsp;<em><font color="#666666"><?=gettext("DHCP client: send hostname patch");?></font></em><br>
+              <br>
+              Bjrn Plsson (<a href="mailto:bjorn@networksab.com">bjorn@networksab.com</a>)<br>
+              &nbsp;&nbsp;&nbsp;&nbsp;<em><font color="#666666"><?=gettext("DHCP lease list page");?></font></em><br>
+              <br>
+              Peter Allgeyer (<a href="mailto:allgeyer@web.de">allgeyer@web.de</a>)<br>
+              &nbsp;&nbsp;&nbsp;&nbsp;<em><font color="#666666">&quot;<?=gettext("reject");?>&quot; <?=gettext("type filter rules; dial-on-demand");?></font></em><br>
+              <br>
+              Thierry Lechat (<a href="mailto:dev@lechat.org">dev@lechat.org</a>)<br>
+              &nbsp;&nbsp;&nbsp;&nbsp;<em><font color="#666666"><?=gettext("SVG-based traffic grapher");?></font></em><br>
+              <br>
+              Steven Honson (<a href="mailto:steven@honson.org">steven@honson.org</a>)<br>
+              &nbsp;&nbsp;&nbsp;&nbsp;<em><font color="#666666"><?=gettext("per-user IP address assignments for PPTP VPN");?></font></em><br>
+              <br>
+              Kurt Inge Smdal (<a href="mailto:kurt@emsp.no">kurt@emsp.no</a>)<br>
+              &nbsp;&nbsp;&nbsp;&nbsp;<em><font color="#666666"><?=gettext("NAT on optional interfaces");?></font></em><br>
+              <br>
+              Dinesh Nair (<a href="mailto:dinesh@alphaque.com">dinesh@alphaque.com</a>)<br>
+              &nbsp;&nbsp;&nbsp;&nbsp;<em><font color="#666666"><?=gettext("captive portal: pass-through MAC/IP addresses, RADIUS authentication");?> &amp; <?=gettext("accounting;");?><br>
+              &nbsp;&nbsp;&nbsp;&nbsp;<em><font color="#666666"></font></em><?=gettext("HTTP server concurrency limit");?></font></em><br>
+              <br>
+              Justin Ellison (<a href="mailto:justin@techadvise.com">justin@techadvise.com</a>)<br>
+              &nbsp;&nbsp;&nbsp;&nbsp;<em><font color="#666666"><?=gettext("traffic shaper TOS matching; magic shaper; DHCP deny unknown clients;");?><br>
+			  &nbsp;&nbsp;&nbsp;&nbsp;<?=gettext("IPsec user FQDNs; DHCP relay");?></font></em><br>
+			  <br>
+              Michael Hanselmann (<a href="mailto:m0n0@hansmi.ch">m0n0@hansmi.ch</a>)<br>
+              &nbsp;&nbsp;&nbsp;&nbsp;<em><font color="#666666"><?=gettext("IDE hard disk standby");?></font></em><br>
+			  <br>
+              Audun Larsen (<a href="mailto:larsen@xqus.com">larsen@xqus.com</a>)<br>
+              &nbsp;&nbsp;&nbsp;&nbsp;<em><font color="#666666"><?=gettext("CPU/memory usage display");?></font></em><br>
+			  <br>
+              Peter Curran (<a href="mailto:peter@closeconsultants.com">peter@closeconsultants.com</a>)<br>
+              &nbsp;&nbsp;&nbsp;&nbsp;<em><font color="#666666"><?=gettext("OpenVPN support");?></font></em></p>
+            <hr size="1">
             <p><?= "{$g['product_name']} " . gettext("is based upon/includes various free software packages, ".
               "listed below.");?><br>
-              <?php printf(gettext("The authors of %s would like to thank the authors of these " .
+              <?php printf(gettext("The author of %s would like to thank the authors of these " .
               "software packages for their efforts"),$g['product_name']);?>.</p>
             <p>FreeBSD (<a href="http://www.freebsd.org" target="_blank">http://www.freebsd.org</a>)<br>
-              <?=gettext("Copyright");?> &copy;<?=gettext("1992-2014 The FreeBSD Project. All rights reserved");?>.<br>
+              <?=gettext("Copyright");?> &copy;<?=gettext("1992-2012 The FreeBSD Project. All rights reserved");?>.<br>
               <br>
               <?=gettext("This product includes PHP, freely available from");?> <a href="http://www.php.net/" target="_blank">http://www.php.net</a>.<br>
-              <?=gettext("Copyright"); ?> &copy; <?=gettext("1999-2014 The PHP Group. All rights reserved.");?>.<br>
+              <?=gettext("Copyright"); ?> &copy; <?=gettext("1999-2010 The PHP Group. All rights reserved.");?>.<br>
               <br>
               <?=gettext("LightTPD"); ?> (<a href="http://www.lighttpd.net" target="_blank">http://www.lighttpd.net)</a><br>
               <?=gettext("Copyright"); ?> &copy;<?=gettext("2004, Jan Knescke, incremental");?><jan@kneschke.de>
@@ -105,13 +174,13 @@ include("head.inc");
               <?=gettext("Copyright"); ?> &copy; 2003-2004, Archie L. Cobbs, Michael Bretterklieber, Alexander Motin<br>
 			  <?=gettext("All rights reserved.");?><br>
               <br>
-              <?=gettext("Circular log support for FreeBSD syslogd ");?>(<a href="http://software.wheelhouse.org/syslogd/" target="_blank">http://software.wheelhouse.org/syslogd/</a>)<br>
+              <?=gettext("Circular log support for FreeBSD syslogd ");?>(<a href="http://software.wwwi.com/syslogd/" target="_blank">http://software.wwwi.com/syslogd</a>)<br>
               <?=gettext("Copyright"); ?> &copy; 2001 Jeff Wheelhouse (jdw@wwwi.com)<br>
               <br>
               <?=gettext("Dnsmasq - a DNS forwarder for NAT firewalls");?> (<a href="http://www.thekelleys.org.uk" target="_blank">http://www.thekelleys.org.uk</a>)<br>
               <?=gettext("Copyright"); ?> &copy; 2000-2012 Simon Kelley.<br>
               <br>
-              <?=gettext("IPsec-Tools"); ?> (<a href="http://ipsec-tools.sourceforge.net/" target="_blank">http://ipsec-tools.sourceforge.net/</a>)<br>
+              <?=gettext("Racoon"); ?> (<a href="http://www.kame.net/racoon" target="_blank">http://www.kame.net/racoon</a>)<br>
               <?=gettext("Copyright"); ?> &copy; <?=gettext("1995-2002 WIDE Project. All rights reserved.");?><br>
               <br>
               <?=gettext("msntp"); ?> (<a href="http://www.hpcf.cam.ac.uk/export" target="_blank">http://www.hpcf.cam.ac.uk/export</a>)<br>
@@ -131,6 +200,9 @@ include("head.inc");
               <?=gettext("Copyright"); ?> &copy; 1997 Takamichi Tateoka (tree@mma.club.uec.ac.jp)<br>
 			 <?=gettext("Copyright"); ?> &copy; 2002 Thomas Quinot (thomas@cuivre.fr.eu.org)<br>
               <br>
+              <?=gettext("BPALogin"); ?> (<a href="http://bpalogin.sourceforge.net/" target="_blank">http://bpalogin.sourceforge.net</a>) - <?=gettext("lightweight portable BIDS2 login client");?><br>
+              <?=gettext("Copyright"); ?> &copy;<?=gettext(" 2001-3 Shane Hyde, and others.");?><br>
+              <br>
               <?=gettext("php-radius"); ?> (<a href="http://www.mavetju.org/programming/php.php" target="_blank">http://www.mavetju.org/programming/php.php</a>)<br>
               <?=gettext("Copyright 2000, 2001, 2002 by Edwin Groothuis. All rights reserved.");?><br>
 			  <?=gettext("This product includes software developed by Edwin Groothuis.");?><br>
@@ -139,7 +211,7 @@ include("head.inc");
 			  <?=gettext("Copyright"); ?> &copy; 2000,2001,2002,2003,2004 Thomas Krennwallner &lt;krennwallner@aon.at&gt;
 			  <br>
 			  <?=gettext("OpenVPN"); ?> (<a href="http://openvpn.net/" target="_blank">http://openvpn.net/</a>)
-			  <?=gettext("Copyright (C) 2002-2005 OpenVPN Solutions LLC ");?>
+			  <?=gettext("Copyright (C) 2002-2005 OpenVPN Solutions LLC ");?><info@openvpn.net>
 			  <?php include("fend.inc"); ?>
 </body>
 </html>
diff --git a/usr/local/www/load_balancer_monitor_edit.php b/usr/local/www/load_balancer_monitor_edit.php
index 1a4206c..271b2f6 100755
--- a/usr/local/www/load_balancer_monitor_edit.php
+++ b/usr/local/www/load_balancer_monitor_edit.php
@@ -87,7 +87,7 @@ if ($_POST) {
 	$reqdfields = explode(" ", "name type descr");
 	$reqdfieldsn = array(gettext("Name"),gettext("Type"),gettext("Description"));
 
-	do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+	do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 
 	/* Ensure that our monitor names are unique */
 	for ($i=0; isset($config['load_balancer']['monitor_type'][$i]); $i++)
diff --git a/usr/local/www/load_balancer_pool_edit.php b/usr/local/www/load_balancer_pool_edit.php
index 13a114a..32b2e4f 100755
--- a/usr/local/www/load_balancer_pool_edit.php
+++ b/usr/local/www/load_balancer_pool_edit.php
@@ -40,8 +40,6 @@
 ##|-PRIV
 
 require("guiconfig.inc");
-require_once("filter.inc");
-require_once("util.inc");
 
 if (!is_array($config['load_balancer']['lbpool'])) {
 	$config['load_balancer']['lbpool'] = array();
@@ -77,7 +75,7 @@ if ($_POST) {
 	$reqdfields = explode(" ", "name mode port monitor servers");
 	$reqdfieldsn = array(gettext("Name"),gettext("Mode"),gettext("Port"),gettext("Monitor"),gettext("Server List"));
 
-	do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+	do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 
 	/* Ensure that our pool names are unique */
 	for ($i=0; isset($config['load_balancer']['lbpool'][$i]); $i++)
@@ -87,12 +85,6 @@ if ($_POST) {
 	if (strpos($_POST['name'], " ") !== false)
 		$input_errors[] = gettext("You cannot use spaces in the 'name' field.");
 
-	if (in_array($_POST['name'], $reserved_table_names))
-		$input_errors[] = sprintf(gettext("The name '%s' is a reserved word and cannot be used."), $_POST['name']);
-
-	if (is_alias($_POST['name']))
-		$input_errors[] = sprintf(gettext("Sorry, an alias is already named %s."), $_POST['name']);
-
 	if (!is_portoralias($_POST['port']))
 		$input_errors[] = gettext("The port must be an integer between 1 and 65535, or a port alias.");
 
@@ -223,7 +215,7 @@ function clearcombo(){
 				</div>
 				<script type="text/javascript">
 				//<![CDATA[
-					var addressarray = <?= json_encode(get_alias_list(array("port", "url_ports", "urltable_ports"))) ?>;
+					var addressarray = <?= json_encode(get_alias_list("port")) ?>;
 					var oTextbox1 = new AutoSuggestControl(document.getElementById("port"), new StateSuggestions(addressarray));
 				//]]>
 				</script>
diff --git a/usr/local/www/load_balancer_relay_action_edit.php b/usr/local/www/load_balancer_relay_action_edit.php
index edbea87..44f0ecb 100755
--- a/usr/local/www/load_balancer_relay_action_edit.php
+++ b/usr/local/www/load_balancer_relay_action_edit.php
@@ -116,7 +116,7 @@ if ($_POST) {
 	$reqdfields = explode(" ", "name protocol direction action descr");
 	$reqdfieldsn = array(gettext("Name"),gettext("Protocol"),gettext("Direction"),gettext("Action"),gettext("Description"));
 
-	do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+	do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 
 	/* Ensure that our monitor names are unique */
 	for ($i=0; isset($config['load_balancer']['lbactions'][$i]); $i++)
diff --git a/usr/local/www/load_balancer_relay_protocol_edit.php b/usr/local/www/load_balancer_relay_protocol_edit.php
index 387d00d..9dd02a0 100755
--- a/usr/local/www/load_balancer_relay_protocol_edit.php
+++ b/usr/local/www/load_balancer_relay_protocol_edit.php
@@ -78,7 +78,7 @@ if ($_POST) {
 	$reqdfields = explode(" ", "name type descr");
 	$reqdfieldsn = array(gettext("Name"),gettext("Type"),gettext("Description"));
 
-	do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+	do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 
 	/* Ensure that our monitor names are unique */
 	for ($i=0; isset($config['load_balancer']['lbprotocol'][$i]); $i++)
diff --git a/usr/local/www/load_balancer_setting.php b/usr/local/www/load_balancer_setting.php
index 7085e5a..6eff1ef 100755
--- a/usr/local/www/load_balancer_setting.php
+++ b/usr/local/www/load_balancer_setting.php
@@ -151,7 +151,7 @@ include("head.inc");
                  <td width="78%" class="vtable">
                    <input name="prefork" id="prefork" value="<?php if ($lbsetting['prefork'] <> "") echo $lbsetting['prefork']; ?>" class="formfld unknown">
                    <br />
-                   <?=gettext("Number of processes used by relayd for dns protocol. Leave blank to use the default value of 5 processes"); ?>
+                   <?=gettext("Number of processes used by relayd. Leave blank to use the default value of 5 processes"); ?>
                 </td>
              </tr>
              <tr>
diff --git a/usr/local/www/load_balancer_virtual_server_edit.php b/usr/local/www/load_balancer_virtual_server_edit.php
index db7a49f..32d8cdd 100755
--- a/usr/local/www/load_balancer_virtual_server_edit.php
+++ b/usr/local/www/load_balancer_virtual_server_edit.php
@@ -79,7 +79,7 @@ if ($_POST) {
     }
   }
 
-	do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+	do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 
 	for ($i=0; isset($config['load_balancer']['virtual_server'][$i]); $i++)
 		if (($_POST['name'] == $config['load_balancer']['virtual_server'][$i]['name']) && ($i != $id))
@@ -96,9 +96,6 @@ if ($_POST) {
 	else if (is_subnetv4($_POST['ipaddr']) && subnet_size($_POST['ipaddr']) > 64)
 		$input_errors[] = sprintf(gettext("%s is a subnet containing more than 64 IP addresses."), $_POST['ipaddr']);
 
-	if ((strtolower($_POST['relay_protocol']) == "dns") && !empty($_POST['sitedown']))
-		$input_errors[] = gettext("You cannot select a Fall Back Pool when using the DNS relay protocol.");
-
 	if (!$input_errors) {
 		$vsent = array();
 		if(isset($id) && $a_vs[$id])
@@ -193,7 +190,7 @@ include("head.inc");
 					<br><?=gettext("You may also specify a port alias listed in Firewall -&gt; Aliases here."); ?>
 					<script type="text/javascript">
 					//<![CDATA[
-						var port_aliases = <?= json_encode(get_alias_list(array("port", "url_ports", "urltable_ports"))) ?>;
+						var port_aliases = <?= json_encode(get_alias_list("port")) ?>;
 						var oTextbox2 = new AutoSuggestControl(document.getElementById("port"), new StateSuggestions(port_aliases));
 					//]]>
 					</script>
@@ -235,8 +232,7 @@ include("head.inc");
             				}
             			?>
             			</select>
-				<br><?=gettext("The server pool to which clients will be redirected if *ALL* servers in the Virtual Server Pool are offline."); ?>
-				<br><?=gettext("This option is NOT compatible with the DNS relay protocol."); ?>
+				<br><b><?=gettext("NOTE:"); ?></b> <?=gettext("This is the server that clients will be redirected to if *ALL* servers in the pool are offline."); ?>
 				  <?php endif; ?>
                   </td>
 				</tr>
diff --git a/usr/local/www/pkg_edit.php b/usr/local/www/pkg_edit.php
index 99e64f8..90f6163 100755
--- a/usr/local/www/pkg_edit.php
+++ b/usr/local/www/pkg_edit.php
@@ -137,7 +137,7 @@ if ($_POST) {
 				$reqfieldsn[] = $field['fielddescr'];
 		}
 	}
-	do_input_validation($_POST, $reqfields, $reqfieldsn, $input_errors);
+	do_input_validation($_POST, $reqfields, $reqfieldsn, &$input_errors);
 
 	if ($pkg['custom_php_validation_command'])
 		eval($pkg['custom_php_validation_command']);
@@ -719,9 +719,7 @@ if ($pkg['tabs'] <> "") {
 				if (is_array($config['interfaces']))
 					foreach ($config['interfaces'] as $iface_key=>$iface_value){
 						if (isset($iface_value['enable']) && ! preg_match("/$interface_regex/",$iface_key)){
-							$iface_description=($iface_value['descr'] !="" ? strtoupper($iface_value['descr']) : strtoupper($iface_key));
-							if (isset($pkga['showips']))
-								$iface_description .= " address";
+							$iface_description=(isset($pkga['showips']) ? strtoupper($iface_key)." address" : strtoupper($iface_key));
 							$ips[]=array('ip'=> $iface_key, 'description'=> $iface_description);
 							}
 					}
@@ -992,7 +990,7 @@ function display_row($trc, $value, $fieldname, $type, $rowhelper, $size) {
 			$multiple = '';
 			if (isset($rowhelper['multiple'])) {
 				$fieldname .= '[]';
-				$multiple = "multiple=\"multiple\"";
+				$multiple = 'multiple="multiple';
 			}
 			echo "<select style='height:22px;' id='{$fieldname}{$trc}' name='{$fieldname}{$trc}' {$size} {$multiple}>\n";
 			$ifaces = get_configured_interface_with_descr();
@@ -1006,7 +1004,7 @@ function display_row($trc, $value, $fieldname, $type, $rowhelper, $size) {
 			$ifaces["lo0"] = "loopback";
 			echo "<option><name></name><value></value></option>/n";
 			foreach($ifaces as $ifname => $iface) {
-				$text .="<option value=\"{$ifname}\">$iface</option>";
+				$text .="<option value=\\\"$ifname\\\">$iface</option>";
 				echo "<option value=\"{$ifname}\" ".(in_array($ifname, $values) ? 'selected="selected"' : '').">{$iface}</option>\n";
 				}
 			echo "</select>\n";
diff --git a/usr/local/www/pkg_mgr.php b/usr/local/www/pkg_mgr.php
index 1773021..bfb6d46 100755
--- a/usr/local/www/pkg_mgr.php
+++ b/usr/local/www/pkg_mgr.php
@@ -1,32 +1,30 @@
 <?php
 /* $Id$ */
 /*
-	pkg_mgr.php
-	Copyright (C) 2004-2012 Scott Ullrich <sullrich@gmail.com>
-	Copyright (C) 2013 Marcello Coutinho
+    pkg_mgr.php
+    Copyright (C) 2004-2012 Scott Ullrich <sullrich@gmail.com>
+    All rights reserved.
 
-	All rights reserved.
+    Redistribution and use in source and binary forms, with or without
+    modification, are permitted provided that the following conditions are met:
 
-	Redistribution and use in source and binary forms, with or without
-	modification, are permitted provided that the following conditions are met:
+    1. Redistributions of source code must retain the above copyright notice,
+       this list of conditions and the following disclaimer.
 
-	1. Redistributions of source code must retain the above copyright notice,
-	   this list of conditions and the following disclaimer.
+    2. Redistributions in binary form must reproduce the above copyright
+       notice, this list of conditions and the following disclaimer in the
+       documentation and/or other materials provided with the distribution.
 
-	2. Redistributions in binary form must reproduce the above copyright
-	   notice, this list of conditions and the following disclaimer in the
-	   documentation and/or other materials provided with the distribution.
-
-	THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES,
-	INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY
-	AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
-	AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY,
-	OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
-	SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
-	INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
-	CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
-	ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
-	POSSIBILITY OF SUCH DAMAGE.
+    THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES,
+    INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY
+    AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
+    AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY,
+    OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
+    SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
+    INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
+    CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
+    ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
+    POSSIBILITY OF SUCH DAMAGE.
 */
 /*
 	pfSense_BUILDER_BINARIES:	/sbin/ifconfig
@@ -64,36 +62,28 @@ if(is_subsystem_dirty('packagelock')) {
 	echo "</html>";
 	exit;
 }
-function domTT_title($title_msg) {
-	if (!empty($title_msg)) {
+function domTT_title($title_msg){
+	if (!empty($title_msg)){
 		$title_msg=preg_replace("/\s+/"," ",$title_msg);
-		$title_msg=preg_replace("/'/","\'",$title_msg);
+        $title_msg=preg_replace("/'/","\'",$title_msg);
 		echo "onmouseout=\"this.style.color = ''; domTT_mouseout(this, event);\" onmouseover=\"domTT_activate(this, event, 'content', '{$title_msg}', 'trail', true, 'delay', 0, 'fade', 'both', 'fadeMax', 93, 'styleClass', 'niceTitle');\"";
 	}
 }
-//get_pkg_info only if cache file has more then $g[min_pkg_cache_file_time] seconds
-$pkg_cache_file_time=($g['min_pkg_cache_file_time'] ? $g['min_pkg_cache_file_time'] : 120);
-
-if (!file_exists("{$g['tmp_path']}/pkg_info.cache") || (time() - filemtime("{$g['tmp_path']}/pkg_info.cache")) > $pkg_cache_file_time) {
-	$pkg_info = get_pkg_info('all', array("noembedded", "name", "category", "website", "version", "status", "descr", "maintainer", "required_version", "maximum_version", "pkginfolink", "supportedbybsdperimeter","config_file"));
-	//create cache file after get_pkg_info
-	if($pkg_info) {
-		$fout = fopen("{$g['tmp_path']}/pkg_info.cache", "w");
-		fwrite($fout, serialize($pkg_info));
-		fclose($fout);
-		//$pkg_sizes = get_pkg_sizes();
+$pkg_info = get_pkg_info('all', array("noembedded", "name", "category", "website", "version", "status", "descr", "maintainer", "required_version", "maximum_version", "pkginfolink", "supportedbybsdperimeter","config_file"));
+if($pkg_info) {
+	$fout = fopen("{$g['tmp_path']}/pkg_info.cache", "w");
+	fwrite($fout, serialize($pkg_info));
+	fclose($fout);
+	//$pkg_sizes = get_pkg_sizes();
+} else {
+	$using_cache = true;
+	$xmlrpc_base_url = isset($config['system']['altpkgrepo']['enable']) ? $config['system']['altpkgrepo']['xmlrpcbaseurl'] : $g['xmlrpcbaseurl'];
+	if(file_exists("{$g['tmp_path']}/pkg_info.cache")) {
+		$savemsg = sprintf(gettext("Unable to retrieve package info from %s. Cached data will be used."), $xmlrpc_base_url);
+		$pkg_info = unserialize(@file_get_contents("{$g['tmp_path']}/pkg_info.cache"));
 	} else {
-		$using_cache = true;
-		$xmlrpc_base_url = isset($config['system']['altpkgrepo']['enable']) ? $config['system']['altpkgrepo']['xmlrpcbaseurl'] : $g['xmlrpcbaseurl'];
-		if(file_exists("{$g['tmp_path']}/pkg_info.cache")) {
-			$savemsg = sprintf(gettext("Unable to retrieve package info from %s. Cached data will be used."), $xmlrpc_base_url);
-			$pkg_info = unserialize(@file_get_contents("{$g['tmp_path']}/pkg_info.cache"));
-		} else {
-			$savemsg = sprintf(gettext('Unable to communicate with %1$s. Please verify DNS and interface configuration, and that %2$s has functional Internet connectivity.'), $xmlrpc_base_url, $g['product_name']);
-		}
+		$savemsg = sprintf(gettext('Unable to communicate with %1$s. Please verify DNS and interface configuration, and that %2$s has functional Internet connectivity.'), $xmlrpc_base_url, $g['product_name']);
 	}
-} else {
-	$pkg_info = unserialize(@file_get_contents("{$g['tmp_path']}/pkg_info.cache"));
 }
 
 if (! empty($_GET))
@@ -119,125 +109,124 @@ include("head.inc");
 		print_info_box($savemsg);
 ?>
 <table width="100%" border="0" cellpadding="0" cellspacing="0" summary="package manager">
-	<tr><td>
-<?php
-	$version = rtrim(file_get_contents("/etc/version"));
-
-	$tab_array = array();
-	$tab_array[] = array(gettext("Available Packages"), $requested_version <> "" ? false : true, "pkg_mgr.php");
-	$tab_array[] = array(gettext("Installed Packages"), false, "pkg_mgr_installed.php");
-	display_top_tabs($tab_array);
-?>
-	</td></tr>
-	<tr><td>
-<?php
-	$version = rtrim(file_get_contents("/etc/version"));
-	if($pkg_info) {
-		$pkg_keys = array_keys($pkg_info);
-		natcasesort($pkg_keys);
-
-		//Check categories
-		$categories=array();
-		if(is_array($pkg_keys)) {
-			foreach($pkg_keys as $key) {
-				if (!package_skip_tests($pkg_info[$key],$requested_version))
-					$categories[$pkg_info[$key]['category']]++;
-				}
-			}
-		ksort($categories);
-		$cm_count=0;
-		$tab_array = array();
-		$visible_categories=array();
-		$categories_min_count=($g['pkg_categories_min_count'] ? $g['pkg_categories_min_count'] : 3);
-		$categories_max_display=($g['pkg_categories_max_display'] ? $g['pkg_categories_max_display'] : 6);
-
-		/* check selected category or define default category to show */
-		if (isset($_REQUEST['category']))
-			$menu_category = $_REQUEST['category'];
-		else if (isset($g['pkg_default_category']))
-			$menu_category = $g['pkg_default_category'];
-		else
-			$menu_category = "All";
+	<tr>
+		<td>
+		<?php
+			$version = rtrim(file_get_contents("/etc/version"));
 
-		$menu_category = (isset($_REQUEST['category']) ? $_REQUEST['category'] : "All");
-		$show_category = ($menu_category == "Other" || $menu_category == "All");
-
-		$tab_array[] = array(gettext("All"), $menu_category=="All" ? true : false, "pkg_mgr.php?category=All");
-		foreach ($categories as $category => $c_count) {
-			if ($c_count >= $categories_min_count && $cm_count <= $categories_max_display) {
-				$tab_array[] = array(gettext($category) , $menu_category==$category ? true : false, "pkg_mgr.php?category={$category}");
-				$visible_categories[]=$category;
-				$cm_count++;
-			}
-		}
-		$tab_array[] = array(gettext("Other Categories"), $menu_category=="Other" ? true : false, "pkg_mgr.php?category=Other");
-		if (count($categories) > 1)
+			$tab_array = array();
+			$tab_array[] = array(gettext("Available Packages"), $requested_version <> "" ? false : true, "pkg_mgr.php");
+//			$tab_array[] = array($version . gettext("packages"), $requested_version <> "" ? false : true, "pkg_mgr.php");
+//			$tab_array[] = array("Packages for any platform", $requested_version == "none" ? true : false, "pkg_mgr.php?ver=none");
+//			$tab_array[] = array("Packages with a different version", $requested_version == "other" ? true : false, "pkg_mgr.php?ver=other");
+			$tab_array[] = array(gettext("Installed Packages"), false, "pkg_mgr_installed.php");
 			display_top_tabs($tab_array);
-	}
-?>
-	</td></tr>
-	<tr><td>
-	<div id="mainarea">
-		<table class="tabcont sortable" width="100%" border="0" cellpadding="6" cellspacing="0" summary="main area">
-		<tr><td width="10%" class="listhdrr"><?=gettext("Name"); ?></td>
-<?php
-		if ($show_category)
-			print '<td width="18%" class="listhdr">'.gettext("Category").'</td>'."\n";
-?>
-		<td width="<?php print $show_category ? "15%" : "20%"; ?>" class="listhdr"><?=gettext("Status"); ?></td>
-		<td width="<?php print $show_category ? "58%" : "70%"; ?>" class="listhdr"><?=gettext("Description"); ?></td>
-		<td width="17">&nbsp;</td></tr>
-<?php
-		if(!$pkg_info) {
-			echo "<tr><td colspan=\"5\"><center>" . gettext("There are currently no packages available for installation.") . "</td></tr>";
-		} else {
-			if(is_array($pkg_keys)) {
-				foreach($pkg_keys as $key):
-					$index = &$pkg_info[$key];
-					if(get_pkg_id($index['name']) >= 0 )
-						continue;
-
-					if (package_skip_tests($index,$requested_version))
-						continue;
-
-					/* get history/changelog git dir */
-					$commit_dir=explode("/",$index['config_file']);
-					$changeloglink ="https://github.com/pfsense/pfsense-packages/commits/master/config/".$commit_dir[(count($commit_dir)-2)];
-
-					/* Check package info link */
-					if($index['pkginfolink']) {
-						$pkginfolink = $index['pkginfolink'];
-						$pkginfo=gettext("Package info");
-					} else {
-						$pkginfolink = "http://forum.pfsense.org/index.php/board,15.0.html";
-						$pkginfo=gettext("No package info, check the forum");
-					}
-
-					if ($menu_category == "All" || $index['category'] == $menu_category || ($menu_category == "Other" && !in_array($index['category'],$visible_categories)) ):
-?>
-						<tr valign="top" class="<?= $index['category'] ?>">
+		?>
+		</td>
+	</tr>
+	<tr>
+		<td>
+			<div id="mainarea">
+				<table class="tabcont sortable" width="100%" border="0" cellpadding="6" cellspacing="0" summary="main area">
+					<tr>
+						<td width="12%" class="listhdrr"><?=gettext("Name"); ?></td>
+						<td width="18%" class="listhdrr"><?=gettext("Category"); ?></td>
+						<td width="15%" class="listhdrr"><?=gettext("Status"); ?></td>
+						<td width="53%" class="listhdr"><?=gettext("Description"); ?></td>
+						<td width="17">&nbsp;</td>
+					</tr>
+					<?php
+						if(!$pkg_info) {
+							echo "<tr><td colspan=\"5\"><center>" . gettext("There are currently no packages available for installation.") . "</td></tr>";
+						} else {
+							$pkgs = array();
+							$instpkgs = array();
+							if($config['installedpackages']['package'] != "")
+								foreach($config['installedpackages']['package'] as $instpkg) $instpkgs[] = $instpkg['name'];
+									$pkg_names = array_keys($pkg_info);
+							$pkg_keys = array();
+							
+							foreach($pkg_names as $name)
+								if(!in_array($name, $instpkgs)) $pkg_keys[] = $name;
+							$pkg_keys = msort($pkg_keys);
+							if(count($pkg_keys) != 0) {
+								foreach($pkg_keys as $key) {
+									$index = &$pkg_info[$key];
+									if(in_array($index['name'], $instpkgs)) 
+										continue;
+									if($g['platform'] == "nanobsd")
+										if($index['noembedded']) 
+											continue;
+									/* If we are on not on HEAD, and the package wants it, skip */
+									if ($version <> "HEAD" &&
+										$index['required_version'] == "HEAD" &&
+										$requested_version <> "other")
+										continue;
+									/* If there is no required version, and the requested package 
+										version is not 'none', then skip */
+									if (empty($index['required_version']) &&
+										$requested_version <> "none")
+										continue;
+									/* If the requested version is not 'other', and the required version is newer than what we have, skip. */
+									if($requested_version <> "other" &&
+										(pfs_version_compare("", $version, $index['required_version']) < 0))
+										continue;
+									/* If the requestion version is 'other' and we are on the version requested, skip. */
+									if($requested_version == "other" &&
+										(pfs_version_compare("", $version, $index['required_version']) == 0))
+										continue;
+									/* Package is only for an older version, lets skip */
+									if($index['maximum_version'] &&
+										(pfs_version_compare("", $version, $index['maximum_version']) > 0))
+										continue;
+									/* get history/changelog git dir */
+									$commit_dir=explode("/",$index['config_file']);
+									$changeloglink ="https://github.com/pfsense/pfsense-packages/commits/master/config/".$commit_dir[(count($commit_dir)-2)];
+									/* Check package info link */
+									if($index['pkginfolink']){
+										$pkginfolink = $index['pkginfolink'];
+										$pkginfo=gettext("Package info");
+										}
+									else{
+										$pkginfolink = "http://forum.pfsense.org/index.php/board,15.0.html";
+										$pkginfo=gettext("No package info, check the forum");
+										}
+					?>
+					<tr valign="top">
 						<td class="listlr" <?=domTT_title(gettext("Click on package name to access its website."))?>>
 							<a target="_blank" href="<?= $index['website'] ?>"><?= $index['name'] ?></a>
 						</td>
-<?php
-						if ($show_category)
-							print '<td class="listr">'.gettext($index['category']).'</td>'."\n";
-
-						if ($g['disablepackagehistory']) {
-							print '<td class="listr">'."\n";
-						} else {
-							print '<td class="listr" ';
-							domTT_title(gettext("Click ").ucfirst($index['name']).gettext(" version to check its change log."));
-							print ">\n";
-						}
-
-						print "{$index['status']} <br>\n";
-
+						<td class="listr">
+							<?= $index['category'] ?>
+						</td>
+						<?php
+							/*
+							if(!$using_cache) {
+								$size = get_package_install_size($index['name'], $pkg_sizes);
+								$size = squash_from_bytes($size[$index['name']], 1);
+							}
+							if(!$size)
+								$size = "Unknown.";
+							*/
+						?>
+<!--
+						<td class="listr">
+							<?= $size ?>
+						</td>
+-->
+						<?php if ($g['disablepackagehistory']){?>
+							<td	class="listr">
+						<?php }else{?>
+							<td class="listr" <?=domTT_title(gettext("Click ".ucfirst($index['name'])." version to check its change log."))?>>
+						<?php }?>
+						<?=$index['status'] ?>
+						<br/>
+						<?php
 						if ($g['disablepackagehistory'])
 							echo"<a>{$index['version']}</a>";
 						else
 							echo "<a target='_blank' href='{$changeloglink}'>{$index['version']}</a>";
-?>
+						?>
 						<br/>
 						<?=gettext("platform") .": ". $index['required_version'] ?>
 						<br/>
@@ -245,29 +234,26 @@ include("head.inc");
 						</td>
 						<td class="listbg" style="overflow:hidden; text-align:justify;" <?=domTT_title(gettext("Click package info for more details about ".ucfirst($index['name'])." package."))?>>
 						<?= $index['descr'] ?>
-<?php
-						if (! $g['disablepackageinfo']):
-?>
-							<br/><br/>
-							<a target='_blank' href='<?=$pkginfolink?>' style='align:center;color:#ffffff; filter:Glow(color=#ff0000, strength=12);'><?=$pkginfo?></a>
-<?php
-						endif;
-?>
+						<?php if (! $g['disablepackageinfo']): ?>
+						<br/><br/>
+						<a target='_blank' href='<?=$pkginfolink?>' style='align:center;color:#ffffff; filter:Glow(color=#ff0000, strength=12);'><?=$pkginfo?></a>
+						<?php endif; ?>
 						</td>
 						<td valign="middle" class="list nowrap" width="17">
 							<a onclick="return confirm('<?=gettext("Do you really want to install ".ucfirst($index['name'])." package?"); ?>')" href="pkg_mgr_install.php?id=<?=$index['name'];?>"><img <?=domTT_title(gettext("Install ".ucfirst($index['name'])." package."))?> src="./themes/<?= $g['theme']; ?>/images/icons/icon_plus.gif" width="17" height="17" border="0" alt="add" /></a>
-						</td></tr>
-<?php
-					endif;
-				endforeach;
-			} else {
-				echo "<tr><td colspan='5' align='center'>" . gettext("There are currently no packages available for installation.") . "</td></tr>";
-			} /* if(is_array($pkg_keys)) */
-		} /* if(!$pkg_info) */
-?>
-		</table>
-	</div>
-	</td></tr>
+						</td>
+					</tr>
+					<?php
+								}
+							} else {
+								echo "<tr><td colspan='5' align='center'>" . gettext("There are currently no packages available for installation.") . "</td></tr>";
+							}
+						}
+					?>
+				</table>
+			</div>
+		</td>
+	</tr>
 </table>
 <?php include("fend.inc"); ?>
 </body>
diff --git a/usr/local/www/services_captiveportal.php b/usr/local/www/services_captiveportal.php
index 3bf53f7..a387ede 100755
--- a/usr/local/www/services_captiveportal.php
+++ b/usr/local/www/services_captiveportal.php
@@ -38,20 +38,12 @@
 ##|*MATCH=services_captiveportal.php*
 ##|-PRIV
 
+require_once("guiconfig.inc");
 require_once("functions.inc");
 require_once("filter.inc");
 require_once("shaper.inc");
 require_once("captiveportal.inc");
 
-if (substr($_GET['act'], 0, 3) == "get")
-	$nocsrf = true;
-
-require_once("guiconfig.inc");
-
-global $cpzone;
-global $cpzoneid;
-
-$cpzoneid = 1; /* Just a default */
 $cpzone = $_GET['zone'];
 if (isset($_POST['zone']))
 	$cpzone = $_POST['zone'];
@@ -72,59 +64,14 @@ if ($_GET['act'] == "viewhtml") {
 	if ($a_cp[$cpzone] && $a_cp[$cpzone]['page']['htmltext'])
 		echo base64_decode($a_cp[$cpzone]['page']['htmltext']);
 	exit;
-} else if ($_GET['act'] == "gethtmlhtml" && $a_cp[$cpzone] && $a_cp[$cpzone]['page']['htmltext']) {
-	$file_data = base64_decode($a_cp[$cpzone]['page']['htmltext']);
-	$file_size = strlen($file_data);
-
-	header("Content-Type: text/html");
-	header("Content-Disposition: attachment; filename=portal.html");
-	header("Content-Length: $file_size");
-	echo $file_data;
-
-	exit;
-} else if ($_GET['act'] == "delhtmlhtml" && $a_cp[$cpzone] && $a_cp[$cpzone]['page']['htmltext']) {
-	unset($a_cp[$cpzone]['page']['htmltext']);
-	write_config(sprintf(gettext("Captive Portal: zone %s: Restore default portal page"), $cpzone));
-	header("Location: services_captiveportal.php?zone={$cpzone}");
-	exit;
 } else if ($_GET['act'] == "viewerrhtml") {
 	if ($a_cp[$cpzone] && $a_cp[$cpzone]['page']['errtext'])
 		echo base64_decode($a_cp[$cpzone]['page']['errtext']);
 	exit;
-} else if ($_GET['act'] == "geterrhtml" && $a_cp[$cpzone] && $a_cp[$cpzone]['page']['errtext']) {
-	$file_data = base64_decode($a_cp[$cpzone]['page']['errtext']);
-	$file_size = strlen($file_data);
-
-	header("Content-Type: text/html");
-	header("Content-Disposition: attachment; filename=err.html");
-	header("Content-Length: $file_size");
-	echo $file_data;
-
-	exit;
-} else if ($_GET['act'] == "delerrhtml" && $a_cp[$cpzone] && $a_cp[$cpzone]['page']['errtext']) {
-	unset($a_cp[$cpzone]['page']['errtext']);
-	write_config(sprintf(gettext("Captive Portal: zone %s: Restore default error page"), $cpzone));
-	header("Location: services_captiveportal.php?zone={$cpzone}");
-	exit;
 } else if ($_GET['act'] == "viewlogouthtml") {
 	if ($a_cp[$cpzone] && $a_cp[$cpzone]['page']['logouttext'])
 		echo base64_decode($a_cp[$cpzone]['page']['logouttext']);
 	exit;
-} else if ($_GET['act'] == "getlogouthtml" && $a_cp[$cpzone] && $a_cp[$cpzone]['page']['logouttext']) {
-	$file_data = base64_decode($a_cp[$cpzone]['page']['logouttext']);
-	$file_size = strlen($file_data);
-
-	header("Content-Type: text/html");
-	header("Content-Disposition: attachment; filename=logout.html");
-	header("Content-Length: $file_size");
-	echo $file_data;
-
-	exit;
-} else if ($_GET['act'] == "dellogouthtml" && $a_cp[$cpzone] && $a_cp[$cpzone]['page']['logouttext']) {
-	unset($a_cp[$cpzone]['page']['logouttext']);
-	write_config(sprintf(gettext("Captive Portal: zone %s: Restore default logout page"), $cpzone));
-	header("Location: services_captiveportal.php?zone={$cpzone}");
-	exit;
 }
 
 if (!is_array($config['ca']))
@@ -138,7 +85,7 @@ if (!is_array($config['cert']))
 $a_cert =& $config['cert'];
 
 if ($a_cp[$cpzone]) {
-	$cpzoneid = $pconfig['zoneid'] = $a_cp[$cpzone]['zoneid'];
+	$pconfig['zoneid'] = $a_cp[$cpzone]['zoneid'];
 	$pconfig['cinterface'] = $a_cp[$cpzone]['interface'];
 	$pconfig['maxproc'] = $a_cp[$cpzone]['maxproc'];
 	$pconfig['maxprocperip'] = $a_cp[$cpzone]['maxprocperip'];
@@ -158,7 +105,6 @@ if ($a_cp[$cpzone]) {
 	$pconfig['httpslogin_enable'] = isset($a_cp[$cpzone]['httpslogin']);
 	$pconfig['httpsname'] = $a_cp[$cpzone]['httpsname'];
 	$pconfig['preauthurl'] = strtolower($a_cp[$cpzone]['preauthurl']);
-	$pconfig['blockedmacsurl'] = strtolower($a_cp[$cpzone]['blockedmacsurl']);
 	$pconfig['certref'] = $a_cp[$cpzone]['certref'];
 	$pconfig['logoutwin_enable'] = isset($a_cp[$cpzone]['logoutwin_enable']);
 	$pconfig['peruserbw'] = isset($a_cp[$cpzone]['peruserbw']);
@@ -208,7 +154,7 @@ if ($_POST) {
 		$reqdfields = explode(" ", "zone cinterface");
 		$reqdfieldsn = array(gettext("Zone name"), gettext("Interface"));
 
-		do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+		do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 
 		/* make sure no interfaces are bridged or used on other zones */
 		if (is_array($_POST['cinterface'])) {
@@ -301,12 +247,10 @@ if ($_POST) {
 		$newcp =& $a_cp[$cpzone];
 		//$newcp['zoneid'] = $a_cp[$cpzone]['zoneid'];
 		if (empty($newcp['zoneid'])) {
-			$newcp['zoneid'] = 2;
-			foreach ($a_cp as $keycpzone => $cp) {
+			$newcp['zoneid'] = 8000;
+			foreach ($a_cp as $keycpzone => $cp)
 				if ($cp['zoneid'] == $newcp['zoneid'] && $keycpzone != $cpzone)
 					$newcp['zoneid'] += 2; /* Resreve space for SSL config if needed */
-			}
-			$cpzoneid = $newcp['zoneid'];
 		}
 		$oldifaces = explode(",", $newcp['interface']);
 		if (is_array($_POST['cinterface']))
@@ -335,7 +279,6 @@ if ($_POST) {
 			unset($newcp['httpslogin']);
 		$newcp['httpsname'] = $_POST['httpsname'];
 		$newcp['preauthurl'] = $_POST['preauthurl'];
-		$newcp['blockedmacsurl'] = $_POST['blockedmacsurl'];
 		$newcp['peruserbw'] = $_POST['peruserbw'] ? true : false;
 		$newcp['bwdefaultdn'] = $_POST['bwdefaultdn'];
 		$newcp['bwdefaultup'] = $_POST['bwdefaultup'];
@@ -399,7 +342,7 @@ if ($_POST) {
 		if (!empty($toremove)) {
 			foreach ($toremove as $removeif) {
 				$removeif = get_real_interface($removeif);
-				mwexec("/usr/local/sbin/ipfw zone {$cpzone} mdel {$removeif}");
+				mwexec("/usr/local/sbin/ipfw_context -d {$cpzone} -x {$removeif}");
 			}
 		}
 		captiveportal_configure_zone($newcp);
@@ -432,7 +375,6 @@ function enable_change(enable_change) {
 	document.iform.freelogins_updatetimeouts.disabled = endis;
 	document.iform.timeout.disabled = endis;
 	document.iform.preauthurl.disabled = endis;
-	document.iform.blockedmacsurl.disabled = endis;
 	document.iform.redirurl.disabled = endis;
 	document.iform.localauth_priv.disabled = localauth_endis;
 	document.iform.radiusip.disabled = radius_endis;
@@ -497,7 +439,7 @@ function enable_change(enable_change) {
 <?php
 	$tab_array = array();
 	$tab_array[] = array(gettext("Captive portal(s)"), true, "services_captiveportal.php?zone={$cpzone}");
-	$tab_array[] = array(gettext("MAC"), false, "services_captiveportal_mac.php?zone={$cpzone}");
+	$tab_array[] = array(gettext("Pass-through MAC"), false, "services_captiveportal_mac.php?zone={$cpzone}");
 	$tab_array[] = array(gettext("Allowed IP addresses"), false, "services_captiveportal_ip.php?zone={$cpzone}");
 	$tab_array[] = array(gettext("Allowed Hostnames"), false, "services_captiveportal_hostname.php?zone={$cpzone}");
 	$tab_array[] = array(gettext("Vouchers"), false, "services_captiveportal_vouchers.php?zone={$cpzone}");
@@ -598,13 +540,6 @@ function enable_change(enable_change) {
 "to access after they've authenticated."); ?></td>
 	</tr>
 	<tr>
-		<td valign="top" class="vncell"><?=gettext("Blocked MAC address redirect URL"); ?> </td>
-		<td class="vtable">
-			<input name="blockedmacsurl" type="text" class="formfld url" id="blockedmacsurl" size="60" value="<?=htmlspecialchars($pconfig['blockedmacsurl']);?>"><br>
-			<?php printf(gettext("If you provide a URL here, MAC addresses set to be blocked will be redirect to that URL when attempt to access anything."));?>
-		</td>
-	</tr>
-	<tr>
       <td valign="top" class="vncell"><?=gettext("Concurrent user logins"); ?></td>
       <td class="vtable">
 	<input name="noconcurrentlogins" type="checkbox" class="formfld" id="noconcurrentlogins" value="yes" <?php if ($pconfig['noconcurrentlogins']) echo "checked"; ?>>
@@ -626,13 +561,13 @@ function enable_change(enable_change) {
         <input name="passthrumacadd" type="checkbox" class="formfld" id="passthrumacadd" value="yes" <?php if ($pconfig['passthrumacadd']) echo "checked"; ?>>
         <strong><?=gettext("Enable Pass-through MAC automatic additions"); ?></strong><br>
     <?=gettext("If this option is set, a MAC passthrough entry is automatically added after the user has successfully authenticated. Users of that MAC address will never have to authenticate again."); ?>
-    <?=gettext("To remove the passthrough MAC entry you either have to log in and remove it manually from the"); ?> <a href="services_captiveportal_mac.php"><?=gettext("MAC tab"); ?></a> <?=gettext("or send a POST from another system to remove it."); ?>
+    <?=gettext("To remove the passthrough MAC entry you either have to log in and remove it manually from the"); ?> <a href="services_captiveportal_mac.php"><?=gettext("Pass-through MAC tab"); ?></a> <?=gettext("or send a POST from another system to remove it."); ?>
     <?=gettext("If this is enabled, RADIUS MAC authentication cannot be used. Also, the logout window will not be shown."); ?>
 	<br/><br/>
         <input name="passthrumacaddusername" type="checkbox" class="formfld" id="passthrumacaddusername" value="yes" <?php if ($pconfig['passthrumacaddusername']) echo "checked"; ?>>
         <strong><?=gettext("Enable Pass-through MAC automatic addition with username"); ?></strong><br>
     <?=gettext("If this option is set, with the automatically MAC passthrough entry created the username, used during authentication, will be saved."); ?>
-    <?=gettext("To remove the passthrough MAC entry you either have to log in and remove it manually from the"); ?> <a href="services_captiveportal_mac.php"><?=gettext("MAC tab"); ?></a> <?=gettext("or send a POST from another system to remove it."); ?>
+    <?=gettext("To remove the passthrough MAC entry you either have to log in and remove it manually from the"); ?> <a href="services_captiveportal_mac.php"><?=gettext("Pass-through MAC tab"); ?></a> <?=gettext("or send a POST from another system to remove it."); ?>
 	</td>
 	</tr>
 	<tr>
@@ -987,12 +922,6 @@ function enable_change(enable_change) {
 		?>
 		<?php if ($pconfig['page']['htmltext']): ?>
 		<a href="<?=$href?>" target="_new"><?=gettext("View current page"); ?></a>
-		<br />
-		<a href="?zone=<?=$cpzone?>&amp;act=gethtmlhtml" target="_blank"><?=gettext("Download current page"); ?></a>
-		<br />
-		<a href="?zone=<?=$cpzone?>&amp;act=delhtmlhtml" onclick="return confirm('Do you really want to restore default page?')" target="_blank">
-			<?=gettext("Restore default portal page"); ?>
-		</a>
 		  <br>
 		  <br>
 		<?php endif; ?>
@@ -1027,12 +956,6 @@ function enable_change(enable_change) {
 		<input name="errfile" type="file" class="formfld file" id="errfile"><br>
 		<?php if ($pconfig['page']['errtext']): ?>
 		<a href="?zone=<?=$cpzone?>&amp;act=viewerrhtml" target="_blank"><?=gettext("View current page"); ?></a>
-		<br />
-		<a href="?zone=<?=$cpzone?>&amp;act=geterrhtml" target="_blank"><?=gettext("Download current page"); ?></a>
-		<br />
-		<a href="?zone=<?=$cpzone?>&amp;act=delerrhtml" onclick="return confirm('Do you really want to restore default page?')" target="_blank">
-			<?=gettext("Restore default error page"); ?>
-		</a>
 		  <br>
 		  <br>
 		<?php endif; ?>
@@ -1047,12 +970,6 @@ function enable_change(enable_change) {
 		<input name="logoutfile" type="file" class="formfld file" id="logoutfile"><br>
 		<?php if ($pconfig['page']['logouttext']): ?>
 		<a href="?zone=<?=$cpzone?>&amp;act=viewlogouthtml" target="_blank"><?=gettext("View current page"); ?></a>
-		<br />
-		<a href="?zone=<?=$cpzone?>&amp;act=getlogouthtml" target="_blank"><?=gettext("Download current page"); ?></a>
-		<br />
-		<a href="?zone=<?=$cpzone?>&amp;act=dellogouthtml" onclick="return confirm('Do you really want to restore default page?')" target="_blank">
-			<?=gettext("Restore default logout page"); ?>
-		</a>
 		  <br>
 		  <br>
 		<?php endif; ?>
diff --git a/usr/local/www/services_captiveportal_filemanager.php b/usr/local/www/services_captiveportal_filemanager.php
index 0b81d23..285fd36 100755
--- a/usr/local/www/services_captiveportal_filemanager.php
+++ b/usr/local/www/services_captiveportal_filemanager.php
@@ -144,8 +144,8 @@ include("head.inc");
   <tr><td class="tabnavtbl">
 <?php
 	$tab_array = array();
-	$tab_array[] = array(gettext("Captive portal(s)"), false, "services_captiveportal.php?zone={$cpzone}");
-	$tab_array[] = array(gettext("MAC"), false, "services_captiveportal_mac.php?zone={$cpzone}");
+	$tab_array[] = array(gettext("Captive portal"), false, "services_captiveportal.php?zone={$cpzone}");
+	$tab_array[] = array(gettext("Pass-through MAC"), false, "services_captiveportal_mac.php?zone={$cpzone}");
 	$tab_array[] = array(gettext("Allowed IP addresses"), false, "services_captiveportal_ip.php?zone={$cpzone}");
 	$tab_array[] = array(gettext("Allowed Hostnames"), false, "services_captiveportal_hostname.php?zone={$cpzone}");
 	$tab_array[] = array(gettext("Vouchers"), false, "services_captiveportal_vouchers.php?zone={$cpzone}");
diff --git a/usr/local/www/services_captiveportal_hostname.php b/usr/local/www/services_captiveportal_hostname.php
index d23f0e8..a177656 100755
--- a/usr/local/www/services_captiveportal_hostname.php
+++ b/usr/local/www/services_captiveportal_hostname.php
@@ -36,9 +36,9 @@
 
 ##|+PRIV
 ##|*IDENT=page-services-captiveportal-allowedhostnames
-##|*NAME=Services: Captive portal: Allowed Hostnames page
-##|*DESCR=Allow access to the 'Services: Captive portal: Allowed Hostnames' page.
-##|*MATCH=services_captiveportal_hostname.php*
+##|*NAME=Services: Captive portal: Allowed IPs page
+##|*DESCR=Allow access to the 'Services: Captive portal: Allowed IPs' page.
+##|*MATCH=services_captiveportal_ip.php*
 ##|-PRIV
 
 require("guiconfig.inc");
@@ -104,8 +104,8 @@ include("head.inc");
   <tr><td class="tabnavtbl">
 <?php
 	$tab_array = array();
-	$tab_array[] = array(gettext("Captive portal(s)"), false, "services_captiveportal.php?zone={$cpzone}");
-	$tab_array[] = array(gettext("MAC"), false, "services_captiveportal_mac.php?zone={$cpzone}");
+	$tab_array[] = array(gettext("Captive portal"), false, "services_captiveportal.php?zone={$cpzone}");
+	$tab_array[] = array(gettext("Pass-through MAC"), false, "services_captiveportal_mac.php?zone={$cpzone}");
 	$tab_array[] = array(gettext("Allowed IP Addresses"), false, "services_captiveportal_ip.php?zone={$cpzone}");
 	$tab_array[] = array(gettext("Allowed Hostnames"), true, "services_captiveportal_hostname.php?zone={$cpzone}");
 	$tab_array[] = array(gettext("Vouchers"), false, "services_captiveportal_vouchers.php?zone={$cpzone}");
diff --git a/usr/local/www/services_captiveportal_hostname_edit.php b/usr/local/www/services_captiveportal_hostname_edit.php
index cf01f18..c1b6c25 100755
--- a/usr/local/www/services_captiveportal_hostname_edit.php
+++ b/usr/local/www/services_captiveportal_hostname_edit.php
@@ -36,8 +36,8 @@
 
 ##|+PRIV
 ##|*IDENT=page-services-captiveportal-editallowedhostnames
-##|*NAME=Services: Captive portal: Edit Allowed Hostnames page
-##|*DESCR=Allow access to the 'Services: Captive portal: Edit Allowed Hostnames' page.
+##|*NAME=Services: Captive portal: Edit Allowed IPs page
+##|*DESCR=Allow access to the 'Services: Captive portal: Edit Allowed IPs' page.
 ##|*MATCH=services_captiveportal_hostname_edit.php*
 ##|-PRIV
 
@@ -99,7 +99,7 @@ if ($_POST) {
 	$reqdfields = explode(" ", "hostname");
 	$reqdfieldsn = array(gettext("Allowed Hostname"));
 	
-	do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+	do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 	
 	if (($_POST['hostname'] && !is_hostname($_POST['hostname']))) 
 		$input_errors[] = sprintf(gettext("A valid Hostname must be specified. [%s]"), $_POST['hostname']);
@@ -140,8 +140,7 @@ if ($_POST) {
 
 		$rules = captiveportal_allowedhostname_configure();
 		@file_put_contents("{$g['tmp_path']}/hostname_rules", $rules);
-		$cpzoneid = $a_cp[$cpzone]['zoneid'];
-		mwexec("/sbin/ipfw -x {$cpzoneid} {$g['tmp_path']}/hostname_rules");
+		mwexec("/sbin/ipfw -x {$cpzone} {$g['tmp_path']}/hostname_rules");
 		unset($rules);
 		
 		header("Location: services_captiveportal_hostname.php?zone={$cpzone}");
diff --git a/usr/local/www/services_captiveportal_ip.php b/usr/local/www/services_captiveportal_ip.php
index 3465d07..2a3d50f 100755
--- a/usr/local/www/services_captiveportal_ip.php
+++ b/usr/local/www/services_captiveportal_ip.php
@@ -99,8 +99,8 @@ include("head.inc");
   <tr><td class="tabnavtbl">
 <?php
 	$tab_array = array();
-	$tab_array[] = array(gettext("Captive portal(s)"), false, "services_captiveportal.php?zone={$cpzone}");
-	$tab_array[] = array(gettext("MAC"), false, "services_captiveportal_mac.php?zone={$cpzone}");
+	$tab_array[] = array(gettext("Captive portal"), false, "services_captiveportal.php?zone={$cpzone}");
+	$tab_array[] = array(gettext("Pass-through MAC"), false, "services_captiveportal_mac.php?zone={$cpzone}");
 	$tab_array[] = array(gettext("Allowed IP addresses"), true, "services_captiveportal_ip.php?zone={$cpzone}");
 	$tab_array[] = array(gettext("Allowed Hostnames"), false, "services_captiveportal_hostname.php?zone={$cpzone}");
 	$tab_array[] = array(gettext("Vouchers"), false, "services_captiveportal_vouchers.php?zone={$cpzone}");
diff --git a/usr/local/www/services_captiveportal_ip_edit.php b/usr/local/www/services_captiveportal_ip_edit.php
index f91d680..f16532c 100755
--- a/usr/local/www/services_captiveportal_ip_edit.php
+++ b/usr/local/www/services_captiveportal_ip_edit.php
@@ -98,7 +98,7 @@ if ($_POST) {
 	$reqdfields = explode(" ", "ip sn");
 	$reqdfieldsn = array(gettext("Allowed IP address"), gettext("Subnet mask"));
 	
-	do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+	do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 	
 	if ($_POST['ip'] && !is_ipaddr($_POST['ip']))
 		$input_errors[] = sprintf(gettext("A valid IP address must be specified. [%s]"), $_POST['ip']);
@@ -147,10 +147,9 @@ if ($_POST) {
 
 		if (isset($a_cp[$cpzone]['enable']) && is_module_loaded("ipfw.ko")) {
 			$rules = "";
-			$cpzoneid = $a_cp[$cpzone]['zoneid'];
 			unset($ipfw);
 			if (isset($oldip) && isset($oldmask)) {
-				$ipfw = pfSense_ipfw_getTablestats($cpzoneid, 3, $oldip, $oldmask);
+				$ipfw = pfSense_ipfw_getTablestats($cpzone, 3, $oldip, $oldmask);
 				$rules .= "table 3 delete {$oldip}/{$oldmask}\n";
 				$rules .= "table 4 delete {$oldip}/{$oldmask}\n";
 				if (is_array($ipfw)) {
@@ -164,7 +163,7 @@ if ($_POST) {
 			}
 			$uniqid = uniqid("{$cpzone}_allowed");
 			@file_put_contents("{$g['tmp_path']}/{$uniqid}_tmp", $rules);
-			mwexec("/sbin/ipfw -x {$cpzoneid} -q {$g['tmp_path']}/{$uniqid}_tmp");
+			mwexec("/sbin/ipfw -x {$cpzone} -q {$g['tmp_path']}/{$uniqid}_tmp");
 			@unlink("{$g['tmp_path']}/{$uniqid}_tmp");
 		}
 		
diff --git a/usr/local/www/services_captiveportal_mac.php b/usr/local/www/services_captiveportal_mac.php
index e636f7b..1cc625b 100755
--- a/usr/local/www/services_captiveportal_mac.php
+++ b/usr/local/www/services_captiveportal_mac.php
@@ -2,20 +2,20 @@
 /*
 	services_captiveportal_mac.php
 	part of m0n0wall (http://m0n0.ch/wall)
-
+	
 	Copyright (C) 2004 Dinesh Nair <dinesh@alphaque.com>
 	All rights reserved.
-
+	
 	Redistribution and use in source and binary forms, with or without
 	modification, are permitted provided that the following conditions are met:
-
+	
 	1. Redistributions of source code must retain the above copyright notice,
 	   this list of conditions and the following disclaimer.
-
+	
 	2. Redistributions in binary form must reproduce the above copyright
 	   notice, this list of conditions and the following disclaimer in the
 	   documentation and/or other materials provided with the distribution.
-
+	
 	THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES,
 	INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY
 	AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
@@ -44,20 +44,17 @@ require_once("filter.inc");
 require("shaper.inc");
 require("captiveportal.inc");
 
-global $cpzone;
-global $cpzoneid;
-
 $cpzone = $_GET['zone'];
 if (isset($_POST['zone']))
-	$cpzone = $_POST['zone'];
+        $cpzone = $_POST['zone'];
 
 if (empty($cpzone) || empty($config['captiveportal'][$cpzone])) {
-	header("Location: services_captiveportal_zones.php");
-	exit;
+        header("Location: services_captiveportal_zones.php");
+        exit;
 }
 
 if (!is_array($config['captiveportal']))
-	$config['captiveportal'] = array();
+        $config['captiveportal'] = array();
 $a_cp =& $config['captiveportal'];
 
 $pgtitle = array(gettext("Services"),gettext("Captive portal"), $a_cp[$cpzone]['zone']);
@@ -92,7 +89,7 @@ if ($_POST) {
 		if ($_POST['username']) {
 			$mac = captiveportal_passthrumac_findbyname($_POST['username']);
 			if (!empty($mac))
-				$_POST['delmac'] = $mac['mac'];
+				$_POST['delmac'] = $mac['mac'];	
 			else
 				echo gettext("No entry exists for this username:") . " " . $_POST['username'] . "\n";
 		}
@@ -105,12 +102,17 @@ if ($_POST) {
 				}
 			}
 			if ($found == true) {
-				$cpzoneid = $a_cp[$cpzone]['zoneid'];
-				$rules = captiveportal_passthrumac_delete_entry($a_passthrumacs[$idx]);
-				$uniqid = uniqid("{$cpzone}_mac");
-				file_put_contents("{$g['tmp_path']}/{$uniqid}_tmp", $rules);
-				mwexec("/sbin/ipfw -x {$cpzoneid} -q {$g['tmp_path']}/{$uniqid}_tmp");
-				@unlink("{$g['tmp_path']}/{$uniqid}_tmp");
+				$ruleno = captiveportal_get_ipfw_passthru_ruleno($_POST['delmac']);
+				if ($ruleno) {
+					captiveportal_free_ipfw_ruleno($ruleno);
+					$pipeno = captiveportal_get_dn_passthru_ruleno($_POST['delmac']);
+					if ($pipeno)
+						captiveportal_free_dn_ruleno($pipeno);
+					if (!empty($pipeno))
+						mwexec("/sbin/ipfw -x {$cpzone} -q delete {$ruleno}; /sbin/ipfw -x {$cpzone} -q delete " . ++$ruleno . "; /sbin/ipfw -q pipe delete {$pipeno}; /sbin/ipfw -q pipe delete " . (++$pipeno));
+					else
+						mwexec("/sbin/ipfw -x {$cpzone} -q delete {$ruleno}; /sbin/ipfw -x {$cpzone} -q delete " . ++$ruleno);
+				}
 				unset($a_passthrumacs[$idx]);
 				write_config();
 				echo gettext("The entry was sucessfully deleted") . "\n";
@@ -124,12 +126,17 @@ if ($_POST) {
 if ($_GET['act'] == "del") {
 	$a_passthrumacs =& $a_cp[$cpzone]['passthrumac'];
 	if ($a_passthrumacs[$_GET['id']]) {
-		$cpzoneid = $a_cp[$cpzone]['zoneid'];
-		$rules = captiveportal_passthrumac_delete_entry($a_passthrumacs[$_GET['id']]);
-		$uniqid = uniqid("{$cpzone}_mac");
-		file_put_contents("{$g['tmp_path']}/{$uniqid}_tmp", $rules);
-		mwexec("/sbin/ipfw -x {$cpzoneid} -q {$g['tmp_path']}/{$uniqid}_tmp");
-		@unlink("{$g['tmp_path']}/{$uniqid}_tmp");
+		$ruleno = captiveportal_get_ipfw_passthru_ruleno($a_passthrumacs[$_GET['id']]['mac']);
+		if ($ruleno) {
+			captiveportal_free_ipfw_ruleno($ruleno);
+			$pipeno = captiveportal_get_dn_passthru_ruleno($a_passthrumacs[$_GET['id']]['mac']);
+			if ($pipeno)
+				captiveportal_free_dn_ruleno($pipeno);
+			if (!empty($pipeno))
+				mwexec("/sbin/ipfw -x {$cpzone} -q delete {$ruleno}; /sbin/ipfw -x {$cpzone} -q delete " . ++$ruleno . "; /sbin/ipfw -q pipe delete {$pipeno}; /sbin/ipfw -q pipe delete " . (++$pipeno));
+			else
+				mwexec("/sbin/ipfw -x {$cpzone} -q delete {$ruleno}; /sbin/ipfw -x {$cpzone} -q delete " . ++$ruleno);
+		}
 		unset($a_passthrumacs[$_GET['id']]);
 		write_config();
 		header("Location: services_captiveportal_mac.php?zone={$cpzone}");
@@ -149,78 +156,54 @@ include("head.inc");
 <?php print_info_box_np(gettext("The captive portal MAC address configuration has been changed.<br>You must apply the changes in order for them to take effect."));?><br>
 <?php endif; ?>
 <table width="100%" border="0" cellpadding="0" cellspacing="0">
-	<tr><td class="tabnavtbl">
+  <tr><td class="tabnavtbl">
 <?php
 	$tab_array = array();
-	$tab_array[] = array(gettext("Captive portal(s)"), false, "services_captiveportal.php?zone={$cpzone}");
-	$tab_array[] = array(gettext("MAC"), true, "services_captiveportal_mac.php?zone={$cpzone}");
+	$tab_array[] = array(gettext("Captive portal"), false, "services_captiveportal.php?zone={$cpzone}");
+	$tab_array[] = array(gettext("Pass-through MAC"), true, "services_captiveportal_mac.php?zone={$cpzone}");
 	$tab_array[] = array(gettext("Allowed IP addresses"), false, "services_captiveportal_ip.php?zone={$cpzone}");
 	$tab_array[] = array(gettext("Allowed Hostnames"), false, "services_captiveportal_hostname.php?zone={$cpzone}");
 	$tab_array[] = array(gettext("Vouchers"), false, "services_captiveportal_vouchers.php?zone={$cpzone}");
 	$tab_array[] = array(gettext("File Manager"), false, "services_captiveportal_filemanager.php?zone={$cpzone}");
 	display_top_tabs($tab_array, true);
 ?>
-	</td></tr>
+  </td></tr>
+  <tr>
+  <td class="tabcont">
+  <table width="100%" border="0" cellpadding="0" cellspacing="0">
 	<tr>
-		<td class="tabcont">
-			<table width="100%" border="0" cellpadding="0" cellspacing="0">
-				<tr>
-					<td width="3%"  class="list"></td>
-					<td width="37%" class="listhdrr"><?=gettext("MAC address"); ?></td>
-					<td width="50%" class="listhdr"><?=gettext("Description"); ?></td>
-					<td width="10%" class="list"></td>
-				</tr>
-<?php
-			if (is_array($a_cp[$cpzone]['passthrumac'])):
-				$i = 0;
-				foreach ($a_cp[$cpzone]['passthrumac'] as $mac):
-?>
-				<tr ondblclick="document.location='services_captiveportal_mac_edit.php?zone=<?=$cpzone;?>&id=<?=$i;?>'">
-					<td valign="middle" nowrap class="list">
-						<img src="./themes/<?= $g['theme']; ?>/images/icons/icon_<?=$mac['action'];?>.gif" width="11" height="11" border="0" alt="icon" />
-					</td>
-					<td class="listlr">
-						<?=$mac['mac'];?>
-					</td>
-					<td class="listbg">
-						<?=htmlspecialchars($mac['descr']);?>&nbsp;
-					</td>
-					<td valign="middle" nowrap class="list">
-						<a href="services_captiveportal_mac_edit.php?zone=<?=$cpzone;?>&id=<?=$i;?>">
-							<img src="/themes/<?php echo $g['theme']; ?>/images/icons/icon_e.gif" title="<?=gettext("edit host"); ?>" width="17" height="17" border="0">
-						</a>
-						&nbsp;
-						<a href="services_captiveportal_mac.php?zone=<?=$cpzone;?>&act=del&id=<?=$i;?>" onclick="return confirm('<?=gettext("Do you really want to delete this host?"); ?>')">
-							<img src="/themes/<?php echo $g['theme']; ?>/images/icons/icon_x.gif" title="<?=gettext("delete host"); ?>" width="17" height="17" border="0">
-						</a>
-					</td>
-				</tr>
-<?php
-					$i++;
-				endforeach;
-			endif;
-?>
-				<tr>
-					<td class="list" colspan="3">&nbsp;</td>
-					<td class="list">
-						<a href="services_captiveportal_mac_edit.php?zone=<?=$cpzone;?>">
-							<img src="/themes/<?php echo $g['theme']; ?>/images/icons/icon_plus.gif" title="<?=gettext("add host"); ?>" width="17" height="17" border="0">
-						</a>
-					</td>
-				</tr>
-				<tr>
-					<td colspan="3" class="list">
-						<span class="vexpl">
-							<span class="red"><strong><?=gettext("Note:"); ?><br></strong></span>
-							<?=gettext("Adding MAC addresses as 'pass' MACs allows them access through the captive portal automatically without being taken to the portal page."); ?>
-						</span>
-					</td>
-					<td class="list">&nbsp;</td>
-				</tr>
-			</table>
-		</td>
+	  <td width="40%" class="listhdrr"><?=gettext("MAC address"); ?></td>
+	  <td width="50%" class="listhdr"><?=gettext("Description"); ?></td>
+	  <td width="10%" class="list"></td>
+	</tr>
+<?php	if (is_array($a_cp[$cpzone]['passthrumac'])):
+		$i = 0; foreach ($a_cp[$cpzone]['passthrumac'] as $mac): ?>
+	<tr ondblclick="document.location='services_captiveportal_mac_edit.php?zone=<?=$cpzone;?>&id=<?=$i;?>'">
+	  <td class="listlr">
+		<?=strtolower($mac['mac']);?>
+	  </td>
+	  <td class="listbg">
+		<?=htmlspecialchars($mac['descr']);?>&nbsp;
+	  </td>
+	  <td valign="middle" nowrap class="list"> <a href="services_captiveportal_mac_edit.php?zone=<?=$cpzone;?>&id=<?=$i;?>"><img src="/themes/<?php echo $g['theme']; ?>/images/icons/icon_e.gif" title="<?=gettext("edit host"); ?>" width="17" height="17" border="0"></a>
+		 &nbsp;<a href="services_captiveportal_mac.php?zone=<?=$cpzone;?>&act=del&id=<?=$i;?>" onclick="return confirm('<?=gettext("Do you really want to delete this host?"); ?>')"><img src="/themes/<?php echo $g['theme']; ?>/images/icons/icon_x.gif" title="<?=gettext("delete host"); ?>" width="17" height="17" border="0"></a></td>
+	</tr>
+  <?php $i++; endforeach; endif; ?>
+	<tr> 
+	  <td class="list" colspan="2">&nbsp;</td>
+	  <td class="list"> <a href="services_captiveportal_mac_edit.php?zone=<?=$cpzone;?>"><img src="/themes/<?php echo $g['theme']; ?>/images/icons/icon_plus.gif" title="<?=gettext("add host"); ?>" width="17" height="17" border="0"></a></td>
+	</tr>
+	<tr>
+	<td colspan="2" class="list"><span class="vexpl"><span class="red"><strong>
+	<?=gettext("Note:"); ?><br>
+	</strong></span>
+	<?=gettext("Adding MAC addresses as pass-through MACs allows them access through the captive portal automatically without being taken to the portal page."); ?> </span></td>
+	<td class="list">&nbsp;</td>
 	</tr>
-</table>
+  </table>
+  </td>
+  </tr>
+  </table>
 </form>
 <?php include("fend.inc"); ?>
 </body>
diff --git a/usr/local/www/services_captiveportal_mac_edit.php b/usr/local/www/services_captiveportal_mac_edit.php
index e03454d..bb36500 100755
--- a/usr/local/www/services_captiveportal_mac_edit.php
+++ b/usr/local/www/services_captiveportal_mac_edit.php
@@ -1,21 +1,21 @@
-<?php
+<?php 
 /*
 	services_captiveportal_mac_edit.php
 	part of m0n0wall (http://m0n0.ch/wall)
-
+	
 	Copyright (C) 2004 Dinesh Nair <dinesh@alphaque.com>
 	All rights reserved.
-
+	
 	Redistribution and use in source and binary forms, with or without
 	modification, are permitted provided that the following conditions are met:
-
+	
 	1. Redistributions of source code must retain the above copyright notice,
 	   this list of conditions and the following disclaimer.
-
+	
 	2. Redistributions in binary form must reproduce the above copyright
 	   notice, this list of conditions and the following disclaimer in the
 	   documentation and/or other materials provided with the distribution.
-
+	
 	THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES,
 	INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY
 	AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
@@ -43,9 +43,9 @@ function passthrumacscmp($a, $b) {
 }
 
 function passthrumacs_sort() {
-	global $config, $cpzone;
+        global $config, $cpzone;
 
-	usort($config['captiveportal'][$cpzone]['passthrumac'],"passthrumacscmp");
+        usort($config['captiveportal'][$cpzone]['passthrumac'],"passthrumacscmp");
 }
 
 require("guiconfig.inc");
@@ -54,23 +54,20 @@ require_once("filter.inc");
 require("shaper.inc");
 require("captiveportal.inc");
 
-global $cpzone;
-global $cpzoneid;
-
-$pgtitle = array(gettext("Services"),gettext("Captive portal"),gettext("Edit MAC address rules"));
+$pgtitle = array(gettext("Services"),gettext("Captive portal"),gettext("Edit pass-through MAC address"));
 $shortcut_section = "captiveportal";
 
 $cpzone = $_GET['zone'];
 if (isset($_POST['zone']))
-	$cpzone = $_POST['zone'];
+        $cpzone = $_POST['zone'];
 
 if (empty($cpzone) || empty($config['captiveportal'][$cpzone])) {
-	header("Location: services_captiveportal_zones.php");
-	exit;
+        header("Location: services_captiveportal_zones.php");
+        exit;
 }
 
 if (!is_array($config['captiveportal']))
-	$config['captiveportal'] = array();
+        $config['captiveportal'] = array();
 $a_cp =& $config['captiveportal'];
 
 $id = $_GET['id'];
@@ -82,7 +79,6 @@ if (!is_array($a_cp[$cpzone]['passthrumac']))
 $a_passthrumacs = &$a_cp[$cpzone]['passthrumac'];
 
 if (isset($id) && $a_passthrumacs[$id]) {
-	$pconfig['action'] = $a_passthrumacs[$id]['action'];
 	$pconfig['mac'] = $a_passthrumacs[$id]['mac'];
 	$pconfig['bw_up'] = $a_passthrumacs[$id]['bw_up'];
 	$pconfig['bw_down'] = $a_passthrumacs[$id]['bw_down'];
@@ -96,25 +92,15 @@ if ($_POST) {
 	$pconfig = $_POST;
 
 	/* input validation */
-	$reqdfields = explode(" ", "action mac");
-	$reqdfieldsn = array(gettext("Action"), gettext("MAC address"));
-
-	do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
-
-	$_POST['mac'] = strtolower(str_replace("-", ":", $_POST['mac']));
-
-	if ($_POST['mac']) {
-		if (is_macaddr($_POST['mac'])) {
-			$iflist = get_interface_list();
-			foreach ($iflist as $if) {
-				if ($_POST['mac'] == strtolower($if['mac'])) {
-					$input_errors[] = sprintf(gettext("The MAC address %s belongs to a local interface, you cannot use it here."), $_POST['mac']);
-					break;
-				}
-			}
-		} else {
-			$input_errors[] = sprintf("%s. [%s]", gettext("A valid MAC address must be specified"), $_POST['mac']);
-		}
+	$reqdfields = explode(" ", "mac");
+	$reqdfieldsn = array(gettext("MAC address"));
+	
+	do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
+	
+	$_POST['mac'] = str_replace("-", ":", $_POST['mac']);
+	
+	if (($_POST['mac'] && !is_macaddr($_POST['mac']))) {
+		$input_errors[] = sprintf("%s. [%s]", gettext("A valid MAC address must be specified"), $_POST['mac']);
 	}
 	if ($_POST['bw_up'] && !is_numeric($_POST['bw_up']))
 		$input_errors[] = gettext("Upload speed needs to be an integer");
@@ -124,16 +110,15 @@ if ($_POST) {
 	foreach ($a_passthrumacs as $macent) {
 		if (isset($id) && ($a_passthrumacs[$id]) && ($a_passthrumacs[$id] === $macent))
 			continue;
-
+		
 		if ($macent['mac'] == $_POST['mac']){
-			$input_errors[] = sprintf("[%s] %s.", $_POST['mac'], gettext("already exists"));
+			$input_errors[] = sprintf("[%s] %s.", $_POST['mac'], gettext("already allowed"));
 			break;
-		}
+		}	
 	}
 
 	if (!$input_errors) {
 		$mac = array();
-		$mac['action'] = $_POST['action'];
 		$mac['mac'] = $_POST['mac'];
 		if ($_POST['bw_up'])
 			$mac['bw_up'] = $_POST['bw_up'];
@@ -141,29 +126,40 @@ if ($_POST) {
 			$mac['bw_down'] = $_POST['bw_down'];
 		if ($_POST['username'])
 			$mac['username'] = $_POST['username'];
-
+		
 		$mac['descr'] = $_POST['descr'];
 
 		if (isset($id) && $a_passthrumacs[$id]) {
-			$oldmac = $a_passthrumacs[$id];
+			$oldmac = $a_passthrumacs[$id]['mac'];
 			$a_passthrumacs[$id] = $mac;
 		} else {
-			$oldmac = $mac;
+			$oldmac = $mac['mac'];
 			$a_passthrumacs[] = $mac;
 		}
 		passthrumacs_sort();
-
+		
 		write_config();
 
 		if (isset($config['captiveportal'][$cpzone]['enable'])) {
-			$cpzoneid = $config['captiveportal'][$cpzone]['zoneid'];
-			$rules = captiveportal_passthrumac_delete_entry($oldmac);
+			$ruleno = captiveportal_get_ipfw_passthru_ruleno($oldmac);
+			if ($ruleno) {
+				captiveportal_free_ipfw_ruleno($ruleno);
+				$pipeno = captiveportal_get_dn_passthru_ruleno($oldmac);
+				if ($pipeno) {
+					captiveportal_free_dn_ruleno($pipeno);
+					$rules .= "pipe delete {$pipeno}\n";
+					++$pipeno;
+					$rules .= "pipe delete {$pipeno}\n";
+				}
+				$rules = "delete {$ruleno}\n";
+				$rules .= "delete " . ++$ruleno . "\n";
+			}
+			
 			$rules .= captiveportal_passthrumac_configure_entry($mac);
 			$uniqid = uniqid("{$cpzone}_macedit");
 			file_put_contents("{$g['tmp_path']}/{$uniqid}_tmp", $rules);
-			mwexec("/sbin/ipfw -x {$cpzoneid} -q {$g['tmp_path']}/{$uniqid}_tmp");
+			mwexec("/sbin/ipfw -x {$cpzone} -q {$g['tmp_path']}/{$uniqid}_tmp");
 			@unlink("{$g['tmp_path']}/{$uniqid}_tmp");
-			unset($cpzoneid);
 		}
 
 		header("Location: services_captiveportal_mac.php?zone={$cpzone}");
@@ -175,81 +171,57 @@ include("head.inc");
 <?php include("fbegin.inc"); ?>
 <body link="#0000CC" vlink="#0000CC" alink="#0000CC">
 <?php if ($input_errors) print_input_errors($input_errors); ?>
-<form action="services_captiveportal_mac_edit.php" method="post" name="iform" id="iform">
-	<table width="100%" border="0" cellpadding="6" cellspacing="0">
-		<tr>
-			<td colspan="2" valign="top" class="listtopic"><?=gettext("Edit MAC address rules");?></td>
-		</tr>
-		<tr>
-			<td width="22%" valign="top" class="vncellreq"><?=gettext("Action"); ?></td>
-			<td width="78%" class="vtable">
-				<select name="action" class="formselect">
-<?php
-					$actions = explode(" ", "Pass Block");
-					foreach ($actions as $action):
-?>
-						<option value="<?=strtolower($action);?>"<?php if (strtolower($action) == strtolower($pconfig['action'])) echo "selected=\"selected\""; ?>>
-							<?=htmlspecialchars($action);?>
-						</option>
-<?php
-					endforeach;
-?>
-				</select>
-				<br>
-				<span class="vexpl"><?=gettext("Choose what to do with packets coming from this MAC address"); ?>.</span>
-			</td>
-		</tr>
+            <form action="services_captiveportal_mac_edit.php" method="post" name="iform" id="iform">
+              <table width="100%" border="0" cellpadding="6" cellspacing="0">
 		<tr>
-			<td width="22%" valign="top" class="vncellreq"><?=gettext("MAC address"); ?></td>
-			<td width="78%" class="vtable">
-				<?=$mandfldhtml;?><input name="mac" type="text" class="formfld unknown" id="mac" size="17" value="<?=htmlspecialchars($pconfig['mac']);?>">
-<?php
-				$ip = getenv('REMOTE_ADDR');
-				$mac = `/usr/sbin/arp -an | grep {$ip} | cut -d" " -f4`;
-				$mac = str_replace("\n","",$mac);
-?>
-				<a OnClick="document.forms[0].mac.value='<?=$mac?>';" href="#"><?=gettext("Copy my MAC address");?></a>
-				<br>
-				<span class="vexpl"><?=gettext("MAC address (6 hex octets separated by colons)"); ?></span></td>
-		</tr>
+                        <td colspan="2" valign="top" class="listtopic"><?=gettext("Edit Pass-through MAC address");?></td>
+                </tr>
 		<tr>
-			<td width="22%" valign="top" class="vncell"><?=gettext("Description"); ?></td>
-			<td width="78%" class="vtable">
-				<input name="descr" type="text" class="formfld unknown" id="descr" size="40" value="<?=htmlspecialchars($pconfig['descr']);?>">
-				<br>
-				<span class="vexpl"><?=gettext("You may enter a description here for your reference (not parsed)"); ?>.</span>
-			</td>
-		</tr>
+                  <td width="22%" valign="top" class="vncellreq"><?=gettext("MAC address"); ?></td>
+                  <td width="78%" class="vtable"> 
+                    <?=$mandfldhtml;?><input name="mac" type="text" class="formfld unknown" id="mac" size="17" value="<?=htmlspecialchars($pconfig['mac']);?>">
+                    <?php
+                        $ip = getenv('REMOTE_ADDR');
+                        $mac = `/usr/sbin/arp -an | grep {$ip} | cut -d" " -f4`;
+                        $mac = str_replace("\n","",$mac);
+                    ?>
+                    <a OnClick="document.forms[0].mac.value='<?=$mac?>';" href="#"><?=gettext("Copy my MAC address");?></a>
+                    <br> 
+                    <span class="vexpl"><?=gettext("MAC address (6 hex octets separated by colons)"); ?></span></td>
+                </tr>
 		<tr>
-			<td width="22%" valign="top" class="vncell"><?=gettext("Bandwidth up"); ?></td>
-			<td width="78%" class="vtable">
-				<input name="bw_up" type="text" class="formfld unknown" id="bw_up" size="10" value="<?=htmlspecialchars($pconfig['bw_up']);?>">
-				<br>
-				<span class="vexpl"><?=gettext("Enter a upload limit to be enforced on this MAC address in Kbit/s"); ?></span>
-			</td>
-		</tr>
+                  <td width="22%" valign="top" class="vncell"><?=gettext("Description"); ?></td>
+                  <td width="78%" class="vtable"> 
+                    <input name="descr" type="text" class="formfld unknown" id="descr" size="40" value="<?=htmlspecialchars($pconfig['descr']);?>">
+                    <br> <span class="vexpl"><?=gettext("You may enter a description here " .
+                    "for your reference (not parsed)"); ?>.</span></td>
+                </tr>
 		<tr>
-			<td width="22%" valign="top" class="vncell"><?=gettext("Bandwidth down"); ?></td>
-			<td width="78%" class="vtable">
-				<input name="bw_down" type="text" class="formfld unknown" id="bw_down" size="10" value="<?=htmlspecialchars($pconfig['bw_down']);?>">
-				<br>
-				<span class="vexpl"><?=gettext("Enter a download limit to be enforced on this MAC address in Kbit/s"); ?></span>
-			</td>
-		</tr>
+                  <td width="22%" valign="top" class="vncell"><?=gettext("Bandwidth up"); ?></td>
+                  <td width="78%" class="vtable"> 
+                    <input name="bw_up" type="text" class="formfld unknown" id="bw_up" size="10" value="<?=htmlspecialchars($pconfig['bw_up']);?>">
+                    <br> <span class="vexpl"><?=gettext("Enter a upload limit to be enforced on this MAC address in Kbit/s"); ?></span></td>
+                </tr>
 		<tr>
-			<td width="22%" valign="top">&nbsp;</td>
-			<td width="78%">
-				<input name="Submit" type="submit" class="formbtn" value="<?=gettext("Save"); ?>">
-				<input name="zone" type="hidden" value="<?=htmlspecialchars($cpzone);?>">
-				<?php if (isset($id) && $a_passthrumacs[$id]): ?>
-					<input name="id" type="hidden" value="<?=htmlspecialchars($id);?>">
-				<?php endif; ?>
-				<?php if (isset($pconfig['username']) && $pconfig['username']): ?>
-					<input name="username" type="hidden" value="<?=htmlspecialchars($pconfig['username']);?>">
-				<?php endif; ?>
-			</td>
-		</tr>
-	</table>
+                  <td width="22%" valign="top" class="vncell"><?=gettext("Bandwidth down"); ?></td>
+                  <td width="78%" class="vtable"> 
+                    <input name="bw_down" type="text" class="formfld unknown" id="bw_down" size="10" value="<?=htmlspecialchars($pconfig['bw_down']);?>">
+                    <br> <span class="vexpl"><?=gettext("Enter a download limit to be enforced on this MAC address in Kbit/s"); ?></span></td>
+                </tr>
+                <tr>
+                  <td width="22%" valign="top">&nbsp;</td>
+                  <td width="78%"> 
+                    <input name="Submit" type="submit" class="formbtn" value="<?=gettext("Save"); ?>">
+                    <input name="zone" type="hidden" value="<?=htmlspecialchars($cpzone);?>">
+                    <?php if (isset($id) && $a_passthrumacs[$id]): ?>
+                    <input name="id" type="hidden" value="<?=htmlspecialchars($id);?>">
+                    <?php endif; ?>
+		    <?php if (isset($pconfig['username']) && $pconfig['username']): ?>
+                    <input name="username" type="hidden" value="<?=htmlspecialchars($pconfig['username']);?>">
+                    <?php endif; ?>
+                  </td>
+                </tr>
+              </table>
 </form>
 <?php include("fend.inc"); ?>
 </body>
diff --git a/usr/local/www/services_captiveportal_vouchers.php b/usr/local/www/services_captiveportal_vouchers.php
index fb5b844..bd1b2f3 100644
--- a/usr/local/www/services_captiveportal_vouchers.php
+++ b/usr/local/www/services_captiveportal_vouchers.php
@@ -213,7 +213,7 @@ if ($_POST) {
 			$reqdfieldsn = array(gettext("Synchronize Voucher Database IP"),gettext("Sync port"),gettext("Sync password"),gettext("Sync username"));
 		}
 		
-		do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+		do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 	}
 	
 	if (!$_POST['vouchersyncusername']) { 
@@ -324,30 +324,29 @@ EOF;
 					} else {				
 						// If we received back the voucher roll and other information then store it.
 						if($toreturn['voucher']['roll'])
-							$newvoucher['roll'] = $toreturn['voucher']['roll'];
+							$config['voucher'][$cpzone]['roll'] = $toreturn['voucher']['roll'];
 						if($toreturn['voucher']['rollbits'])
-							$newvoucher['rollbits'] = $toreturn['voucher']['rollbits'];
+							$config['voucher'][$cpzone]['rollbits'] = $toreturn['voucher']['rollbits'];
 						if($toreturn['voucher']['ticketbits'])
-							$newvoucher['ticketbits'] = $toreturn['voucher']['ticketbits'];
+							$config['voucher'][$cpzone]['ticketbits'] = $toreturn['voucher']['ticketbits'];
 						if($toreturn['voucher']['checksumbits'])
-							$newvoucher['checksumbits'] = $toreturn['voucher']['checksumbits'];
+							$config['voucher'][$cpzone]['checksumbits'] = $toreturn['voucher']['checksumbits'];
 						if($toreturn['voucher']['magic'])
-							$newvoucher['magic'] = $toreturn['voucher']['magic'];
+							$config['voucher'][$cpzone]['magic'] = $toreturn['voucher']['magic'];
 						if($toreturn['voucher']['exponent'])
-							$newvoucher['exponent'] = $toreturn['voucher']['exponent'];
+							$config['voucher'][$cpzone]['exponent'] = $toreturn['voucher']['exponent'];
 						if($toreturn['voucher']['publickey'])
-							$newvoucher['publickey'] = $toreturn['voucher']['publickey'];
+							$config['voucher'][$cpzone]['publickey'] = $toreturn['voucher']['publickey'];
 						if($toreturn['voucher']['privatekey'])
-							$newvoucher['privatekey'] = $toreturn['voucher']['privatekey'];
+							$config['voucher'][$cpzone]['privatekey'] = $toreturn['voucher']['privatekey'];
 						if($toreturn['voucher']['msgnoaccess'])
-							$newvoucher['msgnoaccess'] = $toreturn['voucher']['msgnoaccess'];
+							$config['voucher'][$cpzone]['msgnoaccess'] = $toreturn['voucher']['msgnoaccess'];
 						if($toreturn['voucher']['msgexpired'])
-							$newvoucher['msgexpired'] = $toreturn['voucher']['msgexpired'];
+							$config['voucher'][$cpzone]['msgexpired'] = $toreturn['voucher']['msgexpired'];
 						if($toreturn['voucher']['msgnoaccess'])
-							$newvoucher['msgnoaccess'] = $toreturn['voucher']['msgnoaccess'];
+							$config['voucher'][$cpzone]['msgnoaccess'] = $toreturn['voucher']['msgnoaccess'];
 						$savemsg = gettext("Voucher database has been synchronized from {$url}:{$port}");
 
-						$config['voucher'][$cpzone] = $newvoucher;
 						write_config();
 						voucher_configure_zone(true);
 					}
@@ -435,8 +434,8 @@ function enable_change(enable_change) {
 			<ul id="tabnav">
 <?php 
 	$tab_array = array();
-	$tab_array[] = array(gettext("Captive portal(s)"), false, "services_captiveportal.php?zone={$cpzone}");
-	$tab_array[] = array(gettext("MAC"), false, "services_captiveportal_mac.php?zone={$cpzone}");
+	$tab_array[] = array(gettext("Captive portal"), false, "services_captiveportal.php?zone={$cpzone}");
+	$tab_array[] = array(gettext("Pass-through MAC"), false, "services_captiveportal_mac.php?zone={$cpzone}");
 	$tab_array[] = array(gettext("Allowed IP addresses"), false, "services_captiveportal_ip.php?zone={$cpzone}");
 	$tab_array[] = array(gettext("Allowed Hostnames"), false, "services_captiveportal_hostname.php?zone={$cpzone}");
 	$tab_array[] = array(gettext("Vouchers"), true, "services_captiveportal_vouchers.php?zone={$cpzone}");
diff --git a/usr/local/www/services_captiveportal_vouchers_edit.php b/usr/local/www/services_captiveportal_vouchers_edit.php
index f30d0ac..9cd85e8 100644
--- a/usr/local/www/services_captiveportal_vouchers_edit.php
+++ b/usr/local/www/services_captiveportal_vouchers_edit.php
@@ -91,7 +91,7 @@ if ($_POST) {
     $reqdfields = explode(" ", "number count minutes");
     $reqdfieldsn = array(gettext("Number"),gettext("Count"),gettext("minutes"));
 
-    do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+    do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 
 	// Look for duplicate roll #
 	foreach($a_roll as $re) {
diff --git a/usr/local/www/services_captiveportal_zones.php b/usr/local/www/services_captiveportal_zones.php
index 454b36e..049e03f 100644
--- a/usr/local/www/services_captiveportal_zones.php
+++ b/usr/local/www/services_captiveportal_zones.php
@@ -4,7 +4,7 @@
 */
 
 ##|+PRIV
-##|*IDENT=page-services-captiveportal-zones
+##|*IDENT=page-services-captiveportalserver-zones
 ##|*NAME=Services: Captiveprotal Zones page
 ##|*DESCR=Allow access to the 'Services: CaptivePortal Zones' page.
 ##|*MATCH=services_captiveportal_zones.php*
@@ -16,9 +16,6 @@ require_once("filter.inc");
 require("shaper.inc");
 require("captiveportal.inc");
 
-global $cpzone;
-global $cpzoneid;
-
 if (!is_array($config['captiveportal']))
 	$config['captiveportal'] = array();
 $a_cp = &$config['captiveportal'];
@@ -26,7 +23,6 @@ $a_cp = &$config['captiveportal'];
 if ($_GET['act'] == "del" && !empty($_GET['zone'])) {
 	$cpzone = $_GET['zone'];
 	if ($a_cp[$cpzone]) {
-		$cpzoneid = $a_cp[$cpzone]['zoneid'];
 		unset($a_cp[$cpzone]['enable']);
 		captiveportal_configure_zone($a_cp[$cpzone]);
 		unset($a_cp[$cpzone]);
diff --git a/usr/local/www/services_captiveportal_zones_edit.php b/usr/local/www/services_captiveportal_zones_edit.php
index e604280..b011352 100644
--- a/usr/local/www/services_captiveportal_zones_edit.php
+++ b/usr/local/www/services_captiveportal_zones_edit.php
@@ -58,7 +58,7 @@ if ($_POST) {
 	$reqdfields = explode(" ", "zone");
 	$reqdfieldsn = array(gettext("Zone name"));
 
-	do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+	do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 
 	if (preg_match('/[^A-Za-z0-9_]/', $_POST['zone'])) {
 		$input_errors[] = gettext("The zone name can only contain letters, digits, and underscores (_).");
diff --git a/usr/local/www/services_dhcp.php b/usr/local/www/services_dhcp.php
index b364768..3b136c9 100755
--- a/usr/local/www/services_dhcp.php
+++ b/usr/local/www/services_dhcp.php
@@ -184,9 +184,6 @@ if (is_array($dhcpdconf)) {
 	list($pconfig['dns1'],$pconfig['dns2']) = $dhcpdconf['dnsserver'];
 	$pconfig['denyunknown'] = isset($dhcpdconf['denyunknown']);
 	$pconfig['ddnsdomain'] = $dhcpdconf['ddnsdomain'];
-	$pconfig['ddnsdomainprimary'] = $dhcpdconf['ddnsdomainprimary'];
-	$pconfig['ddnsdomainkeyname'] = $dhcpdconf['ddnsdomainkeyname'];
-	$pconfig['ddnsdomainkey'] = $dhcpdconf['ddnsdomainkey'];
 	$pconfig['ddnsupdate'] = isset($dhcpdconf['ddnsupdate']);
 	$pconfig['mac_allow'] = $dhcpdconf['mac_allow'];
 	$pconfig['mac_deny'] = $dhcpdconf['mac_deny'];
@@ -244,12 +241,12 @@ if ($_POST) {
 			$input_errors[] = gettext("A valid range must be specified.");
 		if (($_POST['range_to'] && !is_ipaddrv4($_POST['range_to'])))
 			$input_errors[] = gettext("A valid range must be specified.");
-		if (($_POST['gateway'] && $_POST['gateway'] != "none" && !is_ipaddrv4($_POST['gateway'])))
+		if (($_POST['gateway'] && !is_ipaddrv4($_POST['gateway'])))
 			$input_errors[] = gettext("A valid IP address must be specified for the gateway.");
 		if (($_POST['wins1'] && !is_ipaddrv4($_POST['wins1'])) || ($_POST['wins2'] && !is_ipaddrv4($_POST['wins2'])))
 			$input_errors[] = gettext("A valid IP address must be specified for the primary/secondary WINS servers.");
 		$parent_ip = get_interface_ip($_POST['if']);
-		if (is_ipaddrv4($parent_ip) && $_POST['gateway'] && $_POST['gateway'] != "none") {
+		if (is_ipaddrv4($parent_ip) && $_POST['gateway']) {
 			$parent_sn = get_interface_subnet($_POST['if']);
 			if(!ip_in_subnet($_POST['gateway'], gen_subnet($parent_ip, $parent_sn) . "/" . $parent_sn) && !ip_in_interface_alias_subnet($_POST['if'], $_POST['gateway']))
 				$input_errors[] = sprintf(gettext("The gateway address %s does not lie within the chosen interface's subnet."), $_POST['gateway']);
@@ -283,11 +280,6 @@ if ($_POST) {
 			$input_errors[] = gettext("The maximum lease time must be at least 60 seconds and higher than the default lease time.");
 		if (($_POST['ddnsdomain'] && !is_domain($_POST['ddnsdomain'])))
 			$input_errors[] = gettext("A valid domain name must be specified for the dynamic DNS registration.");
-		if (($_POST['ddnsdomain'] && !is_ipaddrv4($_POST['ddnsdomainprimary'])))
-			$input_errors[] = gettext("A valid primary domain name server IP address must be specified for the dynamic domain name.");
-		if (($_POST['ddnsdomainkey'] && !$_POST['ddnsdomainkeyname']) ||
-			($_POST['ddnsdomainkeyname'] && !$_POST['ddnsdomainkey']))
-			$input_errors[] = gettext("You must specify both a valid domain key and key name.");
 		if ($_POST['domainsearchlist']) {
 			$domain_array=preg_split("/[ ;]+/",$_POST['domainsearchlist']);
 			foreach ($domain_array as $curdomain) {
@@ -479,9 +471,6 @@ if ($_POST) {
 		$dhcpdconf['domainsearchlist'] = $_POST['domainsearchlist'];
 		$dhcpdconf['denyunknown'] = ($_POST['denyunknown']) ? true : false;
 		$dhcpdconf['ddnsdomain'] = $_POST['ddnsdomain'];
-		$dhcpdconf['ddnsdomainprimary'] = $_POST['ddnsdomainprimary'];
-		$dhcpdconf['ddnsdomainkeyname'] = $_POST['ddnsdomainkeyname'];
-		$dhcpdconf['ddnsdomainkey'] = $_POST['ddnsdomainkey'];
 		$dhcpdconf['ddnsupdate'] = ($_POST['ddnsupdate']) ? true : false;
 		$dhcpdconf['mac_allow'] = $_POST['mac_allow'];
 		$dhcpdconf['mac_deny'] = $_POST['mac_deny'];
@@ -623,9 +612,6 @@ include("head.inc");
 		document.iform.staticarp.disabled = endis;
 		document.iform.dhcpleaseinlocaltime.disabled = endis;
 		document.iform.ddnsdomain.disabled = endis;
-		document.iform.ddnsdomainprimary.disabled = endis;
-		document.iform.ddnsdomainkeyname.disabled = endis;
-		document.iform.ddnsdomainkey.disabled = endis;
 		document.iform.ddnsupdate.disabled = endis;
 		document.iform.mac_allow.disabled = endis;
 		document.iform.mac_deny.disabled = endis;
@@ -904,14 +890,14 @@ include("head.inc");
 			<td width="22%" valign="top" class="vncell"><?=gettext("Gateway");?></td>
 			<td width="78%" class="vtable">
 				<input name="gateway" type="text" class="formfld host" id="gateway" size="20" value="<?=htmlspecialchars($pconfig['gateway']);?>"><br>
-				<?=gettext("The default is to use the IP on this interface of the firewall as the gateway. Specify an alternate gateway here if this is not the correct gateway for your network. Type \"none\" for no gateway assignment.");?>
+				 <?=gettext("The default is to use the IP on this interface of the firewall as the gateway. Specify an alternate gateway here if this is not the correct gateway for your network.");?>
 			</td>
 			</tr>
 			<tr>
 			<td width="22%" valign="top" class="vncell"><?=gettext("Domain name");?></td>
 			<td width="78%" class="vtable">
 				<input name="domain" type="text" class="formfld unknown" id="domain" size="20" value="<?=htmlspecialchars($pconfig['domain']);?>"><br>
-				<?=gettext("The default is to use the domain name of this system as the default domain name provided by DHCP. You may specify an alternate domain name here.");?>
+				 <?=gettext("The default is to use the domain name of this system as the default domain name provided by DHCP. You may specify an alternate domain name here.");?>
 			</td>
 			</tr>
 			<tr>
@@ -1010,12 +996,6 @@ include("head.inc");
 					<input name="ddnsdomain" type="text" class="formfld unknown" id="ddnsdomain" size="20" value="<?=htmlspecialchars($pconfig['ddnsdomain']);?>"><br />
 					<?=gettext("Note: Leave blank to disable dynamic DNS registration.");?><br />
 					<?=gettext("Enter the dynamic DNS domain which will be used to register client names in the DNS server.");?>
-					<input name="ddnsdomainprimary" type="text" class="formfld unknown" id="ddnsdomainprimary" size="20" value="<?=htmlspecialchars($pconfig['ddnsdomainprimary']);?>"><br>
-					<?=gettext("Enter the primary domain name server IP address for the dynamic domain name.");?><br />
-					<input name="ddnsdomainkeyname" type="text" class="formfld unknown" id="ddnsdomainkeyname" size="20" value="<?=htmlspecialchars($pconfig['ddnsdomainkeyname']);?>"><br />
-					<?=gettext("Enter the dynamic DNS domain key name which will be used to register client names in the DNS server.");?>
-					<input name="ddnsdomainkey" type="text" class="formfld unknown" id="ddnsdomainkey" size="20" value="<?=htmlspecialchars($pconfig['ddnsdomainkey']);?>"><br />
-					<?=gettext("Enter the dynamic DNS domain key secret which will be used to register client names in the DNS server.");?>
 				</div>
 			</td>
 			</tr>
diff --git a/usr/local/www/services_dhcp_edit.php b/usr/local/www/services_dhcp_edit.php
index d7ade1c..f318bc4 100755
--- a/usr/local/www/services_dhcp_edit.php
+++ b/usr/local/www/services_dhcp_edit.php
@@ -92,7 +92,6 @@ if (isset($_POST['id']))
 
 if (isset($id) && $a_maps[$id]) {
 	$pconfig['mac'] = $a_maps[$id]['mac'];
-	$pconfig['cid'] = $a_maps[$id]['cid'];
 	$pconfig['hostname'] = $a_maps[$id]['hostname'];
 	$pconfig['ipaddr'] = $a_maps[$id]['ipaddr'];
 	$pconfig['filename'] = $a_maps[$id]['filename'];
@@ -107,15 +106,11 @@ if (isset($id) && $a_maps[$id]) {
 	list($pconfig['wins1'],$pconfig['wins2']) = $a_maps[$id]['winsserver'];
 	list($pconfig['dns1'],$pconfig['dns2']) = $a_maps[$id]['dnsserver'];
 	$pconfig['ddnsdomain'] = $a_maps[$id]['ddnsdomain'];
-	$pconfig['ddnsdomainprimary'] = $a_maps[$id]['ddnsdomainprimary'];
-	$pconfig['ddnsdomainkeyname'] = $a_maps[$id]['ddnsdomainkeyname'];
-	$pconfig['ddnsdomainkey'] = $a_maps[$id]['ddnsdomainkey'];
 	$pconfig['ddnsupdate'] = isset($a_maps[$id]['ddnsupdate']);
 	list($pconfig['ntp1'],$pconfig['ntp2']) = $a_maps[$id]['ntpserver'];
 	$pconfig['tftp'] = $a_maps[$id]['tftp'];
 } else {
 	$pconfig['mac'] = $_GET['mac'];
-	$pconfig['cid'] = $_GET['cid'];
 	$pconfig['hostname'] = $_GET['hostname'];
 	$pconfig['filename'] = $_GET['filename'];
 	$pconfig['rootpath'] = $_GET['rootpath'];
@@ -131,9 +126,6 @@ if (isset($id) && $a_maps[$id]) {
 	$pconfig['dns1'] = $_GET['dns1'];
 	$pconfig['dns2'] = $_GET['dns2'];
 	$pconfig['ddnsdomain'] = $_GET['ddnsdomain'];
-	$pconfig['ddnsdomainprimary'] = $_GET['ddnsdomainprimary'];
-	$pconfig['ddnsdomainkeyname'] = $_GET['ddnsdomainkeyname'];
-	$pconfig['ddnsdomainkey'] = $_GET['ddnsdomainkey'];
 	$pconfig['ddnsupdate'] = isset($_GET['ddnsupdate']);
 	$pconfig['ntp1'] = $_GET['ntp1'];
 	$pconfig['ntp2'] = $_GET['ntp2'];
@@ -146,14 +138,10 @@ if ($_POST) {
 	$pconfig = $_POST;
 
 	/* input validation */
-	$reqdfields = array();
-	$reqdfieldsn = array();
+	$reqdfields = explode(" ", "mac");
+	$reqdfieldsn = array(gettext("MAC address"));
 
-	do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
-
-    /* either MAC or Client-ID must be specified */
-    if (empty($_POST['mac']) && empty($_POST['cid']))
-        $input_errors[] = gettext("Either MAC address or Client identifier must be specified");
+	do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 
 	/* normalize MAC addresses - lowercase and convert Windows-ized hyphenated MACs to colon delimited */
 	$_POST['mac'] = strtolower(str_replace("-", ":", $_POST['mac']));
@@ -185,8 +173,8 @@ if ($_POST) {
 		if (isset($id) && ($a_maps[$id]) && ($a_maps[$id] === $mapent))
 			continue;
 
-		if ((($mapent['hostname'] == $_POST['hostname']) && $mapent['hostname'])  || (($mapent['mac'] == $_POST['mac']) && $mapent['mac']) || (($mapent['ipaddr'] == $_POST['ipaddr']) && $mapent['ipaddr'] ) || (($mapent['cid'] == $_POST['cid']) && $mapent['cid'])) {
-			$input_errors[] = gettext("This Hostname, IP, MAC address or Client identifier already exists.");
+		if ((($mapent['hostname'] == $_POST['hostname']) && $mapent['hostname'])  || (($mapent['mac'] == $_POST['mac']) && $mapent['mac']) || (($mapent['ipaddr'] == $_POST['ipaddr']) && $mapent['ipaddr'])) {
+			$input_errors[] = gettext("This Hostname, IP or MAC address already exists.");
 			break;
 		}
 	}
@@ -235,11 +223,6 @@ if ($_POST) {
 		$input_errors[] = gettext("The maximum lease time must be at least 60 seconds and higher than the default lease time.");
 	if (($_POST['ddnsdomain'] && !is_domain($_POST['ddnsdomain'])))
 		$input_errors[] = gettext("A valid domain name must be specified for the dynamic DNS registration.");
-	if (($_POST['ddnsdomain'] && !is_ipaddrv4($_POST['ddnsdomainprimary'])))
-		$input_errors[] = gettext("A valid primary domain name server IP address must be specified for the dynamic domain name.");
-	if (($_POST['ddnsdomainkey'] && !$_POST['ddnsdomainkeyname']) ||
-		($_POST['ddnsdomainkeyname'] && !$_POST['ddnsdomainkey']))
-		$input_errors[] = gettext("You must specify both a valid domain key and key name.");
 	if ($_POST['domainsearchlist']) {
 		$domain_array=preg_split("/[ ;]+/",$_POST['domainsearchlist']);
 		foreach ($domain_array as $curdomain) {
@@ -260,7 +243,6 @@ if ($_POST) {
 	if (!$input_errors) {
 		$mapent = array();
 		$mapent['mac'] = $_POST['mac'];
-		$mapent['cid'] = $_POST['cid'];
 		$mapent['ipaddr'] = $_POST['ipaddr'];
 		$mapent['hostname'] = $_POST['hostname'];
 		$mapent['descr'] = $_POST['descr'];
@@ -286,9 +268,6 @@ if ($_POST) {
 		$mapent['domain'] = $_POST['domain'];
 		$mapent['domainsearchlist'] = $_POST['domainsearchlist'];
 		$mapent['ddnsdomain'] = $_POST['ddnsdomain'];
-		$mapent['ddnsdomainprimary'] = $_POST['ddnsdomainprimary'];
-		$mapent['ddnsdomainkeyname'] = $_POST['ddnsdomainkeyname'];
-		$mapent['ddnsdomainkey'] = $_POST['ddnsdomainkey'];
 		$mapent['ddnsupdate'] = ($_POST['ddnsupdate']) ? true : false;
 
 		unset($mapent['ntpserver']);
@@ -355,7 +334,7 @@ include("head.inc");
 					<td colspan="2" valign="top" class="listtopic"><?=gettext("Static DHCP Mapping");?></td>
 				</tr>
                 <tr>
-                  <td width="22%" valign="top" class="vncell"><?=gettext("MAC address");?></td>
+                  <td width="22%" valign="top" class="vncellreq"><?=gettext("MAC address");?></td>
                   <td width="78%" class="vtable">
                     <input name="mac" type="text" class="formfld unknown" id="mac" size="30" value="<?=htmlspecialchars($pconfig['mac']);?>">
 		    <?php
@@ -368,11 +347,6 @@ include("head.inc");
                     <span class="vexpl"><?=gettext("Enter a MAC address in the following format: ".
                     "xx:xx:xx:xx:xx:xx");?></span></td>
                 </tr>
-                  <td width="22%" valign="top" class="vncell"><?=gettext("Client identifier");?></td>
-                  <td width="78%" class="vtable">
-                    <input name="cid" type="text" class="formfld unknown" id="cid" size="30" value="<?=htmlspecialchars($pconfig['cid']);?>">
-                    <span class="vexpl"><?=gettext("");?></span></td>
-                </tr>
                 <tr>
                   <td width="22%" valign="top" class="vncell"><?=gettext("IP address");?></td>
                   <td width="78%" class="vtable">
@@ -486,12 +460,6 @@ include("head.inc");
 				<input name="ddnsdomain" type="text" class="formfld unknown" id="ddnsdomain" size="20" value="<?=htmlspecialchars($pconfig['ddnsdomain']);?>"><br />
 				<?=gettext("Note: Leave blank to disable dynamic DNS registration.");?><br />
 				<?=gettext("Enter the dynamic DNS domain which will be used to register client names in the DNS server.");?>
-				<input name="ddnsdomainprimary" type="text" class="formfld unknown" id="ddnsdomainprimary" size="20" value="<?=htmlspecialchars($pconfig['ddnsdomainprimary']);?>"><br>
-				<?=gettext("Enter the primary domain name server IP address for the dynamic domain name.");?><br />
-				<input name="ddnsdomainkeyname" type="text" class="formfld unknown" id="ddnsdomainkeyname" size="20" value="<?=htmlspecialchars($pconfig['ddnsdomainkeyname']);?>"><br />
-				<?=gettext("Enter the dynamic DNS domain key name which will be used to register client names in the DNS server.");?>
-				<input name="ddnsdomainkey" type="text" class="formfld unknown" id="ddnsdomainkey" size="20" value="<?=htmlspecialchars($pconfig['ddnsdomainkey']);?>"><br />
-				<?=gettext("Enter the dynamic DNS domain key secret which will be used to register client names in the DNS server.");?>
 			</div>
 		</td>
 		</tr>
diff --git a/usr/local/www/services_dhcp_relay.php b/usr/local/www/services_dhcp_relay.php
index 7623e49..b2aa049 100755
--- a/usr/local/www/services_dhcp_relay.php
+++ b/usr/local/www/services_dhcp_relay.php
@@ -71,7 +71,7 @@ if ($_POST) {
 		$reqdfields = explode(" ", "server interface");
 		$reqdfieldsn = array(gettext("Destination Server"), gettext("Interface"));
 
-		do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+		do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 
 		if ($_POST['server']) {
 			$checksrv = explode(",", $_POST['server']);
diff --git a/usr/local/www/services_dhcpv6.php b/usr/local/www/services_dhcpv6.php
index b123e12..09a4696 100644
--- a/usr/local/www/services_dhcpv6.php
+++ b/usr/local/www/services_dhcpv6.php
@@ -45,7 +45,6 @@
 ##|-PRIV
 
 require("guiconfig.inc");
-require_once("filter.inc");
 
 if(!$g['services_dhcp_server_enable']) {
 	Header("Location: /");
@@ -108,10 +107,8 @@ if (is_array($config['dhcpdv6'][$if])){
 	list($pconfig['wins1'],$pconfig['wins2']) = $config['dhcpdv6'][$if]['winsserver'];
 	list($pconfig['dns1'],$pconfig['dns2']) = $config['dhcpdv6'][$if]['dnsserver'];
 	$pconfig['enable'] = isset($config['dhcpdv6'][$if]['enable']);
+	$pconfig['denyunknown'] = isset($config['dhcpdv6'][$if]['denyunknown']);
 	$pconfig['ddnsdomain'] = $config['dhcpdv6'][$if]['ddnsdomain'];
-	$pconfig['ddnsdomainprimary'] = $config['dhcpdv6'][$if]['ddnsdomainprimary'];
-	$pconfig['ddnsdomainkeyname'] = $config['dhcpdv6'][$if]['ddnsdomainkeyname'];
-	$pconfig['ddnsdomainkey'] = $config['dhcpdv6'][$if]['ddnsdomainkey'];
 	$pconfig['ddnsupdate'] = isset($config['dhcpdv6'][$if]['ddnsupdate']);
 	list($pconfig['ntp1'],$pconfig['ntp2']) = $config['dhcpdv6'][$if]['ntpserver'];
 	$pconfig['tftp'] = $config['dhcpdv6'][$if]['tftp'];
@@ -151,10 +148,6 @@ if ($_POST) {
 
 	unset($input_errors);
 
-	$old_dhcpdv6_enable = ($pconfig['enable'] == true);
-	$new_dhcpdv6_enable = ($_POST['enable'] ? true : false);
-	$dhcpdv6_enable_changed = ($old_dhcpdv6_enable != $new_dhcpdv6_enable);
-
 	$pconfig = $_POST;
 
 	$numberoptions = array();
@@ -174,7 +167,7 @@ if ($_POST) {
 		$reqdfields = explode(" ", "range_from range_to");
 		$reqdfieldsn = array(gettext("Range begin"),gettext("Range end"));
 
-		do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+		do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 
 		if (($_POST['prefixrange_from'] && !is_ipaddrv6($_POST['prefixrange_from'])))
 			$input_errors[] = gettext("A valid range must be specified.");
@@ -195,11 +188,6 @@ if ($_POST) {
 			$input_errors[] = gettext("The maximum lease time must be at least 60 seconds and higher than the default lease time.");
 		if (($_POST['ddnsdomain'] && !is_domain($_POST['ddnsdomain'])))
 			$input_errors[] = gettext("A valid domain name must be specified for the dynamic DNS registration.");
-		if (($_POST['ddnsdomain'] && !is_ipaddrv4($_POST['ddnsdomainprimary'])))
-			$input_errors[] = gettext("A valid primary domain name server IPv4 address must be specified for the dynamic domain name.");
-		if (($_POST['ddnsdomainkey'] && !$_POST['ddnsdomainkeyname']) ||
-			($_POST['ddnsdomainkeyname'] && !$_POST['ddnsdomainkey']))
-			$input_errors[] = gettext("You must specify both a valid domain key and key name.");
 		if ($_POST['domainsearchlist']) {
 			$domain_array=preg_split("/[ ;]+/",$_POST['domainsearchlist']);
 			foreach ($domain_array as $curdomain) {
@@ -300,11 +288,9 @@ if ($_POST) {
 
 		$config['dhcpdv6'][$if]['domain'] = $_POST['domain'];
 		$config['dhcpdv6'][$if]['domainsearchlist'] = $_POST['domainsearchlist'];
+		$config['dhcpdv6'][$if]['denyunknown'] = ($_POST['denyunknown']) ? true : false;
 		$config['dhcpdv6'][$if]['enable'] = ($_POST['enable']) ? true : false;
 		$config['dhcpdv6'][$if]['ddnsdomain'] = $_POST['ddnsdomain'];
-		$config['dhcpdv6'][$if]['ddnsdomainprimary'] = $_POST['ddnsdomainprimary'];
-		$config['dhcpdv6'][$if]['ddnsdomainkeyname'] = $_POST['ddnsdomainkeyname'];
-		$config['dhcpdv6'][$if]['ddnsdomainkey'] = $_POST['ddnsdomainkey'];
 		$config['dhcpdv6'][$if]['ddnsupdate'] = ($_POST['ddnsupdate']) ? true : false;
 
 		unset($config['dhcpdv6'][$if]['ntpserver']);
@@ -348,9 +334,7 @@ if ($_POST) {
 			if ($retvaldhcp == 0)
 				clear_subsystem_dirty('staticmaps');
 		}
-		if ($dhcpdv6_enable_changed)
-			$retvalfc = filter_configure();
-		if($retvaldhcp == 1 || $retvaldns == 1 || $retvalfc == 1)
+		if($retvaldhcp == 1 || $retvaldns == 1)
 			$retval = 1;
 		$savemsg = get_std_save_message($retval);
 	}
@@ -407,9 +391,6 @@ include("head.inc");
 		document.iform.domain.disabled = endis;
 		document.iform.domainsearchlist.disabled = endis;
 		document.iform.ddnsdomain.disabled = endis;
-		document.iform.ddnsdomainprimary.disabled = endis;
-		document.iform.ddnsdomainkeyname.disabled = endis;
-		document.iform.ddnsdomainkey.disabled = endis;
 		document.iform.ddnsupdate.disabled = endis;
 		document.iform.ntp1.disabled = endis;
 		document.iform.ntp2.disabled = endis;
@@ -419,6 +400,7 @@ include("head.inc");
 		document.iform.nextserver.disabled = endis;
 		document.iform.filename.disabled = endis;
 		document.iform.rootpath.disabled = endis;
+		document.iform.denyunknown.disabled = endis;
 	}
 
 	function show_shownumbervalue() {
@@ -540,6 +522,13 @@ display_top_tabs($tab_array);
 			"interface"),htmlspecialchars($iflist[$if]));?></strong></td>
 			</tr>
 			<tr>
+			<td width="22%" valign="top" class="vtable">&nbsp;</td>
+			<td width="78%" class="vtable">
+				<input name="denyunknown" id="denyunknown" type="checkbox" value="yes" <?php if ($pconfig['denyunknown']) echo "checked"; ?>>
+				<strong><?=gettext("Deny unknown clients");?></strong><br>
+				<?=gettext("If this is checked, only the clients defined below will get DHCP leases from this server. ");?></td>
+			</tr>
+			<tr>
 			<?php
 			/* the PPPoE Server could well have no IPv6 address and operate fine with just link-local, just hide these */
 			if(is_ipaddrv6($ifcfgip)) {
@@ -696,12 +685,6 @@ display_top_tabs($tab_array);
 					<input name="ddnsdomain" type="text" class="formfld unknown" id="ddnsdomain" size="28" value="<?=htmlspecialchars($pconfig['ddnsdomain']);?>"><br />
 					<?=gettext("Note: Leave blank to disable dynamic DNS registration.");?><br />
 					<?=gettext("Enter the dynamic DNS domain which will be used to register client names in the DNS server.");?>
-					<input name="ddnsdomainprimary" type="text" class="formfld unknown" id="ddnsdomainprimary" size="20" value="<?=htmlspecialchars($pconfig['ddnsdomainprimary']);?>"><br>
-					<?=gettext("Enter the primary domain name server IP address for the dynamic domain name.");?><br />
-					<input name="ddnsdomainkeyname" type="text" class="formfld unknown" id="ddnsdomainkeyname" size="20" value="<?=htmlspecialchars($pconfig['ddnsdomainkeyname']);?>"><br />
-					<?=gettext("Enter the dynamic DNS domain key name which will be used to register client names in the DNS server.");?>
-					<input name="ddnsdomainkey" type="text" class="formfld unknown" id="ddnsdomainkey" size="20" value="<?=htmlspecialchars($pconfig['ddnsdomainkey']);?>"><br />
-					<?=gettext("Enter the dynamic DNS domain key secret which will be used to register client names in the DNS server.");?>
 				</div>
 			</td>
 			</tr>
diff --git a/usr/local/www/services_dhcpv6_edit.php b/usr/local/www/services_dhcpv6_edit.php
index 32ac04a..a4e48e6 100644
--- a/usr/local/www/services_dhcpv6_edit.php
+++ b/usr/local/www/services_dhcpv6_edit.php
@@ -110,7 +110,7 @@ if ($_POST) {
 	$reqdfields = explode(" ", "duid");
 	$reqdfieldsn = array(gettext("DUID Identifier"));
 	
-	do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+	do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 
 	if ($_POST['hostname']) {
 		preg_match("/\-\$/", $_POST['hostname'], $matches);
diff --git a/usr/local/www/services_dhcpv6_relay.php b/usr/local/www/services_dhcpv6_relay.php
index ecd7818..4508198 100644
--- a/usr/local/www/services_dhcpv6_relay.php
+++ b/usr/local/www/services_dhcpv6_relay.php
@@ -72,7 +72,7 @@ if ($_POST) {
 		$reqdfields = explode(" ", "server interface");
 		$reqdfieldsn = array(gettext("Destination Server"), gettext("Interface"));
 
-		do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+		do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 
 		if ($_POST['server']) {
 			$checksrv = explode(",", $_POST['server']);
diff --git a/usr/local/www/services_dnsmasq_domainoverride_edit.php b/usr/local/www/services_dnsmasq_domainoverride_edit.php
index 8d0fce8..c228353 100755
--- a/usr/local/www/services_dnsmasq_domainoverride_edit.php
+++ b/usr/local/www/services_dnsmasq_domainoverride_edit.php
@@ -71,7 +71,7 @@ if ($_POST) {
        $reqdfields = explode(" ", "domain ip");
        $reqdfieldsn = array(gettext("Domain"),gettext("IP address"));
 
-       do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+       do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 
        function String_Begins_With($needle, $haystack) {
            return (substr($haystack, 0, strlen($needle))==$needle);
diff --git a/usr/local/www/services_dnsmasq_edit.php b/usr/local/www/services_dnsmasq_edit.php
index c56f759..e38f977 100755
--- a/usr/local/www/services_dnsmasq_edit.php
+++ b/usr/local/www/services_dnsmasq_edit.php
@@ -80,7 +80,7 @@ if ($_POST) {
 	$reqdfields = explode(" ", "domain ip");
 	$reqdfieldsn = array(gettext("Domain"),gettext("IP address"));
 	
-	do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+	do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 	
 	if (($_POST['host'] && !is_hostname($_POST['host']))) 
 		$input_errors[] = gettext("The hostname can only contain the characters A-Z, 0-9 and '-'.");
@@ -119,7 +119,7 @@ if ($_POST) {
 		$aliasreqdfieldsn = array(gettext("Alias Domain"));
 
 		var_dump(array('fields' => $aliasreqdfields, 'names' => $aliasreqdfieldsn, 'alias' => $alias));
-		do_input_validation($_POST, $aliasreqdfields, $aliasreqdfieldsn, $input_errors);
+		do_input_validation($_POST, $aliasreqdfields, $aliasreqdfieldsn, &$input_errors);
 		if (($alias['host'] && !is_hostname($alias['host']))) {
 			$input_errors[] = gettext("Hostnames in alias list can only contain the characters A-Z, 0-9 and '-'.");
 		}
diff --git a/usr/local/www/services_dyndns.php b/usr/local/www/services_dyndns.php
index 0852071..6705406 100755
--- a/usr/local/www/services_dyndns.php
+++ b/usr/local/www/services_dyndns.php
@@ -26,7 +26,7 @@
 	POSSIBILITY OF SUCH DAMAGE.
 */
 /*
-	pfSense_BUILDER_BINARIES:	/usr/bin/host
+	pfSense_BUILDER_BINARIES:	/usr/bin/host	
 	pfSense_MODULE:	dyndns
 */
 
@@ -118,7 +118,7 @@ include("head.inc");
 		  <?php
 			$types = explode(",", DYNDNS_PROVIDER_DESCRIPTIONS);
 			$vals = explode(" ", DYNDNS_PROVIDER_VALUES);
-			for ($j = 0; $j < count($vals); $j++)
+			for ($j = 0; $j < count($vals); $j++) 
 				if ($vals[$j] == $dyndns['type']) {
 					if (!isset($dyndns['enable']))
 						echo "<span class=\"gray\">".htmlspecialchars($types[$j])."</span>";
@@ -144,9 +144,9 @@ include("head.inc");
 				$ipaddr = dyndnsCheckIP($dyndns['interface']);
 				$cached_ip_s = explode(":", file_get_contents($filename));
 				$cached_ip = $cached_ip_s[0];
-				if ($ipaddr <> $cached_ip)
+				if ($ipaddr <> $cached_ip) 
 					echo "<font color='red'>";
-				else
+				else 
 					echo "<font color='green'>";
 				echo htmlspecialchars($cached_ip);
 				echo "</font>";
@@ -154,9 +154,9 @@ include("head.inc");
 				$ipv6addr = get_interface_ipv6($dyndns['interface']);
 				$cached_ipv6_s = explode("|", file_get_contents($filename_v6));
 				$cached_ipv6 = $cached_ipv6_s[0];
-				if ($ipv6addr <> $cached_ipv6)
+				if ($ipv6addr <> $cached_ipv6) 
 					echo "<font color='red'>";
-				else
+				else 
 					echo "<font color='green'>";
 				echo htmlspecialchars($cached_ipv6);
 				echo "</font>";
@@ -184,7 +184,7 @@ include("head.inc");
 		  <td class="list"> <a href="services_dyndns_edit.php"><img src="./themes/<?= $g['theme']; ?>/images/icons/icon_plus.gif" width="17" height="17" border="0"></a></td>
 		</tr>
 		<tr>
-		  <td colspan="5" class="list"><p class="vexpl"><span class="red"><strong>
+		  <td colspan="3" class="list"><p class="vexpl"><span class="red"><strong>
 			<?=gettext("Note:");?><br>
 			</strong></span>
 			<?=gettext("IP addresses appearing in green are up to date with Dynamic DNS provider.");?><br>
diff --git a/usr/local/www/services_dyndns_edit.php b/usr/local/www/services_dyndns_edit.php
index 67da1ad..09f9e6b 100644
--- a/usr/local/www/services_dyndns_edit.php
+++ b/usr/local/www/services_dyndns_edit.php
@@ -70,8 +70,6 @@ if (isset($id) && isset($a_dyndns[$id])) {
 	$pconfig['interface'] = $a_dyndns[$id]['interface'];
 	$pconfig['wildcard'] = isset($a_dyndns[$id]['wildcard']);
 	$pconfig['verboselog'] = isset($a_dyndns[$id]['verboselog']);
-	$pconfig['curl_ipresolve_v4'] = isset($a_dyndns[$id]['curl_ipresolve_v4']);
-	$pconfig['curl_ssl_verifypeer'] = isset($a_dyndns[$id]['curl_ssl_verifypeer']);
 	$pconfig['zoneid'] = $a_dyndns[$id]['zoneid'];
 	$pconfig['ttl'] = $a_dyndns[$id]['ttl'];
 	$pconfig['updateurl'] = $a_dyndns[$id]['updateurl'];
@@ -105,7 +103,7 @@ if ($_POST) {
 		$reqdfieldsn[] = gettext("Update URL");
  	}
 
-	do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+	do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 
 	if (($_POST['host'] && !is_domain($_POST['host'])))
 		$input_errors[] = gettext("The Hostname contains invalid characters.");
@@ -123,8 +121,6 @@ if ($_POST) {
 		$dyndns['mx'] = $_POST['mx'];
 		$dyndns['wildcard'] = $_POST['wildcard'] ? true : false;
 		$dyndns['verboselog'] = $_POST['verboselog'] ? true : false;
-		$dyndns['curl_ipresolve_v4'] = $_POST['curl_ipresolve_v4'] ? true : false;
-		$dyndns['curl_ssl_verifypeer'] = $_POST['curl_ssl_verifypeer'] ? true : false;
 		/* In this place enable means disabled */
 		if ($_POST['enable'])
 			unset($dyndns['enable']);
@@ -182,7 +178,6 @@ function _onTypeChange(type){
 			document.getElementById("_resulttr").style.display = '';
 			document.getElementById("_urltr").style.display = '';
 			document.getElementById("_requestiftr").style.display = '';
-			document.getElementById("_curloptions").style.display = '';
 			document.getElementById("_hostnametr").style.display = 'none';
 			document.getElementById("_mxtr").style.display = 'none';
 			document.getElementById("_wildcardtr").style.display = 'none';
@@ -193,7 +188,6 @@ function _onTypeChange(type){
 			document.getElementById("_resulttr").style.display = 'none';
 			document.getElementById("_urltr").style.display = 'none';
 			document.getElementById("_requestiftr").style.display = 'none';
-			document.getElementById("_curloptions").style.display = 'none';
 			document.getElementById("_hostnametr").style.display = '';
 			document.getElementById("_mxtr").style.display = '';
 			document.getElementById("_wildcardtr").style.display = '';
@@ -204,7 +198,6 @@ function _onTypeChange(type){
 			document.getElementById("_resulttr").style.display = 'none';
 			document.getElementById("_urltr").style.display = 'none';
 			document.getElementById("_requestiftr").style.display = 'none';
-			document.getElementById("_curloptions").style.display = 'none';
 			document.getElementById("_hostnametr").style.display = '';
 			document.getElementById("_mxtr").style.display = '';
 			document.getElementById("_wildcardtr").style.display = '';
@@ -254,7 +247,6 @@ function _onTypeChange(type){
 							echo "selected";
 						echo ">{$ifdesc}</option>\n";
 					}
-					unset($iflist);
 					$grouplist = return_gateway_groups_array();
 				   	foreach ($grouplist as $name => $group) {
 						echo "<option value=\"{$name}\"";
@@ -262,34 +254,19 @@ function _onTypeChange(type){
 							echo "selected";
 						echo ">GW Group {$name}</option>\n";
 					}
-					unset($grouplist);
 				?>
 					</select>
 					</td>
 					</td>
 				</tr>	
 				<tr id="_requestiftr">
-					<td width="22%" valign="top" class="vncellreq"><?=gettext("Interface to send update from");?></td>  
-					<td width="78%" class="vtable">
-					<select name="requestif" class="formselect" id="requestif">
-				<?php
-					$iflist = get_configured_interface_with_descr();					
-					foreach ($iflist as $if => $ifdesc) {
-						echo "<option value=\"{$if}\"";
-						if ($pconfig['requestif'] == $if)
-							echo "selected";
-						echo ">{$ifdesc}</option>\n";
-					}
-					unset($iflist);
-					$grouplist = return_gateway_groups_array();
-					foreach ($grouplist as $name => $group) {
-						echo "<option value=\"{$name}\"";
-						if ($pconfig['requestif'] == $name)
-							echo "selected";
-						echo ">GW Group {$name}</option>\n";
-					}
-					unset($grouplist);
-				?>
+				   <td width="22%" valign="top" class="vncellreq"><?=gettext("Interface to send update from");?></td>  
+				   <td width="78%" class="vtable">
+				   <select name="requestif" class="formselect" id="requestif">
+				   <?php $iflist = get_configured_interface_with_descr();
+				   		foreach ($iflist as $if => $ifdesc):?>
+							<option value="<?=$if;?>" <?php if ($pconfig['requestif'] == $if) echo "selected";?>><?=$ifdesc;?></option>
+					<?php endforeach; ?>
 					</select>
 					<br/><?= gettext("Note: This is almost always the same as the Interface to Monitor.");?>
 					</td>
@@ -330,15 +307,6 @@ function _onTypeChange(type){
                     <input name="verboselog" type="checkbox" id="verboselog" value="yes" <?php if ($pconfig['verboselog']) echo "checked"; ?>>
                     <?=gettext("Enable ");?><?=gettext("verbose logging"); ?></td>
 				</tr>
-				<tr id="_curloptions">
-                  <td width="22%" valign="top" class="vncell"><?=gettext("CURL options"); ?></td>
-                  <td width="78%" class="vtable">
-                    <input name="curl_ipresolve_v4" type="checkbox" id="curl_ipresolve_v4" value="yes" <?php if ($pconfig['curl_ipresolve_v4']) echo "checked"; ?>>
-                    <?=gettext("Force IPv4 resolving"); ?><br/>
-					<input name="curl_ssl_verifypeer" type="checkbox" id="curl_ssl_verifypeer" value="yes" <?php if ($pconfig['curl_ssl_verifypeer']) echo "checked"; ?>>
-                    <?=gettext("Verify SSL peer"); ?>
-				  </td>
-				</tr>
                 <tr id="_usernametr">
                   <td width="22%" valign="top" class="vncellreq"><?=gettext("Username");?></td>
                   <td width="78%" class="vtable">
diff --git a/usr/local/www/services_igmpproxy_edit.php b/usr/local/www/services_igmpproxy_edit.php
index 92fb71b..78ef6ab 100755
--- a/usr/local/www/services_igmpproxy_edit.php
+++ b/usr/local/www/services_igmpproxy_edit.php
@@ -37,9 +37,9 @@
 */
 
 ##|+PRIV
-##|*IDENT=page-services-igmpproxy-edit
+##|*IDENT=page-services-igmpproxy
 ##|*NAME=Firewall: Igmpproxy: Edit page
-##|*DESCR=Allow access to the 'Services: Igmpproxy: Edit' page.
+##|*DESCR=Allow access to the 'Firewall: Igmpproxy' page.
 ##|*MATCH=services_igmpproxy_edit.php*
 ##|-PRIV
 
diff --git a/usr/local/www/services_rfc2136_edit.php b/usr/local/www/services_rfc2136_edit.php
index d2bf4a3..965940f 100644
--- a/usr/local/www/services_rfc2136_edit.php
+++ b/usr/local/www/services_rfc2136_edit.php
@@ -71,7 +71,7 @@ if ($_POST) {
 	$reqdfields = array_merge($reqdfields, explode(" ", "host ttl keyname keydata"));
 	$reqdfieldsn = array_merge($reqdfieldsn, array(gettext("Hostname"), gettext("TTL"), gettext("Key name"), gettext("Key")));
 
-	do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+	do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 
 	if (($_POST['host'] && !is_domain($_POST['host'])))  
 		$input_errors[] = gettext("The DNS update host name contains invalid characters.");
diff --git a/usr/local/www/services_snmp.php b/usr/local/www/services_snmp.php
index 32e3baa..6e50a86 100755
--- a/usr/local/www/services_snmp.php
+++ b/usr/local/www/services_snmp.php
@@ -94,11 +94,11 @@ if ($_POST) {
 
 		$reqdfields = explode(" ", "rocommunity");
 		$reqdfieldsn = array(gettext("Community"));
-		do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+		do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 
 		$reqdfields = explode(" ", "pollport");
 		$reqdfieldsn = array(gettext("Polling Port"));
-		do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+		do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 		
 	
 	}
@@ -108,15 +108,15 @@ if ($_POST) {
 
 		$reqdfields = explode(" ", "trapserver");
 		$reqdfieldsn = array(gettext("Trap server"));
-		do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+		do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 
 		$reqdfields = explode(" ", "trapserverport");
 		$reqdfieldsn = array(gettext("Trap server port"));
-		do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+		do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 
 		$reqdfields = explode(" ", "trapstring");
 		$reqdfieldsn = array(gettext("Trap string"));
-		do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+		do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 	}
 
 
@@ -124,7 +124,7 @@ if ($_POST) {
 	if ($_POST['rwenable']) {
                $reqdfields = explode(" ", "rwcommunity");
                $reqdfieldsn = explode(",", "Write community string");
-               do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+               do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 	}
 */
 
diff --git a/usr/local/www/services_wol_edit.php b/usr/local/www/services_wol_edit.php
index c829631..ca31048 100755
--- a/usr/local/www/services_wol_edit.php
+++ b/usr/local/www/services_wol_edit.php
@@ -81,7 +81,7 @@ if ($_POST) {
 	$reqdfields = explode(" ", "interface mac");
 	$reqdfieldsn = array(gettext("Interface"),gettext("MAC address"));
 	
-	do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+	do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 
         /* normalize MAC addresses - lowercase and convert Windows-ized hyphenated MACs to colon delimited */
         $_POST['mac'] = strtolower(str_replace("-", ":", $_POST['mac']));
diff --git a/usr/local/www/status.php b/usr/local/www/status.php
index 4459207..a4906cf 100755
--- a/usr/local/www/status.php
+++ b/usr/local/www/status.php
@@ -138,12 +138,10 @@ defCmdT("top | head -n5", "/usr/bin/top | /usr/bin/head -n5");
 
 defCmdT("sysctl hw.physmem","/sbin/sysctl hw.physmem");
 
-if (isset($config['captiveportal']) && is_array($config['captiveportal'])) {
-	foreach ($config['captiveportal'] as $cpZone => $cpdata) {
+if (isset($config['captiveportal']) && is_array($config['captiveportal']))
+	foreach ($config['captiveportal'] as $cpZone => $cpdata)
 		if (isset($cpdata['enable']))
-			defCmdT("ipfw -x {$cpdata['zoneid']} show", "/sbin/ipfw -x {$cpdata['zoneid']} show");
-	}
-}
+			defCmdT("ipfw -x {$cpZone} show", "/sbin/ipfw -x {$cpZone} show");
 
 defCmdT("pfctl -sn", "/sbin/pfctl -sn");
 defCmdT("pfctl -sr", "/sbin/pfctl -sr");
diff --git a/usr/local/www/status_captiveportal.php b/usr/local/www/status_captiveportal.php
index d84e9b2..2325b3c 100755
--- a/usr/local/www/status_captiveportal.php
+++ b/usr/local/www/status_captiveportal.php
@@ -172,7 +172,7 @@ $mac_man = load_mac_manufacturer_table();
     <td class="listr"><?=$cpent[4];?>&nbsp;</td>
     <td class="listr"><?=htmlspecialchars(date("m/d/Y H:i:s", $cpent[0]));?></td>
 	<?php if ($_GET['showact']):
-	$last_act = captiveportal_get_last_activity($cpent[2], $cpent[3]); ?>
+	$last_act = captiveportal_get_last_activity($cpent[2]); ?>
     <td class="listr"><?php if ($last_act != 0) echo htmlspecialchars(date("m/d/Y H:i:s", $last_act));?></td>
 	<?php endif; ?>
 	<td valign="middle" class="list" nowrap>
diff --git a/usr/local/www/status_dhcp_leases.php b/usr/local/www/status_dhcp_leases.php
index b7624d8..6c2dc69 100755
--- a/usr/local/www/status_dhcp_leases.php
+++ b/usr/local/www/status_dhcp_leases.php
@@ -99,16 +99,22 @@ function leasecmp($a, $b) {
 function adjust_gmt($dt) {
 	global $config; 
 	$dhcpd = $config['dhcpd'];
-	foreach ($dhcpd as $dhcpditem) {
-		$dhcpleaseinlocaltime = $dhcpditem['dhcpleaseinlocaltime'];
+	foreach ($dhcpd as $dhcpleaseinlocaltime) {
+		$dhcpleaseinlocaltime = $dhcpleaseinlocaltime['dhcpleaseinlocaltime'];
 		if ($dhcpleaseinlocaltime == "yes") 
 			break;
 	}
+	$timezone = $config['system']['timezone'];
+	$ts = strtotime($dt . " GMT");
 	if ($dhcpleaseinlocaltime == "yes") {
-		$ts = strtotime($dt . " GMT");
+		$this_tz = new DateTimeZone($timezone); 
+		$dhcp_lt = new DateTime(strftime("%I:%M:%S%p", $ts), $this_tz); 
+		$offset = $this_tz->getOffset($dhcp_lt);
+		$ts = $ts + $offset;
 		return strftime("%Y/%m/%d %I:%M:%S%p", $ts);
-	} else
-		return $dt;
+	}
+	else
+		return strftime("%Y/%m/%d %H:%M:%S", $ts);
 }
 
 function remove_duplicate($array, $field)
@@ -131,14 +137,15 @@ $splitpattern = "'BEGIN { RS=\"}\";} {for (i=1; i<=NF; i++) printf \"%s \", \$i;
 exec("/bin/cat {$leasesfile} | {$awk} {$cleanpattern} | {$awk} {$splitpattern}", $leases_content);
 $leases_count = count($leases_content);
 exec("/usr/sbin/arp -an", $rawdata);
-$arpdata_ip = array();
-$arpdata_mac = array();
+$arpdata = array();
 foreach ($rawdata as $line) {
 	$elements = explode(' ',$line);
 	if ($elements[3] != "(incomplete)") {
 		$arpent = array();
-		$arpdata_ip[] = trim(str_replace(array('(',')'),'',$elements[1]));
-		$arpdata_mac[] = strtolower(trim($elements[3]));
+		$arpent['ip'] = trim(str_replace(array('(',')'),'',$elements[1]));
+		// $arpent['mac'] = trim($elements[3]);
+		// $arpent['interface'] = trim($elements[5]);
+	$arpdata[] = $arpent['ip'];
 	}
 }
 unset($rawdata);
@@ -228,7 +235,7 @@ foreach($leases_content as $lease) {
 			case "hardware":
 				$leases[$l]['mac'] = $data[$f+2];
 				/* check if it's online and the lease is active */
-				if (in_array($leases[$l]['ip'], $arpdata_ip)) {
+				if (in_array($leases[$l]['ip'], $arpdata)) {
 					$leases[$l]['online'] = 'online';
 				} else {
 					$leases[$l]['online'] = 'offline';
@@ -282,7 +289,12 @@ foreach($config['interfaces'] as $ifname => $ifarr) {
 			$slease['end'] = "";
 			$slease['hostname'] = htmlentities($static['hostname']);
 			$slease['act'] = "static";
-			$slease['online'] = in_array(strtolower($slease['mac']), $arpdata_mac) ? 'online' : 'offline';
+			$online = exec("/usr/sbin/arp -an |/usr/bin/grep {$slease['mac']}| /usr/bin/wc -l|/usr/bin/awk '{print $1;}'");
+			if ($online == 1) {
+				$slease['online'] = 'online';
+			} else {
+				$slease['online'] = 'offline';
+			}
 			$leases[] = $slease;
 		}
 	}
diff --git a/usr/local/www/status_gateways.php b/usr/local/www/status_gateways.php
index ffe1458..e7154a8 100755
--- a/usr/local/www/status_gateways.php
+++ b/usr/local/www/status_gateways.php
@@ -115,10 +115,7 @@ include("head.inc");
                         <?php
 				if ($gateways_status[$gname]) {
 					$status = $gateways_status[$gname];
-					if (stristr($status['status'], "force_down")) {
-						$online = gettext("Offline (forced)");
-						$bgcolor = "#F08080";  // lightcoral
-					} elseif (stristr($status['status'], "down")) {
+					if (stristr($status['status'], "down")) {
 						$online = gettext("Offline");
 						$bgcolor = "#F08080";  // lightcoral
 					} elseif (stristr($status['status'], "loss")) {
diff --git a/usr/local/www/status_interfaces.php b/usr/local/www/status_interfaces.php
index cd71c1b..0ab83b1 100755
--- a/usr/local/www/status_interfaces.php
+++ b/usr/local/www/status_interfaces.php
@@ -81,7 +81,7 @@ include("head.inc");
 <?php endif; ?>
 	<tr>
 		<td colspan="2" class="listtopic">
-			<?=htmlspecialchars($ifname);?> <?=gettext("interface"); ?> (<?=htmlspecialchars($ifdescr);?>, <?=htmlspecialchars($ifinfo['hwif']);?>)
+			<?=htmlspecialchars($ifname);?> <?=gettext("interface"); ?> (<?=htmlspecialchars($ifinfo['hwif']);?>)
 		</td>
 	</tr>
 	<tr>
diff --git a/usr/local/www/status_lb_vs.php b/usr/local/www/status_lb_vs.php
index c389287..cb1ce0d 100755
--- a/usr/local/www/status_lb_vs.php
+++ b/usr/local/www/status_lb_vs.php
@@ -93,7 +93,7 @@ include("head.inc");
 			<table border="0" cellpadding="0" cellspacing="2">
                         <?php
 			foreach ($a_pool as $vipent) {
-				if ($vipent['name'] == $vsent['poolname']) {
+				if ($vipent['name'] == $vsent['pool']) {
 					foreach ((array) $vipent['servers'] as $server) {
 						print "<tr><td> {$server} </td></tr>";
 					}
diff --git a/usr/local/www/status_ntpd.php b/usr/local/www/status_ntpd.php
index f7292c7..30cf18e 100644
--- a/usr/local/www/status_ntpd.php
+++ b/usr/local/www/status_ntpd.php
@@ -29,7 +29,7 @@
 	POSSIBILITY OF SUCH DAMAGE.
 */
 /*
-	pfSense_BUILDER_BINARIES:	/usr/local/sbin/ntpd	/usr/local/sbin/ntpq
+	pfSense_BUILDER_BINARIES:	/usr/local/bin/ntpd	/usr/local/bin/ntpq
 	pfSense_MODULE:	ntpd
 */
 
@@ -42,7 +42,7 @@
 
 require_once("guiconfig.inc");
 
-exec("/usr/local/sbin/ntpq -pn | /usr/bin/tail +3", $ntpq_output);
+exec("/usr/local/bin/ntpq -pn | /usr/bin/tail +3", $ntpq_output);
 
 $ntpq_servers = array();
 foreach ($ntpq_output as $line) {
@@ -92,7 +92,7 @@ foreach ($ntpq_output as $line) {
 	$ntpq_servers[] = $server;
 }
 
-exec("/usr/local/sbin/ntpq -c clockvar", $ntpq_clockvar_output);
+exec("/usr/local/bin/ntpq -c clockvar", $ntpq_clockvar_output);
 foreach ($ntpq_clockvar_output as $line) {
 	if (substr($line, 0, 9) == "timecode=") {
 		$tmp = explode('"', $line);
diff --git a/usr/local/www/status_openvpn.php b/usr/local/www/status_openvpn.php
index 4956821..1e5f806 100644
--- a/usr/local/www/status_openvpn.php
+++ b/usr/local/www/status_openvpn.php
@@ -49,7 +49,6 @@ $shortcut_section = "openvpn";
 require("guiconfig.inc");
 require_once("openvpn.inc");
 require_once("shortcuts.inc");
-require_once("service-utils.inc");
 
 /* Handle AJAX */
 if($_GET['action']) {
@@ -268,55 +267,53 @@ include("head.inc"); ?>
 		</td>
 	</tr>
 	<tr>
-		<td>
-			<table style="padding-top:0px; padding-bottom:0px; padding-left:0px; padding-right:0px" class="tabcont sortable" width="100%" border="0" cellpadding="0" cellspacing="0">
-			<tr>
-				<td class="listhdrr"><?=gettext("Name"); ?></td>
-				<td class="listhdrr"><?=gettext("Status"); ?></td>
-				<td class="listhdrr"><?=gettext("Connected Since"); ?></td>
-				<td class="listhdrr"><?=gettext("Virtual Addr"); ?></td>
-				<td class="listhdrr"><?=gettext("Remote Host"); ?></td>
-				<td class="listhdrr"><?=gettext("Bytes Sent"); ?></td>
-				<td class="listhdrr"><?=gettext("Bytes Rcvd"); ?></td>
-				<td class="listhdrr"><?=gettext("Service"); ?></td>
-			</tr>
+		<table style="padding-top:0px; padding-bottom:0px; padding-left:0px; padding-right:0px" class="tabcont sortable" width="100%" border="0" cellpadding="0" cellspacing="0">
+		<tr>
+			<td class="listhdrr"><?=gettext("Name"); ?></td>
+			<td class="listhdrr"><?=gettext("Status"); ?></td>
+			<td class="listhdrr"><?=gettext("Connected Since"); ?></td>
+			<td class="listhdrr"><?=gettext("Virtual Addr"); ?></td>
+			<td class="listhdrr"><?=gettext("Remote Host"); ?></td>
+			<td class="listhdrr"><?=gettext("Bytes Sent"); ?></td>
+			<td class="listhdrr"><?=gettext("Bytes Rcvd"); ?></td>
+			<td class="listhdrr"><?=gettext("Service"); ?></td>
+		</tr>
 
 <?php foreach ($sk_servers as $sk_server): ?>
-			<tr name='<?php echo "r:{$sk_server['port']}:{$sk_server['vpnid']}"; ?>'>
-				<td class="listlr">
-					<?=$sk_server['name'];?>
-				</td>
-				<td class="listr">
-					<?=$sk_server['status'];?>
-				</td>
-				<td class="listr">
-					<?=$sk_server['connect_time'];?>
-				</td>
-				<td class="listr">
-					<?=$sk_server['virtual_addr'];?>
-				</td>
-				<td class="listr">
-					<?=$sk_server['remote_host'];?>
-				</td>
-				<td class="listr">
-					<?=$sk_server['bytes_sent'];?>
-				</td>
-				<td class="listr">
-					<?=$sk_server['bytes_recv'];?>
-				</td>
-				<td class="listr">
-				<table>
-				<tr>
-				<?php $ssvc = find_service_by_openvpn_vpnid($sk_server['vpnid']); ?>
-				<?= get_service_status_icon($ssvc, false, true); ?>
-				<td><?= get_service_control_links($ssvc, true); ?></td>
-				</tr>
-				</table>
-				</td>
+		<tr name='<?php echo "r:{$client['port']}:{$conn['remote_host']}"; ?>'>
+			<td class="listlr">
+				<?=$sk_server['name'];?>
+			</td>
+			<td class="listlr">
+				<?=$sk_server['status'];?>
+			</td>
+			<td class="listr">
+				<?=$sk_server['connect_time'];?>
+			</td>
+			<td class="listr">
+				<?=$sk_server['virtual_addr'];?>
+			</td>
+			<td class="listr">
+				<?=$sk_server['remote_host'];?>
+			</td>
+			<td class="listr">
+				<?=$sk_server['bytes_sent'];?>
+			</td>
+			<td class="listr">
+				<?=$sk_server['bytes_recv'];?>
+			</td>
+			<td class="listr">
+			<table>
+			<tr>
+			<?php $ssvc = find_service_by_openvpn_vpnid($sk_server['vpnid']); ?>
+			<?= get_service_status_icon($ssvc, false, true); ?>
+			<td><?= get_service_control_links($ssvc, true); ?></td>
 			</tr>
-<?php endforeach; ?>
 			</table>
-		</td>
+			</td>
+		</tr>
+<?php endforeach; ?>
+		</table>
 	</tr>
 </table>
 
@@ -331,55 +328,53 @@ include("head.inc"); ?>
 		</td>
 	</tr>
 	<tr>
-		<td>
-			<table style="padding-top:0px; padding-bottom:0px; padding-left:0px; padding-right:0px" class="tabcont sortable" width="100%" border="0" cellpadding="0" cellspacing="0">
-			<tr>
-				<td class="listhdrr"><?=gettext("Name"); ?></td>
-				<td class="listhdrr"><?=gettext("Status"); ?></td>
-				<td class="listhdrr"><?=gettext("Connected Since"); ?></td>
-				<td class="listhdrr"><?=gettext("Virtual Addr"); ?></td>
-				<td class="listhdrr"><?=gettext("Remote Host"); ?></td>
-				<td class="listhdrr"><?=gettext("Bytes Sent"); ?></td>
-				<td class="listhdrr"><?=gettext("Bytes Rcvd"); ?></td>
-				<td class="listhdrr"><?=gettext("Service"); ?></td>
-			</tr>
+		<table style="padding-top:0px; padding-bottom:0px; padding-left:0px; padding-right:0px" class="tabcont sortable" width="100%" border="0" cellpadding="0" cellspacing="0">
+		<tr>
+			<td class="listhdrr"><?=gettext("Name"); ?></td>
+			<td class="listhdrr"><?=gettext("Status"); ?></td>
+			<td class="listhdrr"><?=gettext("Connected Since"); ?></td>
+			<td class="listhdrr"><?=gettext("Virtual Addr"); ?></td>
+			<td class="listhdrr"><?=gettext("Remote Host"); ?></td>
+			<td class="listhdrr"><?=gettext("Bytes Sent"); ?></td>
+			<td class="listhdrr"><?=gettext("Bytes Rcvd"); ?></td>
+			<td class="listhdrr"><?=gettext("Service"); ?></td>
+		</tr>
 
 <?php foreach ($clients as $client): ?>
-			<tr name='<?php echo "r:{$client['port']}:{$client['vpnid']}"; ?>'>
-				<td class="listlr">
-					<?=$client['name'];?>
-				</td>
-				<td class="listr">
-					<?=$client['status'];?>
-				</td>
-				<td class="listr">
-					<?=$client['connect_time'];?>
-				</td>
-				<td class="listr">
-					<?=$client['virtual_addr'];?>
-				</td>
-				<td class="listr">
-					<?=$client['remote_host'];?>
-				</td>
-				<td class="listr">
-					<?=$client['bytes_sent'];?>
-				</td>
-				<td class="listr">
-					<?=$client['bytes_recv'];?>
-				</td>
-				<td class="listr" height="12">
-				<table>
-				<tr>
-				<?php $ssvc = find_service_by_openvpn_vpnid($client['vpnid']); ?>
-				<?= get_service_status_icon($ssvc, false, true); ?>
-				<td><?= get_service_control_links($ssvc, true); ?></td>
-				</tr>
-				</table>
-				</td>
+		<tr name='<?php echo "r:{$client['port']}:{$conn['remote_host']}"; ?>'>
+			<td class="listlr">
+				<?=$client['name'];?>
+			</td>
+			<td class="listlr">
+				<?=$client['status'];?>
+			</td>
+			<td class="listr">
+				<?=$client['connect_time'];?>
+			</td>
+			<td class="listr">
+				<?=$client['virtual_addr'];?>
+			</td>
+			<td class="listr">
+				<?=$client['remote_host'];?>
+			</td>
+			<td class="listr">
+				<?=$client['bytes_sent'];?>
+			</td>
+			<td class="listr">
+				<?=$client['bytes_recv'];?>
+			</td>
+			<td class="listr" height="12">
+			<table>
+			<tr>
+			<?php $ssvc = find_service_by_openvpn_vpnid($client['vpnid']); ?>
+			<?= get_service_status_icon($ssvc, false, true); ?>
+			<td><?= get_service_control_links($ssvc, true); ?></td>
 			</tr>
-<?php endforeach; ?>
 			</table>
-		</td>
+			</td>
+		</tr>
+<?php endforeach; ?>
+		</table>
 	</tr>
 </table>
 
diff --git a/usr/local/www/status_rrd_graph.php b/usr/local/www/status_rrd_graph.php
index e920535..6f747d3 100755
--- a/usr/local/www/status_rrd_graph.php
+++ b/usr/local/www/status_rrd_graph.php
@@ -281,7 +281,6 @@ include("head.inc");
 	<?php } ?>
 	<script type="text/javascript" src="/javascript/jquery-ui-timepicker-addon/js/jquery-ui-timepicker-addon.js"></script>
 	<script type="text/javascript">
-	//<![CDATA[
 		jQuery(function ($) {
 			var options = {
 				dateFormat: 'mm/dd/yy',
@@ -291,8 +290,8 @@ include("head.inc");
 			$("#startDateTime").datetimepicker(options);
 			$("#endDateTime").datetimepicker(options);
 		});
-	//]]>
 	</script>
+	</head>
 <?php } ?>
 
 <?php
@@ -389,15 +388,14 @@ function get_dates($curperiod, $graph) {
 }
 
 ?>
-</head>
 <body link="#0000CC" vlink="#0000CC" alink="#0000CC">
 <?php include("fbegin.inc"); ?>
 <?php if ($input_errors && count($input_errors)) { print_input_errors($input_errors); } ?>
-<form name="form1" action="status_rrd_graph.php" method="get">
-<table width="100%" border="0" cellpadding="0" cellspacing="0" summary="rrd graphs">
+<table width="100%" border="0" cellpadding="0" cellspacing="0">
         <tr>
                 <td>
-			<input type="hidden" name="cat" value="<?php echo "$curcat"; ?>" />
+			<form name="form1" action="status_rrd_graph.php" method="get">
+			<input type="hidden" name="cat" value="<?php echo "$curcat"; ?>">
 			<?php
 			        $tab_array = array();
 				if($curcat == "system") { $tabactive = True; } else { $tabactive = False; }
@@ -448,16 +446,13 @@ function get_dates($curperiod, $graph) {
         <tr>
                 <td>
                         <div id="mainarea">
-                        <table class="tabcont" width="100%" border="0" cellspacing="0" cellpadding="0" summary="main area">
+                        <table class="tabcont" width="100%" border="0" cellspacing="0" cellpadding="0">
                                 <tr>
                                         <td colspan="2" class="list"><p><b><?=gettext("Note: Change of color and/or style may not take effect until the next refresh");?></b></p></td>
 				</tr>
 				<tr>
                                         <td colspan="2" class="list">
 					<?=gettext("Graphs:");?>
-					<?php if (!empty($curzone)): ?>
-					<input type="hidden" name="zone" value="<?= htmlspecialchars($curzone) ?>" />
-					<?php endif; ?>
 					<select name="option" class="formselect" style="z-index: -10;" onchange="document.form1.submit()">
 					<?php
 
@@ -469,7 +464,7 @@ function get_dates($curperiod, $graph) {
 							echo "<option value=\"{$database}\"";
 							$prettyprint = ucwords(str_replace($search, $replace, $database));
 							if($curoption == $database) {
-								echo " selected=\"selected\"";
+								echo " selected";
 							}
 							echo ">" . htmlspecialchars($prettyprint) . "</option>\n";
 						}
@@ -509,7 +504,7 @@ function get_dates($curperiod, $graph) {
 								$prettyprint = ucwords(str_replace($search, $replace, $friendly));
 						}
 						if($curoption == $optionc) {
-							echo " selected=\"selected\"";
+							echo " selected";
 						}
 						echo ">" . htmlspecialchars($prettyprint) . "</option>\n";
 					}
@@ -522,7 +517,7 @@ function get_dates($curperiod, $graph) {
 					<?php
 					foreach ($styles as $style => $styled) {
 						echo "<option value=\"$style\"";
-						if ($style == $curstyle) echo " selected=\"selected\"";
+						if ($style == $curstyle) echo " selected";
 						echo ">" . htmlspecialchars($styled) . "</option>\n";
 					}
 					?>
@@ -536,13 +531,12 @@ function get_dates($curperiod, $graph) {
 						<?php
 						foreach ($periods as $period => $value) {
 							echo "<option value=\"$period\"";
-							if ($period == $curperiod) echo " selected=\"selected\"";
+							if ($period == $curperiod) echo " selected";
 							echo ">" . htmlspecialchars($value) . "</option>\n";
 						}
-						echo "</select>\n";
-						echo "</td></tr>\n";
 					}
 					?>
+					</select>
 					<?php
 
 					if($curcat == "custom") {
@@ -552,11 +546,10 @@ function get_dates($curperiod, $graph) {
 						$end_fmt   = strftime("%m/%d/%Y %H:%M:%S", $end);
 						?>
 						<?=gettext("Start:");?>
-						<input id="startDateTime" title="<?= htmlentities($tz_msg); ?>." type="text" name="start" class="formfldunknown" size="24" value="<?= htmlentities($start_fmt); ?>" />
+						<input id="startDateTime" title="<?= htmlentities($tz_msg); ?>." type="text" name="start" class="formfldunknown" size="24" length="32" value="<?= htmlentities($start_fmt); ?>">
 						<?=gettext("End:");?>
-						<input id="endDateTime" title="<?= htmlentities($tz_msg); ?>." type="text" name="end" class="formfldunknown" size="24" value="<?= htmlentities($end_fmt); ?>" />
-						<input type="submit" name="Submit" value="<?=gettext("Go"); ?>" />
-						</td></tr>
+						<input id="endDateTime" title="<?= htmlentities($tz_msg); ?>." type="text" name="end" class="formfldunknown" size="24" length="32" value="<?= htmlentities($end_fmt); ?>">
+						<input type="submit" name="Submit" value="<?=gettext("Go"); ?>">
 						<?php
 						$curdatabase = $curoption;
 						$graph = "custom-$curdatabase";
@@ -564,11 +557,11 @@ function get_dates($curperiod, $graph) {
 							$id = "{$graph}-{$curoption}-{$curdatabase}";
 							$id = preg_replace('/\./', '_', $id);
 
-							echo "<tr><td colspan=\"2\" class=\"list\">\n";
-							echo "<img border=\"0\" name=\"{$id}\" ";
-							echo "id=\"{$id}\" alt=\"$prettydb Graph\" ";
-							echo "src=\"status_rrd_graph_img.php?start={$start}&amp;end={$end}&amp;database={$curdatabase}&amp;style={$curstyle}&amp;graph={$graph}\" />\n";
-							echo "<br /><hr /><br />\n";
+							echo "<tr><td colspan=2 class=\"list\">\n";
+							echo "<IMG BORDER='0' name='{$id}' ";
+							echo "id='{$id}' ALT=\"$prettydb Graph\" ";
+							echo "SRC=\"status_rrd_graph_img.php?start={$start}&amp;end={$end}&amp;database={$curdatabase}&amp;style={$curstyle}&amp;graph={$graph}\" />\n";
+							echo "<br /><hr><br />\n";								
 							echo "</td></tr>\n";
 						}
 					} else {
@@ -633,21 +626,22 @@ function get_dates($curperiod, $graph) {
 									$dates = get_dates($curperiod, $graph);
 									$start = $dates['start'];
 									$end = $dates['end'];
-									echo "<tr><td colspan=\"2\" class=\"list\">\n";
-									echo "<img border=\"0\" name=\"{$id}\" ";
-									echo "id=\"{$id}\" alt=\"$prettydb Graph\" ";
-									echo "src=\"status_rrd_graph_img.php?start={$start}&amp;end={$end}&amp;database={$curdatabase}&amp;style={$curstyle}&amp;graph={$graph}\" />\n";
-									echo "<br /><hr /><br />\n";
+									echo "<tr><td colspan=2 class=\"list\">\n";
+									echo "<IMG BORDER='0' name='{$id}' ";
+									echo "id='{$id}' ALT=\"$prettydb Graph\" ";
+									echo "SRC=\"status_rrd_graph_img.php?start={$start}&amp;end={$end}&amp;database={$curdatabase}&amp;style={$curstyle}&amp;graph={$graph}\" />\n";
+									echo "<br /><hr><br />\n";								
 									echo "</td></tr>\n";
 								}
 							}
 						}
 					}
 					?>
+					</td>
+				</tr>
 				<tr>
-					<td colspan="2" class="list">
-					<script type="text/javascript">
-					//<![CDATA[
+					<td colspan=2 class="list">
+					<script language="javascript">
 						function update_graph_images() {
 							//alert('updating');
 							var randomid = Math.floor(Math.random()*11);
@@ -719,8 +713,8 @@ function get_dates($curperiod, $graph) {
 							window.setTimeout('update_graph_images()', 355000);
 						}
 						window.setTimeout('update_graph_images()', 355000);
-					//]]>
 					</script>
+					</form>
 					</td>
 				</tr>
 			</table>
@@ -728,7 +722,7 @@ function get_dates($curperiod, $graph) {
 		</td>
 	</tr>
 </table>
-</form>
+
 <?php include("fend.inc"); ?>
 </body>
 </html>
diff --git a/usr/local/www/status_rrd_graph_settings.php b/usr/local/www/status_rrd_graph_settings.php
index 032c41a..6a30cc4 100755
--- a/usr/local/www/status_rrd_graph_settings.php
+++ b/usr/local/www/status_rrd_graph_settings.php
@@ -120,7 +120,7 @@ include("head.inc");
 <?php if ($input_errors) print_input_errors($input_errors); ?>
 <?php if ($savemsg) print_info_box($savemsg); ?>
 <form action="status_rrd_graph_settings.php" method="post" name="iform" id="iform">
-<table width="100%" border="0" cellpadding="0" cellspacing="0" summary="rrd graph settings">
+<table width="100%" border="0" cellpadding="0" cellspacing="0">
         <tr>
                 <td>
 			<?php
@@ -167,11 +167,11 @@ include("head.inc");
         <tr>
                 <td>
                         <div id="mainarea">
-                        <table class="tabcont" width="100%" border="0" cellspacing="0" cellpadding="6" summary="main area">
+                        <table class="tabcont" width="100%" border="0" cellspacing="0" cellpadding="6">
 			<tr>
 				<td width="22%" valign="top" class="vtable"><?=gettext("RRD Graphs");?></td>
 				<td width="78%" class="vtable">
-					<input name="enable" type="checkbox" id="enable" value="yes" <?php if ($pconfig['enable']) echo "checked=\"checked\"" ?> onclick="enable_change(false)" />
+					<input name="enable" type="checkbox" id="enable" value="yes" <?php if ($pconfig['enable']) echo "checked" ?> onClick="enable_change(false)">
 					<b><?=gettext("Enables the RRD graphing backend.");?></b>
 				</td>
 			</tr>
@@ -182,7 +182,7 @@ include("head.inc");
 					<?php
 					foreach ($categories as $category => $categoryd) {
 						echo "<option value=\"$category\"";
-						if ($category == $pconfig['category']) echo " selected=\"selected\"";
+						if ($category == $pconfig['category']) echo " selected";
 						echo ">" . htmlspecialchars($categoryd) . "</option>\n";
 					}
 					?>
@@ -197,7 +197,7 @@ include("head.inc");
 					<?php
 					foreach ($styles as $style => $styled) {
 						echo "<option value=\"$style\"";
-						if ($style == $pconfig['style']) echo " selected=\"selected\"";
+						if ($style == $pconfig['style']) echo " selected";
 						echo ">" . htmlspecialchars($styled) . "</option>\n";
 					}
 					?>
@@ -212,7 +212,7 @@ include("head.inc");
 					<?php
 					foreach ($periods as $period => $periodd) {
 						echo "<option value=\"$period\"";
-						if ($period == $pconfig['period']) echo " selected=\"selected\"";
+						if ($period == $pconfig['period']) echo " selected";
 						echo ">" . htmlspecialchars($periodd) . "</option>\n";
 					}
 					?>
@@ -223,18 +223,18 @@ include("head.inc");
 			<tr>
 				<td width="22%" valign="top">&nbsp;</td>
 				<td width="78%">
-					<input name="Submit" type="submit" class="formbtn" value="<?=gettext("Save");?>" onclick="enable_change(true)" />
+					<input name="Submit" type="submit" class="formbtn" value="<?=gettext("Save");?>" onclick="enable_change(true)">
 				</td>
 			</tr>
 			<tr>
 				<td width="22%" valign="top">&nbsp;</td>
 				<td width="78%">
-					<input name="ResetRRD" type="submit" class="formbtn" value="<?=gettext("Reset RRD Data");?>" onclick="return confirm('<?=gettext('Do you really want to reset the RRD graphs? This will erase all graph data.');?>')" />
+					<input name="ResetRRD" type="submit" class="formbtn" value="<?=gettext("Reset RRD Data");?>" onclick="return confirm('<?=gettext('Do you really want to reset the RRD graphs? This will erase all graph data.');?>')">
 				</td>
 			</tr>
 			<tr>
 				<td width="22%" height="53" valign="top">&nbsp;</td>
-				<td width="78%"><strong><span class="red"><?=gettext("Note:");?></span></strong><br/>
+				<td width="78%"><strong><span class="red"><?=gettext("Note:");?></span></strong><br>
 					<?=gettext("Graphs will not be allowed to be recreated within a 1 minute interval, please " .
 					"take this into account after changing the style.");?>
 				</td>
diff --git a/usr/local/www/status_services.php b/usr/local/www/status_services.php
index 48f9db4..1f1fee5 100755
--- a/usr/local/www/status_services.php
+++ b/usr/local/www/status_services.php
@@ -93,16 +93,11 @@ if (count($services) > 0) {
 			continue;
 		if (empty($service['description']))
 			$service['description'] = get_pkg_descr($service['name']);
-		echo "<tr><td class=\"listlr\" width=\"20%\">" . $service['name'] . "</td>\n";
-		echo "<td class=\"listr\" width=\"55%\">" . $service['description'] . "</td>\n";
-		// if service is running then listr else listbg
-		$bgclass = null;
-		if (get_service_status($service))
-			$bgclass = "listr";
-		else
-			$bgclass = "listbg";
-		echo "<td class=\"" . $bgclass . "\" align=\"center\">" . get_service_status_icon($service, true, true) . "</td>\n";
-		echo "<td valign=\"middle\" class=\"list nowrap\">" . get_service_control_links($service);
+		echo '<tr><td class="listlr" width="20%">' . $service['name'] . '</td>' . "\n";
+		echo '<td class="listr" width="55%">' . $service['description'] . '</td>' . "\n";
+		echo get_service_status_icon($service, true, true);
+		echo '<td valign="middle" class="list nowrap">';
+		echo get_service_control_links($service);
 		$scut = get_shortcut_by_service_name($service['name']);
 		if (!empty($scut)) {
 			echo get_shortcut_main_link($scut, true, $service);
@@ -112,7 +107,7 @@ if (count($services) > 0) {
 		echo "</td></tr>\n";
 	}
 } else {
-	echo "<tr><td colspan=\"3\" align=\"center\">" . gettext("No services found") . " . </td></tr>\n";
+	echo "<tr><td colspan=\"3\" align=\"center\">" . gettext("No services found") . ".</td></tr>\n";
 }
 
 ?>
diff --git a/usr/local/www/system.php b/usr/local/www/system.php
index 74159f6..d27637c 100755
--- a/usr/local/www/system.php
+++ b/usr/local/www/system.php
@@ -106,7 +106,7 @@ if ($_POST) {
 	$reqdfields = explode(" ", "hostname domain");
 	$reqdfieldsn = array(gettext("Hostname"),gettext("Domain"));
 
-	do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+	do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 
 	if ($_POST['hostname'] && !is_hostname($_POST['hostname'])) {
 		$input_errors[] = gettext("The hostname may only contain the characters a-z, 0-9 and '-'.");
@@ -155,9 +155,6 @@ if ($_POST) {
 	if (($t < 0) || (($t > 0) && ($t < 6)) || ($t > 1440)) {
 		$input_errors[] = gettext("The time update interval must be either 0 (disabled) or between 6 and 1440.");
 	}
-	# it's easy to have a little too much whitespace in the field, clean it up for the user before processing.
-	$_POST['timeservers'] = preg_replace('/[[:blank:]]+/', ' ', $_POST['timeservers']);
-	$_POST['timeservers'] = trim($_POST['timeservers']);
 	foreach (explode(' ', $_POST['timeservers']) as $ts) {
 		if (!is_domain($ts)) {
 			$input_errors[] = gettext("A NTP Time Server name may only contain the characters a-z, 0-9, '-' and '.'.");
diff --git a/usr/local/www/system_advanced_firewall.php b/usr/local/www/system_advanced_firewall.php
index bdd25bb..7d184e6 100644
--- a/usr/local/www/system_advanced_firewall.php
+++ b/usr/local/www/system_advanced_firewall.php
@@ -40,7 +40,7 @@
 ##|*IDENT=page-system-advanced-firewall
 ##|*NAME=System: Advanced: Firewall and NAT page
 ##|*DESCR=Allow access to the 'System: Advanced: Firewall and NAT' page.
-##|*MATCH=system_advanced_firewall.php*
+##|*MATCH=system_advanced.php*
 ##|-PRIV
 
 require("guiconfig.inc");
@@ -59,7 +59,7 @@ $pconfig['adaptiveend'] = $config['system']['adaptiveend'];
 $pconfig['maximumstates'] = $config['system']['maximumstates'];
 $pconfig['aliasesresolveinterval'] = $config['system']['aliasesresolveinterval'];
 $old_aliasesresolveinterval = $config['system']['aliasesresolveinterval'];
-$pconfig['checkaliasesurlcert'] = isset($config['system']['checkaliasesurlcert']);
+$pconfig['maximumtables'] = $config['system']['maximumtables'];
 $pconfig['maximumtableentries'] = $config['system']['maximumtableentries'];
 $pconfig['disablereplyto'] = isset($config['system']['disablereplyto']);
 $pconfig['disablenegate'] = isset($config['system']['disablenegate']);
@@ -92,6 +92,9 @@ if ($_POST) {
 	if ($_POST['aliasesresolveinterval'] && !is_numericint($_POST['aliasesresolveinterval'])) {
 		$input_errors[] = gettext("The Aliases Hostname Resolve Interval value must be an integer.");
 	}
+	if ($_POST['maximumtables'] && !is_numericint($_POST['maximumtables'])) {
+		$input_errors[] = gettext("The Firewall Maximum Tables value must be an integer.");
+	}
 	if ($_POST['maximumtableentries'] && !is_numericint($_POST['maximumtableentries'])) {
 		$input_errors[] = gettext("The Firewall Maximum Table Entries value must be an integer.");
 	}
@@ -140,14 +143,10 @@ if ($_POST) {
 		else
 			unset($config['system']['adaptivestart']);
 
-		if ($_POST['checkaliasesurlcert'] == "yes")
-			$config['system']['checkaliasesurlcert'] = true;
-		else
-			unset($config['system']['checkaliasesurlcert']);
-
 		$config['system']['optimization'] = $_POST['optimization'];
 		$config['system']['maximumstates'] = $_POST['maximumstates'];
 		$config['system']['aliasesresolveinterval'] = $_POST['aliasesresolveinterval'];
+		$config['system']['maximumtables'] = $_POST['maximumtables'];
 		$config['system']['maximumtableentries'] = $_POST['maximumtableentries'];
 
 		if($_POST['natreflection'] == "proxy") {
@@ -380,6 +379,22 @@ function update_description(itemnum) {
 								</td>
 							</tr>
 							<tr>
+								<td width="22%" valign="top" class="vncell"><?=gettext("Firewall Maximum Tables");?></td>
+								<td width="78%" class="vtable">
+									<input name="maximumtables" type="text" id="maximumtables" value="<?php echo $pconfig['maximumtables']; ?>" />
+									<br/>
+									<strong><?=gettext("Maximum number of tables for systems such as aliases, sshlockout, snort, etc, combined.");?></strong>
+									<br/><?php echo gettext("This is the actual number of tables, not the number of entries inside the tables (see below)");?>
+									<br/>
+									<span class="vexpl">
+										<?=gettext("Note:  Leave this blank for the default.");?>
+										<?php if (empty($pconfig['maximumtables'])): ?>
+											<?= gettext("On your system the default size is:");?> <?= pfsense_default_tables_size(); ?>
+										<?php endif; ?>
+									</span>
+								</td>
+							</tr>
+							<tr>
 								<td width="22%" valign="top" class="vncell"><?=gettext("Firewall Maximum Table Entries");?></td>
 								<td width="78%" class="vtable">
 									<input name="maximumtableentries" type="text" id="maximumtableentries" value="<?php echo $pconfig['maximumtableentries']; ?>" />
@@ -448,16 +463,6 @@ function update_description(itemnum) {
 								</td>
 							</tr>
 							<tr>
-							<td width="22%" valign="top" class="vncell"><?=gettext("Check certificate of aliases URLs");?></td>
-								<td width="78%" class="vtable">
-									<input name="checkaliasesurlcert" type="checkbox" id="checkaliasesurlcert" value="yes" <?php if ($pconfig['checkaliasesurlcert']) echo "checked=\"checked\""; ?> />
-									<strong><?=gettext("Verify HTTPS certificates when downloading alias URLs");?></strong>
-									<br />
-									<?=gettext("Make sure the certificate is valid for all HTTPS addresses on aliases. If it's not valid or is revoked, do not download it.");?>
-									<br />
-								</td>
-							</tr>
-							<tr>
 								<td colspan="2" class="list" height="12">&nbsp;</td>
 							</tr>
 							<tr>
diff --git a/usr/local/www/system_advanced_misc.php b/usr/local/www/system_advanced_misc.php
index b5f6498..a69d35b 100644
--- a/usr/local/www/system_advanced_misc.php
+++ b/usr/local/www/system_advanced_misc.php
@@ -40,7 +40,7 @@
 ##|*IDENT=page-system-advanced-misc
 ##|*NAME=System: Advanced: Miscellaneous page
 ##|*DESCR=Allow access to the 'System: Advanced: Miscellaneous' page.
-##|*MATCH=system_advanced_misc.php*
+##|*MATCH=system_advanced.php*
 ##|-PRIV
 
 require("guiconfig.inc");
@@ -73,7 +73,6 @@ $pconfig['skip_rules_gw_down'] = isset($config['system']['skip_rules_gw_down']);
 $pconfig['use_mfs_tmpvar'] = isset($config['system']['use_mfs_tmpvar']);
 $pconfig['use_mfs_tmp_size'] = $config['system']['use_mfs_tmp_size'];
 $pconfig['use_mfs_var_size'] = $config['system']['use_mfs_var_size'];
-$pconfig['noinstalllanspd'] = $config['system']['noinstalllanspd'];
 
 $pconfig['powerd_ac_mode'] = "hadp";
 if (!empty($config['system']['powerd_ac_mode']))
@@ -178,15 +177,6 @@ if ($_POST) {
 				$need_racoon_restart = true;
 			}
 		}
-		if($_POST['noinstalllanspd'] == "yes") {
-			if (!isset($pconfig['noinstalllanspd']))
-				$need_racoon_restart = true;
-			$config['system']['noinstalllanspd'] = true;
-		} else {
-			if (isset($config['system']['noinstalllanspd']))
-				$need_racoon_restart = true;
-			unset($config['system']['noinstalllanspd']);
-		}
 
 		if($_POST['maxmss_enable'] == "yes") {
 			$config['system']['maxmss_enable'] = true;
@@ -507,16 +497,6 @@ function tmpvar_checked(obj) {
 								<td colspan="2" valign="top" class="listtopic"><?=gettext("IP Security"); ?></td>
 							</tr>
 							<tr>
-								<td width="22%" valign="top" class="vncell"><?=gettext("LAN security associsations"); ?></td>
-								<td width="78%" class="vtable">
-									<input name="noinstalllanspd" type="checkbox" id="noinstalllanspd" value="yes" <?php if ($pconfig['noinstalllanspd']) echo "checked=\"checked\""; ?> />
-									<strong><?=gettext("Do not install LAN SPD"); ?></strong>
-									<br />
-									<?=gettext("By default, if IPSec is enabled negating SPD are inserted to provide protection. " .
-									"This behaviour can be changed by enabling this setting which will prevent installing these SPDs."); ?>
-								</td>
-							</tr>
-							<tr>
 								<td width="22%" valign="top" class="vncell"><?=gettext("Security Associations"); ?></td>
 								<td width="78%" class="vtable">
 									<input name="preferoldsa_enable" type="checkbox" id="preferoldsa_enable" value="yes" <?php if ($pconfig['preferoldsa_enable']) echo "checked=\"checked\""; ?> />
diff --git a/usr/local/www/system_advanced_network.php b/usr/local/www/system_advanced_network.php
index 28450ad..2b6f476 100644
--- a/usr/local/www/system_advanced_network.php
+++ b/usr/local/www/system_advanced_network.php
@@ -39,7 +39,7 @@
 ##|*IDENT=page-system-advanced-network
 ##|*NAME=System: Advanced: Network page
 ##|*DESCR=Allow access to the 'System: Advanced: Networking' page.
-##|*MATCH=system_advanced_network.php*
+##|*MATCH=system_advanced-network.php*
 ##|-PRIV
 
 require("guiconfig.inc");
@@ -51,7 +51,6 @@ require_once("shaper.inc");
 $pconfig['ipv6nat_enable'] = isset($config['diag']['ipv6nat']['enable']);
 $pconfig['ipv6nat_ipaddr'] = $config['diag']['ipv6nat']['ipaddr'];
 $pconfig['ipv6allow'] = isset($config['system']['ipv6allow']);
-$pconfig['prefer_ipv4'] = isset($config['system']['prefer_ipv4']);
 $pconfig['polling_enable'] = isset($config['system']['polling']);
 $pconfig['sharednet'] = $config['system']['sharednet'];
 $pconfig['disablechecksumoffloading'] = isset($config['system']['disablechecksumoffloading']);
@@ -89,12 +88,6 @@ if ($_POST) {
 			unset($config['system']['ipv6allow']);
 		}
 
-		if($_POST['prefer_ipv4'] == "yes") {
-			$config['system']['prefer_ipv4'] = true;
-		} else {
-			unset($config['system']['prefer_ipv4']);
-		}
-
 		if($_POST['sharednet'] == "yes") {
 			$config['system']['sharednet'] = true;
 			system_disable_arp_wrong_if();
@@ -143,9 +136,6 @@ if ($_POST) {
 		// Configure flowtable support from filter.inc
 		flowtable_configure();
 
-		// Set preferred protocol
-		prefer_ipv4_or_ipv6();
-
 		$retval = filter_configure();
 		if(stristr($retval, "error") <> true)
 			$savemsg = get_std_save_message(gettext($retval));
@@ -238,16 +228,6 @@ function enable_change(enable_over) {
 								</td>
 							</tr>
 							<tr>
-								<td width="22%" valign="top" class="vncell"><?=gettext("Prefer IPv4 over IPv6"); ?></td>
-								<td width="78%" class="vtable">
-									<input name="prefer_ipv4" type="checkbox" id="prefer_ipv4" value="yes" <?php if ($pconfig['prefer_ipv4']) echo "checked=\"checked\""; ?> />
-									<strong><?=gettext("Prefer to use IPv4 even if IPv6 is available"); ?></strong><br/>
-									<?=gettext("By default, if a hostname resolves IPv6 and IPv4 addresses ".
-									"IPv6 will be used, if you check this option, IPv4 will be " .
-									"used instead of IPv6."); ?><br />
-								</td>
-							</tr>
-							<tr>
 								<td colspan="2" class="list" height="12">&nbsp;</td>
 							</tr>
 							<tr>
diff --git a/usr/local/www/system_advanced_notifications.php b/usr/local/www/system_advanced_notifications.php
index fe2eb71..48de7fd 100644
--- a/usr/local/www/system_advanced_notifications.php
+++ b/usr/local/www/system_advanced_notifications.php
@@ -32,9 +32,9 @@
 
 ##|+PRIV
 ##|*IDENT=page-system-advanced-notifications
-##|*NAME=System: Advanced: Notifications page
-##|*DESCR=Allow access to the 'System: Advanced: Notifications' page.
-##|*MATCH=system_advanced_notifications.php*
+##|*NAME=System: Advanced: Tunables page
+##|*DESCR=Allow access to the 'System: Advanced: Tunables' page.
+##|*MATCH=system_advanced-sysctrl.php*
 ##|-PRIV
 
 require("guiconfig.inc");
@@ -66,8 +66,6 @@ if($config['notifications']['smtp']['port'])
 	$pconfig['smtpport'] = $config['notifications']['smtp']['port'];
 if($config['notifications']['smtp']['ssl'])
 	$pconfig['smtpssl'] = $config['notifications']['smtp']['ssl'];
-if($config['notifications']['smtp']['tls'])
-	$pconfig['smtptls'] = $config['notifications']['smtp']['tls'];
 if($config['notifications']['smtp']['notifyemailaddress']) 
 	$pconfig['smtpnotifyemailaddress'] = $config['notifications']['smtp']['notifyemailaddress'];
 if($config['notifications']['smtp']['username']) 
@@ -115,7 +113,6 @@ if ($_POST) {
 		$config['notifications']['smtp']['ipaddress'] = $_POST['smtpipaddress'];
 		$config['notifications']['smtp']['port'] = $_POST['smtpport'];
 		$config['notifications']['smtp']['ssl'] = isset($_POST['smtpssl']) ? 'checked' : 'unchecked';
-		$config['notifications']['smtp']['tls'] = isset($_POST['smtptls']) ? (isset($_POST['smtpssl']) ? 'unchecked' : 'checked') : 'unchecked';
 		$config['notifications']['smtp']['notifyemailaddress'] = $_POST['smtpnotifyemailaddress'];
 		$config['notifications']['smtp']['username'] = $_POST['smtpusername'];
 		$config['notifications']['smtp']['password'] = $_POST['smtppassword'];
@@ -261,15 +258,9 @@ include("head.inc");
 						<tr>
 							<td width="22%" valign="top" class="vncell"><?=gettext("SMTP Port of E-Mail server"); ?></td>
 							<td width="78%" class="vtable">
-								<input name='smtpport' value='<?php echo $pconfig['smtpport']; ?>' /><br/>
-								<?=gettext("This is the port of the SMTP E-Mail server, typically 25, 587 (submission) or 465 (smtps)"); ?>
-							</td>
-						</tr>
-						<tr>
-							<td width="22%" valign="top" class="vncell"><?=gettext("Secure SMTP Connection"); ?></td>
-							<td width="78%" class="vtable">
-								<input type='checkbox' id='smtpssl' name='smtpssl' <?php echo $pconfig['smtpssl']; ?> />Enable SMTP over SSL/TLS<br/>
-								<input type='checkbox' id='smtptls' name='smtptls' <?php echo $pconfig['smtptls']; ?> />Enable STARTTLS<br/>
+								<input name='smtpport' value='<?php echo $pconfig['smtpport']; ?>' />
+								<input type='checkbox' name='smtpssl' <?php echo $pconfig['smtpssl']; ?> />Enable SSL/TLS Authentication<br/>
+								<?=gettext("This is the port of the SMTP E-Mail server, typically 25, 587 (submission) or 465 (smtps, tick ssl/tls checkbox)"); ?>
 							</td>
 						</tr>
 						<tr>
@@ -342,21 +333,6 @@ include("head.inc");
 			</td>
 		</tr>
 	</table>
-<script type="text/javascript">
-	jQuery(document).ready(function() {
-		if (jQuery('#smtpssl').is(':checked')) {
-			jQuery('#smtptls').prop('disabled', true);
-		} else if  (jQuery('#smtptls').is(':checked')) {
-			jQuery('#smtpssl').prop('disabled', true);
-		}
-	});
-	jQuery('#smtpssl').change( function() {
-		jQuery('#smtptls').prop('disabled', this.checked);
-	});
-	jQuery('#smtptls').change( function() {
-		jQuery('#smtpssl').prop('disabled', this.checked);
-	});
-</script>
 <?php include("fend.inc"); ?>
 </body>
 </html>
diff --git a/usr/local/www/system_advanced_sysctl.php b/usr/local/www/system_advanced_sysctl.php
index da1aef3..83c129a 100644
--- a/usr/local/www/system_advanced_sysctl.php
+++ b/usr/local/www/system_advanced_sysctl.php
@@ -40,7 +40,7 @@
 ##|*IDENT=page-system-advanced-sysctl
 ##|*NAME=System: Advanced: Tunables page
 ##|*DESCR=Allow access to the 'System: Advanced: Tunables' page.
-##|*MATCH=system_advanced_sysctl.php*
+##|*MATCH=system_advanced-sysctl.php*
 ##|-PRIV
 
 require("guiconfig.inc");
diff --git a/usr/local/www/system_authservers.php b/usr/local/www/system_authservers.php
index 96c7216..2984d8c 100644
--- a/usr/local/www/system_authservers.php
+++ b/usr/local/www/system_authservers.php
@@ -207,7 +207,7 @@ if ($_POST) {
 		}
 	}
 
-	do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+	do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 
 	if (preg_match("/[^a-zA-Z0-9\.\-_]/", $_POST['host']))
 		$input_errors[] = gettext("The host name contains invalid characters.");
@@ -215,7 +215,7 @@ if ($_POST) {
 	if (auth_get_authserver($pconfig['name']) && !isset($id))
 		$input_errors[] = gettext("An authentication server with the same name already exists.");
 
-	if (($pconfig['type'] == "radius") && isset($_POST['radius_timeout']) && !empty($_POST['radius_timeout']) && (!is_numeric($_POST['radius_timeout']) || (is_numeric($_POST['radius_timeout']) && ($_POST['radius_timeout'] <= 0))))
+	if (($pconfig['type'] == "radius") && isset($_POST['radius_timeout']) && (!is_numeric($_POST['radius_timeout']) || (is_numeric($_POST['radius_timeout']) && ($_POST['radius_timeout'] <= 0))))
 		$input_errors[] = gettext("RADIUS Timeout value must be numeric and positive.");
 
 	/* if this is an AJAX caller then handle via JSON */
@@ -277,8 +277,6 @@ if ($_POST) {
 
 			if ($pconfig['radius_timeout'])
 				$server['radius_timeout'] = $pconfig['radius_timeout'];
-			else
-				$server['radius_timeout'] = 5;
 
 			if ($pconfig['radius_srvcs'] == "both") {
 				$server['radius_auth_port'] = $pconfig['radius_auth_port'];
diff --git a/usr/local/www/system_camanager.php b/usr/local/www/system_camanager.php
index ebbb882..254d4e2 100644
--- a/usr/local/www/system_camanager.php
+++ b/usr/local/www/system_camanager.php
@@ -158,7 +158,6 @@ if ($act == "expkey") {
 if ($_POST) {
 
 	unset($input_errors);
-	$input_errors = array();
 	$pconfig = $_POST;
 
 	/* input validation */
@@ -204,7 +203,7 @@ if ($_POST) {
 				gettext("Distinguished name Common Name"));
 	}
 
-	do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+	do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 	if ($pconfig['method'] != "existing") {
 		/* Make sure we do not have invalid characters in the fields for the certificate */
 		for ($i = 0; $i < count($reqdfields); $i++) {
diff --git a/usr/local/www/system_certmanager.php b/usr/local/www/system_certmanager.php
index 1add2fc..05dab3c 100644
--- a/usr/local/www/system_certmanager.php
+++ b/usr/local/www/system_certmanager.php
@@ -107,9 +107,8 @@ if ($act == "del") {
 if ($act == "new") {
 	$pconfig['method'] = $_GET['method'];
 	$pconfig['keylen'] = "2048";
-	$pconfig['digest_alg'] = "sha256";
 	$pconfig['csr_keylen'] = "2048";
-	$pconfig['csr_digest_alg'] = "sha256";
+	$pconfig['digest_alg'] = "sha256";
 	$pconfig['type'] = "user";
 	$pconfig['lifetime'] = "3650";
 }
@@ -157,18 +156,12 @@ if ($act == "p12") {
 	}
 
 	$exp_name = urlencode("{$a_cert[$id]['descr']}.p12");
-	$args = array();
-	$args['friendly_name'] = $a_cert[$id]['descr'];
-
-	$ca = lookup_ca($a_cert[$id]['caref']);
-	if ($ca)
-		$args['extracerts'] = openssl_x509_read(base64_decode($ca['crt']));
 
 	$res_crt = openssl_x509_read(base64_decode($a_cert[$id]['crt']));
 	$res_key = openssl_pkey_get_private(array(0 => base64_decode($a_cert[$id]['prv']) , 1 => ""));
 
 	$exp_data = "";
-	openssl_pkcs12_export($res_crt, $exp_data, $res_key, null, $args);
+	openssl_pkcs12_export($res_crt, $exp_data, $res_key, null);
 	$exp_size = strlen($exp_data);
 
 	header("Content-Type: application/octet-stream");
@@ -245,7 +238,7 @@ if ($_POST) {
 		}
 
 		$altnames = array();
-		do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+		do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 		if ($pconfig['method'] != "import") {
 			/* subjectAltNames */
 			foreach ($_POST as $key => $value) {
@@ -262,7 +255,7 @@ if ($_POST) {
 					$altnames[$entry][$field] = $value;
 				}
 			}
-			$pconfig['altnames']['item'] = $altnames;
+			$pconfig['aliases']['item'] = $aliases;
 
 			/* Input validation for subjectAltNames */
 			foreach ($altnames as $idx => $altname) {
@@ -302,15 +295,11 @@ if ($_POST) {
 				}else if (($reqdfields[$i] != "descr") && preg_match("/[\!\@\#\$\%\^\(\)\~\?\>\<\&\/\\\,\.\"\']/", $_POST["$reqdfields[$i]"]))
 					array_push($input_errors, "The field '" . $reqdfieldsn[$i] . "' contains invalid characters.");
 			}
-			
 			if (isset($_POST["keylen"]) && !in_array($_POST["keylen"], $cert_keylens))
 				array_push($input_errors, gettext("Please select a valid Key Length."));
-			if (!in_array($_POST["digest_alg"], $openssl_digest_algs))
-				array_push($input_errors, gettext("Please select a valid Digest Algorithm."));
-				
 			if (isset($_POST["csr_keylen"]) && !in_array($_POST["csr_keylen"], $cert_keylens))
 				array_push($input_errors, gettext("Please select a valid Key Length."));
-			if (!in_array($_POST["csr_digest_alg"], $openssl_digest_algs))
+			if (!in_array($_POST["digest_alg"], $openssl_digest_algs))
 				array_push($input_errors, gettext("Please select a valid Digest Algorithm."));
 		}
 
@@ -379,7 +368,7 @@ if ($_POST) {
 						}
 						$dn['subjectAltName'] = implode(",", $altnames_tmp);
 					}
-					if(!csr_generate($cert, $pconfig['csr_keylen'], $dn, $pconfig['csr_digest_alg'])){
+					if(!csr_generate($cert, $pconfig['csr_keylen'], $dn, $pconfig['digest_alg'])){
 						while($ssl_err = openssl_error_string()){
 							$input_errors = array();
 							array_push($input_errors, "openssl library returns: " . $ssl_err);
@@ -414,7 +403,7 @@ if ($_POST) {
 			gettext("Descriptive name"),
 			gettext("Final Certificate data"));
 
-		do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+		do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 
 //		old way
 		/* make sure this csr and certificate subjects match */
@@ -810,7 +799,7 @@ function internalca_change() {
 											?>
 											<tr>
 												<td>
-												<input autocomplete="off" name="altname_type<?php echo $counter; ?>" type="text" class="formfld unknown" id="altname_type<?php echo $counter; ?>" size="20" value="<?=htmlspecialchars($type);?>" />
+												<input autocomplete="off" name="altname_type<?php echo $counter; ?>" type="text" class="formfld unknown" id="altname_type<?php echo $counter; ?>" size="20" value="<?=htmlspecialchars($value);?>" />
 												</td>
 												<td>
 												<input autocomplete="off" name="altname_value<?php echo $counter; ?>" type="text" class="formfld unknown" id="altname_value<?php echo $counter; ?>" size="20" value="<?=htmlspecialchars($value);?>" />
@@ -877,14 +866,14 @@ function internalca_change() {
 						<tr>
 							<td width="22%" valign="top" class="vncellreq"><?=gettext("Digest Algorithm");?></td>
 							<td width="78%" class="vtable">
-								<select name='csr_digest_alg' id='csr_digest_alg' class="formselect">
+								<select name='digest_alg' id='digest_alg' class="formselect">
 								<?php
-									foreach( $openssl_digest_algs as $csr_digest_alg):
+									foreach( $openssl_digest_algs as $digest_alg):
 									$selected = "";
-									if ($pconfig['csr_digest_alg'] == $csr_digest_alg)
+									if ($pconfig['digest_alg'] == $digest_alg)
 										$selected = " selected=\"selected\"";
 								?>
-									<option value="<?=$csr_digest_alg;?>"<?=$selected;?>><?=strtoupper($csr_digest_alg);?></option>
+									<option value="<?=$digest_alg;?>"<?=$selected;?>><?=strtoupper($digest_alg);?></option>
 								<?php endforeach; ?>
 								</select>
 								<br/><?= gettext("NOTE: It is recommended to use an algorithm stronger than SHA1 when possible.") ?>
@@ -1180,7 +1169,7 @@ function internalca_change() {
 								<img src="/themes/<?= $g['theme'];?>/images/icons/icon_down.gif" title="<?=gettext("export key");?>" alt="<?=gettext("export ca");?>" width="17" height="17" border="0" />
 							</a>
 							<a href="system_certmanager.php?act=p12&amp;id=<?=$i;?>">
-								<img src="/themes/<?= $g['theme'];?>/images/icons/icon_down.gif" title="<?=gettext("export ca cert+user cert+user cert key in .p12 format");?>" alt="<?=gettext("export ca cert+user cert+user cert key in .p12 format");?>" width="17" height="17" border="0" />
+								<img src="/themes/<?= $g['theme'];?>/images/icons/icon_down.gif" title="<?=gettext("export cert+key in .p12");?>" alt="<?=gettext("export cert+key in .p12");?>" width="17" height="17" border="0" />
 							</a>
 							<?php	if (!cert_in_use($cert['refid'])): ?>
 							<a href="system_certmanager.php?act=del&amp;id=<?=$i;?>" onclick="return confirm('<?=gettext("Do you really want to delete this Certificate?");?>')">
@@ -1230,4 +1219,4 @@ internalca_change();
 </script>
 
 </body>
-</html>
+</html>
\ No newline at end of file
diff --git a/usr/local/www/system_crlmanager.php b/usr/local/www/system_crlmanager.php
index 6390a9e..5d60318 100644
--- a/usr/local/www/system_crlmanager.php
+++ b/usr/local/www/system_crlmanager.php
@@ -107,7 +107,6 @@ if ($act == "new") {
 }
 
 if ($act == "exp") {
-	crl_update($thiscrl);
 	$exp_name = urlencode("{$thiscrl['descr']}.crl");
 	$exp_data = base64_decode($thiscrl['text']);
 	$exp_size = strlen($exp_data);
@@ -201,7 +200,7 @@ if ($_POST) {
 				gettext("Certificate Authority"));
 	}
 
-	do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+	do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 
 	/* if this is an AJAX caller then handle via JSON */
 	if (isAjax() && is_array($input_errors)) {
@@ -589,9 +588,11 @@ function method_change() {
 						<td class="listr"><?php echo ($internal) ? count($tmpcrl['cert']) : "Unknown (imported)"; ?></td>
 						<td class="listr"><?php echo ($inuse) ? "YES" : "NO"; ?></td>
 						<td valign="middle" class="list nowrap">
+							<?php if (!$internal || count($tmpcrl['cert'])): ?>
 							<a href="system_crlmanager.php?act=exp&amp;id=<?=$tmpcrl['refid'];?>">
 								<img src="/themes/<?= $g['theme'];?>/images/icons/icon_down.gif" title="<?=gettext("Export CRL") . " " . htmlspecialchars($tmpcrl['descr']);?>" alt="<?=gettext("Export CRL") . " " . htmlspecialchars($tmpcrl['descr']);?>" width="17" height="17" border="0" />
 							</a>
+							<?php endif; ?>
 							<?php if ($internal): ?>
 							<a href="system_crlmanager.php?act=edit&amp;id=<?=$tmpcrl['refid'];?>">
 								<img src="/themes/<?= $g['theme'];?>/images/icons/icon_e.gif" title="<?=gettext("Edit CRL") . " " . htmlspecialchars($tmpcrl['descr']);?>" alt="<?=gettext("Edit CRL") . " " . htmlspecialchars($tmpcrl['descr']);?>" width="17" height="17" border="0" />
diff --git a/usr/local/www/system_firmware_auto.php.orig b/usr/local/www/system_firmware_auto.php.orig
new file mode 100755
index 0000000..8c99d48
--- /dev/null
+++ b/usr/local/www/system_firmware_auto.php.orig
@@ -0,0 +1,279 @@
+<?php
+/* $Id$ */
+/*
+	system_firmware_auto.php
+	Copyright (C) 2008 Scott Ullrich <sullrich@gmail.com>
+	Copyright (C) 2005 Scott Ullrich
+
+	Based originally on system_firmware.php
+	(C)2003-2004 Manuel Kasper
+	All rights reserved.
+
+	Redistribution and use in source and binary forms, with or without
+	modification, are permitted provided that the following conditions are met:
+
+	1. Redistributions of source code must retain the above copyright notice,
+	   this list of conditions and the following disclaimer.
+
+	2. Redistributions in binary form must reproduce the above copyright
+	   notice, this list of conditions and the following disclaimer in the
+	   documentation and/or other materials provided with the distribution.
+
+	THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES,
+	INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY
+	AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
+	AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY,
+	OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
+	SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
+	INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
+	CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
+	ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
+	POSSIBILITY OF SUCH DAMAGE.
+*/
+/*
+	pfSense_BUILDER_BINARIES:	/usr/bin/tar	/usr/bin/nohup	/bin/cat	/sbin/sha256
+	pfSense_MODULE:	firmware
+*/
+
+##|+PRIV
+##|*IDENT=page-system-firmware-checkforupdate
+##|*NAME=System: Firmware: Check For Update page
+##|*DESCR=Allow access to the 'System: Firmware: Check For Update' page.
+##|*MATCH=system_firmware_auto.php*
+##|-PRIV
+
+$nocsrf = true;
+
+require("guiconfig.inc");
+require_once("pfsense-utils.inc");
+
+$curcfg = $config['system']['firmware'];
+
+if(isset($curcfg['alturl']['enable']))
+	$updater_url = "{$config['system']['firmware']['alturl']['firmwareurl']}";
+else
+	$updater_url = $g['update_url'];
+
+if($_POST['backupbeforeupgrade'])
+	touch("/tmp/perform_full_backup.txt");
+
+$closehead = false;
+$pgtitle = array(gettext("Diagnostics"),gettext("Firmware"),gettext("Auto Update"));
+include("head.inc");
+
+?>
+
+<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
+<link href="gui.css" rel="stylesheet" type="text/css" />
+</head>
+
+<body link="#0000CC" vlink="#0000CC" alink="#0000CC">
+
+<?php include("fbegin.inc"); ?>
+
+<form action="system_firmware_auto.php" method="post">
+<table width="100%" border="0" cellpadding="6" cellspacing="0" summary="firmware auto-check">
+	<tr>
+		<td>
+		<?php
+			$tab_array = array();
+			$tab_array[] = array(gettext("Manual Update"), false, "system_firmware.php");
+			$tab_array[] = array(gettext("Auto Update"), true, "system_firmware_check.php");
+			$tab_array[] = array(gettext("Updater Settings"), false, "system_firmware_settings.php");
+			if($g['hidedownloadbackup'] == false)
+				$tab_array[] = array(gettext("Restore Full Backup"), false, "system_firmware_restorefullbackup.php");
+			display_top_tabs($tab_array);
+		?>
+		</td>
+	</tr>
+	<tr>
+		<td class="tabcont">
+			<table width="100%" border="0" cellpadding="6" cellspacing="0" summary="outer">
+				<tr>
+					<td class="tabcont">
+						<table width="100%" border="0" cellpadding="6" cellspacing="0" summary="inner">
+							<tr>
+								<td align="center">
+									<table style="height:15;colspacing:0" width="420" border="0" cellpadding="0" cellspacing="0" summary="images">
+
+										<tr>
+											<td style="background:url('./themes/<?=$g['theme'];?>/images/misc/bar_left.gif')" height="15" width="5">	</td>
+											<td>
+											<table id="progholder" style="height:15;colspacing:0" width="410" border="0" cellpadding="0" cellspacing="0" summary="">
+												<tr><td style="background:url('./themes/<?=$g['theme'];?>/images/misc/bar_gray.gif')" valign="top" align="left">
+												<img src="./themes/<?=$g['theme'];?>/images/misc/bar_blue.gif" width="0" height="15" name="progressbar" id="progressbar" alt="" />
+												</td></tr>
+											</table>
+											</td>
+											<td style="background:url('./themes/<?=$g['theme'];?>/images/misc/bar_right.gif')" height="15" width="5"></td>
+										</tr>
+									</table>
+									<br />
+									<!-- status box -->
+									<textarea cols="90" rows="1" name="status" id="status" wrap="hard"><?=gettext("Beginning firmware upgrade"); ?>.</textarea>
+									<!-- command output box -->
+									<textarea cols="90" rows="25" name="output" id="output" wrap="hard"></textarea>
+								</td>
+							</tr>
+						</table>
+					</td>
+				</tr>
+			</table>
+		</td>
+	</tr>
+</table>
+</form>
+
+<?php include("fend.inc"); ?>
+
+<?php
+
+update_status(gettext("Downloading current version information") . "...");
+$nanosize = "";
+if ($g['platform'] == "nanobsd") {
+	if (file_exists("/etc/nano_use_vga.txt"))
+		$nanosize = "-nanobsd-vga-";
+	else
+		$nanosize = "-nanobsd-";
+
+	$nanosize .= strtolower(trim(file_get_contents("/etc/nanosize.txt")));
+}
+
+@unlink("/tmp/{$g['product_name']}_version");
+download_file_with_progress_bar("{$updater_url}/version{$nanosize}", "/tmp/{$g['product_name']}_version");
+$latest_version = str_replace("\n", "", @file_get_contents("/tmp/{$g['product_name']}_version"));
+if(!$latest_version) {
+	update_output_window(gettext("Unable to check for updates."));
+	require("fend.inc");
+	exit;
+} else {
+	$current_installed_buildtime = trim(file_get_contents("/etc/version.buildtime"));
+	$current_installed_version = trim(file_get_contents("/etc/version"));
+	$latest_version = trim(@file_get_contents("/tmp/{$g['product_name']}_version"));
+	$latest_version_pfsense = strtotime($latest_version);
+	if(!$latest_version) {
+		update_output_window(gettext("Unable to check for updates."));
+		require("fend.inc");
+		exit;
+	} else {
+		if (pfs_version_compare($current_installed_buildtime, $current_installed_version, $latest_version) == -1) {
+			update_status(gettext("Downloading updates") . "...");
+			conf_mount_rw();
+			if ($g['platform'] == "nanobsd") {
+				$update_filename = "latest{$nanosize}.img.gz";
+			} else {
+				$update_filename = "latest.tgz";
+			}
+			$status = download_file_with_progress_bar("{$updater_url}/{$update_filename}", "{$g['upload_path']}/latest.tgz", "read_body_firmware");
+			$status = download_file_with_progress_bar("{$updater_url}/{$update_filename}.sha256", "{$g['upload_path']}/latest.tgz.sha256");
+			conf_mount_ro();
+			update_output_window("{$g['product_name']} " . gettext("download complete."));
+		} else {
+			update_output_window(gettext("You are on the latest version."));
+			require("fend.inc");
+			exit;
+		}
+	}
+}
+
+/* launch external upgrade helper */
+$external_upgrade_helper_text = "/etc/rc.firmware ";
+
+if($g['platform'] == "nanobsd")
+	$external_upgrade_helper_text .= "pfSenseNanoBSDupgrade ";
+else
+	$external_upgrade_helper_text .= "pfSenseupgrade ";
+
+$external_upgrade_helper_text .= "{$g['upload_path']}/latest.tgz";
+
+$downloaded_latest_tgz_sha256 = str_replace("\n", "", `/sbin/sha256 -q {$g['upload_path']}/latest.tgz`);
+$upgrade_latest_tgz_sha256 = str_replace("\n", "", `/bin/cat {$g['upload_path']}/latest.tgz.sha256 | awk '{ print $4 }'`);
+
+$sigchk = 0;
+
+if(!isset($curcfg['alturl']['enable']))
+	$sigchk = verify_digital_signature("{$g['upload_path']}/latest.tgz");
+
+$exitstatus = 0;
+if ($sigchk == 1) {
+	$sig_warning = gettext("The digital signature on this image is invalid.");
+	$exitstatus = 1;
+} else if ($sigchk == 2) {
+	$sig_warning = gettext("This image is not digitally signed.");
+	if (!isset($config['system']['firmware']['allowinvalidsig']))
+		$exitstatus = 1;
+} else if (($sigchk >= 3)) {
+	$sig_warning = gettext("There has been an error verifying the signature on this image.");
+	$exitstatus = 1;
+}
+
+if ($exitstatus) {
+	update_status($sig_warning);
+	update_output_window(gettext("Update cannot continue.  You can disable this check on the Updater Settings tab."));
+	require("fend.inc");
+	exit;
+} else if ($sigchk == 2) {
+	update_status("Upgrade in progress...");
+	update_output_window("\n" . gettext("Upgrade Image does not contain a signature but the system has been configured to allow unsigned images. One moment please...") . "\n");
+}
+
+if (!verify_gzip_file("{$g['upload_path']}/latest.tgz")) {
+	update_status(gettext("The image file is corrupt."));
+	update_output_window(gettext("Update cannot continue"));
+	if (file_exists("{$g['upload_path']}/latest.tgz")) {
+		conf_mount_rw();
+		unlink("{$g['upload_path']}/latest.tgz");
+		conf_mount_ro();
+	}
+	require("fend.inc");
+	exit;
+}
+
+if($downloaded_latest_tgz_sha256 <> $upgrade_latest_tgz_sha256) {
+	update_status(gettext("Downloading complete but sha256 does not match."));
+	update_output_window(gettext("Auto upgrade aborted.") . "  \n\n" . gettext("Downloaded SHA256") . ": " . $downloaded_latest_tgz_sha256 . "\n\n" . gettext("Needed SHA256") . ": " . $upgrade_latest_tgz_sha256);
+} else {
+	update_output_window($g['product_name'] . " " . gettext("is now upgrading.") . "\\n\\n" . gettext("The firewall will reboot once the operation is completed."));
+	echo "\n<script type=\"text/javascript\">";
+	echo "\n//<![CDATA[";
+	echo "\ndocument.progressbar.style.visibility='hidden';";
+	echo "\n//]]>";
+	echo "\n</script>";
+	mwexec_bg($external_upgrade_helper_text);
+}
+
+/*
+	Helper functions
+*/
+
+function read_body_firmware($ch, $string) {
+	global $fout, $file_size, $downloaded, $counter, $version, $latest_version, $current_installed_version;
+	$length = strlen($string);
+	$downloaded += intval($length);
+	$downloadProgress = round(100 * (1 - $downloaded / $file_size), 0);
+	$downloadProgress = 100 - $downloadProgress;
+	$a = $file_size;
+	$b = $downloaded;
+	$c = $downloadProgress;
+	$text  = "  " . gettext("Auto Update Download Status") . "\\n";
+	$text .= "----------------------------------------------------\\n";
+	$text .= "  " . gettext("Current Version") . " : {$current_installed_version}\\n";
+	$text .= "  " . gettext("Latest Version") . "  : {$latest_version}\\n";
+	$text .= "  " . gettext("File size") . "       : {$a}\\n";
+	$text .= "  " . gettext("Downloaded") . "      : {$b}\\n";
+	$text .= "  " . gettext("Percent") . "         : {$c}%\\n";
+	$text .= "----------------------------------------------------\\n";
+	$counter++;
+	if($counter > 150) {
+		update_output_window($text);
+		update_progress_bar($downloadProgress);
+		$counter = 0;
+	}
+	fwrite($fout, $string);
+	return $length;
+}
+
+?>
+
+</body>
+</html>
diff --git a/usr/local/www/system_gateway_groups_edit.php b/usr/local/www/system_gateway_groups_edit.php
index 1656e9a..fadc283 100755
--- a/usr/local/www/system_gateway_groups_edit.php
+++ b/usr/local/www/system_gateway_groups_edit.php
@@ -82,7 +82,7 @@ if ($_POST) {
 	$reqdfields = explode(" ", "name");
 	$reqdfieldsn = explode(",", "Name");
 	
-	do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+	do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 	
 	if (! isset($_POST['name'])) {
 		$input_errors[] = gettext("A valid gateway group name must be specified.");
diff --git a/usr/local/www/system_gateways.php b/usr/local/www/system_gateways.php
index b4129a8..5fdec7f 100755
--- a/usr/local/www/system_gateways.php
+++ b/usr/local/www/system_gateways.php
@@ -44,17 +44,19 @@ require_once("functions.inc");
 require_once("filter.inc");
 require_once("shaper.inc");
 
-$a_gateways = return_gateways_array(true, false, true);
+$a_gateways = return_gateways_array(true);
 $a_gateways_arr = array();
 foreach ($a_gateways as $gw)
 	$a_gateways_arr[] = $gw;
 $a_gateways = $a_gateways_arr;
 
 if (!is_array($config['gateways']['gateway_item']))
-	$config['gateways']['gateway_item'] = array();
+        $config['gateways']['gateway_item'] = array();
 
 $a_gateway_item = &$config['gateways']['gateway_item'];
 
+$changedesc = "Gateways: ";
+
 if ($_POST) {
 
 	$pconfig = $_POST;
@@ -74,110 +76,56 @@ if ($_POST) {
 	}
 }
 
-function can_delete_gateway_item($id) {
-	global $config, $input_errors, $a_gateways;
-
-	if (!isset($a_gateways[$id]))
-		return false;
-
-	if (is_array($config['gateways']['gateway_group'])) {
-		foreach ($config['gateways']['gateway_group'] as $group) {
-			foreach ($group['item'] as $item) {
-				$items = explode("|", $item);
-				if ($items[0] == $a_gateways[$id]['name']) {
-					$input_errors[] = sprintf(gettext("Gateway '%s' cannot be deleted because it is in use on Gateway Group '%s'"), $a_gateways[$id]['name'], $group['name']);
-					break;
+if ($_GET['act'] == "del") {
+	if ($a_gateways[$_GET['id']]) {
+		/* remove the real entry */
+		$realid = $a_gateways[$_GET['id']]['attribute'];
+		$remove = true;
+		if (is_array($config['gateways']['gateway_group'])) {
+			foreach ($config['gateways']['gateway_group'] as $group) {
+				foreach ($group['item'] as $item) {
+					$items = explode("|", $item);
+					if ($items[0] == $a_gateways[$_GET['id']]['name']) {
+						$input_errors[] = "Gateway cannot be deleted because it is in use on Gateway Group '{$group['name']}'";
+						$remove = false;
+						break;
+					}
+						
 				}
 			}
 		}
-	}
-
-	if (is_array($config['staticroutes']['route'])) {
-		foreach ($config['staticroutes']['route'] as $route) {
-			if ($route['gateway'] == $a_gateways[$id]['name']) {
-				$input_errors[] = sprintf(gettext("Gateway '%s' cannot be deleted because it is in use on Static Route '%s'"), $a_gateways[$id]['name'], $route['network']);
-				break;
+		if (is_array($config['staticroutes']['route'])) {
+			foreach ($config['staticroutes']['route'] as $route) {
+				if ($route['gateway'] == $a_gateways[$_GET['id']]['name']) {
+					$input_errors[] = "Gateway cannot be deleted because it is in use on Static Routes '{$route['network']}'";
+						$remove = false;
+					break;
+				}
 			}
 		}
-	}
-
-	if (isset($input_errors))
-		return false;
-
-	return true;
-}
-
-function delete_gateway_item($id) {
-	global $config, $a_gateways;
-
-	if (!isset($a_gateways[$id]))
-		return;
-
-	/* NOTE: Cleanup static routes for the monitor ip if any */
-	if (!empty($a_gateways[$id]['monitor']) &&
-	    $a_gateways[$id]['monitor'] != "dynamic" &&
-	    is_ipaddr($a_gateways[$id]['monitor']) &&
-	    $a_gateways[$id]['gateway'] != $a_gateways[$id]['monitor']) {
-		if (is_ipaddrv4($a_gateways[$id]['monitor']))
-			mwexec("/sbin/route delete " . escapeshellarg($a_gateways[$id]['monitor']));
-		else
-			mwexec("/sbin/route delete -inet6 " . escapeshellarg($a_gateways[$id]['monitor']));
-	}
-
-	if ($config['interfaces'][$a_gateways[$id]['friendlyiface']]['gateway'] == $a_gateways[$id]['name'])
-		unset($config['interfaces'][$a_gateways[$id]['friendlyiface']]['gateway']);
-	unset($config['gateways']['gateway_item'][$a_gateways[$id]['attribute']]);
-}
-
-unset($input_errors);
-if ($_GET['act'] == "del") {
-	if (can_delete_gateway_item($_GET['id'])) {
-		$realid = $a_gateways[$_GET['id']]['attribute'];
-		delete_gateway_item($_GET['id']);
-		write_config("Gateways: removed gateway {$realid}");
-		mark_subsystem_dirty('staticroutes');
-		header("Location: system_gateways.php");
-		exit;
-	}
-}
-
-if (isset($_POST['del_x'])) {
-	/* delete selected items */
-	if (is_array($_POST['rule']) && count($_POST['rule'])) {
-		foreach ($_POST['rule'] as $rulei)
-			if(!can_delete_gateway_item($rulei))
-				break;
-
-		if (!isset($input_errors)) {
-			$items_deleted = "";
-			foreach ($_POST['rule'] as $rulei) {
-				delete_gateway_item($rulei);
-				$items_deleted .= "{$rulei} ";
-			}
-			if (!empty($items_deleted)) {
-				write_config("Gateways: removed gateways {$items_deleted}");
-				mark_subsystem_dirty('staticroutes');
-			}
+		if ($remove == true) {
+			/* NOTE: Cleanup static routes for the monitor ip if any */
+                        if (!empty($a_gateways[$_GET['id']]['monitor']) && $a_gateways[$_GET['id']]['monitor'] != "dynamic" && is_ipaddr($a_gateways[$_GET['id']]['monitor']) &&
+                            $a_gateways[$_GET['id']]['monitor'] != $a_gateways[$_GET['id']]['monitor'] && $a_gateways[$_GET['id']]['gateway'] != $a_gateways[$_GET['id']]['monitor']) {
+                                if (is_ipaddrv4($a_gateways[$_GET['id']]['monitor']))
+                                        mwexec("/sbin/route delete " . escapeshellarg($a_gateways[$_GET['id']]['monitor']));
+                                else
+                                        mwexec("/sbin/route delete -inet6 " . escapeshellarg($a_gateways[$_GET['id']]['monitor']));
+                        }
+
+			if ($config['interfaces'][$a_gateways[$_GET['id']]['friendlyiface']]['gateway'] == $a_gateways[$_GET['id']]['name'])
+				unset($config['interfaces'][$a_gateways[$_GET['id']]['friendlyiface']]['gateway']);
+			$changedesc .= "removed gateway {$realid}";
+			unset($a_gateway_item[$realid]);
+			write_config($changedesc);
+			mark_subsystem_dirty('staticroutes');
 			header("Location: system_gateways.php");
 			exit;
 		}
 	}
-
-} else if ($_GET['act'] == "toggle" && $a_gateways[$_GET['id']]) {
-	$realid = $a_gateways[$_GET['id']]['attribute'];
-
-	if(isset($a_gateway_item[$realid]['disabled']))
-		unset($a_gateway_item[$realid]['disabled']);
-	else
-		$a_gateway_item[$realid]['disabled'] = true;
-
-	if (write_config("Gateways: enable/disable"))
-		mark_subsystem_dirty('staticroutes');
-
-	header("Location: system_gateways.php");
-	exit;
 }
 
+
 $pgtitle = array(gettext("System"),gettext("Gateways"));
 $shortcut_section = "gateways";
 
@@ -189,14 +137,14 @@ include("head.inc");
 <?php include("fbegin.inc"); ?>
 <?php if ($input_errors) print_input_errors($input_errors); ?>
 <form action="system_gateways.php" method="post">
-<script type="text/javascript" language="javascript" src="/javascript/row_toggle.js"></script>
+<input type="hidden" name="y1" value="1" />
 <?php if ($savemsg) print_info_box($savemsg); ?>
 <?php if (is_subsystem_dirty('staticroutes')): ?><p>
 <?php print_info_box_np(gettext("The gateway configuration has been changed.") . "<br/>" . gettext("You must apply the changes in order for them to take effect."));?><br/></p>
 <?php endif; ?>
 	<table width="100%" border="0" cellpadding="0" cellspacing="0" summary="system gatewyas">
 		<tr>
-			<td>
+		  <td>
 <?php
 			$tab_array = array();
 			$tab_array[0] = array(gettext("Gateways"), true, "system_gateways.php");
@@ -204,201 +152,98 @@ include("head.inc");
 			$tab_array[2] = array(gettext("Groups"), false, "system_gateway_groups.php");
 			display_top_tabs($tab_array);
 ?>
-			</td>
+</td></tr>
+ <tr>
+   <td>
+	<div id="mainarea">
+             <table class="tabcont" width="100%" border="0" cellpadding="0" cellspacing="0" summary="main area">
+                <tr>
+                  <td width="15%" class="listhdrr"><?=gettext("Name"); ?></td>
+                  <td width="15%" class="listhdrr"><?=gettext("Interface"); ?></td>
+                  <td width="20%" class="listhdrr"><?=gettext("Gateway"); ?></td>
+                  <td width="20%" class="listhdrr"><?=gettext("Monitor IP"); ?></td>
+                  <td width="30%" class="listhdr"><?=gettext("Description"); ?></td>
+                  <td width="10%" class="list">
+			<table border="0" cellspacing="0" cellpadding="1" summary="add">
+			   <tr>
+				<td width="17"></td>
+				<td><a href="system_gateways_edit.php"><img src="./themes/<?= $g['theme']; ?>/images/icons/icon_plus.gif" width="17" height="17" border="0" alt="add" /></a></td>
+			   </tr>
+			</table>
+		  </td>
 		</tr>
-		<tr>
-			<td>
-				<div id="mainarea">
-				<table class="tabcont" width="100%" border="0" cellpadding="0" cellspacing="0" summary="main area">
-					<tr id="frheader">
-						<td width="2%" class="list">&nbsp;</td>
-						<td width="2%" class="list">&nbsp;</td>
-						<td width="15%" class="listhdrr"><?=gettext("Name"); ?></td>
-						<td width="10%" class="listhdrr"><?=gettext("Interface"); ?></td>
-						<td width="15%" class="listhdrr"><?=gettext("Gateway"); ?></td>
-						<td width="15%" class="listhdrr"><?=gettext("Monitor IP"); ?></td>
-						<td width="31%" class="listhdr"><?=gettext("Description"); ?></td>
-						<td width="10%" class="list">
-							<table border="0" cellspacing="0" cellpadding="1" summary="add">
-								<tr>
-									<td width="17"></td>
-									<td>
-										<a href="system_gateways_edit.php">
-											<img src="./themes/<?= $g['theme']; ?>/images/icons/icon_plus.gif" width="17" height="17" border="0" alt="add" />
-										</a>
-									</td>
-								</tr>
-							</table>
-						</td>
-					</tr>
-<?php
-				$textse = "</span>";
-				$i = 0;
-				foreach ($a_gateways as $gateway):
-					if (isset($gateway['disabled']) || isset($gateway['inactive'])) {
-						$textss = "<span class=\"gray\">";
-						$iconfn = "pass_d";
-					} else {
-						$textss = "<span>";
-						$iconfn = "pass";
-					}
-?>
-					<tr valign="top" id="fr<?=$i;?>">
-						<td class="listt">
-<?php
-						if (is_numeric($gateway['attribute'])):
-?>
-							<input type="checkbox" id="frc<?=$i;?>" name="rule[]" value="<?=$i;?>" onclick="fr_bgcolor('<?=$i;?>')" style="margin: 0; padding: 0; width: 15px; height: 15px;" />
-<?php
-						else:
-?>
-							&nbsp;
-<?php
-						endif;
-?>
-						</td>
-						<td class="listt" align="center">
-<?php
-						if (isset($gateway['inactive'])):
-?>
-							<img src="./themes/<?= $g['theme']; ?>/images/icons/icon_reject_d.gif" width="11" height="11" border="0"
-								title="<?=gettext("This gateway is inactive because interface is missing");?>" alt="icon" />
-<?php
-						elseif (is_numeric($gateway['attribute'])):
-?>
-							<a href="?act=toggle&amp;id=<?=$i;?>">
-								<img src="./themes/<?= $g['theme']; ?>/images/icons/icon_<?=$iconfn;?>.gif" width="11" height="11" border="0"
-									title="<?=gettext("click to toggle enabled/disabled status");?>" alt="icon" />
-							</a>
-<?php
-						else:
-?>
-							<img src="./themes/<?= $g['theme']; ?>/images/icons/icon_<?=$iconfn;?>.gif" width="11" height="11" border="0"
-								title="<?=gettext("click to toggle enabled/disabled status");?>" alt="icon" />
-<?php
-						endif;
-?>
-						</td>
-						<td class="listlr" onclick="fr_toggle(<?=$i;?>)" id="frd<?=$i;?>" ondblclick="document.location='system_gateways_edit.php?id=<?=$i;?>';">
-<?php
-							echo $textss;
-							echo $gateway['name'];
-							if(isset($gateway['defaultgw']))
-								echo " <strong>(default)</strong>";
-							echo $textse;
-?>
-						</td>
-						<td class="listr" onclick="fr_toggle(<?=$i;?>)" id="frd<?=$i;?>" ondblclick="document.location='system_gateways_edit.php?id=<?=$i;?>';">
-<?php
-							echo $textss;
-							echo htmlspecialchars(convert_friendly_interface_to_friendly_descr($gateway['friendlyiface']));
-							echo $textse;
-?>
-						</td>
-						<td class="listr" onclick="fr_toggle(<?=$i;?>)" id="frd<?=$i;?>" ondblclick="document.location='system_gateways_edit.php?id=<?=$i;?>';">
-<?php
-							echo $textss;
-							echo $gateway['gateway'] . " ";
-							echo $textse;
-?>
-						</td>
-						<td class="listr" onclick="fr_toggle(<?=$i;?>)" id="frd<?=$i;?>" ondblclick="document.location='system_gateways_edit.php?id=<?=$i;?>';">
-<?php
-							echo $textss;
-							echo htmlspecialchars($gateway['monitor']) . " ";
-							echo $textse;
-?>
-						</td>
-<?php
-					if (is_numeric($gateway['attribute'])):
-?>
-						<td class="listbg" onclick="fr_toggle(<?=$i;?>)" ondblclick="document.location='system_gateways_edit.php?id=<?=$i;?>';">
-<?php
-					else:
-?>
-						<td class="listbgns" onclick="fr_toggle(<?=$i;?>)" ondblclick="document.location='system_gateways_edit.php?id=<?=$i;?>';">
-<?php
-					endif;
-							echo $textss;
-							echo htmlspecialchars($gateway['descr']) . "&nbsp;";
-							echo $textse;
-?>
-						</td>
-						<td valign="middle" class="list nowrap">
-							<table border="0" cellspacing="0" cellpadding="1" summary="icons">
-								<tr>
-									<td>
-										<a href="system_gateways_edit.php?id=<?=$i;?>">
-											<img src="./themes/<?= $g['theme']; ?>/images/icons/icon_e.gif" width="17" height="17" border="0" alt="edit" />
-										</a>
-									</td>
-<?php
-								if (is_numeric($gateway['attribute'])):
-?>
-									<td>
-										<a href="system_gateways.php?act=del&amp;id=<?=$i;?>" onclick="return confirm('<?=gettext("Do you really want to delete this gateway?"); ?>')">
-											<img src="./themes/<?= $g['theme']; ?>/images/icons/icon_x.gif" width="17" height="17" border="0" alt="delete" />
-										</a>
-									</td>
-<?php
-								else:
-?>
-									<td width='17'></td>
-<?php
-								endif;
-?>
-								</tr>
-								<tr>
-									<td width="17"></td>
-									<td>
-										<a href="system_gateways_edit.php?dup=<?=$i;?>">
-											<img src="./themes/<?= $g['theme']; ?>/images/icons/icon_plus.gif" width="17" height="17" border="0" alt="add" />
-										</a>
-									</td>
-								</tr>
-							</table>
-						</td>
-					</tr>
-<?php
-					$i++;
-				endforeach;
-?>
-					<tr>
-						<td class="list" colspan="7"></td>
-						<td class="list">
-							<table border="0" cellspacing="0" cellpadding="1" summary="edit">
-								<tr>
-									<td>
-<?php
-									if ($i == 0):
-?>
-										<img src="/themes/<?= $g['theme']; ?>/images/icons/icon_x_d.gif" width="17" height="17"
-											title="<?=gettext("delete selected items");?>" border="0" alt="delete" />
-<?php
-									else:
-?>
-										<input name="del" type="image" src="/themes/<?= $g['theme']; ?>/images/icons/icon_x.gif"
-											style="width:17;height:17" title="<?=gettext("delete selected items");?>"
-											onclick="return confirm('<?=gettext("Do you really want to delete the selected gateway items?");?>')" />
-<?php
-									endif;
-?>
-									</td>
-									<td>
-										<a href="system_gateways_edit.php">
-											<img src="./themes/<?= $g['theme']; ?>/images/icons/icon_plus.gif" width="17" height="17" border="0" alt="edit" />
-										</a>
-									</td>
-								</tr>
-							</table>
-						</td>
-					</tr>
-				</table>
-				</div>
+			  <?php $i = 0; foreach ($a_gateways as $gateway): ?>
+                <tr>
+                  <td class="listlr" ondblclick="document.location='system_gateways_edit.php?id=<?=$i;?>';">
+		<?php
+			echo $gateway['name'];
+			if(isset($gateway['defaultgw']))
+				echo " <strong>(default)</strong>";
+		?>
+                  </td>
+                  <td class="listr" ondblclick="document.location='system_gateways_edit.php?id=<?=$i;?>';">
+		<?php
+			echo htmlspecialchars(convert_friendly_interface_to_friendly_descr($gateway['friendlyiface']));
+		?>
+                  </td>
+                  <td class="listr" ondblclick="document.location='system_gateways_edit.php?id=<?=$i;?>';">
+		<?php
+			echo $gateway['gateway'] . " ";
+		?>
+                  </td>
+                  <td class="listr" ondblclick="document.location='system_gateways_edit.php?id=<?=$i;?>';">
+		<?php
+			echo htmlspecialchars($gateway['monitor']) . " ";
+		?>
+                  </td>
+		<?php if (is_numeric($gateway['attribute'])) : ?>
+                  <td class="listbg" ondblclick="document.location='system_gateways_edit.php?id=<?=$i;?>';">
+		<?php else : ?>
+                  <td class="listbgns" ondblclick="document.location='system_gateways_edit.php?id=<?=$i;?>';">
+		<?php endif; ?>
+                    <?=htmlspecialchars($gateway['descr']);?>&nbsp;
+                  </td>
+
+                  <td valign="middle" class="list nowrap">
+			<table border="0" cellspacing="0" cellpadding="1" summary="icons">
+			   <tr>
+				<td><a href="system_gateways_edit.php?id=<?=$i;?>"><img src="./themes/<?= $g['theme']; ?>/images/icons/icon_e.gif" width="17" height="17" border="0" alt="edit" /></a></td>
+				<?php
+				if (is_numeric($gateway['attribute'])) : ?>
+					<td>
+						<a href="system_gateways.php?act=del&amp;id=<?=$i;?>" onclick="return confirm('<?=gettext("Do you really want to delete this gateway?"); ?>')">
+							<img src="./themes/<?= $g['theme']; ?>/images/icons/icon_x.gif" width="17" height="17" border="0" alt="delete" />
+						</a>
+					</td>
+				<?php else : ?>
+					<td width='17'></td>
+				<?php endif; ?>
+			   </tr>
+			   <tr>
+				<td width="17"></td>
+				<td><a href="system_gateways_edit.php?dup=<?=$i;?>"><img src="./themes/<?= $g['theme']; ?>/images/icons/icon_plus.gif" width="17" height="17" border="0" alt="add" /></a></td>
+			   </tr>
+			</table>
 			</td>
 		</tr>
-	</table>
-</form>
+		  <?php $i++; endforeach; ?>
+                <tr>
+                  <td class="list" colspan="5"></td>
+                  <td class="list">
+			<table border="0" cellspacing="0" cellpadding="1" summary="edit">
+			   <tr>
+				<td width="17"></td>
+				<td><a href="system_gateways_edit.php"><img src="./themes/<?= $g['theme']; ?>/images/icons/icon_plus.gif" width="17" height="17" border="0" alt="edit" /></a></td>
+			   </tr>
+		                    </table>
+				  </td>
+		                </tr>
+			</table>
+			</div>
+			</td>
+		  </tr>
+		</table>
+            </form>
 <?php include("fend.inc"); ?>
 </body>
 </html>
diff --git a/usr/local/www/system_gateways_edit.php b/usr/local/www/system_gateways_edit.php
index 429e4cc..a1a0df5 100755
--- a/usr/local/www/system_gateways_edit.php
+++ b/usr/local/www/system_gateways_edit.php
@@ -42,7 +42,7 @@
 require("guiconfig.inc");
 require("pkg-utils.inc");
 
-$a_gateways = return_gateways_array(true, false, true);
+$a_gateways = return_gateways_array(true);
 $a_gateways_arr = array();
 foreach($a_gateways as $gw) {
 	$a_gateways_arr[] = $gw;
@@ -75,17 +75,15 @@ if (isset($id) && $a_gateways[$id]) {
 		$pconfig['dynamic'] = true;
 	$pconfig['gateway'] = $a_gateways[$id]['gateway'];
 	$pconfig['defaultgw'] = isset($a_gateways[$id]['defaultgw']);
-	$pconfig['force_down'] = isset($a_gateways[$id]['force_down']);
-	$pconfig['latencylow'] = $a_gateways[$id]['latencylow'];
-	$pconfig['latencyhigh'] = $a_gateways[$id]['latencyhigh'];
-	$pconfig['losslow'] = $a_gateways[$id]['losslow'];
-	$pconfig['losshigh'] = $a_gateways[$id]['losshigh'];
-	$pconfig['down'] = $a_gateways[$id]['down'];
+	$pconfig['latencylow'] = $a_gateway_item[$id]['latencylow'];
+	$pconfig['latencyhigh'] = $a_gateway_item[$id]['latencyhigh'];
+	$pconfig['losslow'] = $a_gateway_item[$id]['losslow'];
+	$pconfig['losshigh'] = $a_gateway_item[$id]['losshigh'];
+	$pconfig['down'] = $a_gateway_item[$id]['down'];
 	$pconfig['monitor'] = $a_gateways[$id]['monitor'];
 	$pconfig['monitor_disable'] = isset($a_gateways[$id]['monitor_disable']);
 	$pconfig['descr'] = $a_gateways[$id]['descr'];
 	$pconfig['attribute'] = $a_gateways[$id]['attribute'];
-	$pconfig['disabled'] = isset($a_gateways[$id]['disabled']);
 }
 
 if (isset($_GET['dup'])) {
@@ -93,9 +91,6 @@ if (isset($_GET['dup'])) {
 	unset($pconfig['attribute']);
 }
 
-if (isset($id) && $a_gateways[$id])
-	$realid = $a_gateways[$id]['attribute'];
-
 if ($_POST) {
 
 	unset($input_errors);
@@ -104,7 +99,7 @@ if ($_POST) {
 	$reqdfields = explode(" ", "name interface");
 	$reqdfieldsn = array(gettext("Name"), gettext("Interface"));
 
-	do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+	do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 
 	if (! isset($_POST['name'])) {
 		$input_errors[] = "A valid gateway name must be specified.";
@@ -122,7 +117,7 @@ if ($_POST) {
 			$parent_ip = get_interface_ip($_POST['interface']);
 			$parent_sn = get_interface_subnet($_POST['interface']);
 			if(empty($parent_ip) || empty($parent_sn)) {
-				$input_errors[] = gettext("Cannot add IPv4 Gateway Address because no IPv4 address could be found on the interface.");
+				$input_errors[] = gettext("You can not use a IPv4 Gateway Address on a IPv6 only interface.");
 			} else {
 				$subnets = array(gen_subnet($parent_ip, $parent_sn) . "/" . $parent_sn);
 				$vips = link_interface_to_vips($_POST['interface']);
@@ -150,7 +145,7 @@ if ($_POST) {
 				$parent_ip = get_interface_ipv6($_POST['interface']);
 				$parent_sn = get_interface_subnetv6($_POST['interface']);
 				if(empty($parent_ip) || empty($parent_sn)) {
-					$input_errors[] = gettext("Cannot add IPv6 Gateway Address because no IPv6 address could be found on the interface.");
+					$input_errors[] = gettext("You can not use a IPv6 Gateway Address on a IPv4 only interface.");
 				} else {
 					$subnets = array(gen_subnetv6($parent_ip, $parent_sn) . "/" . $parent_sn);
 					$vips = link_interface_to_vips($_POST['interface']);
@@ -389,18 +384,16 @@ if ($_POST) {
 		$gateway['descr'] = $_POST['descr'];
 		if ($_POST['monitor_disable'] == "yes")
 			$gateway['monitor_disable'] = true;
-		if ($_POST['force_down'] == "yes")
-			$gateway['force_down'] = true;
-		if (is_ipaddr($_POST['monitor']))
+		else if (is_ipaddr($_POST['monitor'])) {
+			/* NOTE: If monitor ip is changed need to cleanup the old static route */
+			if ($_POST['monitor'] != "dynamic" && !empty($a_gateway_item[$id]) && is_ipaddr($a_gateway_item[$id]['monitor']) &&
+			    $_POST['monitor'] != $a_gateway_item[$id]['monitor'] && $gateway['gateway'] != $a_gateway_item[$id]['monitor']) {
+				if (is_ipaddrv4($a_gateway_item[$id]['monitor']))
+					mwexec("/sbin/route delete " . escapeshellarg($a_gateway_item[$id]['monitor']));
+				else
+					mwexec("/sbin/route delete -inet6 " . escapeshellarg($a_gateway_item[$id]['monitor']));
+			}
 			$gateway['monitor'] = $_POST['monitor'];
-
-		/* NOTE: If monitor ip is changed need to cleanup the old static route */
-		if ($_POST['monitor'] != "dynamic" && !empty($a_gateway_item[$realid]) && is_ipaddr($a_gateway_item[$realid]['monitor']) &&
-		    $_POST['monitor'] != $a_gateway_item[$realid]['monitor'] && $gateway['gateway'] != $a_gateway_item[$realid]['monitor']) {
-			if (is_ipaddrv4($a_gateway_item[$realid]['monitor']))
-				mwexec("/sbin/route delete " . escapeshellarg($a_gateway_item[$realid]['monitor']));
-			else
-				mwexec("/sbin/route delete -inet6 " . escapeshellarg($a_gateway_item[$realid]['monitor']));
 		}
 
 		if ($_POST['defaultgw'] == "yes" || $_POST['defaultgw'] == "on") {
@@ -428,14 +421,9 @@ if ($_POST) {
 		if ($_POST['down'])
 			$gateway['down'] = $_POST['down'];
 
-		if(isset($_POST['disabled']))
-			$gateway['disabled'] = true;
-		else
-			unset($gateway['disabled']);
-
 		/* when saving the manual gateway we use the attribute which has the corresponding id */
-		if (isset($realid) && $a_gateway_item[$realid])
-			$a_gateway_item[$realid] = $gateway;
+		if (isset($id) && $a_gateway_item[$id])
+			$a_gateway_item[$id] = $gateway;
 		else
 			$a_gateway_item[] = $gateway;
 
@@ -504,14 +492,6 @@ function monitor_change() {
 				<td colspan="2" valign="top" class="listtopic"><?=gettext("Edit gateway"); ?></td>
 			</tr>
 			<tr>
-				<td width="22%" valign="top" class="vncellreq"><?=gettext("Disabled");?></td>
-				<td width="78%" class="vtable">
-					<input name="disabled" type="checkbox" id="disabled" value="yes" <?php if ($pconfig['disabled']) echo "checked=\"checked\""; ?> />
-					<strong><?=gettext("Disable this gateway");?></strong><br />
-					<span class="vexpl"><?=gettext("Set this option to disable this gateway without removing it from the list.");?></span>
-				</td>
-			</tr>
-			<tr>
 				<td width="22%" valign="top" class="vncellreq"><?=gettext("Interface"); ?></td>
 				<td width="78%" class="vtable">
 					<select name='interface' class='formselect'>
@@ -599,14 +579,6 @@ function monitor_change() {
 				</td>
 			</tr>
 			<tr>
-				<td width="22%" valign="top" class="vncell"><?=gettext("Mark Gateway as Down"); ?></td>
-				<td width="78%" class="vtable">
-					<input name="force_down" type="checkbox" id="force_down" value="yes" <?php if ($pconfig['force_down'] == true) echo "checked=\"checked\""; ?> />
-					<strong><?=gettext("Mark Gateway as Down"); ?></strong><br />
-					<?=gettext("This will force this gateway to be considered Down"); ?>
-				</td>
-			</tr>
-			<tr>
 				<td width="22%" valign="top" class="vncell"><?=gettext("Advanced");?></td>
 				<td width="78%" class="vtable">
 					<?php $showbutton = (!empty($pconfig['latencylow']) || !empty($pconfig['latencyhigh']) || !empty($pconfig['losslow']) || !empty($pconfig['losshigh']) || (isset($pconfig['weight']) && $pconfig['weight'] > 1) || (isset($pconfig['interval']) && ($pconfig['interval'] > $apinger_default['interval'])) || (isset($pconfig['down']) && !($pconfig['down'] == $apinger_default['down']))); ?>
diff --git a/usr/local/www/system_groupmanager.php b/usr/local/www/system_groupmanager.php
index a02e986..27cd2f2 100644
--- a/usr/local/www/system_groupmanager.php
+++ b/usr/local/www/system_groupmanager.php
@@ -116,7 +116,7 @@ if ($_POST) {
 	$reqdfields = explode(" ", "groupname");
 	$reqdfieldsn = array(gettext("Group Name"));
 	
-	do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+	do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 	
 	if (preg_match("/[^a-zA-Z0-9\.\-_ ]/", $_POST['groupname']))
 		$input_errors[] = gettext("The group name contains invalid characters.");
diff --git a/usr/local/www/system_groupmanager_addprivs.php b/usr/local/www/system_groupmanager_addprivs.php
index f4e0dd0..29f0193 100644
--- a/usr/local/www/system_groupmanager_addprivs.php
+++ b/usr/local/www/system_groupmanager_addprivs.php
@@ -78,7 +78,7 @@ if ($_POST) {
 	$reqdfields = explode(" ", "sysprivs");
 	$reqdfieldsn = array(gettext("Selected priveleges"));
 
-	do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+	do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 
 	/* if this is an AJAX caller then handle via JSON */
 	if(isAjax() && is_array($input_errors)) {
diff --git a/usr/local/www/system_routes.php b/usr/local/www/system_routes.php
index 96ee9b9..b5dd849 100755
--- a/usr/local/www/system_routes.php
+++ b/usr/local/www/system_routes.php
@@ -48,8 +48,8 @@ if (!is_array($config['staticroutes']['route']))
 	$config['staticroutes']['route'] = array();
 
 $a_routes = &$config['staticroutes']['route'];
-$a_gateways = return_gateways_array(true, true, true);
-$changedesc_prefix = gettext("Static Routes") . ": ";
+$a_gateways = return_gateways_array(true, true);
+$changedesc = gettext("Static Routes") . ": ";
 
 if ($_POST) {
 
@@ -78,117 +78,33 @@ if ($_POST) {
 	}
 }
 
-function delete_static_route($id) {
-	global $config, $a_routes, $changedesc_prefix;
-
-	if (!isset($a_routes[$id]))
-		return;
-
-	$targets = array();
-	if (is_alias($a_routes[$id]['network'])) {
-		foreach (filter_expand_alias_array($a_routes[$id]['network']) as $tgt) {
-			if (is_ipaddrv4($tgt))
-				$tgt .= "/32";
-			else if (is_ipaddrv6($tgt))
-				$tgt .= "/128";
-			if (!is_subnet($tgt))
-				continue;
-			$targets[] = $tgt;
-		}
-	} else {
-		$targets[] = $a_routes[$id]['network'];
-	}
-
-	foreach ($targets as $tgt) {
-		$family = (is_subnetv6($tgt) ? "-inet6" : "-inet");
-		mwexec("/sbin/route delete {$family} " . escapeshellarg($tgt));
-	}
-
-	unset($targets);
-}
-
 if ($_GET['act'] == "del") {
 	if ($a_routes[$_GET['id']]) {
-		$changedesc = $changedesc_prefix . gettext("removed route to") . " " . $a_routes[$_GET['id']]['network'];
-		delete_static_route($_GET['id']);
-		unset($a_routes[$_GET['id']]);
-		write_config($changedesc);
-		header("Location: system_routes.php");
-		exit;
-	}
-}
-
-if (isset($_POST['del_x'])) {
-	/* delete selected routes */
-	if (is_array($_POST['route']) && count($_POST['route'])) {
-		$changedesc = $changedesc_prefix . gettext("removed route to");
-		foreach ($_POST['route'] as $routei) {
-			$changedesc .= " " . $a_routes[$routei]['network'];
-			delete_static_route($routei);
-			unset($a_routes[$routei]);
-		}
-		write_config($changedesc);
-		header("Location: system_routes.php");
-		exit;
-	}
-
-} else if ($_GET['act'] == "toggle") {
-	if ($a_routes[$_GET['id']]) {
-		if(isset($a_routes[$_GET['id']]['disabled'])) {
-			unset($a_routes[$_GET['id']]['disabled']);
-			$changedesc = $changedesc_prefix . gettext("enabled route to") . " " . $a_routes[$id]['network'];
+		$changedesc .= gettext("removed route to") . " " . $a_routes[$_GET['id']]['route'];
+
+		$targets = array();
+		if (is_alias($a_routes[$_GET['id']]['network'])) {
+			foreach (filter_expand_alias_array($a_routes[$_GET['id']]['network']) as $tgt) {
+				if (is_ipaddrv4($tgt))
+					$tgt .= "/32";
+				else if (is_ipaddrv6($tgt))
+					$tgt .= "/128";
+				if (!is_subnet($tgt))
+					continue;
+				$targets[] = $tgt;
+			}
 		} else {
-			delete_static_route($_GET['id']);
-			$a_routes[$_GET['id']]['disabled'] = true;
-			$changedesc = $changedesc_prefix . gettext("disabled route to") . " " . $a_routes[$id]['network'];
+			$targets[] = $a_routes[$_GET['id']]['network'];
 		}
 
-		if (write_config($changedesc))
-			mark_subsystem_dirty('staticroutes');
-		header("Location: system_routes.php");
-		exit;
-	}
-} else {
-	/* yuck - IE won't send value attributes for image buttons, while Mozilla does - so we use .x/.y to find move button clicks instead... */
-	unset($movebtn);
-	foreach ($_POST as $pn => $pd) {
-		if (preg_match("/move_(\d+)_x/", $pn, $matches)) {
-			$movebtn = $matches[1];
-			break;
-		}
-	}
-	/* move selected routes before this route */
-	if (isset($movebtn) && is_array($_POST['route']) && count($_POST['route'])) {
-		$a_routes_new = array();
-
-		/* copy all routes < $movebtn and not selected */
-		for ($i = 0; $i < $movebtn; $i++) {
-			if (!in_array($i, $_POST['route']))
-				$a_routes_new[] = $a_routes[$i];
+		foreach ($targets as $tgt) {
+			$family = (is_subnetv6($tgt) ? "-inet6" : "-inet");
+			mwexec("/sbin/route delete {$family} " . escapeshellarg($tgt));
 		}
 
-		/* copy all selected routes */
-		for ($i = 0; $i < count($a_routes); $i++) {
-			if ($i == $movebtn)
-				continue;
-			if (in_array($i, $_POST['route']))
-				$a_routes_new[] = $a_routes[$i];
-		}
-
-		/* copy $movebtn route */
-		if ($movebtn < count($a_routes))
-			$a_routes_new[] = $a_routes[$movebtn];
-
-		/* copy all routes > $movebtn and not selected */
-		for ($i = $movebtn+1; $i < count($a_routes); $i++) {
-			if (!in_array($i, $_POST['route']))
-				$a_routes_new[] = $a_routes[$i];
-		}
-		if (count($a_routes_new) > 0)
-			$a_routes = $a_routes_new;
-
-		if (write_config())
-			mark_subsystem_dirty('staticroutes');
+		unset($a_routes[$_GET['id']]);
+		unset($targets);
+		write_config($changedesc);
 		header("Location: system_routes.php");
 		exit;
 	}
@@ -204,7 +120,7 @@ include("head.inc");
 <body link="#0000CC" vlink="#0000CC" alink="#0000CC">
 <?php include("fbegin.inc"); ?>
 <form action="system_routes.php" method="post">
-<script type="text/javascript" language="javascript" src="/javascript/row_toggle.js"></script>
+<input type="hidden" name="y1" value="1" />
 <?php if ($savemsg) print_info_box($savemsg); ?>
 <?php if (is_subsystem_dirty('staticroutes')): ?><p>
 <?php print_info_box_np(sprintf(gettext("The static route configuration has been changed.%sYou must apply the changes in order for them to take effect."), "<br/>"));?><br/></p>
@@ -226,13 +142,11 @@ include("head.inc");
 		<td>
 			<div id="mainarea">
 				<table class="tabcont" width="100%" border="0" cellpadding="0" cellspacing="0" summary="main area">
-					<tr id="frheader">
-						<td width="2%" class="list">&nbsp;</td>
-						<td width="2%" class="list">&nbsp;</td>
-						<td width="22%" class="listhdrr"><?=gettext("Network");?></td>
+					<tr>
+						<td width="25%" class="listhdrr"><?=gettext("Network");?></td>
 						<td width="20%" class="listhdrr"><?=gettext("Gateway");?></td>
 						<td width="15%" class="listhdrr"><?=gettext("Interface");?></td>
-						<td width="29%" class="listhdr"><?=gettext("Description");?></td>
+						<td width="30%" class="listhdr"><?=gettext("Description");?></td>
 						<td width="10%" class="list">
 							<table border="0" cellspacing="0" cellpadding="1" summary="add">
 								<tr>
@@ -243,120 +157,55 @@ include("head.inc");
 						</td>
 					</tr>
 					<?php $i = 0; foreach ($a_routes as $route): ?>
-					<tr valign="top" id="fr<?=$i;?>">
+					<tr>
 					<?php
-						$iconfn = "pass";
 						if (isset($route['disabled'])) {
 							$textss = "<span class=\"gray\">";
 							$textse = "</span>";
-							$iconfn .= "_d";
 						} else
-							$textss = $textse = "";
+						$textss = $textse = "";
 					?>
-						<td class="listt">
-							<input type="checkbox" id="frc<?=$i;?>" name="route[]" value="<?=$i;?>" onclick="fr_bgcolor('<?=$i;?>')" style="margin: 0; padding: 0; width: 15px; height: 15px;" />
-						</td>
-						<td class="listt" align="center">
-							<a href="?act=toggle&amp;id=<?=$i;?>">
-								<img src="./themes/<?= $g['theme']; ?>/images/icons/icon_<?=$iconfn;?>.gif" width="11" height="11" border="0"
-									title="<?=gettext("click to toggle enabled/disabled status");?>" alt="icon" />
-							</a>
-						</td>
-						<td class="listlr" onclick="fr_toggle(<?=$i;?>)" id="frd<?=$i;?>" ondblclick="document.location='system_routes_edit.php?id=<?=$i;?>';">
+						<td class="listlr" ondblclick="document.location='system_routes_edit.php?id=<?=$i;?>';">
 							<?=$textss;?><?=strtolower($route['network']);?><?=$textse;?>
 						</td>
-						<td class="listr" onclick="fr_toggle(<?=$i;?>)" id="frd<?=$i;?>" ondblclick="document.location='system_routes_edit.php?id=<?=$i;?>';">
+						<td class="listr" ondblclick="document.location='system_routes_edit.php?id=<?=$i;?>';">
 							<?=$textss;?>
 							<?php
 								echo htmlentities($a_gateways[$route['gateway']]['name']) . " - " . htmlentities($a_gateways[$route['gateway']]['gateway']);
 							?>
 							<?=$textse;?>
 						</td>
-						<td class="listr" onclick="fr_toggle(<?=$i;?>)" id="frd<?=$i;?>" ondblclick="document.location='system_routes_edit.php?id=<?=$i;?>';">
+						<td class="listr" ondblclick="document.location='system_routes_edit.php?id=<?=$i;?>';">
 							<?=$textss;?>
 							<?php
 								echo convert_friendly_interface_to_friendly_descr($a_gateways[$route['gateway']]['friendlyiface']) . " ";
 							?>
 							<?=$textse;?>
 						</td>
-						<td class="listbg" onclick="fr_toggle(<?=$i;?>)" ondblclick="document.location='system_routes_edit.php?id=<?=$i;?>';">
+						<td class="listbg" ondblclick="document.location='system_routes_edit.php?id=<?=$i;?>';">
 							<?=$textss;?><?=htmlspecialchars($route['descr']);?>&nbsp;<?=$textse;?>
 						</td>
-						<td class="list nowrap" valign="middle">
-							<table border="0" cellspacing="0" cellpadding="1" summary="move">
+						<td valign="middle" class="list nowrap">
+							<table border="0" cellspacing="0" cellpadding="1" summary="edit">
 								<tr>
-									<td>
-										<input onmouseover="fr_insline(<?=$i;?>, true)" onmouseout="fr_insline(<?=$i;?>, false)" name="move_<?=$i;?>"
-											src="/themes/<?= $g['theme']; ?>/images/icons/icon_left.gif"
-											title="<?=gettext("move selected rules before this rule");?>"
-											type="image" style="height:17;width:17;border:0" />
-									</td>
-									<td>
-										<a href="system_routes_edit.php?id=<?=$i;?>">
-											<img src="/themes/<?= $g['theme']; ?>/images/icons/icon_e.gif" width="17" height="17" border="0" title="<?=gettext("edit rule");?>" alt="edit" />
-										</a>
-									</td>
+									<td><a href="system_routes_edit.php?id=<?=$i;?>"><img src="./themes/<?= $g['theme']; ?>/images/icons/icon_e.gif" width="17" height="17" border="0" alt="edit" /></a>
+									<td><a href="system_routes.php?act=del&amp;id=<?=$i;?>" onclick="return confirm('<?=gettext("Do you really want to delete this route?");?>')"><img src="./themes/<?= $g['theme']; ?>/images/icons/icon_x.gif" width="17" height="17" border="0" alt="delete" /></a></td>
 								</tr>
 								<tr>
-									<td align="center" valign="middle">
-										<a href="system_routes.php?act=del&amp;id=<?=$i;?>" onclick="return confirm('<?=gettext("Do you really want to delete this rule?");?>')">
-											<img src="./themes/<?= $g['theme']; ?>/images/icons/icon_x.gif" width="17" height="17" border="0" title="<?=gettext("delete rule");?>" alt="delete" />
-										</a>
-									</td>
-									<td>
-										<a href="system_routes_edit.php?dup=<?=$i;?>">
-											<img src="/themes/<?= $g['theme']; ?>/images/icons/icon_plus.gif" title="<?=gettext("add a new rule based on this one");?>" width="17" height="17" border="0" alt="duplicate" />
-										</a>
-									</td>
+									<td width="17"></td>
+									<td><a href="system_routes_edit.php?dup=<?=$i;?>"><img src="./themes/<?= $g['theme']; ?>/images/icons/icon_plus.gif" width="17" height="17" border="0" alt="add" /></a></td>
 								</tr>
 							</table>
 						</td>
 					</tr>
 					<?php $i++; endforeach; ?>
 					<tr>
-						<td class="list" colspan="6"></td>
-						<td class="list nowrap" valign="middle">
+						<td class="list" colspan="4"></td>
+						<td class="list">
 							<table border="0" cellspacing="0" cellpadding="1" summary="edit">
 								<tr>
-									<td>
-<?php
-									if ($i == 0):
-?>
-										<img src="/themes/<?= $g['theme']; ?>/images/icons/icon_left_d.gif" width="17" height="17"
-											title="<?=gettext("move selected routes to end");?>" border="0" alt="move" />
-<?php
-									else:
-?>
-										<input name="move_<?=$i;?>" type="image" src="/themes/<?= $g['theme']; ?>/images/icons/icon_left.gif"
-											style="width:17;height:17;border:0" title="<?=gettext("move selected routes to end");?>" />
-<?php
-									endif;
-?>
-									</td>
-									<td>
-										<a href="system_routes_edit.php">
-											<img src="/themes/<?= $g['theme']; ?>/images/icons/icon_plus.gif" width="17" height="17" border="0"
-											title="<?=gettext("add new route");?>" alt="add" />
-										</a>
-									</td>
-								</tr>
-								<tr>
-									<td>
-<?php
-									if ($i == 0):
-?>
-										<img src="/themes/<?= $g['theme']; ?>/images/icons/icon_x_d.gif" width="17" height="17"
-											title="<?=gettext("delete selected rules");?>" border="0" alt="delete" />
-<?php
-									else:
-?>
-										<input name="del" type="image" src="/themes/<?= $g['theme']; ?>/images/icons/icon_x.gif"
-											style="width:17;height:17" title="<?=gettext("delete selected routes");?>"
-											onclick="return confirm('<?=gettext("Do you really want to delete the selected routes?");?>')" />
-<?php
-									endif;
-?>
-									</td>
+									<td width="17"></td>
+									<td><a href="system_routes_edit.php"><img src="./themes/<?= $g['theme']; ?>/images/icons/icon_plus.gif" width="17" height="17" border="0" alt="edit" /></a></td>
 								</tr>
 							</table>
 						</td>
diff --git a/usr/local/www/system_routes_edit.php b/usr/local/www/system_routes_edit.php
index 4fc531e..631fab0 100755
--- a/usr/local/www/system_routes_edit.php
+++ b/usr/local/www/system_routes_edit.php
@@ -39,6 +39,19 @@
 ##|*MATCH=system_routes_edit.php*
 ##|-PRIV
 
+function staticroutecmp($a, $b) {
+	return strcmp($a['network'], $b['network']);
+}
+
+function staticroutes_sort() {
+	global $g, $config;
+
+	if (!is_array($config['staticroutes']['route']))
+		return;
+
+	usort($config['staticroutes']['route'], "staticroutecmp");
+}
+
 require_once("guiconfig.inc");
 require_once("filter.inc");
 require_once("util.inc");
@@ -83,7 +96,7 @@ if ($_POST) {
 			gettext("Destination network bit count") . "," .
 			gettext("Gateway"));
 
-	do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+	do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 
 	if (($_POST['network'] && !is_ipaddr($_POST['network']) && !is_alias($_POST['network']))) {
 		$input_errors[] = gettext("A valid IPv4 or IPv6 destination network must be specified.");
@@ -114,16 +127,19 @@ if ($_POST) {
 		}
 	} elseif (is_alias($_POST['network'])) {
 		$osn = $_POST['network'];
-		foreach (preg_split('/\s+/', $aliastable[$osn]) as $tgt) {
+		$fqdn_found = 0;
+		foreach (filter_expand_alias_array($osn, true) as $tgt) {
 			if (is_ipaddrv4($tgt))
 				$tgt .= "/32";
 			if (is_ipaddrv6($tgt))
 				$tgt .= "/128";
-			if (!is_subnet($tgt))
-				continue;
-			if (!is_subnetv6($tgt))
-				continue;
-			$new_targets[] = $tgt;
+			if (is_fqdn($tgt)) {
+				$input_errors[] = sprintf(gettext("The alias (%s) has one or more FQDNs configured and cannot be used to configure a static route."), $_POST['network']);
+				$fqdn_found = 1;
+				break;
+			}
+			if (is_subnet($tgt))
+				$new_targets[] = $tgt;
 		}
 	}
 	if (!isset($id))
@@ -196,6 +212,7 @@ if ($_POST) {
 				}
 		}
 		file_put_contents("{$g['tmp_path']}/.system_routes.apply", serialize($toapplylist));
+		staticroutes_sort();
 
 		mark_subsystem_dirty('staticroutes');
 
diff --git a/usr/local/www/system_usermanager.php b/usr/local/www/system_usermanager.php
index 4754941..4d486a2 100644
--- a/usr/local/www/system_usermanager.php
+++ b/usr/local/www/system_usermanager.php
@@ -35,7 +35,7 @@
     POSSIBILITY OF SUCH DAMAGE.
 */
 /*
-	pfSense_BUILDER_BINARIES:
+	pfSense_BUILDER_BINARIES:	
 	pfSense_MODULE:	auth
 */
 
@@ -57,7 +57,7 @@ $id = $_GET['id'];
 if (isset($_POST['id']))
 	$id = $_POST['id'];
 
-if (!is_array($config['system']['user']))
+if (!is_array($config['system']['user'])) 
 	$config['system']['user'] = array();
 
 $a_user = &$config['system']['user'];
@@ -82,9 +82,7 @@ if ($_GET['act'] == "deluser") {
 		exit;
 	}
 
-	conf_mount_rw();
 	local_user_del($a_user[$id]);
-	conf_mount_ro();
 	$userdeleted = $a_user[$id]['name'];
 	unset($a_user[$id]);
 	write_config();
@@ -195,7 +193,7 @@ if ($_POST) {
 		}
 	}
 
-	do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+	do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 
 	if (preg_match("/[^a-zA-Z0-9\.\-_]/", $_POST['usernamefld']))
 		$input_errors[] = gettext("The username contains invalid characters.");
@@ -284,10 +282,10 @@ if ($_POST) {
 		$userent['expires'] = $_POST['expires'];
 		$userent['authorizedkeys'] = base64_encode($_POST['authorizedkeys']);
 		$userent['ipsecpsk'] = $_POST['ipsecpsk'];
-
+		
 		if($_POST['disabled'])
 			$userent['disabled'] = true;
-		else
+		else 
 			unset($userent['disabled']);
 
 		if (isset($id) && $a_user[$id])
@@ -340,7 +338,7 @@ if ($_POST) {
 			run_plugins("/etc/inc/privhooks");
 
 		conf_mount_ro();
-
+		
 		pfSenseHeader("system_usermanager.php");
 	}
 }
@@ -348,18 +346,14 @@ if ($_POST) {
 include("head.inc");
 ?>
 
-<link rel="stylesheet" type="text/css" href="/javascript/jquery-ui-timepicker-addon/css/jquery-ui-timepicker-addon.css" />
-<link rel="stylesheet" type="text/css" href="/javascript/jquery/jquery-ui.custom.css" />
-
-<script>
-	jQuery(function() {
-		jQuery( "#expires" ).datepicker( { dateFormat: 'mm/dd/yy', changeYear: true, yearRange: "+0:+100" } );
-	});
-</script>
-
 <body link="#000000" vlink="#000000" alink="#000000" onload="<?= $jsevents["body"]["onload"] ?>">
 <?php include("fbegin.inc"); ?>
-
+<!--
+//Date Time Picker script- by TengYong Ng of http://www.rainforestnet.com
+//Script featured on JavaScript Kit (http://www.javascriptkit.com)
+//For this script, visit http://www.javascriptkit.com
+// -->
+<script type="text/javascript" src="javascript/datetimepicker.js"></script>
 <script type="text/javascript">
 //<![CDATA[
 
@@ -505,6 +499,9 @@ function sshkeyClicked(obj) {
 							<td width="22%" valign="top" class="vncell"><?=gettext("Expiration date"); ?></td>
 							<td width="78%" class="vtable">
 								<input name="expires" type="text" class="formfld unknown" id="expires" size="10" value="<?=htmlspecialchars($pconfig['expires']);?>" />
+								<a href="javascript:NewCal('expires','mmddyyyy')">
+									<img src="/themes/<?php echo $g['theme']; ?>/images/icons/icon_cal.gif" width="16" height="16" border="0" alt="<?=gettext("Pick a date");?>" />
+								</a>
 								<br/>
 								<span class="vexpl"><?=gettext("Leave blank if the account shouldn't expire, otherwise enter the expiration date in the following format: mm/dd/yyyy"); ?></span></td>
 						</tr>
@@ -580,7 +577,7 @@ function sshkeyClicked(obj) {
 										<td class="list"></td>
 									</tr>
 									<?php
-
+											
 										$privdesc = get_user_privdesc($a_user[$id]);
 										if(is_array($privdesc)):
 											$i = 0;
@@ -633,7 +630,7 @@ function sshkeyClicked(obj) {
 										<td class="list"></td>
 									</tr>
 									<?php
-
+										
 										$a_cert = $a_user[$id]['cert'];
 										if(is_array($a_cert)):
 											$i = 0;
@@ -873,5 +870,4 @@ function sshkeyClicked(obj) {
 </table>
 <?php include("fend.inc");?>
 </body>
-</html>
-
+</html>
\ No newline at end of file
diff --git a/usr/local/www/system_usermanager_addprivs.php b/usr/local/www/system_usermanager_addprivs.php
index df537e9..c7e1d3a 100644
--- a/usr/local/www/system_usermanager_addprivs.php
+++ b/usr/local/www/system_usermanager_addprivs.php
@@ -83,7 +83,7 @@ if ($_POST) {
 	$reqdfields = explode(" ", "sysprivs");
 	$reqdfieldsn = array(gettext("Selected priveleges"));
 
-	do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+	do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 
 	/* if this is an AJAX caller then handle via JSON */
 	if(isAjax() && is_array($input_errors)) {
diff --git a/usr/local/www/system_usermanager_passwordmg.php b/usr/local/www/system_usermanager_passwordmg.php
index a35a8a4..55f8150 100644
--- a/usr/local/www/system_usermanager_passwordmg.php
+++ b/usr/local/www/system_usermanager_passwordmg.php
@@ -48,18 +48,15 @@ if (isset($_POST['save'])) {
 
 	$reqdfields = explode(" ", "passwordfld1");
 	$reqdfieldsn = array(gettext("Password"));
-	do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+	do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 
 	if ($_POST['passwordfld1'] != $_POST['passwordfld2'])
 		$input_errors[] = gettext("The passwords do not match.");
 
 	if (!$input_errors) {
-		if (!session_id())
-			session_start();
 		// all values are okay --> saving changes
-		$config['system']['user'][$userindex[$_SESSION['Username']]]['password'] = crypt(trim($_POST['passwordfld1']));
-		local_user_set($config['system']['user'][$userindex[$_SESSION['Username']]]);
-		session_commit();
+		$config['system']['user'][$userindex[$HTTP_SERVER_VARS['AUTH_USER']]]['password'] = crypt(trim($_POST['passwordfld1']));
+		local_user_set($config['system']['user'][$userindex[$HTTP_SERVER_VARS['AUTH_USER']]]);
 
 		write_config();
 
@@ -104,11 +101,7 @@ if ($islocal == false) {
                 <form action="system_usermanager_passwordmg.php" method="post" name="iform" id="iform">
                         <table width="100%" border="0" cellpadding="6" cellspacing="0" summary="main area">
                                 <tr>
-<?php if (!session_id())
-		session_start();
-?>
-                                        <td colspan="2" valign="top" class="listtopic"><?=$_SESSION['Username']?>'s <?=gettext("Password"); ?></td>
-<?php session_commit(); ?>
+                                        <td colspan="2" valign="top" class="listtopic"><?=$HTTP_SERVER_VARS['AUTH_USER']?>'s <?=gettext("Password"); ?></td>
                                 </tr>
                                 <tr>
                                         <td width="22%" valign="top" class="vncell" rowspan="2"><?=gettext("Password"); ?></td>
diff --git a/usr/local/www/system_usermanager_settings.php b/usr/local/www/system_usermanager_settings.php
index 8895f0e..33b6b82 100755
--- a/usr/local/www/system_usermanager_settings.php
+++ b/usr/local/www/system_usermanager_settings.php
@@ -1,34 +1,34 @@
 <?php
 /* $Id$ */
 /*
-	part of pfSense (http://www.pfsense.org/)
+    part of pfSense (http://www.pfsense.org/)
 
 	Copyright (C) 2007 Scott Ullrich <sullrich@gmail.com>
 	All rights reserved.
 
-	Copyright (C) 2007 Bill Marquette <bill.marquette@gmail.com>
-	All rights reserved.
-
-	Redistribution and use in source and binary forms, with or without
-	modification, are permitted provided that the following conditions are met:
-
-	1. Redistributions of source code must retain the above copyright notice,
-	   this list of conditions and the following disclaimer.
-
-	2. Redistributions in binary form must reproduce the above copyright
-	   notice, this list of conditions and the following disclaimer in the
-	   documentation and/or other materials provided with the distribution.
-
-	THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES,
-	INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY
-	AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
-	AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY,
-	OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
-	SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
-	INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
-	CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
-	ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
-	POSSIBILITY OF SUCH DAMAGE.
+    Copyright (C) 2007 Bill Marquette <bill.marquette@gmail.com>
+    All rights reserved.
+
+    Redistribution and use in source and binary forms, with or without
+    modification, are permitted provided that the following conditions are met:
+
+    1. Redistributions of source code must retain the above copyright notice,
+       this list of conditions and the following disclaimer.
+
+    2. Redistributions in binary form must reproduce the above copyright
+       notice, this list of conditions and the following disclaimer in the
+       documentation and/or other materials provided with the distribution.
+
+    THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES,
+    INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY
+    AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
+    AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY,
+    OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
+    SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
+    INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
+    CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
+    ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
+    POSSIBILITY OF SUCH DAMAGE.
 */
 /*
 	pfSense_MODULE:	auth
@@ -107,70 +107,70 @@ include("head.inc");
 	}
 ?>
 
-	<table width="100%" border="0" cellpadding="0" cellspacing="0" summary="user manager settings">
-		<tr>
-			<td class="tabnavtbl">
+  <table width="100%" border="0" cellpadding="0" cellspacing="0" summary="user manager settings">
+    <tr>
+      <td class="tabnavtbl">
 <?php
-				$tab_array = array();
-				$tab_array[] = array(gettext("Users"), false, "system_usermanager.php");
-				$tab_array[] = array(gettext("Groups"), false, "system_groupmanager.php");
-				$tab_array[] = array(gettext("Settings"), true, "system_usermanager_settings.php");
-				$tab_array[] = array(gettext("Servers"), false, "system_authservers.php");
-				display_top_tabs($tab_array);
-
-				/* Default to pfsense backend type if none is defined */
-				if(!$pconfig['backend'])
-					$pconfig['backend'] = "pfsense";
+    $tab_array = array();
+    $tab_array[] = array(gettext("Users"), false, "system_usermanager.php");
+    $tab_array[] = array(gettext("Groups"), false, "system_groupmanager.php");
+    $tab_array[] = array(gettext("Settings"), true, "system_usermanager_settings.php");
+    $tab_array[] = array(gettext("Servers"), false, "system_authservers.php");
+    display_top_tabs($tab_array);
+
+/* Default to pfsense backend type if none is defined */
+if(!$pconfig['backend'])
+	$pconfig['backend'] = "pfsense";
+
 ?>
+      </td>
+    </tr>
+    <tr>
+       <td>
+            <div id="mainarea">
+            <form id="iform" name="iform" action="system_usermanager_settings.php" method="post">
+              <table class="tabcont" width="100%" border="0" cellspacing="0" cellpadding="6" summary="main area">
+		<tr>
+                        <td width="22%" valign="top" class="vncell"><?=gettext("Session Timeout"); ?></td>
+                        <td width="78%" class="vtable">
+				<input name="session_timeout" id="session_timeout" type="text" size="8" value="<?=htmlspecialchars($pconfig['session_timeout']);?>" />
+                          	<br />
+				<?=gettext("Time in minutes to expire idle management sessions. The default is 4 hours (240 minutes).");?><br/>
+				<?=gettext("Enter 0 to never expire sessions. NOTE: This is a security risk!");?><br />
 			</td>
 		</tr>
 		<tr>
-			<td>
-				<div id="mainarea">
-					<form id="iform" name="iform" action="system_usermanager_settings.php" method="post">
-						<table class="tabcont" width="100%" border="0" cellspacing="0" cellpadding="6" summary="main area">
-							<tr>
-								<td width="22%" valign="top" class="vncell"><?=gettext("Session Timeout"); ?></td>
-								<td width="78%" class="vtable">
-									<input name="session_timeout" id="session_timeout" type="text" size="8" value="<?=htmlspecialchars($pconfig['session_timeout']);?>" />
-									<br />
-									<?=gettext("Time in minutes to expire idle management sessions. The default is 4 hours (240 minutes).");?><br/>
-									<?=gettext("Enter 0 to never expire sessions. NOTE: This is a security risk!");?><br />
-								</td>
-							</tr>
-							<tr>
-								<td width="22%" valign="top" class="vncell"><?=gettext("Authentication Server"); ?></td>
-								<td width="78%" class="vtable">
-									<select name='authmode' id='authmode' class="formselect" >
-<?php
-									$auth_servers = auth_get_authserver_list();
-									foreach ($auth_servers as $auth_server):
-										$selected = "";
-										if ($auth_server['name'] == $pconfig['authmode'])
-											$selected = "selected=\"selected\"";
-										if (!isset($pconfig['authmode']) && $auth_server['name'] == "Local Database")
-											$selected = "selected=\"selected\"";
-?>
-										<option value="<?=$auth_server['name'];?>" <?=$selected;?>><?=$auth_server['name'];?></option>
-<?php
-									endforeach;
-?>
-									</select>
-								</td>
-							</tr>
-							<tr>
-								<td width="22%" valign="top">&nbsp;</td>
-								<td width="78%">
-									<input id="save" name="save" type="submit" class="formbtn" value="<?=gettext("Save");?>" />
-									<input id="savetest" name="savetest" type="submit" class="formbtn" value="<?=gettext("Save and Test");?>" />
-								</td>
-							</tr>
-						</table>
-					</form>
-				</div>
+                        <td width="22%" valign="top" class="vncell"><?=gettext("Authentication Server"); ?></td>
+                        <td width="78%" class="vtable">
+				<select name='authmode' id='authmode' class="formselect" >
+                                        <?php
+						$auth_servers = auth_get_authserver_list();
+                                        	foreach ($auth_servers as $auth_server):
+                                                	$selected = "";
+                                                        if ($auth_server['name'] == $pconfig['authmode'])
+                                                        	$selected = "selected=\"selected\"";
+							if (!isset($pconfig['authmode']) && $auth_server['name'] == "Local Database")
+								$selected = "selected=\"selected\"";
+
+                                        ?>
+                                        <option value="<?=$auth_server['name'];?>" <?=$selected;?>><?=$auth_server['name'];?></option>
+                                        <?php   endforeach; ?>
+                                </select>
 			</td>
 		</tr>
-	</table>
+		<tr>
+			<td width="22%" valign="top">&nbsp;</td>
+			<td width="78%">
+				<input id="save" name="save" type="submit" class="formbtn" value="<?=gettext("Save");?>" />
+				<input id="savetest" name="savetest" type="submit" class="formbtn" value="<?=gettext("Save and Test");?>" />
+			</td>
+               	</tr>
+              </table>
+            </form>
+            </div>
+      </td>
+    </tr>
+  </table>
 <?php include("fend.inc");?>
 </body>
 </html>
diff --git a/usr/local/www/vpn_ipsec_keys_edit.php b/usr/local/www/vpn_ipsec_keys_edit.php
index a561990..5a04c08 100644
--- a/usr/local/www/vpn_ipsec_keys_edit.php
+++ b/usr/local/www/vpn_ipsec_keys_edit.php
@@ -68,7 +68,7 @@ if ($_POST) {
 	$reqdfields = explode(" ", "ident psk");
 	$reqdfieldsn = array(gettext("Identifier"),gettext("Pre-Shared Key"));
 	
-	do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+	do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 	
 	if (preg_match("/[^a-zA-Z0-9@\.\-]/", $_POST['ident']))
 		$input_errors[] = gettext("The identifier contains invalid characters.");
diff --git a/usr/local/www/vpn_ipsec_mobile.php b/usr/local/www/vpn_ipsec_mobile.php
index d483f8b..30927c2 100755
--- a/usr/local/www/vpn_ipsec_mobile.php
+++ b/usr/local/www/vpn_ipsec_mobile.php
@@ -131,7 +131,7 @@ if ($_POST['submit']) {
 	$reqdfields = explode(" ", "user_source group_source");
 	$reqdfieldsn =  array(gettext("User Authentication Source"),gettext("Group Authentication Source"));
 
-    do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+    do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 
 	if ($pconfig['pool_enable'])
 		if (!is_ipaddr($pconfig['pool_address']))
diff --git a/usr/local/www/vpn_ipsec_phase1.php b/usr/local/www/vpn_ipsec_phase1.php
index 76a78ae..90c2c34 100644
--- a/usr/local/www/vpn_ipsec_phase1.php
+++ b/usr/local/www/vpn_ipsec_phase1.php
@@ -171,7 +171,7 @@ if ($_POST) {
 		$reqdfieldsn[] = gettext("Remote gateway");
 	}
 
-	do_input_validation($pconfig, $reqdfields, $reqdfieldsn, $input_errors);
+	do_input_validation($pconfig, $reqdfields, $reqdfieldsn, &$input_errors);
 
 	if (($pconfig['lifetime'] && !is_numeric($pconfig['lifetime'])))
 		$input_errors[] = gettext("The P1 lifetime must be an integer.");
diff --git a/usr/local/www/vpn_ipsec_phase2.php b/usr/local/www/vpn_ipsec_phase2.php
index b5c0f41..483c8ac 100644
--- a/usr/local/www/vpn_ipsec_phase2.php
+++ b/usr/local/www/vpn_ipsec_phase2.php
@@ -118,7 +118,7 @@ if ($_POST) {
 		$reqdfieldsn[] = gettext("Remote network type");
 	}
 
-	do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+	do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 
 	if(($pconfig['mode'] == "tunnel") || ($pconfig['mode'] == "tunnel6")) 
 	{
diff --git a/usr/local/www/vpn_l2tp.php b/usr/local/www/vpn_l2tp.php
index 47228c1..cedcef5 100644
--- a/usr/local/www/vpn_l2tp.php
+++ b/usr/local/www/vpn_l2tp.php
@@ -79,7 +79,7 @@ if ($_POST) {
 				array(gettext("RADIUS server address"),gettext("RADIUS shared secret")));
 		}
 
-		do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+		do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 
 		if (($_POST['localip'] && !is_ipaddr($_POST['localip']))) {
 			$input_errors[] = gettext("A valid server address must be specified.");
diff --git a/usr/local/www/vpn_l2tp_users_edit.php b/usr/local/www/vpn_l2tp_users_edit.php
index f4ef5f0..28e9707 100644
--- a/usr/local/www/vpn_l2tp_users_edit.php
+++ b/usr/local/www/vpn_l2tp_users_edit.php
@@ -82,7 +82,7 @@ if ($_POST) {
 		$reqdfieldsn = array(gettext("Username"),gettext("Password"));
 	}
 
-	do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+	do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 
 	if (preg_match("/[^a-zA-Z0-9\.\-_]/", $_POST['usernamefld']))
 		$input_errors[] = gettext("The username contains invalid characters.");
diff --git a/usr/local/www/vpn_openvpn_client.php b/usr/local/www/vpn_openvpn_client.php
index 5604b32..6452895 100644
--- a/usr/local/www/vpn_openvpn_client.php
+++ b/usr/local/www/vpn_openvpn_client.php
@@ -92,8 +92,6 @@ if($_GET['act']=="new"){
 	$pconfig['autotls_enable'] = "yes";
 	$pconfig['interface'] = "wan";
 	$pconfig['server_port'] = 1194;
-	// OpenVPN Defaults to SHA1
-	$pconfig['digest'] = "SHA1";
 }
 
 if($_GET['act']=="edit"){
@@ -131,8 +129,6 @@ if($_GET['act']=="edit"){
 		} else
 			$pconfig['shared_key'] = base64_decode($a_client[$id]['shared_key']);
 		$pconfig['crypto'] = $a_client[$id]['crypto'];
-		// OpenVPN Defaults to SHA1 if unset
-		$pconfig['digest'] = !empty($a_client[$id]['digest']) ? $a_client[$id]['digest'] : "SHA1";
 		$pconfig['engine'] = $a_client[$id]['engine'];
 
 		$pconfig['tunnel_network'] = $a_client[$id]['tunnel_network'];
@@ -246,7 +242,7 @@ if ($_POST) {
 		$reqdfieldsn = array(gettext('Shared key'));
 	}
 
-	do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+	do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 	
 	if (!$input_errors) {
 
@@ -287,7 +283,6 @@ if ($_POST) {
             $client['shared_key'] = base64_encode($pconfig['shared_key']);
         }
 		$client['crypto'] = $pconfig['crypto'];
-		$client['digest'] = $pconfig['digest'];
 		$client['engine'] = $pconfig['engine'];
 
 		$client['tunnel_network'] = $pconfig['tunnel_network'];
@@ -767,24 +762,6 @@ if ($savemsg)
 							</select>
 						</td>
 					</tr>
-					<tr>
-						<td width="22%" valign="top" class="vncellreq"><?=gettext("Auth Digest Algorithm"); ?></td>
-						<td width="78%" class="vtable">
-							<select name="digest" class="formselect">
-								<?php
-									$digestlist = openvpn_get_digestlist();
-									foreach ($digestlist as $name => $desc):
-									$selected = '';
-									if ($name == $pconfig['digest'])
-										$selected = ' selected';
-								?>
-								<option value="<?=$name;?>"<?=$selected?>>
-									<?=htmlspecialchars($desc);?>
-								</option>
-								<?php endforeach; ?>
-							</select>
-						</td>
-					</tr>
 					<tr id="engine">
 						<td width="22%" valign="top" class="vncellreq"><?=gettext("Hardware Crypto"); ?></td>
 						<td width="78%" class="vtable">
@@ -879,18 +856,19 @@ if ($savemsg)
 					<tr>
 						<td width="22%" valign="top" class="vncell"><?=gettext("Compression"); ?></td>
 						<td width="78%" class="vtable">
-							<select name="compression" class="formselect">
-								<?php
-									foreach ($openvpn_compression_modes as $cmode => $cmodedesc):
-									$selected = '';
-									if ($cmode == $pconfig['compression'])
-										$selected = ' selected';
-								?>
-								<option value="<?= $cmode ?>" <?= $selected ?>><?= $cmodedesc ?></option>
-								<?php endforeach; ?>
-							</select>
-							<br/>
-							<?=gettext("Compress tunnel packets using the LZO algorithm. Adaptive compression will dynamically disable compression for a period of time if OpenVPN detects that the data in the packets is not being compressed efficiently."); ?>.
+							<table border="0" cellpadding="2" cellspacing="0">
+								<tr>
+									<td>
+										<?php set_checked($pconfig['compression'],$chk); ?>
+										<input name="compression" type="checkbox" value="yes" <?=$chk;?>>
+									</td>
+									<td>
+										<span class="vexpl">
+											<?=gettext("Compress tunnel packets using the LZO algorithm"); ?>.
+										</span>
+									</td>
+								</tr>
+							</table>
 						</td>
 					</tr>
 					<tr>
diff --git a/usr/local/www/vpn_openvpn_csc.php b/usr/local/www/vpn_openvpn_csc.php
index 6272eb1..9d0bc67 100644
--- a/usr/local/www/vpn_openvpn_csc.php
+++ b/usr/local/www/vpn_openvpn_csc.php
@@ -76,10 +76,6 @@ if($_GET['act']=="edit"){
 		$pconfig['description'] = $a_csc[$id]['description'];
 
 		$pconfig['tunnel_network'] = $a_csc[$id]['tunnel_network'];
-		$pconfig['local_network'] = $a_csc[$id]['local_network'];
-		$pconfig['local_networkv6'] = $a_csc[$id]['local_networkv6'];
-		$pconfig['remote_network'] = $a_csc[$id]['remote_network'];
-		$pconfig['remote_networkv6'] = $a_csc[$id]['remote_networkv6'];
 		$pconfig['gwredir'] = $a_csc[$id]['gwredir'];
 
 		$pconfig['push_reset'] = $a_csc[$id]['push_reset'];
@@ -129,18 +125,6 @@ if ($_POST) {
 	if ($result = openvpn_validate_cidr($pconfig['tunnel_network'], 'Tunnel network'))
 		$input_errors[] = $result;
 
-	if ($result = openvpn_validate_cidr($pconfig['local_network'], 'IPv4 Local Network', true, "ipv4"))
-		$input_errors[] = $result;
-
-	if ($result = openvpn_validate_cidr($pconfig['local_networkv6'], 'IPv6 Local Network', true, "ipv6"))
-		$input_errors[] = $result;
-
-	if ($result = openvpn_validate_cidr($pconfig['remote_network'], 'IPv4 Remote Network', true, "ipv4"))
-		$input_errors[] = $result;
-
-	if ($result = openvpn_validate_cidr($pconfig['remote_networkv6'], 'IPv6 Remote Network', true, "ipv6"))
-		$input_errors[] = $result;
-
 	if ($pconfig['dns_server_enable']) {
 		if (!empty($pconfig['dns_server1']) && !is_ipaddr(trim($pconfig['dns_server1'])))
 			$input_errors[] = gettext("The field 'DNS Server #1' must contain a valid IP address");
@@ -178,7 +162,7 @@ if ($_POST) {
 	$reqdfields[] = 'common_name';
 	$reqdfieldsn[] = 'Common name';
 
-    do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+    do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 
 	if (!$input_errors) {
 
@@ -192,10 +176,6 @@ if ($_POST) {
 		$csc['description'] = $pconfig['description'];
 
 		$csc['tunnel_network'] = $pconfig['tunnel_network'];
-		$csc['local_network'] = $pconfig['local_network'];
-		$csc['local_networkv6'] = $pconfig['local_networkv6'];
-		$csc['remote_network'] = $pconfig['remote_network'];
-		$csc['remote_networkv6'] = $pconfig['remote_networkv6'];
 		$csc['gwredir'] = $pconfig['gwredir'];
 
 		$csc['push_reset'] = $pconfig['push_reset'];
@@ -409,58 +389,6 @@ function netbios_change() {
 							"interface"); ?>.
 						</td>
 					</tr>
-					<tr id="local_optsv4">
-						<td width="22%" valign="top" class="vncell"><?=gettext("IPv4 Local Network/s"); ?></td>
-						<td width="78%" class="vtable">
-							<input name="local_network" type="text" class="formfld unknown" size="40" value="<?=htmlspecialchars($pconfig['local_network']);?>">
-							<br>
-							<?=gettext("These are the IPv4 networks that will be accessible " .
-							"from this particular client. Expressed as a comma-separated list of one or more CIDR ranges."); ?>
-							<br/><?=gettext("NOTE: You do not need to specify networks here if they have " .
-							"already been defined on the main server configuration.");?>
-						</td>
-					</tr>
-					<tr id="local_optsv6">
-						<td width="22%" valign="top" class="vncell"><?=gettext("IPv6 Local Network/s"); ?></td>
-						<td width="78%" class="vtable">
-							<input name="local_networkv6" type="text" class="formfld unknown" size="40" value="<?=htmlspecialchars($pconfig['local_networkv6']);?>">
-							<br>
-							<?=gettext("These are the IPv6 networks that will be accessible " .
-							"from this particular client. Expressed as a comma-separated list of one or more IP/PREFIX networks."); ?>
-							<br/><?=gettext("NOTE: You do not need to specify networks here if they have " .
-							"already been defined on the main server configuration.");?>
-						</td>
-					</tr>
-					<tr id="remote_optsv4">
-						<td width="22%" valign="top" class="vncell"><?=gettext("IPv4 Remote Network/s"); ?></td>
-						<td width="78%" class="vtable">
-							<input name="remote_network" type="text" class="formfld unknown" size="40" value="<?=htmlspecialchars($pconfig['remote_network']);?>">
-							<br>
-							<?=gettext("These are the IPv4 networks that will be routed " .
-							"to this client specifically using iroute, so that a site-to-site " .
-							"VPN can be established. " .
-							"Expressed as a comma-separated list of one or more CIDR ranges. " .
-							"You may leave this blank if there are no client-side networks to " .
-							"be routed"); ?>.
-							<br/><?=gettext("NOTE: Remember to add these subnets to the " .
-							"IPv4 Remote Networks list on the corresponding OpenVPN server settings.");?>
-						</td>
-					</tr>
-					<tr id="remote_optsv6">
-						<td width="22%" valign="top" class="vncell"><?=gettext("IPv6 Remote Network/s"); ?></td>
-						<td width="78%" class="vtable">
-							<input name="remote_networkv6" type="text" class="formfld unknown" size="40" value="<?=htmlspecialchars($pconfig['remote_networkv6']);?>">
-							<br>
-							<?=gettext("These are the IPv6 networks that will be routed " .
-							"to this client specifically using iroute, so that a site-to-site " .
-							"VPN can be established. " .
-							"Expressed as a comma-separated list of one or more IP/PREFIX networks. " .
-							"You may leave this blank if there are no client-side networks to " .
-							"be routed"); ?>.
-							<br/><?=gettext("NOTE: Remember to add these subnets to the " .
-							"IPv6 Remote Networks list on the corresponding OpenVPN server settings.");?>
-						</td>
-					</tr>
 					<tr>
 						<td width="22%" valign="top" class="vncell"><?=gettext("Redirect Gateway"); ?></td>
 						<td width="78%" class="vtable">
@@ -718,7 +646,7 @@ function netbios_change() {
 							<table border="0" cellpadding="2" cellspacing="0">
 								<tr>
 									<td>
-										<textarea rows="6" cols="70" name="custom_options" id="custom_options"><?=$pconfig['custom_options'];?></textarea><br/>
+										<textarea rows="6" cols="78" name="custom_options" id="custom_options"><?=$pconfig['custom_options'];?></textarea><br/>
 										<?=gettext("Enter any additional options you would like to add for this client specific override, separated by a semicolon"); ?><br/>
 										<?=gettext("EXAMPLE: push \"route 10.0.0.0 255.255.255.0\""); ?>;
 									</td>
diff --git a/usr/local/www/vpn_openvpn_server.php b/usr/local/www/vpn_openvpn_server.php
index aedff32..78f08a2 100644
--- a/usr/local/www/vpn_openvpn_server.php
+++ b/usr/local/www/vpn_openvpn_server.php
@@ -97,8 +97,6 @@ if($_GET['act']=="new"){
 	$pconfig['local_port'] = openvpn_port_next('UDP');
 	$pconfig['pool_enable'] = "yes";
 	$pconfig['cert_depth'] = 1;
-	// OpenVPN Defaults to SHA1
-	$pconfig['digest'] = "SHA1";
 }
 
 if($_GET['act']=="edit"){
@@ -135,8 +133,6 @@ if($_GET['act']=="edit"){
 		} else
 			$pconfig['shared_key'] = base64_decode($a_server[$id]['shared_key']);
 		$pconfig['crypto'] = $a_server[$id]['crypto'];
-		// OpenVPN Defaults to SHA1 if unset
-		$pconfig['digest'] = !empty($a_server[$id]['digest']) ? $a_server[$id]['digest'] : "SHA1";
 		$pconfig['engine'] = $a_server[$id]['engine'];
 
 		$pconfig['tunnel_network'] = $a_server[$id]['tunnel_network'];
@@ -191,10 +187,6 @@ if($_GET['act']=="edit"){
 			$pconfig['wins_server2'])
 			$pconfig['wins_server_enable'] = true;
 
-		$pconfig['client_mgmt_port'] = $a_server[$id]['client_mgmt_port'];
-		if ($pconfig['client_mgmt_port'])
-			$pconfig['client_mgmt_port_enable'] = true;
-
 		$pconfig['nbdd_server1'] = $a_server[$id]['nbdd_server1'];
 		if ($pconfig['nbdd_server1'])
 			$pconfig['nbdd_server_enable'] = true;
@@ -308,11 +300,6 @@ if ($_POST) {
 				$input_errors[] = gettext("The field 'NetBIOS Data Distribution Server #1' must contain a valid IP address");
 	}
 
-	if ($pconfig['client_mgmt_port_enable']) {
-		if ($result = openvpn_validate_port($pconfig['client_mgmt_port'], 'Client management port'))
-			$input_errors[] = $result;
-	}
-
 	if ($pconfig['maxclients'] && !is_numeric($pconfig['maxclients']))
 		$input_errors[] = gettext("The field 'Concurrent connections' must be numeric.");
 
@@ -342,7 +329,7 @@ if ($_POST) {
 		if (ip2ulong($pconfig['serverbridge_dhcp_start']) > ip2ulong($pconfig['serverbridge_dhcp_end']))
 			$input_errors[] = gettext("The Server Bridge DHCP range is invalid (start higher than end).");
 	}
-	do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+	do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 	
 	if (!$input_errors) {
 
@@ -385,7 +372,6 @@ if ($_POST) {
 			$server['shared_key'] = base64_encode($pconfig['shared_key']);
 		}
 		$server['crypto'] = $pconfig['crypto'];
-		$server['digest'] = $pconfig['digest'];
 		$server['engine'] = $pconfig['engine'];
 
 		$server['tunnel_network'] = $pconfig['tunnel_network'];
@@ -439,9 +425,6 @@ if ($_POST) {
 				$server['nbdd_server1'] = $pconfig['nbdd_server1'];
 		}
 
-		if ($pconfig['client_mgmt_port_enable'])
-			$server['client_mgmt_port'] = $pconfig['client_mgmt_port'];
-
 		if ($_POST['duplicate_cn'] == "yes")
 			$server['duplicate_cn'] = true;
 
@@ -624,14 +607,6 @@ function wins_server_change() {
 		document.getElementById("wins_server_data").style.display="none";
 }
 
-function client_mgmt_port_change() {
-
-	if (document.iform.client_mgmt_port_enable.checked)
-		document.getElementById("client_mgmt_port_data").style.display="";
-	else
-		document.getElementById("client_mgmt_port_data").style.display="none";
-}
-
 function ntp_server_change() {
 
 	if (document.iform.ntp_server_enable.checked)
@@ -1065,24 +1040,6 @@ if ($savemsg)
 							</select>
 						</td>
 					</tr>
-					<tr>
-						<td width="22%" valign="top" class="vncellreq"><?=gettext("Auth Digest Algorithm"); ?></td>
-						<td width="78%" class="vtable">
-							<select name="digest" class="formselect">
-								<?php
-									$digestlist = openvpn_get_digestlist();
-									foreach ($digestlist as $name => $desc):
-									$selected = '';
-									if ($name == $pconfig['digest'])
-										$selected = ' selected';
-								?>
-								<option value="<?=$name;?>"<?=$selected?>>
-									<?=htmlspecialchars($desc);?>
-								</option>
-								<?php endforeach; ?>
-							</select>
-						</td>
-					</tr>
 					<tr id="engine">
 						<td width="22%" valign="top" class="vncellreq"><?=gettext("Hardware Crypto"); ?></td>
 						<td width="78%" class="vtable">
@@ -1330,18 +1287,19 @@ if ($savemsg)
 					<tr>
 						<td width="22%" valign="top" class="vncell"><?=gettext("Compression"); ?></td>
 						<td width="78%" class="vtable">
-							<select name="compression" class="formselect">
-								<?php
-									foreach ($openvpn_compression_modes as $cmode => $cmodedesc):
-									$selected = '';
-									if ($cmode == $pconfig['compression'])
-										$selected = ' selected';
-								?>
-								<option value="<?= $cmode ?>" <?= $selected ?>><?= $cmodedesc ?></option>
-								<?php endforeach; ?>
-							</select>
-							<br/>
-							<?=gettext("Compress tunnel packets using the LZO algorithm. Adaptive compression will dynamically disable compression for a period of time if OpenVPN detects that the data in the packets is not being compressed efficiently."); ?>.
+							<table border="0" cellpadding="2" cellspacing="0">
+								<tr>
+									<td>
+										<?php set_checked($pconfig['compression'],$chk); ?>
+										<input name="compression" type="checkbox" value="yes" <?=$chk;?>>
+									</td>
+									<td>
+										<span class="vexpl">
+											<?=gettext("Compress tunnel packets using the LZO algorithm"); ?>.
+										</span>
+									</td>
+								</tr>
+							</table>
 						</td>
 					</tr>
 					<tr>
@@ -1677,31 +1635,6 @@ if ($savemsg)
 							</table>
 						</td>
 					</tr>
-					<tr>
-						<td width="22%" valign="top" class="vncell"><?=gettext("Client Management Port"); ?></td>
-						<td width="78%" class="vtable">
-							<table border="0" cellpadding="2" cellspacing="0">
-								<tr>
-									<td>
-										<?php set_checked($pconfig['client_mgmt_port_enable'],$chk); ?>
-										<input name="client_mgmt_port_enable" type="checkbox" id="client_mgmt_port_enable" value="yes" <?=$chk;?> onClick="client_mgmt_port_change()">
-									</td>
-									<td>
-										<span class="vexpl">
-	                                        <?=gettext("Use a different management port on clients. The default port is 166. Specify a different port if the client machines need to select from multiple OpenVPN links."); ?><br>
-										</span>
-									</td>
-								</tr>
-							</table>
-							<table border="0" cellpadding="2" cellspacing="0" id="client_mgmt_port_data">
-								<tr>
-									<td>
-										<input name="client_mgmt_port" type="text" class="formfld unknown" id="client_mgmt_port" size="30" value="<?=htmlspecialchars($pconfig['client_mgmt_port']);?>">
-									</td>
-								</tr>
-							</table>
-						</td>
-					</tr>
 				</table>
 
 				<table width="100%" border="0" cellpadding="6" cellspacing="0" id="client_opts">
@@ -1818,7 +1751,6 @@ gwredir_change();
 dns_domain_change();
 dns_server_change();
 wins_server_change();
-client_mgmt_port_change();
 ntp_server_change();
 netbios_change();
 tuntap_change();
diff --git a/usr/local/www/vpn_pppoe_edit.php b/usr/local/www/vpn_pppoe_edit.php
index 63db7e4..ad401e2 100755
--- a/usr/local/www/vpn_pppoe_edit.php
+++ b/usr/local/www/vpn_pppoe_edit.php
@@ -2,21 +2,21 @@
 /*
 	vpn_pppoe_edit.php
 	part of pfSense
-
+	
 	Copyright (C) 2005 Scott Ullrich (sullrich@gmail.com)
 	Copyright (C) 2010 Ermal Lui
 	All rights reserved.
-
+	
 	Redistribution and use in source and binary forms, with or without
 	modification, are permitted provided that the following conditions are met:
-
+	
 	1. Redistributions of source code must retain the above copyright notice,
 	   this list of conditions and the following disclaimer.
-
+	
 	2. Redistributions in binary form must reproduce the above copyright
 	   notice, this list of conditions and the following disclaimer in the
 	   documentation and/or other materials provided with the distribution.
-
+	
 	THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES,
 	INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY
 	AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
@@ -43,12 +43,12 @@ function vpn_pppoe_get_id() {
 	global $config;
 
 	$vpnid = 1;
-	if (is_array($config['pppoes']['pppoe'])) {
+	if (!is_array($config['pppoes']['pppoe'])) {
 		foreach ($config['pppoes']['pppoe'] as $pppoe) {
-			if ($vpnid == $pppoe['pppoeid'])
+			if ($vpnid == $pppoe['id'])
 				$vpnid++;
 			else
-				return $vpnid;
+				return $vpnid; 
 		}
 	}
 
@@ -62,7 +62,7 @@ $a_pppoes = &$config['pppoes']['pppoe'];
 
 $id = $_GET['id'];
 if (isset($_POST['id']))
-	$id = $_POST['id'];
+        $id = $_POST['id'];
 
 if (isset($id) && $a_pppoes[$id]) {
 	$pppoecfg =& $a_pppoes[$id];
@@ -117,7 +117,7 @@ if ($_POST) {
 				array(gettext("RADIUS server address"),gettext("RADIUS shared secret")));
 		}
 
-		do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+		do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 
 		if (($_POST['localip'] && !is_ipaddr($_POST['localip'])))
 			$input_errors[] = gettext("A valid server address must be specified.");
@@ -131,9 +131,9 @@ if ($_POST) {
 		$subnet_end = ip2ulong($_POST['remoteip']) + $_POST['pppoe_subnet'] - 1;
 		if ((ip2ulong($_POST['localip']) >= $subnet_start) &&
 		    (ip2ulong($_POST['localip']) <= $subnet_end))
-			$input_errors[] = gettext("The specified server address lies in the remote subnet.");
+			$input_errors[] = gettext("The specified server address lies in the remote subnet.");	
 		if ($_POST['localip'] == get_interface_ip($_POST['interface']))
-			$input_errors[] = gettext("The specified server address is equal to an interface ip address.");
+			$input_errors[] = gettext("The specified server address is equal to an interface ip address.");	
 
 		for($x=0; $x<4999; $x++) {
 			if ($_POST["username{$x}"]) {
@@ -155,14 +155,14 @@ if ($_POST) {
 		$pppoecfg['localip'] = $_POST['localip'];
 		$pppoecfg['mode'] = $_POST['mode'];
 		$pppoecfg['interface'] = $_POST['interface'];
-		$pppoecfg['n_pppoe_units'] = $_POST['n_pppoe_units'];
+		$pppoecfg['n_pppoe_units'] = $_POST['n_pppoe_units'];	
 		$pppoecfg['pppoe_subnet'] = $_POST['pppoe_subnet'];
 		$pppoecfg['descr'] = $_POST['descr'];
 		if ($_POST['radiusserver'] || $_POST['radiusserver2']) {
 			$pppoecfg['radius'] = array();
 
 			$pppoecfg['radius']['nasip'] = $_POST['radius_nasip'];
-			$pppoecfg['radius']['acct_update'] = $_POST['radius_acct_update'];
+                        $pppoecfg['radius']['acct_update'] = $_POST['radius_acct_update'];
 		}
 		if ($_POST['radiusserver']) {
 			$pppoecfg['radius']['server'] = array();
@@ -181,18 +181,18 @@ if ($_POST) {
 			$pppoecfg['radius']['server2']['acctport'] = $_POST['radiusserver2acctport'];
 		}
 
-		if ($_POST['pppoe_dns1'] <> "")
+ 		if ($_POST['pppoe_dns1'] <> "") 
 			$pppoecfg['dns1'] = $_POST['pppoe_dns1'];
 
-		if ($_POST['pppoe_dns2'] <> "")
+ 		if ($_POST['pppoe_dns2'] <> "") 
 			$pppoecfg['dns2'] = $_POST['pppoe_dns2'];
 
 		if($_POST['radiusenable'] == "yes")
 			$pppoecfg['radius']['server']['enable'] = true;
-
+			
 		if($_POST['radiussecenable'] == "yes")
 			$pppoecfg['radius']['server2']['enable'] = true;
-
+			
 		if($_POST['radacct_enable'] == "yes")
 			$pppoecfg['radius']['accounting'] = true;
 
@@ -217,18 +217,18 @@ if ($_POST) {
 			$pppoecfg['username'] = implode(" ", $users);
 
 		if (!isset($id))
-			$id = count($a_pppoes);
-		if (file_exists("{$g['tmp_path']}/.vpn_pppoe.apply"))
-			$toapplylist = unserialize(file_get_contents("{$g['tmp_path']}/.vpn_pppoe.apply"));
-		else
-			$toapplylist = array();
+                        $id = count($a_pppoes);
+                if (file_exists("{$g['tmp_path']}/.vpn_pppoe.apply"))
+                        $toapplylist = unserialize(file_get_contents("{$g['tmp_path']}/.vpn_pppoe.apply"));
+                else
+                        $toapplylist = array();
 
-		$toapplylist[] = $pppoecfg['pppoeid'];
+                $toapplylist[] = $pppoecfg['pppoeid'];
 		$a_pppoes[$id] = $pppoecfg;
 
 		write_config();
 		mark_subsystem_dirty('vpnpppoe');
-		file_put_contents("{$g['tmp_path']}/.vpn_pppoe.apply", serialize($toapplylist));
+		file_put_contents("{$g['tmp_path']}/.vpn_pppoe.apply", serialize($toapplylist));	
 		header("Location: vpn_pppoe.php");
 		exit;
 	}
@@ -242,30 +242,29 @@ include("head.inc");
 
 <body link="#0000CC" vlink="#0000CC" alink="#0000CC">
 <?php include("fbegin.inc"); ?>
-<script type="text/javascript" src="/javascript/row_helper.js"></script>
+<script type="text/javascript" src="/javascript/row_helper.js">
+</script>
 
 <input type='hidden' name='username' value='textbox' class="formfld unknown" />
 <input type='hidden' name='password' value='textbox' />
 <input type='hidden' name='ip' value='textbox' />
 
 <script type="text/javascript">
-	//<![CDATA[
-	rowname[0] = "username";
-	rowtype[0] = "textbox";
-	rowsize[0] = "20";
-
-	rowname[1] = "password";
-	rowtype[1] = "password";
-	rowsize[1] = "20";
-
-	rowname[2] = "ip";
-	rowtype[2] = "textbox";
-	rowsize[2] = "10";
-	//]]>
+        rowname[0] = "username";
+        rowtype[0] = "textbox";
+        rowsize[0] = "20";
+
+        rowname[1] = "password";
+        rowtype[1] = "password";
+        rowsize[1] = "20";
+
+        rowname[2] = "ip";
+        rowtype[2] = "textbox";
+        rowsize[2] = "10";
 </script>
 
-<script type="text/javascript">
-//<![CDATA[
+<script language="JavaScript">
+<!--
 function get_radio_value(obj)
 {
 	for (i = 0; i < obj.length; i++) {
@@ -282,10 +281,10 @@ function enable_change(enable_over) {
 		document.iform.localip.disabled = 0;
 		document.iform.radiusenable.disabled = 0;
 		document.iform.interface.disabled = 0;
-		document.iform.n_pppoe_units.disabled = 0;
-		document.iform.pppoe_subnet.disabled = 0;
+		document.iform.n_pppoe_units.disabled = 0;		
+		document.iform.pppoe_subnet.disabled = 0;		
 		document.iform.pppoe_dns1.disabled = 0;
-		document.iform.pppoe_dns2.disabled = 0;
+		document.iform.pppoe_dns2.disabled = 0;		
 		if (document.iform.radiusenable.checked || enable_over) {
 			document.iform.radacct_enable.disabled = 0;
 			document.iform.radiusserver.disabled = 0;
@@ -323,8 +322,8 @@ function enable_change(enable_over) {
 		}
 	} else {
 		document.iform.interface.disabled = 1;
-		document.iform.n_pppoe_units.disabled = 1;
-		document.iform.pppoe_subnet.disabled = 1;
+		document.iform.n_pppoe_units.disabled = 1;		
+		document.iform.pppoe_subnet.disabled = 1;		
 		document.iform.remoteip.disabled = 1;
 		document.iform.descr.disabled = 1;
 		document.iform.localip.disabled = 1;
@@ -346,284 +345,275 @@ function enable_change(enable_over) {
 		document.iform.radius_acct_update.disabled = 1;
 	}
 }
-//]]>
+//-->
 </script>
 <form action="vpn_pppoe_edit.php" method="post" name="iform" id="iform">
-<?php
-if ($input_errors)
-	print_input_errors($input_errors);
-if ($savemsg)
-	print_info_box($savemsg);
-?>
+<?php if ($input_errors) print_input_errors($input_errors); ?>
+<?php if ($savemsg) print_info_box($savemsg); ?>
 <table width="100%" border="0" cellpadding="0" cellspacing="0">
-	<tr>
-		<td>
-			<div id="mainarea">
-				<table class="tabcont" width="100%" border="0" cellpadding="6" cellspacing="0">
-					<tr>
-						<td height="16" colspan="2" class="listtopic" valign="top"><?php echo gettext("PPPoE server configuration"); ?></td>
-					</tr>
-					<tr>
-						<td width="22%" valign="top" class="vtable">&nbsp;</td>
-						<td width="78%" class="vtable">
-							<input name="mode" type="radio" onclick="enable_change(false)" value="off" <?php if ($pconfig['mode'] != "server") echo "checked=\"checked\"";?> />
-							<?=gettext("Off"); ?>
-						</td>
-					</tr>
-					<tr>
-						<td width="22%" valign="top" class="vtable">&nbsp;</td>
-						<td width="78%" class="vtable">
-							<input type="radio" name="mode" value="server" onclick="enable_change(false)" <?php if ($pconfig['mode'] == "server") echo "checked=\"checked\""; ?> />
-							<?=gettext("Enable PPPoE server"); ?></td>
-					</tr>
-
-					<tr>
-						<td width="22%" valign="top" class="vncell"><b><?=gettext("Interface"); ?></b></td>
-						<td width="78%" valign="top" class="vtable">
-
-							<select name="interface" class="formselect" id="interface">
-<?php
-							$interfaces = get_configured_interface_with_descr();
-							foreach ($interfaces as $iface => $ifacename):
-?>
-								<option value="<?=$iface;?>" <?php if ($iface == $pconfig['interface']) echo "selected=\"selected\""; ?>>
-									<?=htmlspecialchars($ifacename);?>
-								</option>
-<?php
-							endforeach;
-?>
-							</select> <br />
-
-						</td>
-					</tr>
-					<tr>
-						<td width="22%" valign="top" class="vncellreq"><?=gettext("Subnet netmask"); ?></td>
-						<td width="78%" class="vtable">
-							<select id="pppoe_subnet" name="pppoe_subnet">
-<?php
-							for($x=0; $x<33; $x++) {
-								if($x == $pconfig['pppoe_subnet'])
-									$selected = "selected=\"selected\"";
-								else
-									$selected = "";
-								echo "<option value=\"{$x}\" {$selected}>{$x}</option>\n";
-							}
-?>
-							</select>
-							<br /><?=gettext("Hint"); ?>: 24 <?=gettext("is"); ?> 255.255.255.0
-						</td>
-					</tr>
-					<tr>
-						<td width="22%" valign="top" class="vncellreq"><?=gettext("No. PPPoE users"); ?></td>
-						<td width="78%" class="vtable">
-							<select id="n_pppoe_units" name="n_pppoe_units">
-<?php
-							for($x=0; $x<255; $x++) {
-								if($x == $pconfig['n_pppoe_units'])
-									$selected = "selected=\"selected\"";
-								else
-									$selected = "";
-								echo "<option value=\"{$x}\" {$selected}>{$x}</option>\n";
-							}
-?>
-							</select>
-							<br /><?=gettext("Hint: 10 is ten PPPoE clients"); ?>
-						</td>
-					</tr>
-					<tr>
-						<td width="22%" valign="top" class="vncellreq"><?=gettext("Server address"); ?></td>
-						<td width="78%" class="vtable">
-							<?=$mandfldhtml;?><input name="localip" type="text" class="formfld unknown" id="localip" size="20" value="<?=htmlspecialchars($pconfig['localip']);?>" />
-							<br/>
-							<?=gettext("Enter the IP address the PPPoE server should give to clients for use as their \"gateway\""); ?>.
-							<br/>
-							<?=gettext("Typically this is set to an unused IP just outside of the client range"); ?>.
-							<br/>
-							<br/>
-							<?=gettext("NOTE: This should NOT be set to any IP address currently in use on this firewall"); ?>.</td>
-					</tr>
-					<tr>
-						<td width="22%" valign="top" class="vncellreq"><?=gettext("Remote address range"); ?></td>
-						<td width="78%" class="vtable">
-							<?=$mandfldhtml;?><input name="remoteip" type="text" class="formfld unknown" id="remoteip" size="20" value="<?=htmlspecialchars($pconfig['remoteip']);?>" />
-							<br />
-							<?=gettext("Specify the starting address for the client IP address subnet"); ?>.<br />
-						</td>
-					</tr>
-					<tr>
-						<td width="22%" valign="top" class="vncell"><?=gettext("Description"); ?></td>
-						<td width="78%" class="vtable">
-							<?=$mandfldhtml;?><input name="descr" type="text" class="formfld unknown" id="descr" size="40" value="<?=htmlspecialchars($pconfig['descr']);?>" />
-							<br/>
-						</td>
-					</tr>
-					<tr>
-						<td width="22%" valign="top" class="vncell"><?=gettext("DNS servers"); ?></td>
-						<td width="78%" class="vtable">
-							<?=$mandfldhtml;?><input name="pppoe_dns1" type="text" class="formfld unknown" id="pppoe_dns1" size="20" value="<?=htmlspecialchars($pconfig['pppoe_dns1']);?>" />
-							<br />
-							<input name="pppoe_dns2" type="text" class="formfld unknown" id="pppoe_dns2" size="20" value="<?=htmlspecialchars($pconfig['pppoe_dns2']);?>" />
-							<br />
-							<?=gettext("If entered they will be given to all PPPoE clients, else LAN DNS and one WAN DNS will go to all clients"); ?><br />
-						</td>
-					</tr>
-					<tr>
-						<td width="22%" valign="top" class="vncell"><?=gettext("RADIUS"); ?></td>
-						<td width="78%" class="vtable">
-							<input name="radiusenable" type="checkbox" id="radiusenable" onclick="enable_change(false)" value="yes" <?php if ($pconfig['radiusenable']) echo "checked=\"checked\""; ?> />
-							<strong><?=gettext("Use a RADIUS server for authentication"); ?><br />
-							</strong><?=gettext("When set, all users will be authenticated using " .
-							"the RADIUS server specified below. The local user database " .
-							"will not be used"); ?>.<br />
-							<br />
-							<input name="radacct_enable" type="checkbox" id="radacct_enable" onclick="enable_change(false)" value="yes" <?php if ($pconfig['radacct_enable']) echo "checked=\"checked\""; ?> />
-							<strong><?=gettext("Enable RADIUS accounting"); ?> <br />
-								<br />
-							</strong><?=gettext("Sends accounting packets to the RADIUS server"); ?>.<br />
-							<input name="radiussecenable" type="checkbox" id="radiussecenable" onclick="enable_change(false)" value="yes" <?php if ($pconfig['radiussecenable']) echo "checked=\"checked\""; ?> />
-							<strong><?=gettext("Use Backup RADIUS Server"); ?></strong><br />
-							<?=gettext("When set, if primary server fails all requests will be sent via backup server"); ?></td>
-					</tr>
-					<tr>
-						<td width="22%" valign="top" class="vncellreq"><?=gettext("NAS IP Address"); ?></td>
-						<td width="78%" class="vtable">
-							<?=$mandfldhtml;?><input name="radius_nasip" type="text" class="formfld unknown" id="radius_nasip" size="20" value="<?=htmlspecialchars($pconfig['radius_nasip']);?>" />
-							<br /><?=gettext("RADIUS server NAS IP Address"); ?><br />
-						</td>
-					</tr>
-					<tr>
-						<td width="22%" valign="top" class="vncellreq"><?=gettext("RADIUS Accounting Update"); ?></td>
-						<td width="78%" class="vtable">
-							<?=$mandfldhtml;?><input name="radius_acct_update" type="text" class="formfld unknown" id="radius_acct_update" size="20" value="<?=htmlspecialchars($pconfig['radius_acct_update']);?>" />
-							<br /><?=gettext("RADIUS accounting update period in seconds"); ?>
-						</td>
-					</tr>
-					<tr>
-						<td width="22%" valign="top" class="vncell"><?=gettext("RADIUS issued IPs"); ?></td>
-						<td width="78%" valign="top" class="vtable">
-							<input name="radiusissueips" value="yes" type="checkbox" class="formfld" id="radiusissueips" <?php if($pconfig['radiusissueips']) echo "checked=\"checked\""; ?> />
-							<br /><?=gettext("Issue IP Addresses via RADIUS server"); ?>.</td>
-					</tr>
-					<tr>
-						<td width="22%" valign="top" class="vncell"><?=gettext("RADIUS server Primary"); ?></td>
-						<td width="78%" class="vtable">
-							<input name="radiusserver" type="text" class="formfld unknown" id="radiusserver" size="20" value="<?=htmlspecialchars($pconfig['radiusserver']);?>" />
-							<input name="radiusserverport" type="text" class="formfld unknown" id="radiusserverport" size="4" value="<?=htmlspecialchars($pconfig['radiusserverport']);?>" />
-							<input name="radiusserveracctport" type="text" class="formfld unknown" id="radiusserveracctport" size="4" value="<?=htmlspecialchars($pconfig['radiusserveracctport']);?>" />
-							<br /><?=gettext("Enter the IP address, authentication port and accounting port (optional) of the RADIUS server."); ?><br />
-							<br /> <?=gettext("standard port 1812 and 1813 accounting"); ?></td>
-					</tr>
-					<tr>
-						<td width="22%" valign="top" class="vncell"><?=gettext("RADIUS primary shared secret"); ?></td>
-						<td width="78%" valign="top" class="vtable">
-							<input name="radiussecret" type="password" class="formfld pwd" id="radiussecret" size="20" value="<?=htmlspecialchars($pconfig['radiussecret']);?>" />
-							<br /><?=gettext("Enter the shared secret that will be used to authenticate " .
-							"to the RADIUS server"); ?>.</td>
-					</tr>
-					<tr>
-						<td width="22%" valign="top" class="vncell"><?=gettext("RADIUS server Secondary"); ?></td>
-						<td width="78%" class="vtable">
-							<input name="radiusserver2" type="text" class="formfld unknown" id="radiusserver2" size="20" value="<?=htmlspecialchars($pconfig['radiusserver2']);?>" />
-							<input name="radiusserver2port" type="text" class="formfld unknown" id="radiusserver2port" size="4" value="<?=htmlspecialchars($pconfig['radiusserver2port']);?>" />
-							<input name="radiusserver2acctport" type="text" class="formfld unknown" id="radiusserver2acctport" size="4" value="<?=htmlspecialchars($pconfig['radiusserver2acctport']);?>" />
-							<br /><?=gettext("Enter the IP address, authentication port and accounting port (optional) of the backup RADIUS server."); ?><br />
-							<br /> <?=gettext("standard port 1812 and 1813 accounting"); ?></td>
-					</tr>
-					<tr>
-						<td width="22%" valign="top" class="vncell"><?=gettext("RADIUS secondary shared secret"); ?></td>
-						<td width="78%" valign="top" class="vtable">
-							<input name="radiussecret2" type="password" class="formfld pwd" id="radiussecret2" size="20" value="<?=htmlspecialchars($pconfig['radiussecret2']);?>" />
-							<br />
-							<?=gettext("Enter the shared secret that will be used to authenticate " .
-							"to the RADIUS server"); ?>.</td>
-					</tr>
-					<tr>
-						<td width="22%" valign="top" class="vncell"><div id="addressnetworkport"><?=gettext("User (s)");?></div></td>
-						<td width="78%" class="vtable">
-							<table id="usertable">
-								<tbody>
-								<tr>
-									<td><div id="onecolumn"><?=gettext("Username");?></div></td>
-									<td><div id="twocolumn"><?=gettext("Password");?></div></td>
-									<td><div id="thirdcolumn"><?=gettext("IP");?></div></td>
-								</tr>
-<?php
-						$counter = 0;
-						$usernames = $pconfig['username'];
-						if ($usernames <> ""):
-							$item = explode(" ", $usernames);
-							foreach($item as $ww):
-								$wws = explode(":", $ww);
-								$user = $wws[0];
-								$passwd = base64_decode($wws[1]);
-								$ip = $wws[2];
-								$tracker = $counter;
-?>
-								<tr>
-									<td>
-										<input name="username<?php echo $tracker; ?>" type="text" class="formfld unknown" id="username<?php echo $tracker; ?>" size="20" value="<?=htmlspecialchars($user);?>" />
-									</td>
-									<td>
-										<input name="password<?php echo $tracker; ?>" type="password" class="formfld pwd" id="password<?php echo $tracker; ?>" size="20" value="<?=htmlspecialchars($passwd);?>" />
-									</td>
-									<td>
-										<input name="ip<?php echo $tracker; ?>" type="text" class="formfld unknown" id="ip<?php echo $tracker; ?>" size="10" value="<?=htmlspecialchars($ip);?>" />
-									</td>
-									<td>
-										<a onclick="removeRow(this); return false;" href="#"><img border="0" src="/themes/<?echo $g['theme'];?>/images/icons/icon_x.gif" /></a>
-									</td>
-								</tr>
-<?php
-								$counter++;
-							endforeach;
-						endif;
-?>
-								</tbody>
-							</table>
-							<a onclick="javascript:addRowTo('usertable'); return false;" href="#">
-								<img border="0" src="/themes/<?= $g['theme']; ?>/images/icons/icon_plus.gif" alt="" title="<?=gettext("add another entry");?>" />
-							</a>
-						</td>
-					</tr>
-					<tr>
-						<td height="16" colspan="2" valign="top"></td>
-					</tr>
-					<tr>
-						<td width="22%" valign="top">&nbsp;</td>
-						<td width="78%">
-<?php
-						if (isset($id))
-							echo "<input type='hidden' name='id' id='id' value='{$id}' />";
-?>
-<?php
-						if (isset($pconfig['pppoeid']))
-							echo "<input type='hidden' name='pppoeid' id='pppoeid' value='{$pppoeid}' />";
-?>
-							<input name="Submit" type="submit" class="formbtn" value="<?=gettext("Save"); ?>"  onclick="enable_change(true)" />
-							<a href="vpn_pppoe.php"><input name="Cancel" type="button" class="formbtn" value="<?=gettext("Cancel"); ?>" /></a>
-						</td>
-					</tr>
-					<tr>
-						<td width="22%" valign="top">&nbsp;</td>
-						<td width="78%"><span class="vexpl"><span class="red"><strong><?=gettext("Note"); ?>:<br />
-								</strong></span><?=gettext("don't forget to add a firewall rule to permit " .
-								"traffic from PPPoE clients"); ?>!</span></td>
-					</tr>
-				</table>
-			</div>
-		</td>
+  <tr> 
+    <td>
+	<div id="mainarea">
+              <table class="tabcont" width="100%" border="0" cellpadding="6" cellspacing="0">
+		<tr>
+                  <td height="16" colspan="2" class="listtopic" valign="top"><?php echo gettext("PPPoE server configuration"); ?></td>
+                </tr>
+                <tr> 
+                  <td width="22%" valign="top" class="vtable">&nbsp;</td>
+                  <td width="78%" class="vtable"> 
+                    <input name="mode" type="radio" onclick="enable_change(false)" value="off"
+				  	<?php if ($pconfig['mode'] != "server") echo "checked";?>>
+                    <?=gettext("Off"); ?></td>
+		</tr>
+                <tr> 
+                  <td width="22%" valign="top" class="vtable">&nbsp;</td>
+                  <td width="78%" class="vtable">
+		    <input type="radio" name="mode" value="server" onclick="enable_change(false)" <?php if ($pconfig['mode'] == "server") echo "checked"; ?>>
+                    <?=gettext("Enable PPPoE server"); ?></td>
+		</tr>
+
+                <tr> 
+                  <td width="22%" valign="top" class="vncell"><b><?=gettext("Interface"); ?></b></td>
+                  <td width="78%" valign="top" class="vtable">
+
+			<select name="interface" class="formselect" id="interface">
+			  <?php
+				$interfaces = get_configured_interface_with_descr();
+
+				foreach ($interfaces as $iface => $ifacename):
+			  ?>
+			  <option value="<?=$iface;?>" <?php if ($iface == $pconfig['interface']) echo "selected"; ?>>
+			  <?=htmlspecialchars($ifacename);?>
+			  </option>
+			  <?php endforeach; ?>
+			</select> <br>			
+                      
+		  </td>
+                </tr>
+                <tr> 
+                  <td width="22%" valign="top" class="vncellreq"><?=gettext("Subnet netmask"); ?></td>
+                  <td width="78%" class="vtable">
+		    <select id="pppoe_subnet" name="pppoe_subnet">
+		    <?php
+		     for($x=0; $x<33; $x++) {
+			if($x == $pconfig['pppoe_subnet'])
+				$SELECTED = " SELECTED";
+			else
+				$SELECTED = "";
+			echo "<option value=\"{$x}\"{$SELECTED}>{$x}</option>\n";			
+		     }
+		    ?>
+		    </select>
+		    <br><?=gettext("Hint"); ?>: 24 <?=gettext("is"); ?> 255.255.255.0
+                  </td>
+		</tr>
+                <tr> 
+                  <td width="22%" valign="top" class="vncellreq"><?=gettext("No. PPPoE users"); ?></td>
+                  <td width="78%" class="vtable">
+		    <select id="n_pppoe_units" name="n_pppoe_units">
+		    <?php
+		     for($x=0; $x<255; $x++) {
+			if($x == $pconfig['n_pppoe_units'])
+				$SELECTED = " SELECTED";
+			else
+				$SELECTED = "";
+			echo "<option value=\"{$x}\"{$SELECTED}>{$x}</option>\n";			
+		     }
+		    ?>
+		    </select>
+		    <br><?=gettext("Hint: 10 is ten PPPoE clients"); ?>
+                  </td>
+		</tr>
+                <tr> 
+                  <td width="22%" valign="top" class="vncellreq"><?=gettext("Server address"); ?></td>
+                  <td width="78%" class="vtable"> 
+                    <?=$mandfldhtml;?><input name="localip" type="text" class="formfld unknown" id="localip" size="20" value="<?=htmlspecialchars($pconfig['localip']);?>"> 
+			<br/>
+			<?=gettext("Enter the IP address the PPPoE server should give to clients for use as their \"gateway\""); ?>.
+			<br/>
+			<?=gettext("Typically this is set to an unused IP just outside of the client range"); ?>.
+			<br/>
+			<br/>
+			<?=gettext("NOTE: This should NOT be set to any IP address currently in use on this firewall"); ?>.</td>
+                </tr>
+                <tr> 
+                  <td width="22%" valign="top" class="vncellreq"><?=gettext("Remote address range"); ?></td>
+                  <td width="78%" class="vtable"> 
+                    <?=$mandfldhtml;?><input name="remoteip" type="text" class="formfld unknown" id="remoteip" size="20" value="<?=htmlspecialchars($pconfig['remoteip']);?>">
+                    <br>
+                    <?=gettext("Specify the starting address for the client IP address subnet"); ?>.<br>
+                    </td>
+                </tr>
+                <tr>
+                  <td width="22%" valign="top" class="vncell"><?=gettext("Description"); ?></td>
+                  <td width="78%" class="vtable">
+                    <?=$mandfldhtml;?><input name="descr" type="text" class="formfld unknown" id="descr" size="40" value="<?=htmlspecialchars($pconfig['descr']);?>">
+                    <br/>
+                    </td>
+                </tr>
+                <tr> 
+                  <td width="22%" valign="top" class="vncell"><?=gettext("DNS servers"); ?></td>
+                  <td width="78%" class="vtable"> 
+                    <?=$mandfldhtml;?><input name="pppoe_dns1" type="text" class="formfld unknown" id="pppoe_dns1" size="20" value="<?=htmlspecialchars($pconfig['pppoe_dns1']);?>">
+                    <br>
+			<input name="pppoe_dns2" type="text" class="formfld unknown" id="pppoe_dns2" size="20" value="<?=htmlspecialchars($pconfig['pppoe_dns2']);?>">
+                    <br>
+                    <?=gettext("If entered they will be given to all PPPoE clients, else LAN DNS and one WAN DNS will go to all clients"); ?><br>
+                    </td>
+                </tr>
+                <tr> 
+                  <td width="22%" valign="top" class="vncell"><?=gettext("RADIUS"); ?></td>
+                  <td width="78%" class="vtable"> 
+                      <input name="radiusenable" type="checkbox" id="radiusenable" onclick="enable_change(false)" value="yes" <?php if ($pconfig['radiusenable']) echo "checked"; ?>>
+                      <strong><?=gettext("Use a RADIUS server for authentication"); ?><br>
+                      </strong><?=gettext("When set, all users will be authenticated using " .
+                      "the RADIUS server specified below. The local user database " .
+                      "will not be used"); ?>.<br>
+                      <br>
+                      <input name="radacct_enable" type="checkbox" id="radacct_enable" onclick="enable_change(false)" value="yes" <?php if ($pconfig['radacct_enable']) echo "checked"; ?>>
+                      <strong><?=gettext("Enable RADIUS accounting"); ?> <br>
+			 <br>
+                      </strong><?=gettext("Sends accounting packets to the RADIUS server"); ?>.<br>
+                      <input name="radiussecenable" type="checkbox" id="radiussecenable" onclick="enable_change(false)" value="yes" <?php if ($pconfig['radiussecenable']) echo "checked"; ?>>
+                      <strong><?=gettext("Use Backup RADIUS Server"); ?></strong><br>
+                      <?=gettext("When set, if primary server fails all requests will be sent via backup server"); ?></td>
+                </tr>
+                <tr> 
+                  <td width="22%" valign="top" class="vncellreq"><?=gettext("NAS IP Address"); ?></td>
+                  <td width="78%" class="vtable"> 
+                    <?=$mandfldhtml;?><input name="radius_nasip" type="text" class="formfld unknown" id="radius_nasip" size="20" value="<?=htmlspecialchars($pconfig['radius_nasip']);?>">
+                    <br><?=gettext("RADIUS server NAS IP Address"); ?><br>
+                    </td>
+                </tr>
+                <tr> 
+                  <td width="22%" valign="top" class="vncellreq"><?=gettext("RADIUS Accounting Update"); ?></td>
+                  <td width="78%" class="vtable"> 
+                    <?=$mandfldhtml;?><input name="radius_acct_update" type="text" class="formfld unknown" id="radius_acct_update" size="20" value="<?=htmlspecialchars($pconfig['radius_acct_update']);?>">
+                    <br><?=gettext("RADIUS accounting update period in seconds"); ?>
+                    </td>
+                </tr>
+                <tr> 
+                  <td width="22%" valign="top" class="vncell"><?=gettext("RADIUS issued IPs"); ?></td>
+                  <td width="78%" valign="top" class="vtable">
+                      <input name="radiusissueips" value="yes" type="checkbox" class="formfld" id="radiusissueips"<?php if($pconfig['radiusissueips']) echo " CHECKED"; ?>>
+                      <br><?=gettext("Issue IP Addresses via RADIUS server"); ?>.</td>
+                </tr>
+                <tr> 
+                  <td width="22%" valign="top" class="vncell"><?=gettext("RADIUS server Primary"); ?></td>
+                  <td width="78%" class="vtable">
+                      <input name="radiusserver" type="text" class="formfld unknown" id="radiusserver" size="20" value="<?=htmlspecialchars($pconfig['radiusserver']);?>">
+			 <input name="radiusserverport" type="text" class="formfld unknown" id="radiusserverport" size="4" value="<?=htmlspecialchars($pconfig['radiusserverport']);?>">
+			 <input name="radiusserveracctport" type="text" class="formfld unknown" id="radiusserveracctport" size="4" value="<?=htmlspecialchars($pconfig['radiusserveracctport']);?>">
+                      <br><?=gettext("Enter the IP address, authentication port and accounting port (optional) of the RADIUS server."); ?><br>
+			 <br> <?=gettext("standard port 1812 and 1813 accounting"); ?></td>
+                </tr>
+                <tr> 
+                  <td width="22%" valign="top" class="vncell"><?=gettext("RADIUS primary shared secret"); ?></td>
+                  <td width="78%" valign="top" class="vtable">
+                      <input name="radiussecret" type="password" class="formfld pwd" id="radiussecret" size="20" value="<?=htmlspecialchars($pconfig['radiussecret']);?>">
+                      <br><?=gettext("Enter the shared secret that will be used to authenticate " .
+                      "to the RADIUS server"); ?>.</td>
+                </tr>
+                <tr> 
+                  <td width="22%" valign="top" class="vncell"><?=gettext("RADIUS server Secondary"); ?></td>
+                  <td width="78%" class="vtable">
+                      <input name="radiusserver2" type="text" class="formfld unknown" id="radiusserver2" size="20" value="<?=htmlspecialchars($pconfig['radiusserver2']);?>">
+			 <input name="radiusserver2port" type="text" class="formfld unknown" id="radiusserver2port" size="4" value="<?=htmlspecialchars($pconfig['radiusserver2port']);?>">
+			 <input name="radiusserver2acctport" type="text" class="formfld unknown" id="radiusserver2acctport" size="4" value="<?=htmlspecialchars($pconfig['radiusserver2acctport']);?>">
+                      <br><?=gettext("Enter the IP address, authentication port and accounting port (optional) of the backup RADIUS server."); ?><br>
+			 <br> <?=gettext("standard port 1812 and 1813 accounting"); ?></td>
+                </tr>
+                <tr> 
+                  <td width="22%" valign="top" class="vncell"><?=gettext("RADIUS secondary shared secret"); ?></td>
+                  <td width="78%" valign="top" class="vtable">
+                      <input name="radiussecret2" type="password" class="formfld pwd" id="radiussecret2" size="20" value="<?=htmlspecialchars($pconfig['radiussecret2']);?>">
+                      <br>
+                      <?=gettext("Enter the shared secret that will be used to authenticate " .
+                      "to the RADIUS server"); ?>.</td>
+                </tr>
+		<tr>
+			<td width="22%" valign="top" class="vncell"><div id="addressnetworkport"><?=gettext("User (s)");?></div></td>
+			<td width="78%" class="vtable">
+			<table id="usertable">
+			<tbody>
+			<tr>
+				<td><div id="onecolumn"><?=gettext("Username");?></div></td>
+				<td><div id="twocolumn"><?=gettext("Password");?></div></td>
+				<td><div id="thirdcolumn"><?=gettext("IP");?></div></td>
+			</tr>
+		<?php	$counter = 0;
+			$usernames = $pconfig['username'];
+			if ($usernames <> "") {
+				$item = explode(" ", $usernames);
+				foreach($item as $ww) {
+					$wws = explode(":", $ww);
+					$user = $wws[0];
+					$passwd = base64_decode($wws[1]);
+					$ip = $wws[2];
+                        		$tracker = $counter;
+		?>
+		<tr>
+			<td>
+				<input name="username<?php echo $tracker; ?>" type="text" class="formfld unknown" id="username<?php echo $tracker; ?>" size="20" value="<?=htmlspecialchars($user);?>" />
+			</td>
+			<td>
+				<input name="password<?php echo $tracker; ?>" type="password" class="formfld pwd" id="password<?php echo $tracker; ?>" size="20" value="<?=htmlspecialchars($passwd);?>" />
+			</td>
+			<td>
+				<input name="ip<?php echo $tracker; ?>" type="text" class="formfld unknown" id="ip<?php echo $tracker; ?>" size="10" value="<?=htmlspecialchars($ip);?>" />
+			</td>
+			<td>
+				<a onclick="removeRow(this); return false;" href="#"><img border="0" src="/themes/<?echo $g['theme'];?>/images/icons/icon_x.gif" /></a>
+			</td>
+		</tr>
+		<?php
+					$counter++;
+				} // end foreach
+			} // end if
+		?>
+			</tbody>
+			</table>
+			<a onclick="javascript:addRowTo('usertable'); return false;" href="#">
+        			<img border="0" src="/themes/<?= $g['theme']; ?>/images/icons/icon_plus.gif" alt="" title="<?=gettext("add another entry");?>" />
+      			</a>
+                	</td>
+		</tr>
+                <tr> 
+                  <td height="16" colspan="2" valign="top"></td>
+                </tr>
+                <tr> 
+                  <td width="22%" valign="top">&nbsp;</td>
+                  <td width="78%"> 
+		<?php if (isset($id))
+			echo "<input type='hidden' name='id' id='id' value='{$id}' >";
+		?>
+		<?php if (isset($pconfig['pppoeid']))
+			echo "<input type='hidden' name='pppoeid' id='pppoeid' value='{$pppoeid}' >";
+		?>
+                    <input name="Submit" type="submit" class="formbtn" value="<?=gettext("Save"); ?>"  onclick="enable_change(true)"/> 
+                    <a href="vpn_pppoe.php"><input name="Cancel" type="button" class="formbtn" value="<?=gettext("Cancel"); ?>"></a> 
+                  </td>
+                </tr>
+                <tr> 
+                  <td width="22%" valign="top">&nbsp;</td>
+                  <td width="78%"><span class="vexpl"><span class="red"><strong><?=gettext("Note"); ?>:<br>
+                    </strong></span><?=gettext("don't forget to add a firewall rule to permit " .
+                    "traffic from PPPoE clients"); ?>!</span></td>
+                </tr>
+              </table>
+	   </div>
+	 </td>
 	</tr>
 </table>
 </form>
 <script type="text/javascript">
-	//<![CDATA[
-	enable_change(false);
-
-	field_counter_js = 3;
-	rows = 1;
-	totalrows = <?php echo $counter; ?>;
-	loaded = <?php echo $counter; ?>;
-	//]]>
+enable_change(false);
+
+field_counter_js = 3;
+rows = 1;
+totalrows = <?php echo $counter; ?>;
+loaded = <?php echo $counter; ?>;
+
 </script>
 <?php include("fend.inc"); ?>
 </body>
diff --git a/usr/local/www/vpn_pptp.php b/usr/local/www/vpn_pptp.php
index ac3dc8c..a5da316 100755
--- a/usr/local/www/vpn_pptp.php
+++ b/usr/local/www/vpn_pptp.php
@@ -87,7 +87,7 @@ if ($_POST) {
 				array(gettext("RADIUS server address"),gettext("RADIUS shared secret")));
 		}
 		
-		do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+		do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 		
 		if (($_POST['localip'] && !is_ipaddr($_POST['localip']))) {
 			$input_errors[] = gettext("A valid server address must be specified.");
@@ -119,7 +119,7 @@ if ($_POST) {
 		$reqdfields = explode(" ", "redir");
 		$reqdfieldsn = array(gettext("PPTP redirection target address"));
 		
-		do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+		do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 		
 		if (($_POST['redir'] && !is_ipaddr($_POST['redir']))) {
 			$input_errors[] = gettext("A valid target address must be specified.");
diff --git a/usr/local/www/vpn_pptp_users_edit.php b/usr/local/www/vpn_pptp_users_edit.php
index 24c0063..cf375e8 100755
--- a/usr/local/www/vpn_pptp_users_edit.php
+++ b/usr/local/www/vpn_pptp_users_edit.php
@@ -79,7 +79,7 @@ if ($_POST) {
 		$reqdfieldsn = array(gettext("Username"),gettext("Password"));
 	}
 
-	do_input_validation($_POST, $reqdfields, $reqdfieldsn, $input_errors);
+	do_input_validation($_POST, $reqdfields, $reqdfieldsn, &$input_errors);
 
 	if (preg_match("/[^a-zA-Z0-9\.\-_]/", $_POST['username']))
 		$input_errors[] = gettext("The username contains invalid characters.");
diff --git a/usr/local/www/widgets/include/interface_statistics.inc~ b/usr/local/www/widgets/include/interface_statistics.inc~
new file mode 100644
index 0000000..c789418
--- /dev/null
+++ b/usr/local/www/widgets/include/interface_statistics.inc~
@@ -0,0 +1,5 @@
+<?php
+//set variable for custom title
+$interface_statistics_title = "Interface Statistics";
+$interface_statistics_title_link = "status_interfaces.php";
+?>
\ No newline at end of file
diff --git a/usr/local/www/widgets/include/interfaces.inc~ b/usr/local/www/widgets/include/interfaces.inc~
new file mode 100644
index 0000000..6c19a6b
--- /dev/null
+++ b/usr/local/www/widgets/include/interfaces.inc~
@@ -0,0 +1,6 @@
+<?php
+//set variable for custom title
+$interfaces_title = "Interfaces";
+$interfaces_title_link = "status_interfaces.php";
+
+?>
\ No newline at end of file
diff --git a/usr/local/www/widgets/include/log.inc~ b/usr/local/www/widgets/include/log.inc~
new file mode 100644
index 0000000..7ad453a
--- /dev/null
+++ b/usr/local/www/widgets/include/log.inc~
@@ -0,0 +1,6 @@
+<?php
+//set variable for custom title
+$log_title = "Firewall Logs";
+$log_title_link = "diag_logs_filter.php";
+
+?>
\ No newline at end of file
diff --git a/usr/local/www/widgets/include/services_status.inc~ b/usr/local/www/widgets/include/services_status.inc~
new file mode 100644
index 0000000..9fd4832
--- /dev/null
+++ b/usr/local/www/widgets/include/services_status.inc~
@@ -0,0 +1,7 @@
+<?php
+
+//set variable for custom title
+$services_status_title = "Trạng thái của các Dịch vụ";
+$services_status_title_link = "status_services.php";
+
+?>
diff --git a/usr/local/www/widgets/widgets/captive_portal_status.widget.php b/usr/local/www/widgets/widgets/captive_portal_status.widget.php
index d773877..245b65b 100644
--- a/usr/local/www/widgets/widgets/captive_portal_status.widget.php
+++ b/usr/local/www/widgets/widgets/captive_portal_status.widget.php
@@ -67,7 +67,7 @@ foreach ($a_cp as $cpzone => $cp) {
 	foreach ($cpdb as $cpent) {
 		$cpent[10] = $cpzone;
 		if ($_GET['showact'])
-			$cpent[11] = captiveportal_get_last_activity($cpent[2], $cpentry[3]);
+			$cpent[11] = captiveportal_get_last_activity($cpent[2]);
 		$cpdb_all[] = $cpent;
 	}
 }
@@ -111,4 +111,4 @@ if ($_GET['order']) {
 	<a href="?order=<?=$_GET['order'];?>&amp;showact=<?=$_GET['showact'];?>&amp;act=del&amp;zone=<?=$cpent[10];?>&amp;id=<?=$cpent[5];?>" onclick="return confirm('Do you really want to disconnect this client?')"><img src="./themes/<?= $g['theme']; ?>/images/icons/icon_x.gif" width="17" height="17" border="0" alt="x" /></a></td>
   </tr>
 <?php endforeach; ?>
-</table>
+</table>
\ No newline at end of file
diff --git a/usr/local/www/widgets/widgets/carp_status.widget.php b/usr/local/www/widgets/widgets/carp_status.widget.php
index 3b52fd8..1710d1b 100644
--- a/usr/local/www/widgets/widgets/carp_status.widget.php
+++ b/usr/local/www/widgets/widgets/carp_status.widget.php
@@ -49,13 +49,14 @@ $carp_enabled = get_carp_status();
 			$netmask = $carp['subnet_bits'];
 			$vhid = $carp['vhid'];
 			$advskew = $carp['advskew'];
-			$status = get_carp_interface_status("{$carp['interface']}_vip{$vhid}");
+			$carp_int = "{$carp['interface']}_vip{$vhid}";
+			$status = get_carp_interface_status($carp_int);
 ?>
 <tr>
 	<td class="vncellt" width="35%">
 		<img src="./themes/<?= $g['theme']; ?>/images/icons/icon_cablenic.gif" alt="cablenic" />&nbsp;
 		<strong><a href="/system_hasync.php">
-		<span style="color:#000000"><?=htmlspecialchars(convert_friendly_interface_to_friendly_descr($carp['interface']) . "@{$vhid}");?></span></a></strong>
+		<span style="color:#000000"><?=htmlspecialchars($carp_int);?></span></a></strong>
 	</td>
 	<td width="65%"  class="listr">
 <?php
@@ -78,4 +79,4 @@ $carp_enabled = get_carp_status();
 	} else { ?>
 		<tr><td class="listr">No CARP Interfaces Defined. Click <a href="carp_status.php">here</a> to configure CARP.</td></tr>
 <?php	} ?>
-</table>
+</table>
\ No newline at end of file
diff --git a/usr/local/www/widgets/widgets/dyn_dns_status.widget.php b/usr/local/www/widgets/widgets/dyn_dns_status.widget.php
index 6fc9da7..2ae268b 100644
--- a/usr/local/www/widgets/widgets/dyn_dns_status.widget.php
+++ b/usr/local/www/widgets/widgets/dyn_dns_status.widget.php
@@ -28,7 +28,7 @@
     POSSIBILITY OF SUCH DAMAGE.
 */
 /*
-	pfSense_BUILDER_BINARIES:	/usr/bin/host
+	pfSense_BUILDER_BINARIES:	/usr/bin/host	
 	pfSense_MODULE:	dyndns
 */
 
@@ -109,8 +109,8 @@ if($_REQUEST['getdyndnsstatus']) {
 		<?php
 		$types = explode(",", DYNDNS_PROVIDER_DESCRIPTIONS);
 		$vals = explode(" ", DYNDNS_PROVIDER_VALUES);
-		for ($j = 0; $j < count($vals); $j++)
-			if ($vals[$j] == $dyndns['type']) {
+		for ($j = 0; $j < count($vals); $j++) 
+			if ($vals[$j] == $dyndns['type']) { 
 				if (!isset($dyndns['enable']))
 					echo "<span class=\"gray\">".htmlspecialchars($types[$j])."</span>";
 				else
diff --git a/usr/local/www/widgets/widgets/gateways.widget.php b/usr/local/www/widgets/widgets/gateways.widget.php
index 52048a1..1b7bd81 100644
--- a/usr/local/www/widgets/widgets/gateways.widget.php
+++ b/usr/local/www/widgets/widgets/gateways.widget.php
@@ -48,11 +48,11 @@ $counter = 1;
 			Name
 	</td>
 	<td width="70%" class="listr">
-		<table width="100%" border="0" cellspacing="0" cellpadding="0" style="table-layout: fixed;" summary="heading">
+		<table width="100%" border="0" cellspacing="0" cellpadding="0" summary="heading">
 			<tr>
-			<td width="25%" class="listhdrr ellipsis">RTT</td>
-			<td width="25%" class="listhdrr ellipsis">Loss</td>
-			<td width="50%" class="listhdrr ellipsis">Status</td>
+			<td width="25%" class="listhdrr">RTT</td>
+			<td width="25%" class="listhdrr">Loss</td>
+			<td width="50%" class="listhdrr">Status</td>
 			</tr>
 		</table>
 	</td>
@@ -65,10 +65,10 @@ $counter = 1;
 		</strong>
 		<?php $counter++; ?>
 	</td>
-	<td width="70%" class="listr ellipsis">
-		<table width="100%" border="0" cellspacing="0" cellpadding="0" style="table-layout: fixed;" summary="address">
+	<td width="70%" class="listr">
+		<table width="100%" border="0" cellspacing="0" cellpadding="0" summary="address">
 			<tr>
-			<td class="vncellt ellipsis" width="100%">
+			<td class="vncellt" width="100%">
 				<div id="gateway<?php echo $counter; ?>" style="display:inline">
 					<?php
 						if (is_ipaddr($gateway['gateway']))
@@ -85,9 +85,9 @@ $counter = 1;
 			</td>
 			</tr>
 		</table>
-		<table width="100%" border="0" cellspacing="0" cellpadding="0" style="table-layout: fixed;" summary="statistics">
+		<table width="100%" border="0" cellspacing="0" cellpadding="0" summary="statistics">
 			<tr>
-			<td width="25%" class="listlr ellipsis" align="center" id="gateway<?php echo $counter; ?>">
+			<td width="25%" class="listlr" align="center" id="gateway<?php echo $counter; ?>">
 			<?php
 				if ($gateways_status[$gname])
 					echo htmlspecialchars($gateways_status[$gname]['delay']);
@@ -96,7 +96,7 @@ $counter = 1;
 			?>
 			<?php $counter++; ?>
 			</td>
-			<td width="25%" class="listr ellipsis" align="center" id="gateway<?php echo $counter; ?>">
+			<td width="25%" class="listr" align="center" id="gateway<?php echo $counter; ?>">
 			<?php
 				if ($gateways_status[$gname])
 					echo htmlspecialchars($gateways_status[$gname]['loss']);
@@ -105,14 +105,11 @@ $counter = 1;
 			?>
 			<?php $counter++; ?>
 			</td>
-			<td width="50%" class="listr ellipsis" id="gateway<?php echo $counter ?>" >
-			<table border="0" cellpadding="0" cellspacing="2" style="table-layout: fixed;" summary="status">
+			<td width="50%" class="listr" id="gateway<?php echo $counter ?>" >
+			<table border="0" cellpadding="0" cellspacing="2" summary="status">
 			<?php
 				if ($gateways_status[$gname]) {
-					if (stristr($gateways_status[$gname]['status'], "force_down")) {
-						$online = "Offline (forced)";
-						$bgcolor = "#F08080";  // lightcoral
-					} elseif (stristr($gateways_status[$gname]['status'], "down")) {
+					if (stristr($gateways_status[$gname]['status'], "down")) {
 						$online = "Offline";
 						$bgcolor = "#F08080";  // lightcoral
 					} elseif (stristr($gateways_status[$gname]['status'], "loss")) {
@@ -132,7 +129,7 @@ $counter = 1;
 					$online = gettext("Unknown");
 					$bgcolor = "#ADD8E6";  // lightblue
 				}
-				echo "<tr><td class=\"ellipsis\" bgcolor=\"$bgcolor\">&nbsp;$online&nbsp;</td></tr>\n";
+				echo "<tr><td bgcolor=\"$bgcolor\">&nbsp;$online&nbsp;</td></tr>\n";
 				$counter++;
 			?>
 			</table>
@@ -143,5 +140,3 @@ $counter = 1;
 	</tr>
 	<?php } // foreach ?>
 </table>
-
-
diff --git a/usr/local/www/widgets/widgets/installed_packages.widget.php~ b/usr/local/www/widgets/widgets/installed_packages.widget.php~
new file mode 100644
index 0000000..ed6164c
--- /dev/null
+++ b/usr/local/www/widgets/widgets/installed_packages.widget.php~
@@ -0,0 +1,123 @@
+<?php
+/*
+	$Id$
+	Copyright 2007 Scott Dale
+	Part of pfSense widgets (www.pfsense.com)
+	originally based on m0n0wall (http://m0n0.ch/wall)
+
+	Copyright (C) 2004-2005 T. Lechat <dev@lechat.org>, Manuel Kasper <mk@neon1.net>
+	and Jonathan Watt <jwatt@jwatt.org>.
+	All rights reserved.
+
+	Redistribution and use in source and binary forms, with or without
+	modification, are permitted provided that the following conditions are met:
+
+	1. Redistributions of source code must retain the above copyright notice,
+	   this list of conditions and the following disclaimer.
+
+	2. Redistributions in binary form must reproduce the above copyright
+	   notice, this list of conditions and the following disclaimer in the
+	   documentation and/or other materials provided with the distribution.
+
+	THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES,
+	INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY
+	AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
+	AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY,
+	OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
+	SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
+	INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
+	CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
+	ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
+	POSSIBILITY OF SUCH DAMAGE.
+*/
+
+$nocsrf = true;
+
+require_once("guiconfig.inc");
+require_once("pfsense-utils.inc");
+require_once("functions.inc");
+require_once("/usr/local/www/widgets/include/installed_packages.inc");
+require_once("pkg-utils.inc");
+
+if(is_array($config['installedpackages']['package'])) {
+	foreach($config['installedpackages']['package'] as $instpkg) {
+		$tocheck[] = $instpkg['name'];
+	}
+	$currentvers = get_pkg_info($tocheck, array('version', 'xmlver'));
+}
+
+$updateavailable = false;
+?>
+
+<table width="100%" border="0" cellpadding="6" cellspacing="0" summary="installed packages">
+	<tr>
+		<td width="15%" class="listhdrr">Package Name</td>
+		<td width="15%" class="listhdrr">Category</td>
+		<td width="30%" class="listhdrr">Package Version</td>
+	</tr>
+	<?php
+	if($config['installedpackages']['package'] != "") {
+		$instpkgs = array();
+		foreach($config['installedpackages']['package'] as $instpkg)
+			$instpkgs[] = $instpkg['name'];
+		natcasesort($instpkgs);
+		$y=1;
+		foreach ($instpkgs as $index => $pkgname){
+
+			$pkg = $config['installedpackages']['package'][$index];
+			if($pkg['name'] <> "") { ?>
+				<tr valign="top">
+				<td class="listlr">
+					<?= $pkg['name'] ?>
+				</td>
+				<td class="listlr">
+					<?= $pkg['category'] ?>
+				</td>
+				<td class="listlr">
+				<?php
+				$latest_package = $currentvers[$pkg['name']]['version'];
+				if($latest_package == false) {
+					// We can't determine this package's version status.
+					echo "Current: Unknown.<br/>Installed: " . $pkg['version'];
+				} elseif(strcmp($pkg['version'], $latest_package) > 0) {
+					/* we're running a newer version of the package */
+					echo "Current: {$latest_package}";
+					echo "<br/>Installed: {$pkg['version']}";
+				} elseif(strcmp($pkg['version'], $latest_package) < 0) {
+					/* our package is out of date */
+					$updateavailable = true;
+					?>
+					<div id="updatediv-<?php echo $y; ?>" style="color:red">
+						<b>Đã có phiên bản mới!</b></div><div style="float:left">
+						Phiên bản mới: <?php echo $latest_package; ?><br/>
+						Đang sử dụng: <?php echo $pkg['version']; ?></div><div style="float:right">
+					<a href="pkg_mgr_install.php?mode=reinstallpkg&amp;pkg=<?= $pkg['name']; ?>"><img title="Update this package." src="./themes/<?= $g['theme']; ?>/images/icons/icon_reinstall_pkg.gif" width="17" height="17" border="0" alt="reinstall" /></a>
+					</div>
+					<?php
+					$y++;
+				} else {
+					echo $pkg['version'];
+				} ?>
+				</td>
+				</tr>
+		<?php	}
+		}
+	} else {
+		echo "<tr><td colspan=\"5\" align=\"center\">There are no packages currently installed.</td></tr>";
+	}
+	?>
+</table>
+
+<?php if ($updateavailable): ?>
+<script type="text/javascript">
+//<![CDATA[
+	window.onload = function(in_event)
+	{
+		for (y=1; y<=<?php echo $y;?>; y++){
+			textID = "#updatediv-" + y;
+			jQuery(textID).effect('pulsate');
+		}
+	}
+//]]>
+</script>
+<?php endif; ?>
diff --git a/usr/local/www/widgets/widgets/interface_statistics.widget.php~ b/usr/local/www/widgets/widgets/interface_statistics.widget.php~
new file mode 100644
index 0000000..c72c514
--- /dev/null
+++ b/usr/local/www/widgets/widgets/interface_statistics.widget.php~
@@ -0,0 +1,214 @@
+<?php
+/*
+        $Id: interface_statistics.widget.php 
+        Copyright 2007 Scott Dale
+        Part of pfSense widgets (www.pfsense.com)
+        originally based on m0n0wall (http://m0n0.ch/wall)
+
+        Copyright (C) 2004-2005 T. Lechat <dev@lechat.org>, Manuel Kasper <mk@neon1.net>
+        and Jonathan Watt <jwatt@jwatt.org>.
+        All rights reserved.
+
+        Redistribution and use in source and binary forms, with or without
+        modification, are permitted provided that the following conditions are met:
+
+        1. Redistributions of source code must retain the above copyright notice,
+           this list of conditions and the following disclaimer.
+
+        2. Redistributions in binary form must reproduce the above copyright
+           notice, this list of conditions and the following disclaimer in the
+           documentation and/or other materials provided with the distribution.
+
+        THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES,
+        INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY
+        AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
+        AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY,
+        OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
+        SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
+        INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
+        CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
+        ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
+        POSSIBILITY OF SUCH DAMAGE.
+*/
+
+$nocsrf = true;
+
+require_once("guiconfig.inc");
+require_once("pfsense-utils.inc");
+require_once("functions.inc");
+require_once("/usr/local/www/widgets/include/interface_statistics.inc");
+
+		$ifdescrs = get_configured_interface_with_descr();
+		
+		$array_in_packets = array();
+		$array_out_packets = array();
+		$array_in_bytes = array();
+		$array_out_bytes = array();
+		$array_in_errors = array();
+		$array_out_errors = array();
+		$array_collisions = array();
+		$array_interrupt = array();
+		$interfacecounter = 0;
+		
+		//build data arrays
+		foreach ($ifdescrs as $ifdescr => $ifname){
+			$ifinfo = get_interface_info($ifdescr);
+			$interfacecounter++;
+			if ($ifinfo['status'] != "down"){ 		
+				$array_in_packets[] = $ifinfo['inpkts'];
+				$array_out_packets[] = $ifinfo['outpkts'];
+				$array_in_bytes[] = format_bytes($ifinfo['inbytes']);
+				$array_out_bytes[] = format_bytes($ifinfo['outbytes']);
+				if (isset($ifinfo['inerrs'])){
+					$array_in_errors[] = $ifinfo['inerrs'];
+					$array_out_errors[] = $ifinfo['outerrs'];
+				}
+				else{
+					$array_in_errors[] = "n/a";
+					$array_out_errors[] = "n/a";
+				}
+				if (isset($ifinfo['collisions']))
+					$array_collisions[] = htmlspecialchars($ifinfo['collisions']);
+				else
+					$array_collisions[] = "n/a";
+			}
+					
+			
+		}//end for
+		
+	
+		
+		
+		?>
+		<div style="padding: 5px">			
+              <div id="int_labels" style="float:left;width:32%">
+				<table width="100%" border="0" cellspacing="0" cellpadding="0" summary="interfaces statistics">
+					<tr><td class="widgetsubheader" style="height:25px">&nbsp;&nbsp;&nbsp;</td></tr>	
+					<tr>
+	                	<td class="vncellt" style="height:25px">Gói tin Vào</td>
+					</tr>	              
+		            <tr>
+		                <td class="vncellt" style="height:25px">Gói tin Ra</td>
+		           </tr>	              
+	               <tr>
+	                <td class="vncellt" style="height:25px">Dung lượng Vào</td>
+				    </tr>	              
+	              <tr>
+	                <td class="vncellt" style="height:25px">Dung lượng Ra</td>
+				  </tr>	              
+	              <tr>
+	                <td class="vncellt" style="height:25px">Số lỗi Vào</td>
+				 </tr>	              
+	              <tr>
+	                <td class="vncellt" style="height:25px">Số lỗi Ra</td>
+				</tr>              
+	              <tr>
+	                <td class="vncellt" style="height:25px">Xung đột</td>
+				 </tr>	              
+	              </table>
+	          </div>
+	          <div id="interfacestats" style="float:right;overflow: auto; width:68%">
+	                   
+	          <table width="100%" border="0" cellspacing="0" cellpadding="0" summary="the stats">
+	              <tr>
+		                <?php 
+		               		$interface_names = array();
+		                	foreach ($ifdescrs as $ifdescr => $ifname): 
+		                	$ifinfo = get_interface_info($ifdescr);
+		                	if ($ifinfo['status'] != "down"){ ?>
+			                	<td class="widgetsubheader nowrap" style="height:25px">
+			                  		<?=htmlspecialchars($ifname);?>
+								</td>
+							<?php 							
+							//build array of interface names
+							$interface_names[] = $ifname;
+							} 
+							endforeach; ?>
+		              </tr>
+		              
+		              <tr>
+			                <?php 
+			                $counter = 1;
+			                foreach ($array_in_packets as $data): ?>
+							<td class="listr nowrap" id="stat<?php echo $counter?>" style="height:25px">
+								<?=htmlspecialchars($data);?>
+			                </td>
+			                <?php 
+			                $counter = $counter + 7;
+			                endforeach; ?>
+	              		</tr>
+	              		
+	              		<tr>
+			                <?php 
+			                $counter = 2;
+			                foreach ($array_out_packets as $data): ?>
+							<td class="listr nowrap" id="stat<?php echo $counter;?>" style="height:25px">
+								<?=htmlspecialchars($data);?>
+			                </td>
+			                <?php 
+			                $counter = $counter + 7;
+			                endforeach; ?>
+	              		</tr>
+			               
+			            <tr>
+			                <?php 
+			                $counter = 3;
+			                foreach ($array_in_bytes as $data): ?>
+							<td class="listr nowrap" id="stat<?php echo $counter;?>" style="height:25px">
+								<?=htmlspecialchars($data);?>
+			                </td>
+			                <?php 
+			                $counter = $counter + 7;
+			                endforeach; ?>
+	          			</tr>
+	          			
+	          			<tr>
+			                <?php 
+			                $counter = 4;
+			                foreach ($array_out_bytes as $data): ?>
+							<td class="listr nowrap" id="stat<?php echo $counter;?>" style="height:25px">
+								<?=htmlspecialchars($data);?>
+			                </td>
+			                <?php 
+			                $counter = $counter + 7;
+			                endforeach; ?>
+	            		</tr>
+	            		
+	            		<tr>
+			                <?php
+			                $counter = 5;
+				               foreach ($array_in_errors as $data): ?>
+									<td class="listr nowrap" id="stat<?php echo $counter;?>" style="height:25px">
+										<?=htmlspecialchars($data);?>
+					                </td>
+				                <?php 
+				                $counter = $counter + 7;
+				                endforeach; ?>
+	              		</tr>
+		                	
+		                <tr>
+		                	<?php 
+		                	$counter = 6;
+			               foreach ($array_out_errors as $data): ?>
+								<td class="listr nowrap" id="stat<?php echo $counter;?>" style="height:25px">
+									<?=htmlspecialchars($data);?>
+				                </td>
+			                <?php 
+			                $counter = $counter + 7;
+			                endforeach; ?>
+	             		</tr>
+		                	
+		                <tr>	
+		                	<?php  
+		                	$counter = 7;
+				                foreach ($array_collisions as $data): ?>
+								<td class="listr nowrap" id="stat<?php echo $counter;?>" style="height:25px">
+									<?=htmlspecialchars($data);?>
+				                </td>
+			                <?php 
+			                $counter = $counter + 7;
+			                endforeach; ?>
+						</tr>
+	             </table>
+			</div>
+	</div>
diff --git a/usr/local/www/widgets/widgets/interfaces.widget.php b/usr/local/www/widgets/widgets/interfaces.widget.php
index 3473783..1a9398b 100644
--- a/usr/local/www/widgets/widgets/interfaces.widget.php
+++ b/usr/local/www/widgets/widgets/interfaces.widget.php
@@ -38,53 +38,71 @@ require_once("pfsense-utils.inc");
 require_once("functions.inc");
 require_once("/usr/local/www/widgets/include/interfaces.inc");
 
-		$i = 0;
+		$i = 0; 
 		$ifdescrs = get_configured_interface_with_descr();
 ?>
-
+			
 	         <table bgcolor="#990000" width="100%" border="0" cellspacing="0" cellpadding="0" summary="interfaces">
-				<?php
+				<?php 
 				foreach ($ifdescrs as $ifdescr => $ifname) {
 					$ifinfo = get_interface_info($ifdescr);
 					$iswireless = is_interface_wireless($ifdescr);
 				?>
-				<tr>
+				<tr> 
 				<td class="vncellt" width="40%">
-				<?php
+				<?php 
 				if($ifinfo['ppplink']) {
 					echo "<img src='./themes/{$g['theme']}/images/icons/icon_3g.gif' alt='3g' />";
 				} else if($iswireless) {
-					if($ifinfo['status'] == "associated") { ?>
+					if($ifinfo['status'] == "associated") { ?> 
 						<img src="./themes/<?= $g['theme']; ?>/images/icons/icon_wlan.gif" alt="wlan" />
 					<?php } else { ?>
 						<img src="./themes/<?= $g['theme']; ?>/images/icons/icon_wlan_d.gif" alt="wlan_d" />
 					<?php } ?>
 				<?php } else { ?>
 						<img src="./themes/<?= $g['theme']; ?>/images/icons/icon_cablenic.gif" alt="cablenic" />
-				<?php } ?>&nbsp;
+				<?php } ?>&nbsp; 
 				<strong><u>
 				<span onclick="location.href='/interfaces.php?if=<?=$ifdescr; ?>'" style="cursor:pointer">
 				<?=htmlspecialchars($ifname);?></span></u></strong>
-				<?php
-					if ($ifinfo['dhcplink'])
+				<?php 
+					if ($ifinfo['dhcplink']) 
 						echo "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(DHCP)";
 				?>
 				</td>
 				<td width="60%"  class="listr">
 	                 		<table width="100%" border="0" cellspacing="0" cellpadding="0" summary="status">
 						<tr>
-		                 <?php if($ifinfo['status'] == "up" || $ifinfo['status'] == "associated") { ?>
+		                 <?php if($ifinfo['status'] == "up" || $ifinfo['status'] == "associated") { ?> 
 							<td>
 								<div id="<?php echo $ifname;?>-up" style="display:inline" ><img src="./themes/<?= $g['theme']; ?>/images/icons/icon_interface_up.gif" title="<?=$ifname;?> is up" alt="up" /></div>
 							</td>
+							<td>
+								<div id="<?php echo $ifname;?>-down" style="display:none" ><img src="./themes/<?= $g['theme']; ?>/images/icons/icon_interface_down.gif" title="<?=$ifname;?> is down" alt="down" /></div>
+							</td>
+							<td>
+								<div id="<?php echo $ifname;?>-block" style="display:none" ><img src="./themes/<?= $g['theme']; ?>/images/icons/icon_block.gif" title="<?=$ifname;?> is disabled" alt="disabled" /></div>
+							</td>
 		                <?php } else if ($ifinfo['status'] == "no carrier") { ?>
 							<td>
 								<div id="<?php echo $ifname;?>-down" style="display:inline" ><img src="./themes/<?= $g['theme']; ?>/images/icons/icon_interface_down.gif" title="<?=$ifname;?> is down" alt="down" /></div>
 							</td>
+							<td>
+								<div id="<?php echo $ifname;?>-block" style="display:none" ><img src="./themes/<?= $g['theme']; ?>/images/icons/icon_block.gif" title="<?=$ifname;?> is disabled" alt="disabled" /></div>
+							</td>
+							<td>
+								<div id="<?php echo $ifname;?>-up" style="display:none" ><img src="./themes/<?= $g['theme']; ?>/images/icons/icon_interface_up.gif" title="<?=$ifname;?> is up" alt="up" /></div>
+							</td>
 				<?php }  else if ($ifinfo['status'] == "down") { ?>
 							<td>
 								<div id="<?php echo $ifname;?>-block" style="display:inline" ><img src="./themes/<?= $g['theme']; ?>/images/icons/icon_block.gif" title="<?=$ifname;?> is disabled" alt="disabled" /></div>
 							</td>
+							<td>
+								<div id="<?php echo $ifname;?>-up" style="display:none" ><img src="./themes/<?= $g['theme']; ?>/images/icons/icon_interface_up.gif" title="<?=$ifname;?> is up" alt="up" /></div>
+							</td>
+							<td>
+								<div id="<?php echo $ifname;?>-down" style="display:none" ><img src="./themes/<?= $g['theme']; ?>/images/icons/icon_interface_down.gif" title="<?=$ifname;?> is down" alt="down" /></div>
+							</td>
 		                <?php } else { ?><?=htmlspecialchars($ifinfo['status']); }?>
 							<td>
 								<div id="<?php echo $ifname;?>-media" style="display:inline"><?=htmlspecialchars($ifinfo['media']);?></div>
diff --git a/usr/local/www/widgets/widgets/load_balancer_status.widget.php b/usr/local/www/widgets/widgets/load_balancer_status.widget.php
index 47da743..3ec5ba6 100644
--- a/usr/local/www/widgets/widgets/load_balancer_status.widget.php
+++ b/usr/local/www/widgets/widgets/load_balancer_status.widget.php
@@ -94,7 +94,7 @@ if (!$nentries)
 		<table border="0" cellpadding="0" cellspacing="2" summary="status">
 		<?php
 		foreach ($a_pool as $pool) {
-			if ($pool['name'] == $vsent['poolname']) {
+			if ($pool['name'] == $vsent['pool']) {
 				$pool_hosts=array();
 				foreach ((array) $pool['servers'] as $server) {
 					$svr['ip']['addr']=$server;
diff --git a/usr/local/www/widgets/widgets/log.widget.php b/usr/local/www/widgets/widgets/log.widget.php
index b099789..8a92092 100644
--- a/usr/local/www/widgets/widgets/log.widget.php
+++ b/usr/local/www/widgets/widgets/log.widget.php
@@ -64,8 +64,8 @@ if($_POST['filterlogentries']) {
     echo '</script>';
     echo '<noscript>';
     echo '<meta http-equiv="refresh" content="0;url='.$filename.'" />';
-    echo '</noscript>';
-  }
+    echo '</noscript>';  
+  } 
 	Header("Location: /");
 }
 
@@ -131,14 +131,14 @@ function format_log_line(row) {
 
 <div id="log-settings" class="widgetconfigdiv" style="display:none;">
 	<form action="/widgets/widgets/log.widget.php" method="post" name="iforma">
-		Number of lines to display:
+		Number of lines to display: 
 		<select name="filterlogentries" class="formfld unknown" id="filterlogentries">
 		<?php for ($i = 1; $i <= 20; $i++) { ?>
 			<option value="<?php echo $i;?>" <?php if ($nentries == $i) echo "SELECTED";?>><?php echo $i;?></option>
 		<?php } ?>
 		</select>
 
-<?php
+<?php 
 		$Include_Act = explode(",", str_replace(" ", ",", $nentriesacts));
 		if ($nentriesinterfaces == "All") $nentriesinterfaces = "";
 ?>
@@ -146,17 +146,9 @@ function format_log_line(row) {
 		<input id="actblock"  name="actblock"  type="checkbox" value="Block"  <?php if (in_arrayi('Block',  $Include_Act)) echo "checked=\"checked\""; ?> /> Block
 		<input id="actreject" name="actreject" type="checkbox" value="Reject" <?php if (in_arrayi('Reject', $Include_Act)) echo "checked=\"checked\""; ?> /> Reject
 		<br/>
-		Interfaces:
-		<select id="filterlogentriesinterfaces" name="filterlogentriesinterfaces" class="formselect">
-			<option value="All">ALL</option>
-                      <?php
-						$interfaces = get_configured_interface_with_descr();
-					  	foreach ($interfaces as $iface => $ifacename): ?>
-                        <option value="<?=$iface;?>" <?php if ($nentriesinterfaces == $iface) echo "selected='selected'";?>>
-                      <?=htmlspecialchars($ifacename);?>
-                      </option>
-                      <?php endforeach; ?>
-                    </select>
+		Interfaces: 
+		<input id="filterlogentriesinterfaces" name="filterlogentriesinterfaces" class="formfld unknown" type="text" size="20" value="<?= $nentriesinterfaces ?>" />
+        &nbsp; &nbsp; &nbsp; 
 
 		<input id="submita" name="submita" type="submit" class="formbtn" value="Save" />
 	</form>
diff --git a/usr/local/www/widgets/widgets/openvpn.widget.php b/usr/local/www/widgets/widgets/openvpn.widget.php
index 5c7d756..6413353 100644
--- a/usr/local/www/widgets/widgets/openvpn.widget.php
+++ b/usr/local/www/widgets/widgets/openvpn.widget.php
@@ -107,9 +107,9 @@ $clients = openvpn_get_active_clients();
 				<td class="listhdrr">Real/Virtual IP</td>
 			</tr>
 			<?php $rowIndex = 0;
-			foreach ($server['conns'] as $conn):
+			foreach ($server['conns'] as $conn): 
 			$evenRowClass = $rowIndex % 2 ? " listMReven" : " listMRodd";
-			$rowIndex++;
+			$rowIndex++;			
 			?>
 			<tr name='<?php echo "r:{$server['mgmt']}:{$conn['remote_host']}"; ?>' class="<?=$evenRowClass?>">
 				<td class="listMRlr">
diff --git a/usr/local/www/widgets/widgets/picture.widget.php b/usr/local/www/widgets/widgets/picture.widget.php
index 013d30c..199cb9d 100644
--- a/usr/local/www/widgets/widgets/picture.widget.php
+++ b/usr/local/www/widgets/widgets/picture.widget.php
@@ -35,7 +35,7 @@ require_once("functions.inc");
 if($_GET['getpic']=="true") {
 	$pic_type_s = explode(".", $config['widgets']['picturewidget_filename']);
 	$pic_type = $pic_type_s[1];
-	if($config['widgets']['picturewidget'])
+	if($config['widgets']['picturewidget']) 
 		$data = base64_decode($config['widgets']['picturewidget']);
 	header("Content-Disposition: inline; filename=\"{$config['widgets']['picturewidget_filename']}\"");
 	header("Content-Type: image/{$pic_type}");
@@ -47,7 +47,7 @@ if($_GET['getpic']=="true") {
 if($_POST) {
 	if (is_uploaded_file($_FILES['pictfile']['tmp_name'])) {
 		/* read the file contents */
-		$fd_pic = fopen($_FILES['pictfile']['tmp_name'], "rb");
+		$fd_pic = fopen($_FILES['pictfile']['tmp_name'], "rb");		
 		while ( ($buf=fread( $fd_pic, 8192 )) != '' ) {
 		    // Here, $buf is guaranteed to contain data
 		    $data .= $buf;
@@ -73,16 +73,17 @@ if($_POST) {
 
 <div id="picture-settings" class="widgetconfigdiv" style="display:none;">
 	<form action="/widgets/widgets/picture.widget.php" method="post" name="iforma" enctype="multipart/form-data">
-		<input name="pictfile" type="file" class="formbtn" id="pictfile" size="20" />
-		<input id="submita" name="submita" type="submit" class="formbtn" value="Upload" />
+		<input name="pictfile" type="file" class="formfld unknown" id="pictfile" size="20" />
+		<input id="submita" name="submita" type="submit" class="formbtn" value="Upload" /><br/>
+		<b>NOTE:</b> Best image size is 350x350 or smaller.
 	</form>
 </div>
 
 <div id="picture-widgets" style="padding: 5px">
 	<a href='/widgets/widgets/picture.widget.php?getpic=true' target='_blank'>
-		<img border="0" width="100%" height="100%" src="/widgets/widgets/picture.widget.php?getpic=true" alt="picture" />
+		<img border="0" width="350" height="350" src="/widgets/widgets/picture.widget.php?getpic=true" alt="picture" />
 	</a>
-</div>
+</div>											 
 
 <!-- needed to show the settings widget icon -->
 <script type="text/javascript">
diff --git a/usr/local/www/widgets/widgets/rss.widget.php b/usr/local/www/widgets/widgets/rss.widget.php
index 5f06422..f955fcd 100644
--- a/usr/local/www/widgets/widgets/rss.widget.php
+++ b/usr/local/www/widgets/widgets/rss.widget.php
@@ -42,8 +42,8 @@ if($_POST['rssfeed']) {
 }
 
 // Use saved feed and max items
-if($config['widgets']['rssfeed'])
-	$rss_feed_s = explode(",", $config['widgets']['rssfeed']);
+if($config['widgets']['rssfeed']) 
+	$rss_feed_s = explode(",", $config['widgets']['rssfeed']);	
 
 if($config['widgets']['rssmaxitems'])
 	$max_items =  $config['widgets']['rssmaxitems'];
@@ -59,19 +59,19 @@ if(!$rss_feed_s) {
 	$rss_feed_s = "http://blog.pfsense.org";
 	$config['widgets']['rssfeed'] = "http://blog.pfsense.org";
 }
-
+	
 if(!$max_items)
 	$max_items = 10;
 
 if(!$rsswidgetheight)
 	$rsswidgetheight = 300;
-
+	
 if(!$rsswidgettextlength)
 	$rsswidgettextlength = 140;	// oh twitter, how do we love thee?
 
-if($config['widgets']['rssfeed'])
+if($config['widgets']['rssfeed']) 
 	$textarea_txt =  str_replace(",", "\n", $config['widgets']['rssfeed']);
-else
+else 
 	$textarea_txt = "";
 
 ?>
@@ -80,51 +80,51 @@ else
 
 <div id="rss-settings" class="widgetconfigdiv" style="display:none;">
 	<form action="/widgets/widgets/rss.widget.php" method="post" name="iformc">
-		<textarea name="rssfeed" class="formfld unknown textarea_widget" id="rssfeed" cols="40" rows="3"><?=$textarea_txt;?></textarea>
+		<textarea name="rssfeed" class="formfld unknown" id="rssfeed" cols="40" rows="3"><?=$textarea_txt;?></textarea>
 		<br/>
 		<table summary="rss widget">
 			<tr>
 				<td align="right">
-					Display number of items:
+					Display number of items: 
 				</td>
 				<td>
 					<select name='rssmaxitems' id='rssmaxitems'>
 						<option value='<?= $max_items ?>'><?= $max_items ?></option>
 						<?php
-							for($x=100; $x<5100; $x=$x+100)
+							for($x=100; $x<5100; $x=$x+100) 
 								echo "<option value='{$x}'>{$x}</option>\n";
 						?>
 					</select>
 				</td>
 			</tr>
 			<tr>
-				<td align="right">
-					Widget height:
+				<td align="right">		
+					Widget height: 
 				</td>
 				<td>
 					<select name='rsswidgetheight' id='rsswidgetheight'>
 						<option value='<?= $rsswidgetheight ?>'><?= $rsswidgetheight ?>px</option>
 						<?php
-							for($x=100; $x<5100; $x=$x+100)
+							for($x=100; $x<5100; $x=$x+100) 
 								echo "<option value='{$x}'>{$x}px</option>\n";
 						?>
 					</select>
 				</td>
 			</tr>
 			<tr>
-				<td align="right">
+				<td align="right">		
 					Show how many characters from story:
 				</td>
 				<td>
 					<select name='rsswidgettextlength' id='rsswidgettextlength'>
 						<option value='<?= $rsswidgettextlength ?>'><?= $rsswidgettextlength ?></option>
 						<?php
-							for($x=10; $x<5100; $x=$x+10)
+							for($x=10; $x<5100; $x=$x+10) 
 								echo "<option value='{$x}'>{$x}</option>\n";
 						?>
 					</select>
 				</td>
-			</tr>
+			</tr>			
 			<tr>
 				<td>
 					&nbsp;
@@ -150,7 +150,7 @@ else
 	  if(strlen($string) > $length)
 	  return (preg_match('/^(.*)\W.*$/', substr($string, 0, $length+1), $matches) ? $matches[1] : substr($string, 0, $length)) . $replacer;
 	  return $string;
-	}
+	}	
 	$feed = new SimplePie();
 	$feed->set_cache_location("/tmp/simplepie/");
 	$feed->set_feed_url($rss_feed_s);
@@ -169,10 +169,10 @@ else
 		$counter++;
 		if($counter > $max_items)
 			break;
-		echo "<hr/>";
+		echo "<hr/>";			
 	}
 ?>
-</div>
+</div>				 
 
 <!-- needed to display the widget settings menu -->
 <script type="text/javascript">
diff --git a/usr/local/www/widgets/widgets/services_status.widget.php b/usr/local/www/widgets/widgets/services_status.widget.php
index dfe172b..9ae8696 100644
--- a/usr/local/www/widgets/widgets/services_status.widget.php
+++ b/usr/local/www/widgets/widgets/services_status.widget.php
@@ -73,19 +73,15 @@ if (count($services) > 0) {
 		if (empty($service['description']))
 			$service['description'] = get_pkg_descr($service['name']);
 		$service_desc = explode(".",$service['description']);
-		echo "<tr><td class=\"listlr\">" . $service['name'] . "</td>\n";
-		echo "<td class=\"listr\">" . $service_desc[0] . "</td>\n";
-		// if service is running then listr else listbg
-		$bgclass = null;
-		if (get_service_status($service))
-			$bgclass = "listr";
-		else
-			$bgclass = "listbg";
-		echo "<td class=\"" . $bgclass . "\" align=\"center\">" . get_service_status_icon($service, true, true) . "</td>\n";
-		echo "<td valign=\"middle\" class=\"list nowrap\">" . get_service_control_links($service) . "</td></tr>\n";
+		echo '<tr><td class="listlr">' . $service['name'] . '</td>' . "\n";
+		echo '<td class="listr">' . $service_desc[0] . '</td>' . "\n";
+		echo get_service_status_icon($service, false, true);
+		echo '<td valign="middle" class="list nowrap">';
+		echo get_service_control_links($service);
+		echo "</td></tr>\n";
 	}
 } else {
-	echo "<tr><td colspan=\"3\" align=\"center\">" . gettext("No services found") . " . </td></tr>\n";
+	echo "<tr><td colspan=\"3\" align=\"center\">" . gettext("No services found") . ".</td></tr>\n";
 }
 ?>
 </table>
diff --git a/usr/local/www/widgets/widgets/services_status.widget.php~ b/usr/local/www/widgets/widgets/services_status.widget.php~
new file mode 100644
index 0000000..8a9db46
--- /dev/null
+++ b/usr/local/www/widgets/widgets/services_status.widget.php~
@@ -0,0 +1,96 @@
+<?php
+/*
+    services_status.widget.php
+    Copyright (C) 2004, 2005 Scott Ullrich
+    All rights reserved.
+
+    services_status.widget.php
+    Copyright (C) 2007 Sam Wenham
+
+    Redistribution and use in source and binary forms, with or without
+    modification, are permitted provided that the following conditions are met:
+
+    1. Redistributions of source code must retain the above copyright notice,
+       this list of conditions and the following disclaimer.
+
+    2. Redistributions in binary form must reproduce the above copyright
+       notice, this list of conditions and the following disclaimer in the
+       documentation and/or other materials provided with the distribution.
+
+    THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES,
+    INClUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY
+    AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
+    AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY,
+    OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
+    SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
+    INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
+    CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
+    ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
+    POSSIBILITY OF SUCH DAMAGE.
+*/
+
+$nocsrf = true;
+
+require_once("guiconfig.inc");
+require_once("captiveportal.inc");
+require_once("service-utils.inc");
+require_once("ipsec.inc");
+require_once("vpn.inc");
+require_once("/usr/local/www/widgets/include/services_status.inc");
+
+$services = get_services();
+
+if(isset($_POST['servicestatusfilter'])) {
+	$config['widgets']['servicestatusfilter'] = $_POST['servicestatusfilter'];
+	write_config("Saved Service Status Filter via Dashboard");
+	header("Location: ../../index.php");
+}
+?>
+<input type="hidden" id="services_status-config" name="services_status-config" value="" />
+<div id="services_status-settings" class="widgetconfigdiv" style="display:none;">
+	<form action="/widgets/widgets/services_status.widget.php" method="post" name="iformd">
+		Comma separated list of services to NOT display in the widget<br />
+		<input type="text" size="30" name="servicestatusfilter" class="formfld unknown" id="servicestatusfilter" value="<?= $config['widgets']['servicestatusfilter'] ?>" />
+		<input id="submitd" name="submitd" type="submit" class="formbtn" value="Save" />
+    </form>
+</div>
+
+<table width="100%" border="0" cellpadding="0" cellspacing="0" summary="services">
+	<tr>
+	  <td class="widgetsubheader" align="center"><b>Dịch vụ</b></td>
+	  <td class="widgetsubheader" align="center"><b>Mô tả</b></td>
+	  <td class="widgetsubheader" align="center"><b>Status</b></td>
+	  <td class="widgetsubheader">&nbsp;</td>
+	</tr>
+<?php
+$skipservices = explode(",", $config['widgets']['servicestatusfilter']);
+
+if (count($services) > 0) {
+	uasort($services, "service_name_compare");
+	foreach($services as $service) {
+		if((!$service['name']) || (in_array($service['name'], $skipservices)) || (!is_service_enabled($service['name'])))
+			continue;
+		if (empty($service['description']))
+			$service['description'] = get_pkg_descr($service['name']);
+		$service_desc = explode(".",$service['description']);
+		echo '<tr><td class="listlr">' . $service['name'] . '</td>' . "\n";
+		echo '<td class="listr">' . $service_desc[0] . '</td>' . "\n";
+		echo get_service_status_icon($service, false, true);
+		echo '<td valign="middle" class="list nowrap">';
+		echo get_service_control_links($service);
+		echo "</td></tr>\n";
+	}
+} else {
+	echo "<tr><td colspan=\"3\" align=\"center\">" . gettext("No services found") . ".</td></tr>\n";
+}
+?>
+</table>
+
+<!-- needed to display the widget settings menu -->
+<script type="text/javascript">
+//<![CDATA[
+	selectIntLink = "services_status-configure";
+	textlink = document.getElementById(selectIntLink);
+	textlink.style.display = "inline";
+//]]>
+</script>
diff --git a/usr/local/www/widgets/widgets/system_information.widget.php~ b/usr/local/www/widgets/widgets/system_information.widget.php~
new file mode 100644
index 0000000..b6e148e
--- /dev/null
+++ b/usr/local/www/widgets/widgets/system_information.widget.php~
@@ -0,0 +1,297 @@
+<?php
+/*
+        $Id$
+        Copyright 2007 Scott Dale
+        Part of pfSense widgets (www.pfsense.com)
+        originally based on m0n0wall (http://m0n0.ch/wall)
+
+        Copyright (C) 2004-2005 T. Lechat <dev@lechat.org>, Manuel Kasper <mk@neon1.net>
+        and Jonathan Watt <jwatt@jwatt.org>.
+        All rights reserved.
+
+        Redistribution and use in source and binary forms, with or without
+        modification, are permitted provided that the following conditions are met:
+
+        1. Redistributions of source code must retain the above copyright notice,
+           this list of conditions and the following disclaimer.
+
+        2. Redistributions in binary form must reproduce the above copyright
+           notice, this list of conditions and the following disclaimer in the
+           documentation and/or other materials provided with the distribution.
+
+        THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES,
+        INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY
+        AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
+        AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY,
+        OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
+        SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
+        INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
+        CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
+        ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
+        POSSIBILITY OF SUCH DAMAGE.
+*/
+
+require_once("functions.inc");
+require_once("guiconfig.inc");
+require_once('notices.inc');
+include_once("includes/functions.inc.php");
+
+if($_REQUEST['getupdatestatus']) {
+	if(isset($config['system']['firmware']['disablecheck'])) {
+		exit;
+	}
+	if(isset($config['system']['firmware']['alturl']['enable']))
+		$updater_url = "{$config['system']['firmware']['alturl']['firmwareurl']}";
+	else 
+		$updater_url = $g['update_url'];
+
+	$nanosize = "";
+	if ($g['platform'] == "nanobsd") {
+		if (file_exists("/etc/nano_use_vga.txt"))
+			$nanosize = "-nanobsd-vga-";
+		else
+			$nanosize = "-nanobsd-";
+		$nanosize .= strtolower(trim(file_get_contents("/etc/nanosize.txt")));
+	}
+
+	@unlink("/tmp/{$g['product_name']}_version");
+	if (download_file_with_progress_bar("{$updater_url}/version{$nanosize}", "/tmp/{$g['product_name']}_version", 'read_body', 5, 5) === true)
+		$remote_version = trim(@file_get_contents("/tmp/{$g['product_name']}_version"));
+
+	if(empty($remote_version))
+		echo "<br /><br />Unable to check for updates.";
+	else {
+		$current_installed_buildtime = trim(file_get_contents("/etc/version.buildtime"));
+		$current_installed_version = trim(file_get_contents("/etc/version"));
+
+		if(!$remote_version) {
+			echo "<br /><br />Unable to check for updates.";
+		}
+		else {
+			$needs_system_upgrade = false;
+			if (pfs_version_compare($current_installed_buildtime, $current_installed_version, $remote_version) == -1) {
+				echo "<br/><span class=\"red\" id=\"updatealert\"><b>Đã có phiên bản mới. </b></span><a href=\"/system_firmware_check.php\">Vào đây</a> xem chi tiêt.";
+				echo "<script type=\"text/javascript\">";
+				echo "jQuery('#updatealert').effect('pulsate',{times: 30},10000);";
+
+				echo "</script>";
+			} else
+				echo "<br />Đã sử dụng phiên bản mới nhất.";
+		}
+	}
+	exit;
+}
+
+$curcfg = $config['system']['firmware'];
+
+?>
+
+<table width="100%" border="0" Icellspacing="0" cellpadding="0" summary="Thông tin hệ thống">
+	<tbody>
+		<tr>
+			<td width="25%" class="vncellt"><?=gettext("Name");?></td>
+			<td width="75%" class="listr"><?php echo $config['system']['hostname'] . "." . $config['system']['domain']; ?></td>
+		</tr>
+		<tr>
+			<td width="25%" valign="top" class="vncellt"><?=gettext("Version");?></td>
+			<td width="75%" class="listr">
+				<strong><?php readfile("/etc/version"); ?></strong>
+				(<?php echo php_uname("m"); ?>)
+				<br />
+				tạo lúc <?php readfile("/etc/version.buildtime"); ?>
+		<?php if(!$g['hideuname']): ?>
+		<br />
+		<div id="uname"><a href="#" onclick='swapuname(); return false;'><?php echo php_uname("s") . " " . php_uname("r"); ?></a></div>
+		<?php endif; ?>
+		<?php if(!isset($config['system']['firmware']['disablecheck'])): ?>
+		<div id='updatestatus'><br/><?php echo gettext("Obtaining update status"); ?> ...</div>
+		<?php endif; ?>
+			</td>
+		</tr>
+		<?php if(!$g['hideplatform']): ?>
+		<tr>
+			<td width="25%" class="vncellt"><?=gettext("Platform");?></td>
+			<td width="75%" class="listr">
+				<?=htmlspecialchars($g['platform']);?>
+				<?php if (($g['platform'] == "nanobsd") && (file_exists("/etc/nanosize.txt"))) {
+					echo " (" . htmlspecialchars(trim(file_get_contents("/etc/nanosize.txt"))) . ")";
+				} ?>
+			</td>
+		</tr>
+		<?php endif; ?>
+		<?php if ($g['platform'] == "nanobsd"): ?>
+			<?
+			global $SLICE, $OLDSLICE, $TOFLASH, $COMPLETE_PATH, $COMPLETE_BOOT_PATH;
+			global $GLABEL_SLICE, $UFS_ID, $OLD_UFS_ID, $BOOTFLASH;
+			global $BOOT_DEVICE, $REAL_BOOT_DEVICE, $BOOT_DRIVE, $ACTIVE_SLICE;
+			nanobsd_detect_slice_info();
+			$rw = is_writable("/") ? "(rw)" : "(ro)";
+			?>
+		<tr>
+			<td width="25%" class="vncellt">NanoBSD Boot Slice</td>
+			<td width="75%" class="listr">
+				<?=htmlspecialchars(nanobsd_friendly_slice_name($BOOT_DEVICE));?> / <?=htmlspecialchars($BOOTFLASH);?> <?php echo $rw; ?>
+				<?php if ($BOOTFLASH != $ACTIVE_SLICE): ?>
+				<br/><br/>Next Boot:<br/>
+				<?=htmlspecialchars(nanobsd_friendly_slice_name($GLABEL_SLICE));?> / <?=htmlspecialchars($ACTIVE_SLICE);?>
+				<?php endif; ?>
+			</td>
+		</tr>
+		<?php endif; ?>
+		<tr>
+			<td width="25%" class="vncellt"><?=gettext("CPU Type");?></td>
+			<td width="75%" class="listr">
+			<?php 
+				$cpumodel = "";
+				exec("/sbin/sysctl -n hw.model", $cpumodel);
+				$cpumodel = implode(" ", $cpumodel);
+				echo (htmlspecialchars($cpumodel));
+			?>
+			<div id="cpufreq"><?= get_cpufreq(); ?></div>
+		<?php	$cpucount = get_cpu_count();
+			if ($cpucount > 1): ?>
+			<div id="cpucount">
+				<?= htmlspecialchars($cpucount) ?> CPUs: <?= htmlspecialchars(get_cpu_count(true)); ?></div>
+		<?php	endif; ?>
+			</td>
+		</tr>
+		<?php if ($hwcrypto): ?>
+		<tr>
+			<td width="25%" class="vncellt">Hardware crypto</td>
+			<td width="75%" class="listr"><?=htmlspecialchars($hwcrypto);?></td>
+		</tr>
+		<?php endif; ?>
+		<tr>
+			<td width="25%" class="vncellt"><?=gettext("Uptime");?></td>
+			<td width="75%" class="listr" id="uptime"><?= htmlspecialchars(get_uptime()); ?></td>
+		</tr>
+        <tr>
+            <td width="25%" class="vncellt"><?=gettext("Current date/time");?></td>
+            <td width="75%" class="listr">
+                <div id="datetime"><?= date("D M j G:i:s T Y"); ?></div>
+            </td>
+        </tr>			
+		 <tr>
+             <td width="30%" class="vncellt">DNS server(s)</td>
+             <td width="70%" class="listr">
+					<?php
+						$dns_servers = get_dns_servers();
+						foreach($dns_servers as $dns) {
+							echo "{$dns}<br/>";
+						}
+					?>
+			</td>
+		</tr>	
+		<?php if ($config['revision']): ?>
+		<tr>
+			<td width="25%" class="vncellt"><?=gettext("Last config change");?></td>
+			<td width="75%" class="listr"><?= htmlspecialchars(date("D M j G:i:s T Y", intval($config['revision']['time'])));?></td>
+		</tr>
+		<?php endif; ?>
+		<tr>
+			<td width="25%" class="vncellt"><?=gettext("State table size");?></td>
+			<td width="75%" class="listr">
+				<?php	$pfstatetext = get_pfstate();
+					$pfstateusage = get_pfstate(true);
+				?>
+				<img src="./themes/<?= $g['theme']; ?>/images/misc/bar_left.gif" height="15" width="4" border="0" align="middle" alt="left bar" /><img src="./themes/<?= $g['theme']; ?>/images/misc/bar_blue.gif" height="15" name="pfstatewidtha" id="pfstatewidtha" width="<?= round($pfstateusage); ?>" border="0" align="middle" alt="red bar" /><img src="./themes/<?= $g['theme']; ?>/images/misc/bar_gray.gif" height="15" name="pfstatewidthb" id="pfstatewidthb" width="<?= (100 - $pfstateusage); ?>" border="0" align="middle" alt="gray bar" /><img src="./themes/<?= $g['theme']; ?>/images/misc/bar_right.gif" height="15" width="5" border="0" align="middle" alt="right bar" />
+				<br/><span id="pfstateusagemeter"><?= $pfstateusage.'%'; ?></span> (<span id="pfstate"><?= htmlspecialchars($pfstatetext); ?></span>)
+		    	<br />
+		    	<a href="diag_dump_states.php"><?=gettext("Show states");?></a>
+			</td>
+		</tr>
+		<tr>
+			<td width="25%" class="vncellt"><?=gettext("MBUF Usage");?></td>
+			<td width="75%" class="listr">
+				<?php
+					$mbufstext = get_mbuf();
+					$mbufusage = get_mbuf(true);
+				?>
+				<img src="./themes/<?= $g['theme']; ?>/images/misc/bar_left.gif" height="15" width="4" border="0" align="middle" alt="left bar" /><img src="./themes/<?= $g['theme']; ?>/images/misc/bar_blue.gif" height="15" name="mbufwidtha" id="mbufwidtha" width="<?= round($mbufusage); ?>" border="0" align="middle" alt="red bar" /><img src="./themes/<?= $g['theme']; ?>/images/misc/bar_gray.gif" height="15" name="mbufwidthb" id="mbufwidthb" width="<?= (100 - $mbufusage); ?>" border="0" align="middle" alt="gray bar" /><img src="./themes/<?= $g['theme']; ?>/images/misc/bar_right.gif" height="15" width="5" border="0" align="middle" alt="right bar" />
+				<br/><span id="mbufusagemeter"><?= $mbufusage.'%'; ?></span> (<span id="mbuf"><?= $mbufstext ?></span>)
+			</td>
+		</tr>
+                <?php if (get_temp() != ""): ?>
+                <tr>
+                        <td width="25%" class="vncellt"><?=gettext("Temperature");?></td>
+			<td width="75%" class="listr">
+				<?php $TempMeter = $temp = get_temp(); ?>
+				<img src="./themes/<?= $g['theme']; ?>/images/misc/bar_left.gif" height="15" width="4" border="0" align="middle" alt="left bar" /><img src="./themes/<?= $g['theme']; ?>/images/misc/bar_blue.gif" height="15" name="tempwidtha" id="tempwidtha" width="<?= round($TempMeter); ?>" border="0" align="middle" alt="red bar" /><img src="./themes/<?= $g['theme']; ?>/images/misc/bar_gray.gif" height="15" name="tempwidthb" id="tempwidthb" width="<?= (100 - $TempMeter); ?>" border="0" align="middle" alt="gray bar" /><img src="./themes/<?= $g['theme']; ?>/images/misc/bar_right.gif" height="15" width="5" border="0" align="middle" alt="right bar" />
+				&nbsp;
+				<span id="tempmeter"><?= $temp."&#176;C"; ?></span>
+			</td>
+                </tr>
+                <?php endif; ?>
+		<tr>
+			<td width="25%" class="vncellt"><?=gettext("Load average");?></td>
+			<td width="75%" class="listr">
+			<div id="load_average" title="Last 1, 5 and 15 minutes"><?= get_load_average(); ?></div>
+			</td>
+		</tr>
+		<tr>
+			<td width="25%" class="vncellt"><?=gettext("CPU usage");?></td>
+			<td width="75%" class="listr">
+				<?php $cpuUsage = "0"; ?>
+				<img src="./themes/<?= $g['theme']; ?>/images/misc/bar_left.gif" height="15" width="4" border="0" align="middle" alt="left bar" /><img src="./themes/<?= $g['theme']; ?>/images/misc/bar_blue.gif" height="15" name="cpuwidtha" id="cpuwidtha" width="<?= $cpuUsage; ?>" border="0" align="middle" alt="red bar" /><img src="./themes/<?= $g['theme']; ?>/images/misc/bar_gray.gif" height="15" name="cpuwidthb" id="cpuwidthb" width="<?= (100 - $cpuUsage); ?>" border="0" align="middle" alt="gray bar" /><img src="./themes/<?= $g['theme']; ?>/images/misc/bar_right.gif" height="15" width="5" border="0" align="middle" alt="right bar" />
+				&nbsp;
+				<br/><span id="cpumeter">(Cập nhật trong 10 giây)</span>
+			</td>
+		</tr>
+		<tr>
+			<td width="25%" class="vncellt"><?=gettext("Memory usage");?></td>
+			<td width="75%" class="listr">
+				<?php $memUsage = mem_usage(); ?>
+				<img src="./themes/<?= $g['theme']; ?>/images/misc/bar_left.gif" height="15" width="4" border="0" align="middle" alt="left bar" /><img src="./themes/<?= $g['theme']; ?>/images/misc/bar_blue.gif" height="15" name="memwidtha" id="memwidtha" width="<?= $memUsage; ?>" border="0" align="middle" alt="red bar" /><img src="./themes/<?= $g['theme']; ?>/images/misc/bar_gray.gif" height="15" name="memwidthb" id="memwidthb" width="<?= (100 - $memUsage); ?>" border="0" align="middle" alt="gray bar" /><img src="./themes/<?= $g['theme']; ?>/images/misc/bar_right.gif" height="15" width="5" border="0" align="middle" alt="right bar" />
+				&nbsp;
+				<br/><span id="memusagemeter"><?= $memUsage.'%'; ?></span> of <?= sprintf("%.0f", `/sbin/sysctl -n hw.physmem` / (1024*1024)) ?> MB
+			</td>
+		</tr>
+		<?php if($showswap == true): ?>
+		<tr>
+			<td width="25%" class="vncellt"><?=gettext("SWAP usage");?></td>
+			<td width="75%" class="listr">
+				<?php $swapusage = swap_usage(); ?>
+				<img src="./themes/<?= $g['theme']; ?>/images/misc/bar_left.gif" height="15" width="4" border="0" align="middle" alt="left bar" /><img src="./themes/<?= $g['theme']; ?>/images/misc/bar_blue.gif" height="15" width="<?= $swapusage; ?>" border="0" align="middle" alt="red bar" /><img src="./themes/<?= $g['theme']; ?>/images/misc/bar_gray.gif" height="15" width="<?= (100 - $swapusage); ?>" border="0" align="middle" alt="gray bar" /><img src="./themes/<?= $g['theme']; ?>/images/misc/bar_right.gif" height="15" width="5" border="0" align="middle" alt="right bar" />
+				&nbsp;
+				<br/><span id="swapusagemeter"><?= $swapusage.'%'; ?></span> of <?= sprintf("%.0f", `/usr/sbin/swapinfo -m | /usr/bin/grep -v Device | /usr/bin/awk '{ print $2;}'`) ?> MB
+			</td>
+		</tr>
+		<?php endif; ?>
+		<tr>
+			<td width="25%" class="vncellt"><?=gettext("Disk usage");?></td>
+			<td width="75%" class="listr">
+				<?php $diskusage = disk_usage(); ?>
+				<img src="./themes/<?= $g["theme"]; ?>/images/misc/bar_left.gif" height="15" width="4" border="0" align="middle" alt="left bar" /><img src="./themes/<?= $g["theme"]; ?>/images/misc/bar_blue.gif" height="15" width="<?= $diskusage; ?>" border="0" align="middle" alt="red bar" /><img src="./themes/<?= $g["theme"]; ?>/images/misc/bar_gray.gif" height="15" width="<?= (100 - $diskusage); ?>" border="0" align="middle" alt="gray bar" /><img src="./themes/<?= $g["theme"]; ?>/images/misc/bar_right.gif" height="15" width="5" border="0" align="middle" alt="right bar" />
+				&nbsp;
+				<br/><span id="diskusagemeter"><?= $diskusage.'%'; ?></span> of <?= `/bin/df -h / | /usr/bin/grep -v 'Size' | /usr/bin/awk '{ print $2 }'` ?>
+			</td>
+		</tr>
+	</tbody>
+</table>
+<script type="text/javascript">
+//<![CDATA[
+	function swapuname() {
+		jQuery('#uname').html("<?php echo php_uname("a"); ?>");
+	}
+	<?php if(!isset($config['system']['firmware']['disablecheck'])): ?>
+	function getstatus() {
+		scroll(0,0);
+		var url = "/widgets/widgets/system_information.widget.php";
+		var pars = 'getupdatestatus=yes';
+		jQuery.ajax(
+			url,
+			{
+				type: 'get',
+				data: pars,
+				complete: activitycallback
+			});
+	}
+	function activitycallback(transport) {
+		// .html() method process all script tags contained in responseText,
+		// to avoid this we set the innerHTML property
+		jQuery('#updatestatus').prop('innerHTML',transport.responseText);
+	}
+	setTimeout('getstatus()', 4000);
+	<?php endif; ?>
+//]]>
+</script>
diff --git a/usr/local/www/widgets/widgets/thermal_sensors.widget.php b/usr/local/www/widgets/widgets/thermal_sensors.widget.php
index 99ed40a..4413ba6 100644
--- a/usr/local/www/widgets/widgets/thermal_sensors.widget.php
+++ b/usr/local/www/widgets/widgets/thermal_sensors.widget.php
@@ -4,7 +4,7 @@
 	Description: Thermal Sensors Widget.
 		NOTE: depends on proper cofing in System >> Advanced >> Miscellaneous tab >> Thermal Sensors section.
 
-	File location:
+	File location: 
 		\usr\local\www\widgets\widgets\
 	Depends on:
 		\usr\local\www\widgets\javascript\thermal_sensors.js
@@ -179,73 +179,73 @@ function getBoolValueFromConfig(&$configArray, $valueKey, $defaultValue) {
 		</tr>
 		<tr>
 		<td align="right">
-			Zone Warning:
+			Zone Warning: 
 		</td>
 		<td>
-			<input type="text" maxlength="3" size="3" class="formfld unknown"
-			   name="thermal_sensors_widget_zone_warning_threshold"
-			   id="thermal_sensors_widget_zone_warning_threshold"
+			<input type="text" maxlength="3" size="3" class="formfld unknown" 
+			   name="thermal_sensors_widget_zone_warning_threshold" 
+			   id="thermal_sensors_widget_zone_warning_threshold" 
 			   value="<?= $thermal_sensors_widget_zoneWarningTempThreshold; ?>" />
 		</td>
 		<td align="right">
 			<label for="thermal_sensors_widget_show_raw_output">Show raw output (no graph): </label>
-			<input type="checkbox"
-			   id="thermal_sensors_widget_show_raw_output"
-			   name="thermal_sensors_widget_show_raw_output"
+			<input type="checkbox" 
+			   id="thermal_sensors_widget_show_raw_output" 
+			   name="thermal_sensors_widget_show_raw_output" 
 			   value="<?= $thermal_sensors_widget_showRawOutput; ?>" <?= ($thermal_sensors_widget_showRawOutput) ? " checked='checked'" : ""; ?> />
 		</td>
 		</tr>
 		<tr>
 		<td align="right">
-			Zone Critical:
+			Zone Critical: 
 		</td>
 		<td>
-			<input type="text" maxlength="3" size="3" class="formfld unknown"
-			   name="thermal_sensors_widget_zone_critical_threshold"
-			   id="thermal_sensors_widget_zone_critical_threshold"
+			<input type="text" maxlength="3" size="3" class="formfld unknown" 
+			   name="thermal_sensors_widget_zone_critical_threshold" 
+			   id="thermal_sensors_widget_zone_critical_threshold" 
 			   value="<?= $thermal_sensors_widget_zoneCriticalTempThreshold; ?>" />
 		</td>
 		<td align="right">
 			<label for="thermal_sensors_widget_show_full_sensor_name">Show full sensor name: </label>
-			<input type="checkbox"
-			   id="thermal_sensors_widget_show_full_sensor_name"
-			   name="thermal_sensors_widget_show_full_sensor_name"
+			<input type="checkbox" 
+			   id="thermal_sensors_widget_show_full_sensor_name" 
+			   name="thermal_sensors_widget_show_full_sensor_name" 
 			   value="<?= $thermal_sensors_widget_showFullSensorName; ?>" <?= ($thermal_sensors_widget_showFullSensorName) ? " checked='checked'" : ""; ?> />
 		</td>
 		</tr>
 		<tr>
 		<td align="right">
-			Core Warning:
+			Core Warning: 
 		</td>
 		<td>
-			<input type="text" maxlength="3" size="3" class="formfld unknown"
-			   name="thermal_sensors_widget_core_warning_threshold"
-			   id="thermal_sensors_widget_core_warning_threshold"
+			<input type="text" maxlength="3" size="3" class="formfld unknown" 
+			   name="thermal_sensors_widget_core_warning_threshold" 
+			   id="thermal_sensors_widget_core_warning_threshold" 
 			   value="<?= $thermal_sensors_widget_coreWarningTempThreshold ?>" />
 		</td>
 		<td align="right">
 			<label for="thermal_sensors_widget_pulsate_warning">Pulsate Warning: </label>
-			<input type="checkbox"
-			   id="thermal_sensors_widget_pulsate_warning"
-			   name="thermal_sensors_widget_pulsate_warning"
+			<input type="checkbox" 
+			   id="thermal_sensors_widget_pulsate_warning" 
+			   name="thermal_sensors_widget_pulsate_warning" 
 			   value="<?= $thermal_sensors_widget_pulsateWarning; ?>" <?= ($thermal_sensors_widget_pulsateWarning) ? " checked='checked'" : ""; ?> />
 		</td>
 		</tr>
 		<tr>
 		<td align="right">
-			Core Critical:
+			Core Critical: 
 		</td>
 		<td>
-			<input type="text" maxlength="3" size="3" class="formfld unknown"
-			   name="thermal_sensors_widget_core_critical_threshold"
-			   id="thermal_sensors_widget_core_critical_threshold"
+			<input type="text" maxlength="3" size="3" class="formfld unknown" 
+			   name="thermal_sensors_widget_core_critical_threshold" 
+			   id="thermal_sensors_widget_core_critical_threshold" 
 			   value="<?= $thermal_sensors_widget_coreCriticalTempThreshold ?>" />
 		</td>
 		<td align="right">
 			<label for="thermal_sensors_widget_pulsate_critical">Pulsate Critical: </label>
-			<input type="checkbox"
-			   id="thermal_sensors_widget_pulsate_critical"
-			   name="thermal_sensors_widget_pulsate_critical"
+			<input type="checkbox" 
+			   id="thermal_sensors_widget_pulsate_critical" 
+			   name="thermal_sensors_widget_pulsate_critical" 
 			   value="<?= $thermal_sensors_widget_pulsateCritical; ?>" <?= ($thermal_sensors_widget_pulsateCritical) ? " checked='checked'" : ""; ?> />
 		</td>
 		</tr>
diff --git a/usr/local/www/widgets/widgets/traffic_graphs.widget.php b/usr/local/www/widgets/widgets/traffic_graphs.widget.php
index 931c2a5..a9e4e47 100644
--- a/usr/local/www/widgets/widgets/traffic_graphs.widget.php
+++ b/usr/local/www/widgets/widgets/traffic_graphs.widget.php
@@ -59,9 +59,6 @@ if ($_POST) {
 	if (isset($_POST["refreshinterval"])) {
 		$a_config["refreshinterval"] = $_POST["refreshinterval"];
 	}
-	if (isset($_POST["scale_type"])) {
-		$a_config["scale_type"] = $_POST["scale_type"];
-	}
 	$a_config["shown"]["item"] = array();
 	foreach ($ifdescrs as $ifname => $ifdescr) {
 		$state = $_POST["shown"][$ifname];
@@ -89,12 +86,6 @@ if (isset($a_config["refreshinterval"])) {
 	$refreshinterval = 10;
 }
 
-if (isset($a_config["scale_type"])) {
-        $scale_type = $a_config["scale_type"];
-} else {
-        $scale_type = "up";
-}
-
 ?>
 <input type="hidden" id="traffic_graphs-config" name="traffic_graphs-config" value="">
 
@@ -109,22 +100,6 @@ if (isset($a_config["scale_type"])) {
 	<?php foreach ($ifdescrs as $ifname => $ifdescr) { ?>
 		<input type="hidden" name="shown[<?= $ifname ?>]" value="<?= $shown[$ifname] ? "show" : "hide" ?>" />
 	<?php } ?>
-	Default AutoScale:
-		<?php 
-			$scale_type_up="checked";
-			$scale_type_follow="unchecked";
-			if (isset($config["widgets"]["trafficgraphs"]["scale_type"])) {
-				$selected_radio = $config["widgets"]["trafficgraphs"]["scale_type"];
-				if ($selected_radio == "up") {
-					$scale_type_up = "checked";
-				}
-				else if ($selected_radio == "follow") {
-					$scale_type_follow = "checked";
-				}
-			}
-		?>
-	<input name="scale_type" class="radio" type="radio" id="scale_type" value="up" <?php echo $scale_type_up; ?> onchange="updateGraphDisplays();" /> <span>up</span>
-	<input name="scale_type" class="radio" type="radio" id="scale_type" value="follow" <?php echo $scale_type_follow; ?> onchange="updateGraphDisplays();" /> <span>follow</span><br><br>
 	Refresh Interval:
 	<select name="refreshinterval" class="formfld" id="refreshinterval" onchange="updateGraphDisplays();">
 		<?php for ($i = 1; $i <= 10; $i += 1) { ?>
@@ -171,7 +146,7 @@ foreach ($ifdescrs as $ifname => $ifdescr) {
 				<div style="clear:both;"></div>
 			</div>
 			<div id="<?=$ifname;?>graphdiv" style="display:<?php echo $graphdisplay;?>">
-				<embed id="graph" src="graph.php?ifnum=<?=$ifname;?>&ifname=<?=rawurlencode($ifdescr);?>&timeint=<?=$refreshinterval;?>&initdelay=<?=($graphcounter+1) * 2;?>" type="image/svg+xml" width="100%" height="100%" pluginspage="http://www.adobe.com/svg/viewer/install/auto" />
+				<embed id="graph" src="graph.php?ifnum=<?=$ifname;?>&ifname=<?=rawurlencode($ifname);?>&timeint=<?=$refreshinterval;?>&initdelay=<?=($graphcounter+1) * 2;?>" type="image/svg+xml" width="<?php echo $width; ?>" height="<?php echo $height; ?>" pluginspage="http://www.adobe.com/svg/viewer/install/auto" />
 			</div>
 		</div>
 	<?php }
diff --git a/usr/local/www/widgets/widgets/wake_on_lan.widget.php b/usr/local/www/widgets/widgets/wake_on_lan.widget.php
index 6639601..6deb74b 100644
--- a/usr/local/www/widgets/widgets/wake_on_lan.widget.php
+++ b/usr/local/www/widgets/widgets/wake_on_lan.widget.php
@@ -2,17 +2,17 @@
 /*
 	wake_on_lan.widget.php
 	Copyright (C) 2010 Yehuda Katz
-
+	
 	Redistribution and use in source and binary forms, with or without
 	modification, are permitted provided that the following conditions are met:
-
+	
 	1. Redistributions of source code must retain the above copyright notice,
 	this list of conditions and the following disclaimer.
-
+	
 	2. Redistributions in binary form must reproduce the above copyright
 	notice, this list of conditions and the following disclaimer in the
 	documentation and/or other materials provided with the distribution.
-
+	
 	THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES,
 	INClUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY
 	AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
@@ -50,7 +50,7 @@ if (count($wolcomputers) > 0) {
 	foreach($wolcomputers as $wolent) {
 		echo '<tr><td class="listlr">' . $wolent['descr'] . '<br />' . $wolent['mac'] . '</td>' . "\n";
 		echo '<td class="listr">' . convert_friendly_interface_to_friendly_descr($wolent['interface']) . '</td>' . "\n";
-
+		
 		$is_active = exec("/usr/sbin/arp -an |/usr/bin/grep {$wolent['mac']}| /usr/bin/wc -l|/usr/bin/awk '{print $1;}'");
 		if($is_active == 1) {
 			echo '<td class="listr" align="center">' . "\n";
diff --git a/usr/local/www/wizards/openvpn_wizard.inc b/usr/local/www/wizards/openvpn_wizard.inc
index a6ce0df..0637639 100644
--- a/usr/local/www/wizards/openvpn_wizard.inc
+++ b/usr/local/www/wizards/openvpn_wizard.inc
@@ -326,24 +326,6 @@ function step10_stepbeforeformdisplay() {
 				$opt['value'] = $name;
 			$pkg['step'][$stepid]['fields']['field'][$idx]['options']['option'][] = $opt;
 			}
-		} else if ($field['name'] == "digest") {
-			$pkg['step'][$stepid]['fields']['field'][$idx]['options']['option'] = array();
-			$digestlist = openvpn_get_digestlist();
-			foreach ($digestlist as $name => $desc) {
-				$opt = array();
-				$opt['name'] = $desc;
-				$opt['value'] = $name;
-			$pkg['step'][$stepid]['fields']['field'][$idx]['options']['option'][] = $opt;
-			}
-		} else if ($field['name'] == "compression") {
-			global $openvpn_compression_modes;
-			$pkg['step'][$stepid]['fields']['field'][$idx]['options']['option'] = array();
-			foreach ($openvpn_compression_modes as $name => $desc) {
-				$opt = array();
-				$opt['name'] = $desc;
-				$opt['value'] = $name;
-			$pkg['step'][$stepid]['fields']['field'][$idx]['options']['option'][] = $opt;
-			}
 		} else if ($field['name'] == "engine") {
 			$pkg['step'][$stepid]['fields']['field'][$idx]['options']['option'] = array();
 			$engines = openvpn_get_engines();
@@ -613,7 +595,6 @@ function step12_submitphpaction() {
 		$server['netbios_enable'] = $pconfig['step10']['nbtenable'];
 	}
 	$server['crypto'] = $pconfig['step10']['crypto'];
-	$server['digest'] = $pconfig['step10']['digest'];
 	$server['engine'] = $pconfig['step10']['engine'];
 
 	if (isset($pconfig['step11']['ovpnrule'])) {
diff --git a/usr/local/www/wizards/openvpn_wizard.xml b/usr/local/www/wizards/openvpn_wizard.xml
index d869c5b..66ecea9 100644
--- a/usr/local/www/wizards/openvpn_wizard.xml
+++ b/usr/local/www/wizards/openvpn_wizard.xml
@@ -692,20 +692,6 @@
 			<description>&lt;br/&gt;The method used to encrypt traffic between endpoints. This setting must match on the client and server side, but is otherwise set however you like. Certain algorithms will perform better on different hardware, depending on the availability of supported VPN accelerator chips.</description>
 		</field>
 		<field>
-			<name>digest</name>
-			<type>select</type>
-			<displayname>Auth Digest Algorithm</displayname>
-			<bindstofield>ovpnserver->step10->digest</bindstofield>
-			<options>
-				<option>
-					<name>dummy</name>
-					<value>dummy</value>
-				</option>
-			</options>
-			<value>SHA1</value>
-			<description>&lt;br/&gt;The method used to authenticate traffic between endpoints. This setting must match on the client and server side, but is otherwise set however you like.</description>
-		</field>
-		<field>
 			<name>engine</name>
 			<type>select</type>
 			<displayname>Hardware Crypto</displayname>
@@ -756,15 +742,9 @@
 		<field>
 			<displayname>Compression</displayname>
 			<name>compression</name>
-			<description>&lt;br/&gt;Compress tunnel packets using the LZO algorithm. Adaptive compression will dynamically disable compression for a period of time if OpenVPN detects that the data in the packets is not being compressed efficiently.</description>
+			<type>checkbox</type>
+			<description>Compress tunnel packets using the LZO algorithm.</description>
 			<bindstofield>ovpnserver->step10->compression</bindstofield>
-			<type>select</type>
-			<options>
-				<option>
-					<name>dummy</name>
-					<value>dummy</value>
-				</option>
-			</options>
 		</field>
 		<field>
 			<displayname>Type-of-Service</displayname>
diff --git a/usr/local/www/wizards/setup_wizard.xml b/usr/local/www/wizards/setup_wizard.xml
index daf32dd..85f1152 100644
--- a/usr/local/www/wizards/setup_wizard.xml
+++ b/usr/local/www/wizards/setup_wizard.xml
@@ -138,6 +138,8 @@
 			<description>Enter the hostname (FQDN) of the time server.</description>
 			<type>input</type>
 			<bindstofield>system->timeservers</bindstofield>
+			<validate>^[a-z0-9.|-]+$</validate>
+			<message>Invalid Time Server Field</message>
 		</field>
 		<field>
 			<name>Timezone</name>
@@ -151,11 +153,9 @@
 	</fields>
 	<stepsubmitphpaction>
 		<![CDATA[
-		foreach (explode(' ', $_POST['timeserverhostname']) as $ts) {
-			if (!is_domain($ts)) {
-				print_info_box_np(gettext("NTP Time Server names may only contain the characters a-z, 0-9, '-' and '.'. Entries may be separated by spaces. Please press back in your browser window and correct."));
-				die;
-			}
+		if(!empty($_POST['timeserverhostname']) && !(is_hostname($_POST['timeserverhostname']) || is_ipaddr($_POST['timeserverhostname']))) {
+			print_info_box_np("Invalid Time Server. Please press back in your browser window and correct.");
+			die;
 		}
 		]]>
 	</stepsubmitphpaction>
@@ -409,17 +409,9 @@
 			print_info_box_np("Invalid MAC Address. Please press back in your browser window and correct.");
 			die;
 		}
-		if(!empty($_POST['ipaddress']) && ($_POST['selectedtype'] == "Static")) {
-			if (!is_ipaddr($_POST['ipaddress'])) {
-				print_info_box_np("Invalid WAN IP Address. Please press back in your browser window and correct.");
-				die;
-			}
-			if ($_POST['subnetmask'] < 31 &&
-			    ($_POST['ipaddress'] == gen_subnet($_POST['ipaddress'], $_POST['subnetmask']) ||
-			     $_POST['ipaddress'] == gen_subnet_max($_POST['ipaddress'], $_POST['subnetmask']))) {
-				print_info_box_np("Invalid WAN IP Address. Please press back in your browser window and correct.");
-				die;
-			}
+		if(!empty($_POST['ipaddress']) && ($_POST['selectedtype'] == "Static") && (!is_ipaddr($_POST['ipaddress']))) {
+			print_info_box_np("Invalid WAN IP Address. Please press back in your browser window and correct.");
+			die;
 		}
 		if(!empty($_POST['dhcphostname']) && !is_hostname($_POST['dhcphostname'])) {
 			print_info_box_np("Invalid DHCP Hostname. Please press back in your browser window and correct.");
@@ -517,12 +509,6 @@
 			print_info_box_np("Invalid LAN IP Address. Please press back in your browser window and correct.");
 			die;
 		}
-		if ($_POST['subnetmask'] < 31 &&
-		    ($_POST['lanipaddress'] == gen_subnet($_POST['lanipaddress'], $_POST['subnetmask']) ||
-		     $_POST['lanipaddress'] == gen_subnet_max($_POST['lanipaddress'], $_POST['subnetmask']))) {
-			print_info_box_np("Invalid LAN IP Address. Please press back in your browser window and correct.");
-			die;
-		}
 		$ft = explode(".", $_POST['lanipaddress']);
 		$ft_ip = $ft[0] . "." . $ft[1] . "." . $ft[2] . ".";
 		$config['dhcpd']['lan']['range']['from'] = $ft_ip . "10";
diff --git a/usr/local/www/wizards/traffic_shaper_wizard.inc b/usr/local/www/wizards/traffic_shaper_wizard.inc
index 3520508..3b411c0 100644
--- a/usr/local/www/wizards/traffic_shaper_wizard.inc
+++ b/usr/local/www/wizards/traffic_shaper_wizard.inc
@@ -721,7 +721,7 @@ function apply_all_choosen_items() {
 				$tmpcf['bandwidthtype'] = "%";
 			}
 			array_push($tmppath, "qACK");
-			$qtmp =& $altq->add_queue($q, $tmpcf, $tmppath, $input_errors);
+			$qtmp =& $altq->add_queue($q, &$tmpcf, &$tmppath, $input_errors);
 			array_pop($tmppath);
 			//echo "qACK <br />";
 			//var_dump($input_errors);
@@ -752,7 +752,7 @@ function apply_all_choosen_items() {
 				$tmpcf['bandwidthtype'] = "%";
 			}
 			array_push($tmppath, $tmpcf['name']);
-			$qtmp =& $altq->add_queue($q, $tmpcf, $tmppath, $input_errors);
+			$qtmp =& $altq->add_queue($q, &$tmpcf, &$tmppath, $input_errors);
 			array_pop($tmppath);
 			//echo "qDefault <br />";
 			//var_dump($input_errors);
@@ -801,7 +801,7 @@ function apply_all_choosen_items() {
 					}
 				}
 				array_push($tmppath, "qP2P");
-				$qtmp =& $altq->add_queue($q, $tmpcf, $tmppath, $input_errors);
+				$qtmp =& $altq->add_queue($q, &$tmpcf, &$tmppath, $input_errors);
 				array_pop($tmppath);
 				//echo "qP2P <br />";
 				//var_dump($input_errors);
@@ -841,7 +841,7 @@ function apply_all_choosen_items() {
 					$tmpcf['bandwidthtype'] = "Kb";
 				}
 				array_push($tmppath, "qVoIP");
-				$qtmp =& $altq->add_queue($q, $tmpcf, $tmppath, $input_errors);
+				$qtmp =& $altq->add_queue($q, &$tmpcf, &$tmppath, $input_errors);
 				array_pop($tmppath);
 				//echo "qVoIP <br />";
 				//var_dump($input_errors);
@@ -872,7 +872,7 @@ function apply_all_choosen_items() {
 					$tmpcf['bandwidthtype'] = "%";
 				}
 				array_push($tmppath, "qGames");
-				$qtmp =& $altq->add_queue($q, $tmpcf, $tmppath, $input_errors);
+				$qtmp =& $altq->add_queue($q, &$tmpcf, &$tmppath, $input_errors);
 				array_pop($tmppath);
 				//echo "qGames <br />";
 				//var_dump($input_errors);
@@ -903,7 +903,7 @@ function apply_all_choosen_items() {
 					$tmpcf['bandwidthtype'] = "%";
 				}
 				array_push($tmppath, "qOthersHigh");
-				$qtmp =& $altq->add_queue($q, $tmpcf, $tmppath, $input_errors);
+				$qtmp =& $altq->add_queue($q, &$tmpcf, &$tmppath, $input_errors);
 				array_pop($tmppath);
 				//echo "qHigh <br />";
 				//var_dump($input_errors);
@@ -942,7 +942,7 @@ function apply_all_choosen_items() {
 					$tmpcf['linkshare'] = "on";
 				}
 				array_push($tmppath, "qOthersLow");
-				$qtmp =& $altq->add_queue($q, $tmpcf, $tmppath, $input_errors);
+				$qtmp =& $altq->add_queue($q, &$tmpcf, &$tmppath, $input_errors);
 				array_pop($tmppath);
 				//echo "qLow <br />";
 				//var_dump($input_errors);
@@ -1068,7 +1068,7 @@ function apply_all_choosen_items() {
 				$tmpcf['bandwidthtype'] = "%";
 			}
 			array_push($tmppath, $tmpcf['name']);
-			$qtmp =& $altq->add_queue($q, $tmpcf, $tmppath, $input_errors);
+			$qtmp =& $altq->add_queue($q, &$tmpcf, &$tmppath, $input_errors);
 			array_pop($tmppath);
 			//echo "qDefault <br />";
 			//var_dump($input_errors);
@@ -1098,7 +1098,7 @@ function apply_all_choosen_items() {
 				$tmpcf['bandwidthtype'] = "Kb";
 			}
 			array_push($tmppath, "qInternet");
-			$qtmp =& $altq->add_queue($q, $tmpcf, $tmppath, $input_errors);
+			$qtmp =& $altq->add_queue($q, &$tmpcf, &$tmppath, $input_errors);
 			//array_pop($tmppath);
 			//echo "qInternet <br />";
 			//var_dump($input_errors);
@@ -1129,7 +1129,7 @@ function apply_all_choosen_items() {
 			$tmpcf['bandwidthtype'] = "%";
 		}
 		array_push($tmppath, "qACK");
-		$qtmp =& $altq->add_queue($q, $tmpcf, $tmppath, $input_errors);
+		$qtmp =& $altq->add_queue($q, &$tmpcf, &$tmppath, $input_errors);
 		array_pop($tmppath);
 		//echo "qACK <br />";
 		//var_dump($input_errors);
@@ -1177,7 +1177,7 @@ function apply_all_choosen_items() {
 				}
 			}
 			array_push($tmppath, "qP2P");
-			$qtmp =& $altq->add_queue($q, $tmpcf, $tmppath, $input_errors);
+			$qtmp =& $altq->add_queue($q, &$tmpcf, &$tmppath, $input_errors);
 			array_pop($tmppath);
 			//echo "qP2P <br />";
 			//var_dump($input_errors);
@@ -1217,7 +1217,7 @@ function apply_all_choosen_items() {
 				$tmpcf['bandwidthtype'] = "Kb";
 			}
 			array_push($tmppath, "qVoIP");
-			$qtmp =& $altq->add_queue($q, $tmpcf, $tmppath, $input_errors);
+			$qtmp =& $altq->add_queue($q, &$tmpcf, &$tmppath, $input_errors);
 			array_pop($tmppath);
 			//echo "qVoIP <br />";
 			//var_dump($input_errors);
@@ -1248,7 +1248,7 @@ function apply_all_choosen_items() {
 				$tmpcf['bandwidthtype'] = "%";
 			}
 			array_push($tmppath, "qGames");
-			$qtmp =& $altq->add_queue($q, $tmpcf, $tmppath, $input_errors);
+			$qtmp =& $altq->add_queue($q, &$tmpcf, &$tmppath, $input_errors);
 			array_pop($tmppath);
 			//echo "qGames <br />";
 			//var_dump($input_errors);
@@ -1279,7 +1279,7 @@ function apply_all_choosen_items() {
 				$tmpcf['bandwidthtype'] = "%";
 			}
 			array_push($tmppath, "qOthersHigh");
-			$qtmp =& $altq->add_queue($q, $tmpcf, $tmppath, $input_errors);
+			$qtmp =& $altq->add_queue($q, &$tmpcf, &$tmppath, $input_errors);
 			array_pop($tmppath);
 			//echo "qHigh <br />";
 			//var_dump($input_errors);
@@ -1317,7 +1317,7 @@ function apply_all_choosen_items() {
 				$tmpcf['linkshare'] = "on";
 			}
 			array_push($tmppath, "qOthersLow");
-			$qtmp =& $altq->add_queue($q, $tmpcf, $tmppath, $input_errors);
+			$qtmp =& $altq->add_queue($q, &$tmpcf, &$tmppath, $input_errors);
 			array_pop($tmppath);
 			//echo "qLow <br />";
 			//var_dump($input_errors);
diff --git a/usr/local/www/wizards/traffic_shaper_wizard_dedicated.inc b/usr/local/www/wizards/traffic_shaper_wizard_dedicated.inc
index 875d0bb..b6bb470 100755
--- a/usr/local/www/wizards/traffic_shaper_wizard_dedicated.inc
+++ b/usr/local/www/wizards/traffic_shaper_wizard_dedicated.inc
@@ -750,7 +750,7 @@ function apply_all_choosen_items() {
                                 $tmpcf['bandwidthtype'] = $config['ezshaper']['step2']["conn{$i}uploadspeed"];
                         }
                         array_push($tmppath, "qInternet");
-                        $qtmp =& $altq->add_queue($q, $tmpcf, $tmppath, $input_errors);
+                        $qtmp =& $altq->add_queue($q, &$tmpcf, &$tmppath, $input_errors);
                         //array_pop($tmppath);
                         //echo "qInternet <br />";
                         //var_dump($input_errors);
@@ -782,7 +782,7 @@ function apply_all_choosen_items() {
 				$tmpcf['bandwidthtype'] = "%";
 			}
 			array_push($tmppath, "qACK");
-			$qtmp =& $altq->add_queue($q, $tmpcf, $tmppath, $input_errors);
+			$qtmp =& $altq->add_queue($q, &$tmpcf, &$tmppath, $input_errors);
 			array_pop($tmppath);
 			//echo "qACK <br />";
 			//var_dump($input_errors);
@@ -813,7 +813,7 @@ function apply_all_choosen_items() {
 				$tmpcf['bandwidthtype'] = "%";
 			}
 			array_push($tmppath, $tmpcf['name']);
-			$qtmp =& $altq->add_queue($q, $tmpcf, $tmppath, $input_errors);
+			$qtmp =& $altq->add_queue($q, &$tmpcf, &$tmppath, $input_errors);
 			array_pop($tmppath);
 			//echo "qDefault <br />";
 			//var_dump($input_errors);
@@ -862,7 +862,7 @@ function apply_all_choosen_items() {
 					}
 				}
 				array_push($tmppath, "qP2P");
-				$qtmp =& $altq->add_queue($q, $tmpcf, $tmppath, $input_errors);
+				$qtmp =& $altq->add_queue($q, &$tmpcf, &$tmppath, $input_errors);
 				array_pop($tmppath);
 				//echo "qP2P <br />";
 				//var_dump($input_errors);
@@ -902,7 +902,7 @@ function apply_all_choosen_items() {
 					$tmpcf['bandwidthtype'] = "Kb";
 				}
 				array_push($tmppath, "qVoIP");
-				$qtmp =& $altq->add_queue($q, $tmpcf, $tmppath, $input_errors);
+				$qtmp =& $altq->add_queue($q, &$tmpcf, &$tmppath, $input_errors);
 				array_pop($tmppath);
 				//echo "qVoIP <br />";
 				//var_dump($input_errors);
@@ -933,7 +933,7 @@ function apply_all_choosen_items() {
 					$tmpcf['bandwidthtype'] = "%";
 				}
 				array_push($tmppath, "qGames");
-				$qtmp =& $altq->add_queue($q, $tmpcf, $tmppath, $input_errors);
+				$qtmp =& $altq->add_queue($q, &$tmpcf, &$tmppath, $input_errors);
 				array_pop($tmppath);
 				//echo "qGames <br />";
 				//var_dump($input_errors);
@@ -964,7 +964,7 @@ function apply_all_choosen_items() {
 					$tmpcf['bandwidthtype'] = "%";
 				}
 				array_push($tmppath, "qOthersHigh");
-				$qtmp =& $altq->add_queue($q, $tmpcf, $tmppath, $input_errors);
+				$qtmp =& $altq->add_queue($q, &$tmpcf, &$tmppath, $input_errors);
 				array_pop($tmppath);
 				//echo "qHigh <br />";
 				//var_dump($input_errors);
@@ -1005,7 +1005,7 @@ function apply_all_choosen_items() {
 					$tmpcf['linkshare'] = "on";
 				}
 				array_push($tmppath, "qOthersLow");
-				$qtmp =& $altq->add_queue($q, $tmpcf, $tmppath, $input_errors);
+				$qtmp =& $altq->add_queue($q, &$tmpcf, &$tmppath, $input_errors);
 				array_pop($tmppath);
 				//echo "qLow <br />";
 				//var_dump($input_errors);
@@ -1133,7 +1133,7 @@ function apply_all_choosen_items() {
 				$tmpcf['bandwidthtype'] = "%";
 			}
 			array_push($tmppath, $tmpcf['name']);
-			$qtmp =& $altq->add_queue($q, $tmpcf, $tmppath, $input_errors);
+			$qtmp =& $altq->add_queue($q, &$tmpcf, &$tmppath, $input_errors);
 			array_pop($tmppath);
 			//echo "qDefault <br />";
 			//var_dump($input_errors);
@@ -1163,7 +1163,7 @@ function apply_all_choosen_items() {
                                 $tmpcf['bandwidthtype'] = $config['ezshaper']['step2']["conn{$i}downloadspeed"];
                         }
                         array_push($tmppath, "qInternet");
-                        $qtmp =& $altq->add_queue($q, $tmpcf, $tmppath, $input_errors);
+                        $qtmp =& $altq->add_queue($q, &$tmpcf, &$tmppath, $input_errors);
                         //array_pop($tmppath);
                         //echo "qInternet <br />";
                         //var_dump($input_errors);
@@ -1194,7 +1194,7 @@ function apply_all_choosen_items() {
 			$tmpcf['bandwidthtype'] = "%";
 		}
 		array_push($tmppath, "qACK");
-		$qtmp =& $altq->add_queue($q, $tmpcf, $tmppath, $input_errors);
+		$qtmp =& $altq->add_queue($q, &$tmpcf, &$tmppath, $input_errors);
 		array_pop($tmppath);
 		//echo "qACK $remainbw <br />";
 		//var_dump($input_errors);
@@ -1243,7 +1243,7 @@ function apply_all_choosen_items() {
 				}
 			}
 			array_push($tmppath, "qP2P");
-			$qtmp =& $altq->add_queue($q, $tmpcf, $tmppath, $input_errors);
+			$qtmp =& $altq->add_queue($q, &$tmpcf, &$tmppath, $input_errors);
 			array_pop($tmppath);
 			//echo "qP2P <br />";
 			//var_dump($input_errors);
@@ -1283,7 +1283,7 @@ function apply_all_choosen_items() {
 				$tmpcf['bandwidthtype'] = "Kb";
 			}
 			array_push($tmppath, "qVoIP");
-			$qtmp =& $altq->add_queue($q, $tmpcf, $tmppath, $input_errors);
+			$qtmp =& $altq->add_queue($q, &$tmpcf, &$tmppath, $input_errors);
 			array_pop($tmppath);
 			//echo "qVoIP <br />";
 			//var_dump($input_errors);
@@ -1314,7 +1314,7 @@ function apply_all_choosen_items() {
 				$tmpcf['bandwidthtype'] = "%";
 			}
 			array_push($tmppath, "qGames");
-			$qtmp =& $altq->add_queue($q, $tmpcf, $tmppath, $input_errors);
+			$qtmp =& $altq->add_queue($q, &$tmpcf, &$tmppath, $input_errors);
 			array_pop($tmppath);
 			//echo "qGames <br />";
 			//var_dump($input_errors);
@@ -1345,7 +1345,7 @@ function apply_all_choosen_items() {
 				$tmpcf['bandwidthtype'] = "%";
 			}
 			array_push($tmppath, "qOthersHigh");
-			$qtmp =& $altq->add_queue($q, $tmpcf, $tmppath, $input_errors);
+			$qtmp =& $altq->add_queue($q, &$tmpcf, &$tmppath, $input_errors);
 			array_pop($tmppath);
 			//echo "qHigh <br />";
 			//var_dump($input_errors);
@@ -1385,7 +1385,7 @@ function apply_all_choosen_items() {
 				$tmpcf['linkshare'] = "on";
 			}
 			array_push($tmppath, "qOthersLow");
-			$qtmp =& $altq->add_queue($q, $tmpcf, $tmppath, $input_errors);
+			$qtmp =& $altq->add_queue($q, &$tmpcf, &$tmppath, $input_errors);
 			array_pop($tmppath);
 			//echo "qLow <br />";
 			//var_dump($input_errors);
diff --git a/usr/local/www/wizards/traffic_shaper_wizard_multi_all.inc b/usr/local/www/wizards/traffic_shaper_wizard_multi_all.inc
index 977c2dd..f87ba4c 100755
--- a/usr/local/www/wizards/traffic_shaper_wizard_multi_all.inc
+++ b/usr/local/www/wizards/traffic_shaper_wizard_multi_all.inc
@@ -789,7 +789,7 @@ function apply_all_choosen_items() {
                                 $tmpcf['bandwidthtype'] = $config['ezshaper']['step2']["conn{$i}uploadspeed"];
                         }
                         array_push($tmppath, "qInternet");
-                        $qtmp =& $altq->add_queue($q, $tmpcf, $tmppath, $input_errors);
+                        $qtmp =& $altq->add_queue($q, &$tmpcf, &$tmppath, $input_errors);
                         //array_pop($tmppath);
                         //echo "qInternet <br />";
                         //var_dump($input_errors);
@@ -821,7 +821,7 @@ function apply_all_choosen_items() {
 				$tmpcf['bandwidthtype'] = "%";
 			}
 			array_push($tmppath, "qACK");
-			$qtmp =& $altq->add_queue($q, $tmpcf, $tmppath, $input_errors);
+			$qtmp =& $altq->add_queue($q, &$tmpcf, &$tmppath, $input_errors);
 			array_pop($tmppath);
 			//echo "qACK <br />";
 			//var_dump($input_errors);
@@ -852,7 +852,7 @@ function apply_all_choosen_items() {
 				$tmpcf['bandwidthtype'] = "%";
 			}
 			array_push($tmppath, $tmpcf['name']);
-			$qtmp =& $altq->add_queue($q, $tmpcf, $tmppath, $input_errors);
+			$qtmp =& $altq->add_queue($q, &$tmpcf, &$tmppath, $input_errors);
 			array_pop($tmppath);
 			//echo "qDefault <br />";
 			//var_dump($input_errors);
@@ -901,7 +901,7 @@ function apply_all_choosen_items() {
 					}
 				}
 				array_push($tmppath, "qP2P");
-				$qtmp =& $altq->add_queue($q, $tmpcf, $tmppath, $input_errors);
+				$qtmp =& $altq->add_queue($q, &$tmpcf, &$tmppath, $input_errors);
 				array_pop($tmppath);
 				//echo "qP2P <br />";
 				//var_dump($input_errors);
@@ -941,7 +941,7 @@ function apply_all_choosen_items() {
 					$tmpcf['bandwidthtype'] = "Kb";
 				}
 				array_push($tmppath, "qVoIP");
-				$qtmp =& $altq->add_queue($q, $tmpcf, $tmppath, $input_errors);
+				$qtmp =& $altq->add_queue($q, &$tmpcf, &$tmppath, $input_errors);
 				array_pop($tmppath);
 				//echo "qVoIP <br />";
 				//var_dump($input_errors);
@@ -972,7 +972,7 @@ function apply_all_choosen_items() {
 					$tmpcf['bandwidthtype'] = "%";
 				}
 				array_push($tmppath, "qGames");
-				$qtmp =& $altq->add_queue($q, $tmpcf, $tmppath, $input_errors);
+				$qtmp =& $altq->add_queue($q, &$tmpcf, &$tmppath, $input_errors);
 				array_pop($tmppath);
 				//echo "qGames <br />";
 				//var_dump($input_errors);
@@ -1003,7 +1003,7 @@ function apply_all_choosen_items() {
 					$tmpcf['bandwidthtype'] = "%";
 				}
 				array_push($tmppath, "qOthersHigh");
-				$qtmp =& $altq->add_queue($q, $tmpcf, $tmppath, $input_errors);
+				$qtmp =& $altq->add_queue($q, &$tmpcf, &$tmppath, $input_errors);
 				array_pop($tmppath);
 				//echo "qHigh <br />";
 				//var_dump($input_errors);
@@ -1044,7 +1044,7 @@ function apply_all_choosen_items() {
 					$tmpcf['linkshare'] = "on";
 				}
 				array_push($tmppath, "qOthersLow");
-				$qtmp =& $altq->add_queue($q, $tmpcf, $tmppath, $input_errors);
+				$qtmp =& $altq->add_queue($q, &$tmpcf, &$tmppath, $input_errors);
 				array_pop($tmppath);
 				//echo "qLow <br />";
 				//var_dump($input_errors);
@@ -1183,7 +1183,7 @@ function apply_all_choosen_items() {
 				$tmpcf['bandwidthtype'] = "%";
 			}
 			array_push($tmppath, $tmpcf['name']);
-			$qtmp =& $altq->add_queue($q, $tmpcf, $tmppath, $input_errors);
+			$qtmp =& $altq->add_queue($q, &$tmpcf, &$tmppath, $input_errors);
 			array_pop($tmppath);
 			//echo "qDefault <br />";
 			//var_dump($input_errors);
@@ -1213,7 +1213,7 @@ function apply_all_choosen_items() {
                                 $tmpcf['bandwidthtype'] = "Kb";
                         }
                         array_push($tmppath, "qInternet");
-                        $qtmp =& $altq->add_queue($q, $tmpcf, $tmppath, $input_errors);
+                        $qtmp =& $altq->add_queue($q, &$tmpcf, &$tmppath, $input_errors);
                         //array_pop($tmppath);
                         //echo "qInternet <br />";
                         //var_dump($input_errors);
@@ -1245,7 +1245,7 @@ function apply_all_choosen_items() {
 				$tmpcf['bandwidthtype'] = "%";
 			}
 			array_push($tmppath, "qACK");
-			$qtmp =& $altq->add_queue($q, $tmpcf, $tmppath, $input_errors);
+			$qtmp =& $altq->add_queue($q, &$tmpcf, &$tmppath, $input_errors);
 			array_pop($tmppath);
 			//echo "qACK <br />";
 			//var_dump($input_errors);
@@ -1294,7 +1294,7 @@ function apply_all_choosen_items() {
 					}
 				}
 				array_push($tmppath, "qP2P");
-				$qtmp =& $altq->add_queue($q, $tmpcf, $tmppath, $input_errors);
+				$qtmp =& $altq->add_queue($q, &$tmpcf, &$tmppath, $input_errors);
 				array_pop($tmppath);
 				//echo "qP2P <br />";
 				//var_dump($input_errors);
@@ -1334,7 +1334,7 @@ function apply_all_choosen_items() {
 					$tmpcf['bandwidthtype'] = "Kb";
 				}
 				array_push($tmppath, "qVoIP");
-				$qtmp =& $altq->add_queue($q, $tmpcf, $tmppath, $input_errors);
+				$qtmp =& $altq->add_queue($q, &$tmpcf, &$tmppath, $input_errors);
 				array_pop($tmppath);
 				//echo "qVoIP <br />";
 				//var_dump($input_errors);
@@ -1365,7 +1365,7 @@ function apply_all_choosen_items() {
 					$tmpcf['bandwidthtype'] = "%";
 				}
 				array_push($tmppath, "qGames");
-				$qtmp =& $altq->add_queue($q, $tmpcf, $tmppath, $input_errors);
+				$qtmp =& $altq->add_queue($q, &$tmpcf, &$tmppath, $input_errors);
 				array_pop($tmppath);
 				//echo "qGames <br />";
 				//var_dump($input_errors);
@@ -1396,7 +1396,7 @@ function apply_all_choosen_items() {
 					$tmpcf['bandwidthtype'] = "%";
 				}
 				array_push($tmppath, "qOthersHigh");
-				$qtmp =& $altq->add_queue($q, $tmpcf, $tmppath, $input_errors);
+				$qtmp =& $altq->add_queue($q, &$tmpcf, &$tmppath, $input_errors);
 				array_pop($tmppath);
 				//echo "qHigh <br />";
 				//var_dump($input_errors);
@@ -1437,7 +1437,7 @@ function apply_all_choosen_items() {
 					$tmpcf['linkshare'] = "on";
 				}
 				array_push($tmppath, "qOthersLow");
-				$qtmp =& $altq->add_queue($q, $tmpcf, $tmppath, $input_errors);
+				$qtmp =& $altq->add_queue($q, &$tmpcf, &$tmppath, $input_errors);
 				array_pop($tmppath);
 				//echo "qLow <br />";
 				//var_dump($input_errors);
diff --git a/usr/local/www/wizards/traffic_shaper_wizard_multi_lan.inc b/usr/local/www/wizards/traffic_shaper_wizard_multi_lan.inc
index 3d379b3..a8e7ec9 100644
--- a/usr/local/www/wizards/traffic_shaper_wizard_multi_lan.inc
+++ b/usr/local/www/wizards/traffic_shaper_wizard_multi_lan.inc
@@ -569,7 +569,7 @@ function apply_all_choosen_items() {
 				$tmpcf['bandwidthtype'] = "%";
 			}
 			array_push($tmppath, $tmpcf['name']);
-			$qtmp =& $altq->add_queue($q, $tmpcf, $tmppath, $input_errors);
+			$qtmp =& $altq->add_queue($q, &$tmpcf, &$tmppath, $input_errors);
 			array_pop($tmppath);
 			//echo "qDefault <br />";
 			//var_dump($input_errors);
@@ -601,7 +601,7 @@ function apply_all_choosen_items() {
 				$tmpcf['bandwidthtype'] = $config['ezshaper']['step2']["conndownloadspeed"];
 			}
 			array_push($tmppath, "qInternet");
-			$qtmp =& $altq->add_queue($q, $tmpcf, $tmppath, $input_errors);
+			$qtmp =& $altq->add_queue($q, &$tmpcf, &$tmppath, $input_errors);
 			//array_pop($tmppath);
 			//echo "qInternet <br />";
 			//var_dump($input_errors);
@@ -634,7 +634,7 @@ function apply_all_choosen_items() {
 			$tmpcf['bandwidthtype'] = "%";
 		}
 		array_push($tmppath, "qACK");
-		$qtmp =& $altq->add_queue($q, $tmpcf, $tmppath, $input_errors);
+		$qtmp =& $altq->add_queue($q, &$tmpcf, &$tmppath, $input_errors);
 		array_pop($tmppath);
 		//echo "qACK <br />";
 		//var_dump($input_errors);
@@ -683,7 +683,7 @@ function apply_all_choosen_items() {
 				}
 			}
 			array_push($tmppath, "qP2P");
-			$qtmp =& $altq->add_queue($q, $tmpcf, $tmppath, $input_errors);
+			$qtmp =& $altq->add_queue($q, &$tmpcf, &$tmppath, $input_errors);
 			array_pop($tmppath);
 			//echo "qP2P <br />";
 			//var_dump($input_errors);
@@ -723,7 +723,7 @@ function apply_all_choosen_items() {
 				$tmpcf['bandwidthtype'] = "Kb";
 			}
 			array_push($tmppath, "qVoIP");
-			$qtmp =& $altq->add_queue($q, $tmpcf, $tmppath, $input_errors);
+			$qtmp =& $altq->add_queue($q, &$tmpcf, &$tmppath, $input_errors);
 			array_pop($tmppath);
 			//echo "qVoIP <br />";
 			//var_dump($input_errors);
@@ -754,7 +754,7 @@ function apply_all_choosen_items() {
 				$tmpcf['bandwidthtype'] = "%";
 			}
 			array_push($tmppath, "qGames");
-			$qtmp =& $altq->add_queue($q, $tmpcf, $tmppath, $input_errors);
+			$qtmp =& $altq->add_queue($q, &$tmpcf, &$tmppath, $input_errors);
 			array_pop($tmppath);
 			//echo "qGames <br />";
 			//var_dump($input_errors);
@@ -785,7 +785,7 @@ function apply_all_choosen_items() {
 				$tmpcf['bandwidthtype'] = "%";
 			}
 			array_push($tmppath, "qOthersHigh");
-			$qtmp =& $altq->add_queue($q, $tmpcf, $tmppath, $input_errors);
+			$qtmp =& $altq->add_queue($q, &$tmpcf, &$tmppath, $input_errors);
 			array_pop($tmppath);
 			//echo "qHigh <br />";
 			//var_dump($input_errors);
@@ -824,7 +824,7 @@ function apply_all_choosen_items() {
 				$tmpcf['linkshare'] = "on";
 			}
 			array_push($tmppath, "qOthersLow");
-			$qtmp =& $altq->add_queue($q, $tmpcf, $tmppath, $input_errors);
+			$qtmp =& $altq->add_queue($q, &$tmpcf, &$tmppath, $input_errors);
 			array_pop($tmppath);
 			//echo "qLow <br />";
 			//var_dump($input_errors);
@@ -959,7 +959,7 @@ function apply_all_choosen_items() {
 			$tmpcf['bandwidthtype'] = "%";
 		}
 		array_push($tmppath, "qACK");
-		$qtmp =& $altq->add_queue($q, $tmpcf, $tmppath, $input_errors);
+		$qtmp =& $altq->add_queue($q, &$tmpcf, &$tmppath, $input_errors);
 		array_pop($tmppath);
 		//echo "$lkbw $remainbw qACK <br />";
 		//var_dump($input_errors);
@@ -991,7 +991,7 @@ function apply_all_choosen_items() {
 			$tmpcf['bandwidthtype'] = "%";
 		}
 		array_push($tmppath, $tmpcf['name']);
-		$qtmp =& $altq->add_queue($q, $tmpcf, $tmppath, $input_errors);
+		$qtmp =& $altq->add_queue($q, &$tmpcf, &$tmppath, $input_errors);
 		array_pop($tmppath);
 		//echo "qDefault <br />";
 		//var_dump($input_errors);
@@ -1040,7 +1040,7 @@ function apply_all_choosen_items() {
 				}
 			}
 			array_push($tmppath, "qP2P");
-			$qtmp =& $altq->add_queue($q, $tmpcf, $tmppath, $input_errors);
+			$qtmp =& $altq->add_queue($q, &$tmpcf, &$tmppath, $input_errors);
 			array_pop($tmppath);
 			//echo "qP2P <br />";
 			//var_dump($input_errors);
@@ -1080,7 +1080,7 @@ function apply_all_choosen_items() {
 				$tmpcf['bandwidthtype'] = "Kb";
 			}
 			array_push($tmppath, "qVoIP");
-			$qtmp =& $altq->add_queue($q, $tmpcf, $tmppath, $input_errors);
+			$qtmp =& $altq->add_queue($q, &$tmpcf, &$tmppath, $input_errors);
 			array_pop($tmppath);
 			//echo "qVoIP <br />";
 			//var_dump($input_errors);
@@ -1111,7 +1111,7 @@ function apply_all_choosen_items() {
 				$tmpcf['bandwidthtype'] = "%";
 			}
 			array_push($tmppath, "qGames");
-			$qtmp =& $altq->add_queue($q, $tmpcf, $tmppath, $input_errors);
+			$qtmp =& $altq->add_queue($q, &$tmpcf, &$tmppath, $input_errors);
 			array_pop($tmppath);
 			//echo "qGames <br />";
 			//var_dump($input_errors);
@@ -1142,7 +1142,7 @@ function apply_all_choosen_items() {
 				$tmpcf['bandwidthtype'] = "%";
 			}
 			array_push($tmppath, "qOthersHigh");
-			$qtmp =& $altq->add_queue($q, $tmpcf, $tmppath, $input_errors);
+			$qtmp =& $altq->add_queue($q, &$tmpcf, &$tmppath, $input_errors);
 			array_pop($tmppath);
 			//echo "qHigh <br />";
 			//var_dump($input_errors);
@@ -1181,7 +1181,7 @@ function apply_all_choosen_items() {
 				$tmpcf['linkshare'] = "on";
 			}
 			array_push($tmppath, "qOthersLow");
-			$qtmp =& $altq->add_queue($q, $tmpcf, $tmppath, $input_errors);
+			$qtmp =& $altq->add_queue($q, &$tmpcf, &$tmppath, $input_errors);
 			array_pop($tmppath);
 			//echo "qLow <br />";
 			//var_dump($input_errors);
diff --git a/usr/local/www/xmlrpc.php b/usr/local/www/xmlrpc.php
index 91f05e9..e011162 100755
--- a/usr/local/www/xmlrpc.php
+++ b/usr/local/www/xmlrpc.php
@@ -269,9 +269,8 @@ function restore_config_section_xmlrpc($raw_params) {
 		}
 		/* Cleanup remaining old carps */
 		foreach ($oldvips as $oldvipif => $oldvippar) {
-			$oldvipif = get_real_interface($oldvippar['interface']);
-			if (!empty($oldvipif))
-				pfSense_interface_deladdress($oldvipif, $oldvipar['subnet']);
+			if (!is_ipaddr($oldvipif) && does_interface_exist($oldvipif))
+					pfSense_interface_destroy($oldvipif);
 		}
 		if ($carp_setuped == true)
 			interfaces_carp_setup();
-- 
1.9.1

